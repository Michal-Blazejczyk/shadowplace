function mobileApp(a,b){return angular.element(document).injector().get("MobileApp").broadcast(a,b)}function adsApi(a,b){return angular.element(document).injector().get("AdsApi").broadcast(a,b)}function frameLoginSuccess(a){return angular.element(document).injector().get("Tools").frameLoginSuccess(a)}function frameLoginFailed(a){return angular.element(document).injector().get("Tools").frameLoginFailed(a)}angular.module("nxt-agreement",["nxt-webmail"]);var deps=["ui.router","ui.select","ngSanitize","angularFileUpload","ngProgressLite","ngTouch","ngCookies","nxt-framework","nxt-avatar","nxt-agreement","nxt-common","nxt-composition","nxt-contact","nxt-dialog","nxt-exception","nxt-external-account","nxt-filter","nxt-folder","nxt-message","nxt-navigation","nxt-notification","nxt-settings","nxt-slideshow","nxt-public-gallery","nxt-billing","nxt-change-password"];NXT_CONFIG.env.device.isPc?deps.push("ui.tinymce","ngAnimate"):deps.push("contenteditable"),angular.module("nxt-webmail",deps).config(["uiSelectConfig","$httpProvider","$compileProvider","$locationProvider",function(a,b,c,d){a.theme="selectize",a.searchEnabled=!1,d.hashPrefix(""),b.useApplyAsync(!0),c.debugInfoEnabled(!1),c.commentDirectivesEnabled(!1),c.cssClassDirectivesEnabled(!1)}]),NXT_CONFIG.env.isMobileApp,angular.module("nxt-avatar",["nxt-webmail","nxt-folder"]),angular.module("nxt-billing",["nxt-webmail"]),angular.module("nxt-change-password",["nxt-webmail","nxt-dialog"]),angular.module("nxt-common",[]),angular.module("nxt-composition",["nxt-webmail","nxt-common","nxt-contact","nxt-dialog","nxt-external-account","nxt-notification"]),angular.module("nxt-contact",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-filter","nxt-folder","nxt-notification"]),angular.module("nxt-crop",[]),angular.module("nxt-dialog",[]),angular.module("nxt-exception",["nxt-webmail"]),angular.module("nxt-external-account",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-filter",["nxt-webmail","nxt-notification"]),angular.module("nxt-folder",["nxt-webmail","nxt-common","nxt-composition","pickadate","nxt-dialog","nxt-external-account","nxt-message","nxt-notification"]),angular.module("nxt-framework",[]),angular.module("nxt-message",["nxt-webmail","nxt-common","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-navigation",["nxt-webmail","nxt-composition","nxt-dialog","nxt-folder","nxt-notification"]),angular.module("nxt-notification",[]),angular.module("nxt-public-gallery",["nxt-webmail","nxt-notification"]),angular.module("nxt-settings",["nxt-webmail","nxt-common","nxt-crop"]),angular.module("nxt-slideshow",["nxt-webmail","nxt-message"]),angular.module("nxt-webmail").config(["$provide","$httpProvider",function(a,b){"use strict";var c="/mails",d=c.length;a.factory("LoadingIndicatorInterceptor",["$q","$rootScope",function(a,b){return{request:function(a){return a&&a.url&&a.url.indexOf(c)===a.url.length-d&&b.$broadcast("loadingIndicator:folderLoading"),a},response:function(a){return a&&a.config&&a.config.url&&a.config.url.indexOf(c)===a.config.url.length-d&&b.$broadcast("loadingIndicator:folderLoaded"),a},responseError:function(e){return e&&e.config&&e.config.url&&e.config.url.indexOf(c)===e.config.url.length-d&&b.$broadcast("loadingIndicator:folderLoaded"),a.reject(e)}}}]),b.interceptors.push("LoadingIndicatorInterceptor")}]),angular.module("nxt-webmail").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("ProgressInterceptor",["$q","ngProgressLite","$location","ApplicationData",function(a,b,c,d){return{request:function(a){return a.url.indexOf(c.host())===-1||a.data&&"touch"===a.data.oper||(b.start(),d.setIsRequesting(!0)),a},response:function(a){return b.done(),d.setIsRequesting(!1),a},responseError:function(c){return b.done(),d.setIsRequesting(!1),a.reject(c)}}}]),b.interceptors.push("ProgressInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("BaseUrlInterceptor",["ApplicationConfig","$location",function(a,b){return{request:function(c){return c.url.indexOf(".html")!==-1?c.url=a.env.staticUrl+"/js"+c.url:c.url.indexOf("//")===-1&&(c.url=b.protocol()+"://"+b.host()+"/"+a.env.baseUrl+c.url),c}}}]),b.interceptors.push("BaseUrlInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("PlaceholderInterceptor",function(){return{request:function(a){var b=/:[a-z]+/gi;return a.params&&b.test(a.url)&&(a.url=a.url.replace(b,function(b){var c=b.substr(1),d=a.params[c];return d?(delete a.params[c],d):b})),a}}}),b.interceptors.push("PlaceholderInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("DefaultTransformationInterceptor",function(){return{request:function(a){return Array.isArray(a.transformRequest)||(a.transformRequest=[a.transformRequest].concat(b.defaults.transformRequest)),Array.isArray(a.transformResponse)||(a.transformResponse=b.defaults.transformResponse.concat(a.transformResponse)),a},response:function(a){return a.data&&"object"==typeof a.data&&("data"in a.data?a=a.data.data:"result"in a.data&&(a=a.data.result)),a}}}),b.interceptors.push("DefaultTransformationInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("PostInterceptor",function(){return{request:function(a){return"PUT"!==a.method&&"PATCH"!==a.method&&"DELETE"!==a.method||(a.headers["X-HTTP-Method-Override"]=a.method,a.method="POST"),a.headers["X-HTTP-Body-Format-Json"]?(a.headers["Content-Type"]="application/json",delete a.headers["X-HTTP-Body-Format-Json"]):"POST"===a.method&&(a.headers["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"),a}}}),b.interceptors.push("PostInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("XsrfInterceptor",["ApplicationConfig","$location",function(a,b){return{request:function(c){return c.url.indexOf(b.host())!==-1&&c.url.indexOf("tol.ag.warta.pl")===-1&&(c.headers["X-Requested-With"]="XMLHttpRequest",a.env.uid&&(c.headers["X-XSRF-TOKEN"]=a.env.uid)),c}}}]),b.interceptors.push("XsrfInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("CacheInterceptor",["ApplicationConfig",function(a){return{request:function(b){return void 0===b.cache&&(b.cache=!0,b.params=b.params||{},b.params.cacheTime=a.cacheTime),b},response:function(b){var c=b.config;return c&&"POST"===c.method&&c.headers["X-CACHE-IS-VALID"]!==!0&&(a.cacheTime=Date.now()),b}}}]),b.interceptors.push("CacheInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("SessionExpiredInterceptor",["$q","$rootScope",function(a,b){var c=0,d=function(a){a.data&&a.data.code===-101&&0===c&&(b.$broadcast("http:response:error:sessionExpired",a),NXT_CONFIG.blockRequest=!0,c++)};return{response:function(a){return d(a),a},responseError:function(b){return d(b),a.reject(b)}}}]),NXT_CONFIG.excludeSessionExpired||b.interceptors.push("SessionExpiredInterceptor")}]),angular.module("nxt-framework").config(["$provide","$httpProvider",function(a,b){"use strict";a.factory("ErrorInterceptor",["$q","$rootScope","$location","ApplicationConfig",function(a,b,c,d){return{response:function(c){if(c&&c.data){if(c.data.status===!1)return c.data.code!==-101?setTimeout(function(){d.env.isMobileApp&&c.data.isMobileAppPush?console.log("Error: "+JSON.stringify(c)):b.$broadcast("http:response:error",c)},0):c.data.code===-101&&b.$broadcast("http:response:error:sessionExpired",c),a.reject(c);if(c.data.result&&c.data.result.error)return b.$broadcast("http:response:error",c.data.result),a.reject(c)}return c},responseError:function(d){return d&&d.config&&d.config.url&&d.config.url.indexOf(c.host())!==-1&&(d.data&&d.data.code==-103?location.reload():b.$broadcast("http:response:error",d)),a.reject(d)}}}]),b.interceptors.push("ErrorInterceptor")}]),angular.module("nxt-agreement").provider("Agreement",function(){"use strict";this.$get=["$http","ApplicationConfig",function(a,b){var c=b.env.mailSettings;return{getAgreement:function(b){var d={id:b};return a.get(c+"/v1/agreements/:id",{params:d,withCredentials:!0,transformResponse:function(a){return a&&a.data&&a.data.agreements&&a.data.agreements[0].content.value?a.data.agreements[0].content.value:""}})},acceptAgreement:function(b){return a.post(c+"/v1/agreements/accept/"+b,{},{withCredentials:!0})}}}]}),angular.module("nxt-webmail").service("AdsApi",["$rootScope",function(a){"use strict";var b=1;this.broadcast=function(a,b){this[a]&&this[a](b)},this.createMessageAd=function(c){if(c){var d=c.type>b?"ads:create:fake-message":"ads:create:message";a.$broadcast(d,c)}},this.sitebrandingClick=function(b){b&&a.$broadcast("folderListScroll:resize",b)}}]),angular.module("nxt-webmail").provider("Bugtracker",function(){"use strict";var a,b=5,c={DEFAULT:1,CONNECTION_ERRORS:2,TOL_ERRORS:3},d="looped error: ",e=0;this.$get=["$http","ApplicationConfig",function(f,g){function h(a){return a&&a.indexOf("[ngRepeat:dupes]")!==-1?a.split("{",1)[0]:a}function i(a,b){var e={};return e.type=a.type?a.type:c.DEFAULT,e.location=location.href,e.userAgent=navigator.userAgent,a.exception&&(a.exception.stack&&(e.stack=a.exception.stack),a.exception.fileName&&(e.fileName=a.exception.fileName),a.exception.columnNumber&&(e.columnNumber=a.exception.columnNumber),a.exception.lineNumber&&(e.lineNumber=a.exception.lineNumber)),a.message=h(a.message),!e.stack&&a.message&&(e.stack="message: "+a.message.slice(0,1e3)),b?e.message=d+a.message:e.message=a.message,a.cause&&(e.cause=a.cause),e}return{send:function(c){if(c.message===a?e++:e=0,e<2){var d=i(c);a=c.message,g.env.dev?console.error("Bugtracker",d):f.post("/bugtracker",d)}if(e===b){var d=i(c,!0);g.env.dev?console.error("Bugtracker",d):f.post("/bugtracker",d)}}}}]}),angular.module("nxt-webmail").provider("ApplicationConfig",function(){"use strict";function a(){return NXT_CONFIG.env.sid}function b(){var b=a(),c=sessionStorage.getItem("nxtVisitCounter");return c&&(c=JSON.parse(c),c instanceof Object==!1&&(c={}),c[b])?c[b]:0}function c(b){var c=a(),d=sessionStorage.getItem("nxtVisitCounter");d?(d=JSON.parse(d),d instanceof Object==!1&&(d={})):d={},d.length||(d.length=0),d.length>10&&(d={},d.length=0),d[c]||d.length++,d[c]=b;try{sessionStorage.setItem("nxtVisitCounter",JSON.stringify(d))}catch(e){}}function d(){var a=navigator.userAgent,b=new RegExp(/AppleWebKit\/([\d.]+)/),c=b.exec(a),d=null===c?null:parseFloat(b.exec(a)[1]),e=new RegExp(/Chrome\/([\d.]+)/),f=e.exec(a),g=null===f?null:parseFloat(e.exec(a)[1]),h=null!==d&&d<537||null!==g&&g<37;return h&&angular.element(document.body).addClass("isAndroidBrowser"),h}function e(){var a=navigator.userAgent.toLowerCase(),b=a.match(/android\s([0-9\.]*)/);return!!b&&b[1]}function f(){if(!h)try{var a="";MobileAppConnector&&MobileAppConnector.getNativeAppIdent&&(a=MobileAppConnector.getNativeAppIdent(),a=a.split(":")[1]),h=a}catch(b){console.log("Only to use in mobileApp")}return h}function g(){var a=!l.hacks.isIOS&&f()>1400020716;return NXT_CONFIG.env.device.isMobileApp&&a}var h,i="stary_next",j=0,k=!1;NXT_CONFIG.blockRequest=!1,NXT_CONFIG.isMessageScaleUp=!1,NXT_CONFIG.isInitInfoboardDisplay=!1,NXT_CONFIG.isAlreadyInit=!1;var l={folders:{INBOX:1,SENT:2,DRAFTS:-1,TRASH:3,SPAM:-2,MAILINGI:2147482647},keyCodes:{SEMICOLON:186,COMMA:188,SPACE:32,NEWLINE:13,BACKSPACE:8,ARROW_DOWN:40,ARROW_UP:38,TAB:9},patterns:{email:/^(([^<>()[\]\\.,;:\s@\']+(\.[^<>()[\]\\.,;:\s@\']+)*)|(\'.+\'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,phone:/^(\+48\.)?\d{9}$/,specialChars:/^[^\/\\:*?'<>|'%]+$/,date:/^[0-9]{4}-(?:0[0-9]{1}|1[0-2]{1})-(?:[0-2]{1}[0-9]{1}||3[0-1]{1})$/},hacks:{isIpad:"iPad"===navigator.platform,isIOS:angular.element(document.querySelector("body")).hasClass("isIOS"),isIE:angular.element(document.querySelector("body")).hasClass("isIE"),isPcIE:!!navigator.userAgent.match(/Trident\/7\./),isEdge:navigator.userAgent.indexOf("Edge")>-1,isAndroid:navigator.userAgent.indexOf("Mozilla/5.0")>-1&&navigator.userAgent.indexOf("Android ")>-1&&navigator.userAgent.indexOf("AppleWebKit")>-1,isFirefox:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isChrome:navigator.userAgent.toLowerCase().indexOf("chrome")>-1,isWindowsPhoneOS:/Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;/g.test(navigator.userAgent),isOpera:navigator.userAgent.match(/Opera|OPR\//)},boardStates:{BOARD_STATE_SHOW:1,BOARD_STATE_ACCEPT:16},cacheTime:Date.now(),visitCounter:b(),modulesConfig:[]};angular.forEach(l.folders,function(a){l.maxSystemFolderId=a>l.maxSystemFolderId?a:l.maxSystemFolderId}),l.hacks.isIpad&&(l.hacks.iosVersion=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1),l.hacks.isFirefox&&angular.element(document.body).addClass("isFirefox"),l.hacks.isAndroid&&(l.hacks.isAndroidDefault=d(),l.hacks.AndroidVersion=parseFloat(e())),l=angular.extend(l,NXT_CONFIG),l.ContactKeys={ID:0,AVATAR:1,EMAIL:2,NAME:3,SCORE:4,TYPE:5,GROUPS:6},l.ADMIN_BUSINESS_TYPE={FREE:0,ADMIN:1,SUBACCOUNT:2};for(var m in l.ContactKeys)l.ContactKeys.hasOwnProperty(m)&&l.ContactKeys[m]>j&&(j=l.ContactKeys[m]);j++,l.isShowAdDescription=NXT_CONFIG.env.advKeyword.indexOf(i)!==-1&&1!==NXT_CONFIG.env.accountType,"WORDS,IS_HIDDEN,IS_FORCED_HIDDEN,SORT_NAME,IS_READONLY,IS_ON_BLACKLIST,EMAILS,PHONES,NOTE".split(",").forEach(function(a,b){l.ContactKeys[a]=j+b}),l.incrementSessionVisits=function(){c(++l.visitCounter)},l.getConfigAppModule=function(a){if(!l.modulesConfig[a]){var b;l.configApplicationModule.forEach(function(c){if(c.name==a){var d=[];c.actions&&c.actions.forEach(function(a){"false"==a.allow?d[a.name]=!1:d[a.name]=!0}),c.actions=d,b=c}}),l.modulesConfig[a]=b}return l.modulesConfig[a]},l.hasBillingFolderSetting=function(){var a=NXT_CONFIG.env.device.isMobileApp;return k=NXT_CONFIG.env.hasBillingFolder&&(!a||g())},l.isBillingEnabled=function(){var a=NXT_CONFIG.env.device.isMobileApp;return NXT_CONFIG.env.billing.enabled&&0!==NXT_CONFIG.env.billing.status&&(!a||g())},l.showBillingFolder=function(){return l.hasBillingFolderSetting()||l.isBillingEnabled()},l.hasBillingFolder=function(){return k},l.setHasBillingFolder=function(a){k=a},l.getMobileAppVersion=f,function(){var a=l.getConfigAppModule("links")&&l.getConfigAppModule("links").data.links;a&&(l.links=[],a.map(function(a){var b=a.name;delete a.name,l.links[b]=a}))}(),l.aliasDomains=[],function(){angular.forEach(l.signatures,function(a,b){a.id=parseInt(b,10)})}(),this.$get=function(){return l}}),angular.module("nxt-webmail").provider("ApplicationData",["$cacheFactoryProvider","ApplicationConfigProvider",function(a,b){"use strict";var c,d,e=b.$get(),f=a.$get(),g=f("nxt"),h=!1;for(var i in NXT_INIT_DATA)NXT_INIT_DATA.hasOwnProperty(i)&&(g.put(i[0].toUpperCase()+i.substr(1),{time:e.cacheTime,data:NXT_INIT_DATA[i]}),"theme"===i&&(c=NXT_INIT_DATA[i].filter(function(a){return"2"===a.type})));var j=[],k=[];g.MESSAGE_OPERATION_LIMIT=1e3,g.isFrozen=function(a){return a=parseInt(a,10),j.indexOf(a)!==-1},g.freeze=function(a){return a=parseInt(a,10),j.push(a)},g.unfreeze=function(a){return a=parseInt(a,10),j=j.filter(function(b){return b!=a})},g.getUserSkinMainObject=function(a){return c.filter(function(b){return b.id===a})},g.getIsRequesting=function(){return h},g.setIsRequesting=function(a){h=a},g.putBroadcast=function(a,b){g.put(a,b),d.$broadcast("applicationData:put:"+a.toLowerCase())},this.$get=["$injector",function(a){return d=a.get("$rootScope"),g}],g.putDragMessage=function(a){return k.push(a),k},g.getDragMessage=function(){return k[0]},g.deleteDragMessage=function(){k=[]}}]),angular.module("nxt-webmail").provider("LongPoll",function(){"use strict";function a(a){var b=Date.now()/1e3,c=360;return a>=b-c}function b(a){return a>=10?a:"0"+a.toString()}function c(a){a.paymentDate*=1e3;var c=new Date(a.paymentDate);return{msgId:a.fileName.split(";")[1],afterDeadline:Date.now()>a.paymentDate?1:0,cost:a.amount,date:b(c.getDate())+"."+b(c.getMonth())+"."+c.getFullYear(),pname:a.fileName,state:a.status,isPaid:a.isPaid}}var d,e,f="newMg",g="PushId not exist",h="revisionMismatch",i="Error",j="newBill",k=1210,l=3e5,m=5,n=3e4,o=0,p=0,q=36e5;this.$get=["ApplicationConfig","$http","$rootScope","$q","$timeout","Notification","DialogManager","Bugtracker",function(b,r,s,t,u,v,w,x){function y(a){(a||p&&p<Date.now()-q)&&(s.$broadcast("folder:refresh"),p=Date.now())}return{isConnnected:!1,errorCounter:0,firstErrorTimestamp:null,connect:function(a){this.isConnnected||NXT_CONFIG.blockRequest||(y(a),d&&u.cancel(d),o=t.defer(),r.get(b.env.longPollUrl,{timeout:o.promise,params:{PUSHID:b.env.pushId,revision:b.env.revision,d:Date.now()}}).then(this.success.bind(this),this.error.bind(this)),this.isConnnected=!0,d=u(function(){o.resolve()},l))},disconnect:function(){this.isConnnected=!1,0!==o&&o.resolve(),d&&u.cancel(d)},success:function(d){d=d.data,this.isConnnected=!1,b.env.revision=void 0,d.event===g?this.getPushId().then(this.connect.bind(this)):d.event==i?d.errCode==k?(w.sessionExpiredDialog({message:"Sesja wygasła"}),NXT_CONFIG.blockRequest=!0,this.disconnect()):(x.send({type:3,message:"longPoll Error:"+JSON.stringify(d)}),this.error()):(this.errorCounter=0,d.event===f?(b.cacheTime=Date.now(),b.env.revision=d.currentRevision,d.inLastHour=a(d.rawDate),s.$broadcast("service:longpoll:success",d)):d.event===j&&s.$broadcast("service:longpoll:billing",c(d)),this.connect(d.event===h))},error:function(){this.isConnnected=!1,this.hasExceededErrorLimit()?(this.errorCounter=0,e&&clearTimeout(e),e=setTimeout(this.connect.bind(this),n)):(this.connect(),this.errorCounter++,1===this.errorCounter&&(this.firstErrorTimestamp=Date.now()))},hasExceededErrorLimit:function(){return this.errorCounter>=m},getPushId:function(){return r.get("/getpushid",{cache:!1}).then(function(a){b.env.pushId=a})}}}]}),angular.module("nxt-webmail").provider("ApplicationMessage",function(){"use strict";var a={1014:{title:"Operacja niedostępna",message:"Operacja niedostępna"}},b={"service:contact:delete":"Kontakt został usunięty.","service:contacts:delete":"Kontakty zostały usunięte.","service:contact:save":"Kontakt został dodany.","service:contact:edit":"Zmiany zostały zapisane.","service:contact:save:specialContact":"Kontakt o podanym adresie e-mail już istnieje.","service:contacts:import:succes":"Kontakty zostały zaimportowane.","service:message:move":"Wiadomość została przeniesiona do folderu %s%.","service:messages:move":"Przeniesiono %s% wiadomości do folderu %s%.","service:thread:move":"Wątek został przeniesiony do folderu %s%.","service:threads:move":"Przeniesiono %s% %s% do folderu %s%.","service:folder:delete":"Folder został opróżniony.","service:thread:move-to-trash":"Wątek został przeniesiony do kosza.","service:threads:move-to-trash":"Przeniesiono %s% %s% do kosza.","service:message:move-to-trash":"Wiadomość została przeniesiona do kosza.","service:messages:move-to-trash":"Przeniesiono %s% wiadomości do kosza.","service:message:delete":"Wiadomość została usunięta.","service:messages:delete":"%s% wiadomości zostały usunięte.","external-account:service:deleteAlias":"Alias został usunięty.","external-account:service:deleteAccount":"Konto zewnętrzne zostało usunięte.","external-account::noactive":"Wystąpił problem z obsługą konta. Sprawdź ustawienia i spróbuj ponownie za kilka minut.","external-account:service:add":"Dodatkowy adres został dodany.","external-account:service:save":"Zmiany zostały zapisane.","external-account:service:edit":'%s% <a ng-click="callback()">Sprawdź »</a>',"filtr:service:quickCreate":"Filtr został dodany.","filtr:service:quickUpdate":"Zmiany zostały zapisane.","composition:message-sent":"Wiadomość wysłana","composition:message-saved":"Wiadomość zapisana w folderze Robocze","composition:signature-saved":"Nowy podpis został zapisany.","composition:no-recipients":"Wpisz odbiorców!","composition:sending-error":"Nie udało się wysłać wiadomości","composition:saving-error":"Nie udało się zapisać wiadomości","composition:empty-signature":"Wpisz treść podpisu!","composition:empty-signature-name":"Podaj nazwę!","composition:saving-signature-error":"Nie udało się zapisać podpisu.","composition:add-attachment-error":"Nie udało się dodać załącznika","composition:add-attachment-error-reasone":"Nie udało się dodać załącznika: %s%","composition:add-attachment-error-bug-external-app":"Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.","composition:add-attachment-error-bug-external-app-int":'Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.<br>Zachęcamy do skorzystania z aplikacji <a ng-click="callback()">INT Poczta</a>',"composition:add-attachment-error-bug-external-app-next":'Załącznik nie został dodany - błąd po stronie zewnętrznej aplikacji.<br>Zachęcamy do skorzystania z aplikacji <a ng-click="callback()">Nowa Poczta Interia</a>',"uploader:all-attachments-removed":"Załączniki zostały usunięte.","uploader:all-attachments-added":"Załączniki zostały dodane.","uploader:adding-attachments":"Dodawanie załączników","uploader:theme-added":"Nowa skórka została dodana.","uploader:theme-size-exceeded":"Wgrywane zdjęcie jest za duże, maksymalny rozmiar to 10 MB.","uploader:avatar-size-exceeded":"Wgrywane zdjęcie jest za duże, maksymalny rozmiar to 10 MB.","uploader:theme-other-error":"Coś poszło nie tak z ustawianiem własnej skórki.","uploader:theme-token-error":"Błąd tokena. Proszę odświeżyć stronę.","uploader:avatar-other-error":"Coś poszło nie tak z ustawianiem awataru.","message:sender-marked-as-trusted":"Dodano adres do listy zaufanych nadawców.","message:thread-error":"Wystąpił błąd podczas pobierania wątku.","security:saved-success":"Informacje zostały zapisane","marketingData:saved-success":"Informacje zostały zapisane","marketingData:validate-error":"Wybierz jedną z opcji","personalData:validate-birthday-error":"Uzupełnij poprawnie datę urodzenia"},c=function(a,c,d){var e="";if(b[c])return e=d,a.replace(/%s%/g,function(){return e.shift()})};this.$get=function(){return{list:function(){return b},get:function(a,d){var e=b[a];return d?c(e,a,d):b[a]},getOptions:function(b){return a[b]}}}}),angular.module("nxt-webmail").service("MobileApp",["$rootScope","$state","Compositions","Message","Folder","Notification","ApplicationConfig","DialogManager","$stateParams","Bugtracker","ScopeService","Http","MobilePush","Security",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){h.isCompositionOpen()&&k.safeApply(a,function(){a.$broadcast("directive:dialog:close-composition")})}function p(a,b){m.register(a).then(function(c){c||b===!0||p(a,!0)},function(){b!==!0&&p(a,!0)})}function q(a){v||MobileAppConnector.logoutStatus(a)}function r(){var a="";return MobileAppConnector&&MobileAppConnector.getNativeAppIdent&&(a=MobileAppConnector.getNativeAppIdent(),a=a.split(":")[1]),a}function s(a){var b=0,c=setInterval(function(){b>20&&(a.scrollTop=0),0!==a.scrollTop?(a.scrollTop=a.scrollTop-90,b++):clearInterval(c)},10)}function t(b){a.$broadcast("composition:set-data",b)}var u="1400020300";if(NXT_CONFIG.env.isMobileApp){var v=g.hacks.isIOS;this.broadcast=function(a,b){this[a]&&this[a](b)},this.addExternalAccount=function(){"abstract"==b.current.parent?b.go(".external-account.configure"):b.go("^.external-account.configure")},this.scrollTop=function(){var a=document.querySelector(".msglist-container"),b=document.querySelector(".message-section-container"),c=document.querySelector(".section--navigation");s(c?document.querySelector(".navigation--main"):i.messageId?b:a)},this.newComposition=function(b){o(),k.safeApply(a,function(){c.addComposition(b)})},this.finishUpload=function(b){function c(a){var b,c=a.slice(-2);return a=a.slice(0,-2),a=a.replace(",","."),b="MB"==c?1024*a*1024:1024*a,b=parseInt(b),d+=b,b}for(var d=0,e=[],g=0;g<b.attach.list.length;g++){var h=b.attach.list[g];h.status?e.push({index:h.index,name:h.name,size:c(h.size),mpid:h.index}):(k.safeApply(a,function(){f.error("Wystąpił błąd podczas dodawania załącznika")}),j.send({message:"Dodawanie załącznika mobile error: "+JSON.stringify(h)}))}var i={attach:{list:e,totalSize:d}};a.$broadcast("composition:add:attachment",i)},this.openMessage=function(b){o(),a.$broadcast("isapp:message:open",b),g.cacheTime=Date.now(),a.$broadcast("folder:refresh")},this.newMessages=function(b){console.log("Run newMessages function"),i.search||a.$broadcast("isapp:message:pop",b)},this.setCompositionTitle=function(a){t({value:a,field:"subject"})},this.setCompositionContent=function(a){t({value:a,field:"content"})},this.setCompositionRecipient=function(b){var c={email:b,isAnimationEnabled:!1,isNewlyAdded:!1,name:null,id:null,type:null,isHighlighted:!1};a.$broadcast("composition:validateAddContact",{contact:c,listName:"to"})},this.sendMail=function(){a.$broadcast("composition:send-mail")},this.openFolderList=function(){o(),b.go(".navigation"),a.$broadcast("folder:refresh")},this.enableAutosave=function(){a.$broadcast("composition:enableAutosave")},this.openFolder=function(c){o(),e.get({id:c}).then(function(d){null!==d&&(c==b.params.folderId&&a.$broadcast("folder:refresh"),b.go("folder",{folderId:c}))})},this.reply=function(b){o(),d.get({id:b,leaveAsUnread:!0}).then(function(d){c.addComposition({opt:"ra",mesg:b,to:d.replyTo||d.from,envelopeTo:d.envelopeTo,originalRecipients:d.originalRecipients,senderConfig:d.senderConfig,isReplyingToSingle:!0}),a.$broadcast("folder:refresh")})},this.deleteMessage=function(b){o(),d.get({id:b}).then(function(b){d.moveToFolder(3,b),b.folderId==i.folderId&&a.$broadcast("folder:refresh")})},this.sync=function(a,b){try{!v&&r()>=1400020613&&MobileAppConnector.sync(a,angular.toJson(b))}catch(c){console.log("Only to use in mobileApp")}},this.showSettings=function(){b.go("^");try{v?window.webkit.messageHandlers.showSettings.postMessage("show app Settings"):MobileAppConnector.showSettings()}catch(a){console.log("Only to use in mobileApp")}},this.logout=function(){try{v?window.webkit.messageHandlers.logout.postMessage("Logout"):MobileAppConnector.logout()}catch(a){console.log("Only to use in mobileApp")}},this.refreshFolder=function(){try{v?window.webkit.messageHandlers.refreshFolder.postMessage("refreshFolder"):MobileAppConnector.refreshFolder()}catch(a){console.log("Only to use in mobileApp - refreshFolder")}},this.refreshCurrentFolder=function(){l.ping().then(function(){a.$broadcast("folder:refresh"),a.$broadcast("controller:folder:seen",i.folderId)},function(){f.error("Brak połączenia z Internetem. Aktualizacja listy nie powiodła się.")})},this.sessionExpired=function(){try{v?window.webkit.messageHandlers.sessionExpired.postMessage("sessionExpired"):MobileAppConnector.sessionExpired()}catch(a){console.log("Only to use in mobileApp - sessionExpired")}},this.onNativeBackClick=function(){var c="folder"===b.current.name,d="message"===b.current.name;if(h.isCompositionOpen())o();else if(g.isSearchExpanded&&!d)a.$broadcast("directive:search:close");else if(a.isAnyMessageChecked)k.safeApply(a,function(){a.$broadcast("isapp:message-list:clear-selection")});else if(null!=i.filter)b.go("folder",{folderId:i.folderId,filter:"all"}),a.$broadcast("folder:refresh",{filter:"all"});else if(null!==i.search&&d)b.go("^");else if(null!=i.search)b.go("folder",{folderId:i.folderId,search:null});else if(1!=i.folderId&&c)b.go("folder",{folderId:1});else try{b.go("^")}catch(e){try{b.go("^.^")}catch(f){MobileAppConnector.appClose()}}},this.connectionError=function(){try{v?window.webkit.messageHandlers.connectionError.postMessage("connectionError"):MobileAppConnector.connectionError()}catch(a){console.log("Only to use in mobileApp - connection error")}},this.onSwipeLeft=function(){NXT_CONFIG.isMessageScaleUp||"/slideshow"==b.current.url||a.$broadcast("message:open-message:prev-next","next")},this.onSwipeRight=function(){NXT_CONFIG.isMessageScaleUp||"/slideshow"==b.current.url||a.$broadcast("message:open-message:prev-next","prev")},this.onUnreadCountChange=function(a){try{v||MobileAppConnector.onUnreadCountChange(a)}catch(b){console.log("Only to use in mobileApp - counter change")}},this.renderReady=function(){try{if(v)window.webkit.messageHandlers.renderReady.postMessage(g.env.accountType);else{var a=r();a&&a>u&&"next"===g.env.service.name?MobileAppConnector.renderReady(g.env.accountType):MobileAppConnector.renderReady()}}catch(b){console.log("Only to use in mobileApp - renderReady"+b)}},this.setRODOparam=function(b){a.$broadcast("isapp:adv:rodo",b),window.rodoApiStatusPocztaMobileAndPremium=b;var c=["trackEvent","rodo","skrypt","zaladowany",{rodo:b}];"undefined"!=typeof iwa?iwa(c[0],c[1],c[2],c[3],c[4]):__iwa.push(c)},this.registerMobileDevice=p,this.logoutWebmail=function(a){m.unregister(a).then(function(a){var b=a||!1;return b?void n.logout().then(function(a){b=a||!1,q(b)},function(){q(!1)}):void q(!1)},function(){q(!1)})}}}]),angular.module("nxt-webmail").service("ScopeService",function(){"use strict";return{safeApply:function(a,b){if(a.$root){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$apply(b)}else a.$apply(b)}}}),angular.module("nxt-webmail").service("ServiceWorker",["$http","ApplicationConfig","Track","$rootScope",function(a,b,c,d){"use strict";function e(){return new Promise(function(a,b){var c=indexedDB.open(F,G);c.onsuccess=function(){s=this.result,a(c.result)},c.onerror=function(a){console.error("openDb:",a.target.errorCode),b(c.error)},c.onupgradeneeded=function(a){a.currentTarget.result.createObjectStore(H,{autoIncrement:!0})}})}function f(a,b){var c=s.transaction(a,b);return c.objectStore(a)}function g(a,b){return new Promise(function(c,d){var e=f(H,"readwrite"),g={};try{v&&console.log("indexedDB put",a,b),g=e.put(b,a)}catch(h){console.log(h),d(g.error)}g.onsuccess=function(){c(g.result)},g.onerror=function(){d(g.error)}})}function h(a){return new Promise(function(b,c){var d=f(H),e=d.get(a);return e.onsuccess=function(){b(e.result)},e.onerror=function(){console.error("get error",this.error),c(e.error)},e})}function i(b){b=JSON.parse(JSON.stringify(b));var c=angular.copy(z).map(function(a){return a.status=a.status?1:0,a});return a.post("/webpush",{subscription:{url:b.endpoint,authKey:b.keys.p256dh,authKeySecond:b.keys.auth},folders:c})}function j(){return new Promise(function(a,b){var c=Notification.requestPermission(function(b){a(b)});c&&c.then(a,b)})}function k(a){return a.pushManager.permissionState({userVisibleOnly:!0})}function l(a,b){return v&&console.log("prepareSubscription",a,"isNewUser:"+b),a.pushManager.getSubscription().then(function(c){function d(a){for(var b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);return e}if(b)v&&console.log("subscription to unsc",c),c&&c.unsubscribe();else if(c)return c;return v&&console.log("new subscription"),x=!0,a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:d(u)})}).then(function(a){v&&(console.log("subscription",a),console.log("subscription JSON",JSON.stringify(a))),B=!0,(x||b)&&(v&&console.log("register New Subscription"),i(a))})}function m(a){v&&console.log("registerServiceWorker"),navigator.serviceWorker.register(A).then(function(e){v&&console.log("register serviceWorker success",e),window.addEventListener("focus",function(){var a=new BroadcastChannel("push");a.postMessage({type:"window:focus"})}),"ds"===b.env.name&&e.update(),h("version").then(function(a){v&&console.log("aktualna wersja service workera",a),(void 0===a||t>a)&&(v&&console.log("updatuje serviceWorker na",t),g("version",t),e.update())}),k(e).then(function(b){
y=b,v&&console.log("permissionState",y),"granted"===b&&l(e,a),"prompt"===b&&(c.pushIWACode("pushPromptView"),NXT_CONFIG.isInitInfoboardDisplay||E||(E=!0,d.$broadcast("infoboard:push-prompt")),j().then(function(b){v&&console.log("permissionResult",b),"default"===b&&(D=!0,c.pushIWACode("pushPromptClose")),"granted"===b&&(y=b,l(e,a),c.pushIWACode("pushPromptAllow")),"denied"===b&&(y=b,c.pushIWACode("pushPromptDeny"))}))})})["catch"](function(a){v&&console.log("Service worker registration failed:",a)})}function n(){navigator.serviceWorker.register(A).then(function(a){a.unregister().then(function(a){a&&v&&console.log("UnregisterServiceWorker successfull")})})["catch"](function(a){v&&console.log("Service worker unregister failed:",a)})}function o(){return a.get("/webpush",{params:{method:"folders"},transformResponse:function(a){return a&&a.data&&Array.isArray(a.data)?(a.data=a.data.map(function(a){return a.status=!!a.status,a}),a):[]}})}function p(b){z=b;var c=angular.copy(b).map(function(a){return a.status=a.status?1:0,a});a.put("/webpush?method=folders",{folders:c})}function q(){for(var a=0;a<z.length;a++)if(z[a].status)return!0;return!1}function r(){navigator.serviceWorker.addEventListener("message",function(a){v&&console.log("postMessage:message",a),a.data&&"redirectTo"===a.data.type&&(window.location.href=a.data.url)})}var s,t=12,u="BPxPXc13zCHA2QbPVw17tcQCQ-UwJ6TB9HNW8bHt_ZZUx7-VD0r3yyVFDvYx17Rra0sSUa6h4wNPlLauvzBKAKU=",v="prod"!==b.env.name,w=b.env.ownEmail,x=!1,y="",z=[],A="/sw/sw.js",B=!1,C=!1,D=!1,E=!1,F="ServiceWorkerStorage",G=1,H="data";this.init=function(){b.env.webpush&&o().then(function(a){z=a,!b.env.device.isMobile&&"serviceWorker"in navigator&&"PushManager"in window&&!b.hacks.isEdge&&!b.hacks.isOpera&&(C=!0,r(),q()?e().then(function(){return h("user")}).then(function(a){a!==w?(v&&console.log("Zmiana uzytkownika",w),g("user",w).then(function(){m(!0)})):m(!1)}):n())})},this.getPermissionState=function(){return y},this.isPromptClosed=function(){return D},this.getFolders=function(){return z},this.setWebpushInfo=p,this.isRegisterAndSubscribed=function(){return B},this.isPushServiceWorker=function(){return b.env.webpush&&C&&z.length}}]),angular.module("nxt-webmail").provider("ApplicationTrackEvent",function(){"use strict";this.SEND_TRACK=1,this.NOT_SEND_TRACK=2;var a={mainNewMes:["Lewa szpalta","Nowa wiadomość","klik w ikonę"],folderInbox:["Lewa szpalta","Odebrane","klik w ikonę"],folderShop:["Lewa szpalta","Oferty","klik w ikonę"],folderSocial:["Lewa szpalta","Społeczności","klik w ikonę"],folderSent:["Lewa szpalta","Wysłane","klik w ikonę"],folderDraft:["Lewa szpalta","Robocze","klik w ikonę"],folderTrash:["Lewa szpalta","Kosz","klik w ikonę"],folderSpam:["Lewa szpalta","Spam","klik w ikonę"],foldersUser:["Lewa szpalta","Foldery","klik w ikonę"],clickAddFolder:["Lewa szpalta","Foldery","Dodaj folder - klik link"],clickAddFolderPlus:["Lewa szpalta","Foldery","Dodaj (+) klik"],closeFolderList:["Lewa szpalta","Foldery","Zamknij (x)"],editFolder:["Lewa szpalta","Foldery","Edytuj folder"],deleteFolder:["Lewa szpalta","Foldery","Usuń"],openFolder:["Lewa szpalta","Foldery","Otwórz folder"],actionSearch:["Lista wiadomości","Szukaj","akcja wyszukania"],selectOptSubfolder:["Lewa szpalta","Foldery","zaznaczenie opcji dodania jako podfolderu"],folderSettingMore:["Lewa szpalta","Foldery","Ustawienia folderu"],addSubFolder:["Lewa szpalta","Dodaj folder","stworzenie nowego folderu",[[this.NOT_SEND_TRACK]]],selectAllMessages:["Lista wiadomości","zaznaczenie checkboxa","Zaznaczenie wszystkich",[[this.NOT_SEND_TRACK]]],addExtAccLink:["Lista wiadomości","Dodaj konto zewnętrzne","klik w link"],checkSingleMessage:["Lista wiadomości","zaznaczenie checkboxa","Zaznaczenie pojedynczego maila",[[this.NOT_SEND_TRACK]]],useSuggestSearch:["Lista wiadomości","Szukaj","skorzystanie z zapisanej podpowiedzi"],delSuggestItem:["Lista wiadomości","Szukaj","usuń z historii podpowiedź"],searcherClose:["Lista wiadomości","Szukaj","zamknij (x)"],searcherMoreOptions:["Lista wiadomości","Szukaj","pokaż więcej opcji"],searcherInContent:["Lista wiadomości","Szukaj","szukaj w treści"],searcherAdvanceClose:["Lista wiadomości","Wyszukiwanie (rozwinięte) - wybór opcji podczas wyszukiwania","zamknij rozwinięcie (anuluj)"],searcherOptionFolder:["Lista wiadomości","wybór opcji podczas wyszukiwania","folder"],searcherOptionTo:["Lista wiadomości","wybór opcji podczas wyszukiwania","nadawca"],searcherOptionFrom:["Lista wiadomości","wybór opcji podczas wyszukiwania","odbiorca"],searcherOptionTopic:["Lista wiadomości","wybór opcji podczas wyszukiwania","temat"],searcherOptionDateFrom:["Lista wiadomości","wybór opcji podczas wyszukiwania","data od"],searcherOptionDateTo:["Lista wiadomości","wybór opcji podczas wyszukiwania","data do"],searcherOptionAttach:["Lista wiadomości","wybór opcji podczas wyszukiwania","załącznik"],searcherOptionClose:["Lista wiadomości","wybór opcji podczas wyszukiwania","zamknij rozwinięcie (anuluj)"],mailForwardAllSelect:["Lista wiadomości","więcej - Prześlij dalej","wszystkie zaznaczone"],mailForwardSingle:["Lista wiadomości","więcej - Prześlij dalej","pojedynczy mail"],mailSaveAll:["Lista wiadomości","więcej - zapisz","wszystkie zaznaczone"],mailMarkReadSingleMenuMore:["Lista wiadomości","oznacz jako przeczytane","pojedynczy mail"],mailMarkReadAllMenuMore:["Lista wiadomości","oznacz jako przeczytane","wszystkie zaznaczone"],mailMarkUnReadSingleMenuMore:["Lista wiadomości","oznacz jako nieprzeczytane","pojedynczy mail"],mailMarkUnReadAllMenuMore:["Lista wiadomości","oznacz jako nieprzeczytane","wszystkie zaznaczone"],mailSaveSingle:["Lista wiadomości","więcej - zapisz","pojedynczy mail"],setStarAll:["Lista wiadomości","oznacz gwiazdką","wszystkie zaznaczone"],setStarSingle:["Lista wiadomości","oznacz gwiazdką","pojedynczy mail"],moveAllCheckMesToSocial:["Lista wiadomości","przenieś -  społeczności","wszystkie zaznaczone"],moveMesToSocial:["Lista wiadomości","przenieś -  społeczności","pojedynczy mail"],moveMesToSocialDrag_Drop:["Lista wiadomości","przenieś -  społeczności","drag_drop"],moveAllCheckMesToSpam:["Lista wiadomości","przenieś -  spam","wszystkie zaznaczone"],moveMesToSpam:["Lista wiadomości","przenieś -  spam","pojedynczy mail"],moveMesToSpamDrag_Drop:["Lista wiadomości","przenieś -  spam","drag_drop"],moveAllCheckMesToUserFolder:["Lista wiadomości","przenieś -  folder użytkownika","wszystkie zaznaczone"],moveMesToUserFolder:["Lista wiadomości","przenieś -  folder użytownika","pojedynczy mail"],moveMesToUserFolderDrag_Drop:["Lista wiadomości","przenieś -  folder użytkownika","drag_drop"],moveAllCheckMesToInbox:["Lista wiadomości","przenieś -  odebrane","wszystkie zaznaczone"],moveMesToInbox:["Lista wiadomości","przenieś -  odebrane","pojedynczy mail"],moveMesToInboxDrag_Drop:["Lista wiadomości","przenieś -  odebrane","drag_drop"],moveAllCheckMesToTrash:["Lista wiadomości","przenieś -  kosz","wszystkie zaznaczone"],moveMesToTrash:["Lista wiadomości","przenieś -  kosz","pojedynczy mail"],moveMesToTrashDrag_Drop:["Lista wiadomości","przenieś -  kosz","drag_drop"],moveAllCheckMesToShop:["Lista wiadomości","przenieś - oferty","wszystkie zaznaczone"],moveMesToShop:["Lista wiadomości","przenieś - oferty","pojedynczy mail"],moveMesToShopDrag_Drop:["Lista wiadomości","przenieś - oferty","drag_drop"],topPanelClose:["Lista wiadomości","zamknij","klik x"],topPanelCloseCheckSingle:["Lista wiadomości","zamknij","pojedynczy mail"],topPanelCloseCheckAll:["Lista wiadomości","zamknij","wszystkie zaznaczones"],topDeleteAllMes:["Lista wiadomości","usuń","wszystkie zaznaczone"],topDeleteSingleMes:["Lista wiadomości","usuń","pojedynczy mail"],topToSpamAllMes:["Lista wiadomości","spam","wszystkie zaznaczone"],topToSpamSingleMes:["Lista wiadomości","spam","pojedynczy mail"],deleteAllMessagesFromTrashViaDialog:["Lista wiadomości","usuń - kosz","wszystkie wiadomości (dialog)"],selectUnReadMainToolBar:["Lista wiadomości","nieprzeczytane","Filtrowanie z paska"],filterImportantToolBar:["Lista wiadomości","ważne","Filtrowanie z paska"],filterStarsToolBar:["Lista wiadomości","z gwiazdką","Filtrowanie z paska"],filterAllToolBar:["Lista wiadomości","wszystkie","Filtrowanie z paska"],filterAttachToolBar:["Lista wiadomości","pokaż wiadomości z załącznikami","Filtrowanie z paska"],filterAttachOnlyToolBar:["Lista wiadomości","Pokaż tylko załączniki z wiadomości","Filtrowanie z paska"],filterContactsToolBar:["Lista wiadomości","od znajomych ","Filtrowanie z paska"],dialogNewMailClose:["Nowy mail","zamknij","klik"],dialogNewMailFull:["Nowy mail","pełny ekran","otwarcie"],dialogNewMailFullClose:["Nowy mail","pełny ekran","zamknięcie"],dialogNewMailMin:["Nowy mail","minimalizuj/ przywróć","klik"],newMailDW:["Nowy mail","DW","dodanie adresata do DW"],newMailUDW:["Nowy mail","DW","dodanie adresata do UDW"],newMailDelContact:["Nowy mail","usuń adresata","x"],newMailMoreAction:["Nowy mail","„ptaszek” (więcej)","rozwinięcie"],newMailSave:["Nowy mail","„ptaszek” (więcej)","zapisz jako robocze"],mailToggleImportant:["Nowy mail","priorytet","oznacz jako piorytet"],addSignatureClick:["Nowy mail","dodaj podpis","klik"],addSignature:["Nowy mail","dodaj podpis","akcja"],selectSignature:["Nowy mail","ustaw podpisu","klik"],sendMail:["Nowy mail","Wyślij","wysłanie wiadomości"],addAttachClick:["Nowy mail","Załączniki","klik -dodaj załącznik"],addAttachDrag_Drop:["Nowy mail","Załączniki","drag_drop"],deleteAllAttach:["Nowy mail","Załączniki","usuń wszystkie (załączniki)"],deleteAttach:["Nowy mail","Załączniki","„x” usuń załącznik"],mailContentBold:["Nowy mail","pogrubienie (bold)"," "],mailContentItalic:["Nowy mail","kursywa (italic)"," "],mailContentFontType:["Nowy mail","rozmiar i krój czcionki","klik"],mailContentFontTypeName:["Nowy mail","rozmiar i krój czcionki","%s%"],mailContentFontSize:["Nowy mail","rozmiar i krój czcionki","%s%"],mailContentUnderline:["Nowy mail","podkreślenie (underline)"," "],mailContentFontColor:["Nowy mail","kolor czcionki","%s%"],mailContentAlignClick:["Nowy mail","wyrównanie i lista","klik"],mailContentNumericList:["Nowy mail","wyrównanie i lista","Lista numerowana"],mailContentPointList:["Nowy mail","wyrównanie i lista","Lista punktowa"],mailContentAlign:["Nowy mail","wyrównanie i lista","Do %s%"],mailContentStationery:["Nowy mail","wybierz papeterię","klik","%s%"],mailContentInsImg:["Nowy mail","wstaw obrazek","klik"],mailContentInsEmot:["Nowy mail","wstaw emotikonę","klik"],mailContentClearFormat:["Nowy mail","edytor plain text","klik"],mailContentEditorHtmlOn:["Nowy mail","edytor plain text","włącz html"],mailContentEditorHtmlOff:["Nowy mail","edytor plain text","wyłącz html"],mailAutosaveShow:["Nowy mail","autozapis kopii roboczej","wyświetlenie",[[this.NOT_SEND_TRACK]]],mailAutosaveClose:["Nowy mail","autozapis kopii roboczej","“x” zamknij"],mailAutosaveConfirm:["Nowy mail","autozapis kopii roboczej","Zapisz",[[this.NOT_SEND_TRACK]]],mailAutosaveCancel:["Nowy mail","autozapis kopii roboczej","Anuluj"],extAccClickLink:["Lista wiadomości","Dodaj konto zewnętrzne","klik w link"],extAccClosePanel:["Lista wiadomości","Dodaj konto zewnętrzne","Zamknij (x)"],extAccMoreOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Więcej ustawień"],extAccLessOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Mniej ustawień"],extAccAdd:["Lista wiadomości","Dodaj konto zewnętrzne","Dodanie konta zewnetrznego - %s%"],extAccAddWithChanges:["Lista wiadomości","Dodaj konto zewnętrzne","Dodanie z wprowadzonymi zmianami - %s%"],extAccDelete:["Lista wiadomości","Dodaj konto zewnętrzne","Usuń konto zewnetrzne"],extAccEdit:["Lista wiadomości","Dodaj konto zewnętrzne","Edytuj konto zewnetrzne"],extAccSendVeryfiMail:["Lista wiadomości","Dodaj konto zewnętrzne","Wyślij mail weryfikacyjny"],extAccFilter:["Lista wiadomości","Dodaj konto zewnętrzne","Filtruj po koncie zewnętrzym"],extAccAddServer:["Lista wiadomości","Dodaj konto zewnętrzne","Adres serwera"],extAccAddServerPort:["Lista wiadomości","Dodaj konto zewnętrzne","Port serwera"],extAccAddSsl:["Lista wiadomości","Dodaj konto zewnętrzne","Szyfrowanie SSL/TLS"],extAccAddOptions:["Lista wiadomości","Dodaj konto zewnętrzne","Opcje wysyłki/odbioru (3)"],extAccAddDefualtAcc:["Lista wiadomości","Dodaj konto zewnętrzne","Domyślnie wysyłaj maile z tego konta"],extAccAddCopyOnServer:["Lista wiadomości","Dodaj konto zewnętrzne","Zostaw kopię na serwerze (2 &ndash; tak/nie)"],messageListNextPack:["Lista wiadomości","Pokaż kolejną paczkę maili",""],userTooltipNewMes:["Lista wiadomości","tooltip nadawcy","nowa wiadomość"],userTooltipFilterBy:["Lista wiadomości","tooltip nadawcy","wyszukaj po nadawcy"],userTooltipAddToContact:["Lista wiadomości","tooltip nadawcy","dodaj/usuń  do/z kontaków"],userTooltipBlock:["Lista wiadomości","tooltip nadawcy","zablokuj/odblokuj nadawcę"],userTooltipFilter:["Lista wiadomości","tooltip nadawcy","Filtruj od tej osoby"],viewMailShowImg:["Otwarty mail","Pokaż obrazki","klik w link"],viewMailAlwaysShowImg:["Otwarty mail","Zawsze pokazuj obrazki ","klik w link"],viewMailSetStar:["Otwarty mail","Gwiazdka w nagłówku","oznaczenie maila gwiazdką"],viewMailToolboxReply:["Otwarty mail","Odpowiedz","klik w ikonę w pasku"],viewMailMoreOptionsReplay:["Otwarty mail","Odpowiedz","klik w ikonę z więcej opcji"],viewMailToolbarDelete:["Otwarty mail","Usunięcie maila"," poprzez klik w ikonę w pasku"],viewMailMoreOptionsDelThread:["Otwarty mail","Usunięcie maila","poprzez opcję - Usuń cały wątek"],viewMailMoreOptionsDelete:["Otwarty mail","Usunięcie maila","poprzez opcję - Usuń tę wiadomość"],viewMailMoreOptionsShow:["Otwarty mail","Więcej opcji","rozwinięcie listy"],viewMailMoreOptionsSpam:["Otwarty mail","To jest Spam","klik w ikonę z więcej opcji"],viewMailMoreOptionsNoSpam:["Otwarty mail","To nie jest Spam","klik w ikonę z więcej opcji"],viewMailMoreOptionsForward:["Otwarty mail","Prześlij dalej","klik w ikonę z więcej opcji"],viewMailMoreOptionsMoveToFolder:["Otwarty mail","Przenieś do folderu","przenies do %s%"],viewMailMoreOptionsPrint:["Otwarty mail","Drukuj","klik w ikonę z więcej opcji"],viewMailMoreOptionsSave:["Otwarty mail","Zapisz","klik w ikonę z więcej opcji"],viewMailMoreOptionsInfo:["Otwarty mail","Szczegóły wiadomości","klik w ikonę z więcej opcji"],viewMailMoreOptionsHistory:["Otwarty mail","Historia wiadomości","klik w ikonę z więcej opcji"],viewMailMoreOptionsRelated:["Otwarty mail","Pokaż wiadomości powiązane","klik w ikonę z więcej opcji"],contactShowList:["Prawa szpalta","Rozwiń kontakty"," rozwiń"],contactListClickIcon:["Prawa szpalta","opcje na kontakcie","wyślij maila - klik w ikonkę"],contactListClick:["Prawa szpalta","opcje na kontakcie","wyślij maila - klik na kontakcie"],contactHistory:["Prawa szpalta","opcje na kontakcie","pokaż historię korespondencji"],contactAddFilter:["Prawa szpalta","opcje na kontakcie","dodaj filtr"],contactBlock:["Prawa szpalta","opcje na kontakcie","zablokuj"],contactEdit:["Prawa szpalta","opcje na kontakcie","edytuj kontakt"],contactDelete:["Prawa szpalta","opcje na kontakcie","usuń kontakt"],contactsMoreOptionsShow:["Prawa szpalta","więcej opcji","„^” daszek rozwinięcie listy"],contactsMoreOptionsAdd:["Prawa szpalta","więcej opcji","dodaj kontakt"],contactsMoreOptions:["Prawa szpalta","więcej opcji","zaznacz kilka kontaktów"],contactsMoreOptionsImportFile:["Prawa szpalta","więcej opcji","importuj kontakty z pliku"],contactsMoreOptionsExportFile:["Prawa szpalta","więcej opcji","eksportuj kontakty do pliku"],contactsMoreOptionsGroups:["Prawa szpalta","więcej opcji","grupy kontaktów"],contactsMoreOptionsSortPopularity:["Prawa szpalta","więcej opcji","sortuj:najpopularniejsze",[[this.NOT_SEND_TRACK]]],contactsMoreOptionsSortAlfa:["Prawa szpalta","więcej opcji","sortuj:alfabetycznie",[[this.NOT_SEND_TRACK]]],settingPanelShow:["Prawa szpalta","Ustawienia","klik"],settingPanelClose:["Prawa szpalta","Ustawienia","„x” zamknij"],settingPanelLogout:["Prawa szpalta","Ustawienia","Wyloguj"],settingPanelMain:["Prawa szpalta","Ustawienia","Główne ustawienia"],settingPanelNoAds:["Prawa szpalta","Ustawienia","Poczta bez reklam"],settingPanelChangePass:["Prawa szpalta","Ustawienia","Zmiana hasła i opcji odzyskiwania"],settingPanelSignature:["Prawa szpalta","Ustawienia","Ustaw podpisy"],settingPanelAddAlias:["Prawa szpalta","Ustawienia","Dodaj alias"],settingPanelBlackWhieList:["Prawa szpalta","Ustawienia","Czarna/biała lista"],settingPanelAutorespond:["Prawa szpalta","Ustawienia","Autoresponder"],settingPanelMore:["Prawa szpalta","Ustawienia","Więcej ustawień"],settingPanelReorder:["Prawa szpalta","Ustawienia","Uporządkuj pocztę"],settingPanelHelp:["Prawa szpalta","Ustawienia","Pomoc"],settingPanelMoreInfo:["Prawa szpalta","Ustawienia","Dowiedz się więcej"],settingPanelAutopromo1:["Autopromo_bez_reklam","klik","v1"],settingPanelAutopromo2:["Autopromo_bez_reklam","klik","v2"],settingPanelAutopromo3:["Autopromo_bez_reklam","klik","v3"],settingPanelTutorial:["Prawa szpalta","Ustawienia","Pokaż jak to zrobić"],settingPanelClickAutoPromo:["Prawa szpalta","Ustawienia","Klik w planszę autopromo"],settingPanelChangeSkin:["Prawa szpalta","Ustawienia","Zmiana skin  na %s% "],contactsMainToolbarAddClick:["Prawa szpalta","Dodaj kontakt","klik w ikonę"],contactActionAdd:["Prawa szpalta","Dodaj kontakt","faktyczne dodanie kontaktu"],contactAddToGroup:["Prawa szpalta","Dodaj kontakt","dodanie do grupy kontaktów"],contactSelectPhone:["Prawa szpalta","Dodaj kontakt","wybranie typu telefonu (%s%)"],contactAddPhone:["Prawa szpalta","Dodaj kontakt","wpisanie nr telefonu %s%"],contactAddNote:["Prawa szpalta","Dodaj kontakt","dodanie notatki"],contactAddNextEmail:["Prawa szpalta","Dodaj kontakt","dodanie kolejnego adresu e-mail"],contactDeleteEmail:["Prawa szpalta","Dodaj kontakt","usunięcie jednego z adresów e-mail"],contactSetDefualtEmail:["Prawa szpalta","Dodaj kontakt","ustaw jako adres główny e-mail "],contactAddNextPhone:["Prawa szpalta","Dodaj kontakt","dodanie kolejnego numeru telefonu"],contactDeletePhone:["Prawa szpalta","Dodaj kontakt","usunięcie jednego z numerów telefonu"],searcherContactClose:["Prawa szpalta","Wyszukaj kontakt","„x” zamknij wyszukiwarkę"],useSearcherContact:["Prawa szpalta","Wyszukaj kontakt","wyszukanie kontaktu"],welcomeMailingShow:["Kampania_next_nowy","mailing_pow","wyswietlenie"],welcomeMailingDetails:["Kampania_next_nowy","mailing_pow","klik"],addAttachmentErrorBugExternalAppNext:["komunikat_brak_zalacznika","view","mobi_next"],addAttachmentErrorBugExternalAppNextClick:["komunikat_brak_zalacznika","klik","mobi_next"],avatarCardShow:["Menu_przy_wiadomosci","view"],avatarCardNewMessage:["Menu_przy_wiadomosci","klik","napisz wiadomosc"],avatarCardAddToContactsList:["Menu_przy_wiadomosci","klik","dodaj do listy kontaktow"],avatarCardShowMessages:["Menu_przy_wiadomosci","klik","zobacz wiadomosc"],avatarCardFilterMessages:["Menu_przy_wiadomosci","klik","filtruj wiadomosc"],avatarCardBlockThisUser:["Menu_przy_wiadomosci","klik","zablokuj te osobe"],ingPdfView:["next","view","baner_ing"],ingPdfClick:["next","klik","baner_ing"],empikBanerView:["next","view","baner_empik_fotoksiazka"],empikBanerClick:["next","klik","baner_empik_fotoksiazka"],empikBanerView2:["next","view","baner_empik_plakat"],empikBanerClick2:["next","klik","baner_empik_plakat"],empikBanerView3:["next","view","baner_empik_puzzle"],empikBanerClick3:["next","klik","baner_empik_puzzle"]},b={addAttachmentErrorBugExternalAppInt:["komunikat_brak_zalacznika","view","mobi_int"],addAttachmentErrorBugExternalAppIntClick:["komunikat_brak_zalacznika","klik","mobi_int"]},c={move:["next","%folderName%","%s%","przenies","pojedynczy_mail","%s%"],moveAll:["next","%folderName%","%s%","przenies","wszystkie_zaz","%s%"],moveDrag_Drop:["next","%folderName%","drag_drop","przenies","pojedynczy_mail","%s%"],reply:["next","%folderName%","-","odpowiedz","-"],markRead:["next","%folderName%","-","oznacz_przeczytane","pojedynczy_mail"],markReadAll:["next","%folderName%","-","oznacz_przeczytane","wszystkie_zaz"],markUnread:["next","%folderName%","-","oznacz_nieprzeczytane","pojedynczy_mail"],markUnreadAll:["next","%folderName%","-","oznacz_nieprzeczytane","wszystkie_zaz"],markFavourite:["next","%folderName%","%s%","oznacz_gwiazdka","pojedynczy_mail"],markFavouriteAll:["next","%folderName%","%s%","oznacz_gwiazdka","wszystkie_zaz"],messageListNextPack:["next","%folderName%","doladowanie_listy"],removeThread:["next","%folderName%","-","usun_watek","-"],replyOnlySender:["next","%folderName%","Otwarty_mail","klik","odp_tylko_nadawcy"],messageDeleteThread:["Next","%folderName%","Otwarty_mail","klik","usun_caly_watek"],viewMailShowImg:["next","%folderName%","Otwarty_mail","klik","Pokaz_obrazki"],viewMailAlwaysShowImg:["next","%folderName%","Otwarty_mail","klik","Zawsze_pokazuj_obrazki"],messagePrint:["Next","Otwarty_mail","klik","drukuj"],messageThreadExpand:["Next","Otwarty_mail","klik","Watek_rozwin"],messageThreadHide:["Next","Otwarty_mail","klik","Watek_zwin"],messageThreadOldMsg:["Next","Otwarty_mail","klik","Watek_starsze_wiadomosci"],messageAttachClick:["Next","Otwarty_mail","klik","Zalacznik"],messageDownloadAttach:["Next","Otwarty_mail","klik","Zalaczniki_Pobierz"],messageDownloadAllAttach:["Next","Otwarty_mail","klik","Zalaczniki_zapisz_wszystkie"],messageThreadRevealOriginalMessage:["Next","Otwarty_mail","klik","Watek_wyswietl_tresc"],messageOpenPublicGallery:["%systemName%","Otwarty_mail","klik","stykowka_gal_otwarcie"],messageOpenPublicGalleryPhoto:["%systemName%","Otwarty_mail","klik","stykowka_gal_zdjecie"],messageShowMagnifier:["%systemName%","%folderName%","view","lupa","%s%"],messageZoomInMagnifier:["%systemName%","%folderName%","klik","lupa","%s%"],settingPanelLogout:["Next","Ustawienia","Wyloguj"],mainNewMes:["Next","%folderName%","klik","nowa_wiadomośc"],addAttachClick:["Next","Nowy_mail","klik","zalacznik"],clickAddFolder:["Next","menu","klik","dodaj_nowy_folder"],settingsOpenContacts:["Next","menu","klik","kontakty"],settingsEmptySpam:["Next","menu","klik","oproznij_spam"],mailForwardAllSelect:["next","%folderName%","gorna_belka","przeslij","wszystkie_zaz"],mailForwardSingle:["next","%folderName%","gorna_belka","przeslij","pojedynczy_mail"],sendNewMail:["Next","nowy_mail","klik","wyslij"],deleteThread:["Next","%folderName%","otwarty_mail","usun_watek"],columnResize:["Next","zmiana_szerokosci_kolumn","przesuniecie"],addAttachDrag_Drop:["Next","nowy_mail","drag&drop","zalacznik"],searcherClose:["next","wyszukiwarka","zamknij_(x)"],searcherMoreOptions:["next","wyszukiwarka","klik","pokaz_wiecej_opcji"],searcherInContent:["next","wyszukiwarka","klik","szukaj_w_tresci"],useSuggestSearch:["next","wyszukiwarka","klik","skorzystanie_z_podpowiedzi"],removeSuggestSearch:["next","wyszukiwarka","klik","usun"],searcherOptionFolder:["next","wyszukiwarka","klik","opcje_zaaw","%folderName%"],searcherOptionFrom:["next","wyszukiwarka","klik","opcje_zaaw","nadawca"],searcherOptionTo:["next","wyszukiwarka","klik","opcje_zaaw","odbiorca"],searcherOptionTopic:["next","wyszukiwarka","klik","opcje_zaaw","temat"],searcherOptionDateFrom:["next","wyszukiwarka","klik","opcje_zaaw","data_od"],searcherOptionDateTo:["next","wyszukiwarka","klik","opcje_zaaw","data_do"],searcherOptionAttach:["next","wyszukiwarka","klik","opcje_zaaw","załacznik"],newMailShowBCC:["Next","Nowy_mail","klik","UDW"],newMailShowCC:["Next","Nowy_mail","klik","DW"],mailToggleImportant:["Next","Nowy_mail","klik","piorytet"],addSignatureClick:["Next","Nowy_mail","klik","dodaj_nowy_podpis"],selectSignature:["Next","Nowy_mail","klik","dodaj_podpis"],changeSenderMail:["Next","Nowy_mail","klik","wybor_innego_adresu_nad"],compositionAddNewAccount:["Next","Nowy_mail","klik","dodaj_nowe_konto"],mailContentStationery:["Next","Nowy_mail","klik","wybierz_papeterie","%s%"],mailContentInsImg:["Next","Nowy_mail","klik","wstaw_obrazek"],mailContentInsEmot:["Next","Nowy_mail","klik","wstaw_emotikone"],mailContentFontColor:["Next","Nowy_mail","klik","kolor_czcionki","%s%"],mailContentBold:["Next","Nowy_mail","klik","pogrubienie_(bold)"],mailContentItalic:["Next","Nowy_mail","klik","kursywa_(italic)"],mailContentUnderline:["Next","Nowy_mail","klik","podkreslenie_(underline)"],mailContentAlign:["Next","Nowy_mail","klik","wyrownanie_i_lista","%s%"],deleteAllAttach:["Next","Nowy_mail","klik","usun_wszystkie_zalaczniki"],deleteAttach:["Next","Nowy_mail","klik","usun_1_zalacznik"],newMailDelContact:["Next","Nowy_mail","klik","usun_adresata"],dialogNewMailMin:["Next","Nowy_mail","klik","%s%"],dialogNewMailFull:["Next","Nowy_mail","klik","pełny_ekran"],dialogNewMailClose:["Next","Nowy_mail","klik","zamknij"],sendMail:["next","Nowy_mail","klik","wyslij","%s%"],newMailSave:["Next","Nowy_mail","klik","zapisz_jako_robocze"],settingPanelClose:["Next","Ustawienia","klik","x_zamknij"],settingPanelChangeSkin:["Next","Ustawienia","klik","tlo","%s%"],settingPanelChangeInterface:["Next","Ustawienia","klik","wersja_stara"],avatarCardShow:["next","tooltip","view"],avatarCardNewMessage:["next","tooltip","klik","nowa_wiadomosc"],avatarCardShowMessages:["next","tooltip","klik","wyszukaj_po_nadawcy"],avatarCardAddToContactsList:["next","tooltip","klik","dodaj_kontakt"],avatarCardRemoveFromContactsList:["next","tooltip","klik","usun_kontakt"],avatarCardBlockThisUser:["next","tooltip","klik","zablokuj_nadawce"],avatarCardUnblockThisUser:["next","tooltip","klik","odblokuj_nadawce"],avatarCardFilterMessages:["next","tooltip","klik","filtruj_od_tej_osoby"],avatarCardDeliverToInbox:["next","tooltip","klik","dostarczaj_do_odebranych"],contactNewMessage:["next","kontakt","klik","nowa_wiadomosc","ikona"],contactHistory:["next","kontakt","klik","historia_korespondencji"],contactAddFilter:["next","kontakt","klik","nowy_filtr"],contactBlock:["next","kontakt","klik","blokuj"],contactEdit:["next","kontakt","klik","edytuj"],contactDelete:["next","kontakt","klik","usun"],contactShowContactDetails:["next","kontakt","klik","odkryj_dane"],contactHideContactDetails:["next","kontakt","klik","ukryj_dane"],contactListNewMessage:["next","lista_kontaktow","klik","nowa_wiadomosc"],contactAddToGroup:["next","lista_kontaktow","klik","grupy","dodaj_do_grupy"],contactAddGroup:["next","lista_kontaktow","klik","grupy","nowa_grupa"],contactSelectGroup:["next","lista_kontaktow","klik","grupy","%s%"],contactsMoreOptionsSortAlfa:["next","lista_kontaktow","klik","opcje","sortuj_alfabet"],contactsMoreOptionsSortPopularity:["next","lista_kontaktow","klik","opcje","sortuj_popularne"],contactsMoreOptionsImportFile:["next","lista_kontaktow","klik","opcje","importuj"],contactsMoreOptionsExportFile:["next","lista_kontaktow","klik","opcje","eksportuj"],contactActionAdd:["next","lista_kontaktow","klik","dodaj"],contactShowList:["next","lista_kontaktow","klik","rozwin"],contactHideList:["next","lista_kontaktow","klik","zwin"],clickAddFolderPlus:["Next","foldery-nowy","klik","dodaj_folder"],editFolder:["Next","foldery-nowy","klik","edytuj_folder"],deleteFolder:["Next","foldery-nowy","klik","usun_folder"],closeAddFolder:["Next","foldery-nowy","klik","zamknij"],attachGallerySlideShow:["Next","Galeria_zal","klik","pokaz_slajdow"],attachGalleryRotatePhoto:["Next","Galeria_zal","klik","obroc_zdjecie"],attachGalleryDownload:["Next","Galeria_zal","klik","pobierz"],attachGalleryForward:["Next","Galeria_zal","klik","przeslij"],attachGalleryThumbnail:["Next","Galeria_zal","klik","miniaturka"],viewMailToolboxReply:["next","%folderName%","otwarty_mail","odpowiedz"],viewMailToolboxForward:["next","%folderName%","otwarty_mail","przeslij","pojedynczy_mail"],viewMailToolboxMarkFavourite:["next","%folderName%","otwarty_mail","oznacz_gwiazdka","pojedynczy_mail"],viewMailToolboxMove:["next","%folderName%","otwarty_mail","przenies","pojedynczy_mail","%s%"],messageListToolboxReply:["next","%folderName%","gorna_belka","odpowiedz"],partialOpenMsg:["next","%folderName%","pv_czesciowe","otw_maila","%s%","%customVar%"],partialOpenFolder:["next","%folderName%","pv_czesciowe","otw_folderu","%s%","%customVar%"],partialViewSettings:["next","ustawienia","pv_czesciowe","otw_folderu","-","%customVar%"],partialCustomizeWebmail:["next","dost_poczte","pv_czesciowe","wysw_planszy","%customVar%"],partialDeleteMsg:["next","usuniecie_wiadomosci","pv_czesciowe","%customVar%"],partialEmptyTrash:["next","oproznienie_kosza","pv_czesciowe","%customVar%"],partialOpenNewMsg:["next","nowa_wiadomosc","pv_czesciowe","%customVar%"],partialFilterAllToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","wszystkie","%customVar%"],partialFilterStarsToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","z_gwiazdka","%customVar%"],partialFilterAttachToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","z_zalacznikami","%customVar%"],partialFilterPaidToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","zaplacone","%customVar%"],partialFilterNotPaidToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","niezaplacone","%customVar%"],partialSelectUnReadMainToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","nieprzeczytane","%customVar%"],partialFilterContactsToolBar:["next","%folderName%","pv_czesciowe","filtrowanie","od_znajomych","%customVar%"],partialMessageDetails:["next","Otwarty_mail","pv_czesciowe","szczegoly","%customVar%"],partialActionSearch:["next","%folderName%","pv_czesciowe","akcja_wyszukania","%customVar%"],pushPromptView:["next","powiadomienia_przegladarka","view"],pushPromptAllow:["next","powiadomienia_przegladarka","klik","zezwalaj"],pushPromptDeny:["next","powiadomienia_przegladarka","klik","blokuj"],pushPromptClose:["next","powiadomienia_przegladarka","klik","zamknij"],pushSettingView:["next","ustawienia_powiadomien","view","plansza%s%"],pushSettingClose:["next","ustawienia_powiadomien","klik","plansza%s%","zamknij"],pushSettingCheckboxOn:["next","ustawienia_powiadomien","klik","plansza1","%s%","wlacz"],pushSettingCheckboxOff:["next","ustawienia_powiadomien","klik","plansza1","%s%","wylacz"],pushSettingSave:["next","ustawienia_powiadomien","klik","plansza1","zapisz"],pushSettingCancel:["next","ustawienia_powiadomien","klik","plansza1","anuluj"],pushSettingMore:["next","ustawienia_powiadomien","klik","plansza3","wiecej"],extAccClickIcon:["next","konta_zew","klik","dodaj_konto","gora"],extAccClickText:["next","konta_zew","klik","dodaj_konto","dol"],extAccDelete:["next","konta_zew","klik","usun_konto"],extAccEdit:["next","konta_zew","klik","edytuj_konto"],extAccAddDefaultAcc:["next","konta_zew","klik","wysyłaj_maile_z_tego_konta"],extAccMoreOptions:["next","konta_zew","klik","wiecej_ustawien"],extAccLessOptions:["next","konta_zew","klik","mniej_ustawien"],extAccAddServer:["next","konta_zew","klik","Adres_serwera","%s%"],extAccAddServerPort:["next","konta_zew","klik","Port_serwera","%s%"],extAccAddSsl:["next","konta_zew","klik","Szyfrowanie_SSL/TLS","zaznacz"],extAccDeleteSsl:["next","konta_zew","klik","Szyfrowanie_SSL/TLS","odznacz"],extAccLeaveOnServer:["next","konta_zew","klik","zostaw_kopie_na_serwerze"],extAccRemoveFromServer:["next","konta_zew","klik","usun_po_pobraniu"],extAccFilter:["next","konta_zew","klik","filtruj_po_koncie"],billingOpen:["next","platnosci","klik","przejdz_do_panelu","lista_wiad"],billingPay:["next","platnosci","klik","zaplac","%s%"],billingMarkPaid:["next","platnosci","klik","oznacz_zaplacone","%s%"],billingMarkNotPaid:["next","platnosci","klik","oznacz_niezaplacone","%s%"],notSpamToolbar:["next","spam","gorna_belka","to_nie_spam","%s%"],notSpam:["next","%folderName%","%s%","to_nie_spam","pojedynczy_mail"],notSpamDragAndDrop:["next","spam","drag_drop","to_nie_spam","%s%"],billingReminderOverdueClick:["next","odebrane","klik","czerwony_pasek"],billingReminderOverdueView:["next","odebrane","view","czerwony_pasek"],billingReminderNewClick:["next","odebrane","klik","zielony_pasek"],billingReminderNewView:["next","odebrane","view","zielony_pasek"],billingReminderOldClick:["next","odebrane","klik","zolty_pasek"],billingReminderOldView:["next","odebrane","view","zolty_pasek"],infoboard229Prepare:["plansza_next_229","-","kilk","uzupelnij"],
infoboard228Choose:["plansza_next_228","-","kilk","wybierz_domene"],infoboardLater:["plansza_next_%s%","-","kilk","pozniej"],infoboard230Choose:["plansza_next_230","-","kilk","przedluz"],infoboard230Close:["plansza_next_230","-","klik","zamknij"],infoboardView:["plansza_next_%s%","-","view","-"],infoboardClose:["plansza_next_%s%","-","klik","zamknij"],infoboardPaymentCheck:["plansza_next_231","autopromo","klik","sprawdz","%s%"],infoboardPaymentCloseLink:["plansza_next_231","autopromo","klik","zamknij","%s%"],infoboardPaymentInfoDisplay:["plansza_next_231","%s%","view","-",""],infoboardPaymentInfoDisplayStep0:["plansza_next_231","-","view","-","%s%"],infoboardPaymentTurnOn:["plansza_next_231","%s%","klik","wlacz"],infoboardPaymentTurnOnStep0:["plansza_next_231","-","klik","wlacz","%s%"],infoboardPaymentClose:["plansza_next_231","%s%","klik","x"],infoboardPaymentChangePrev:["plansza_next_231","%s%","klik","poprzednia"],infoboardPaymentChangeNext:["plansza_next_231","%s%","klik","nastepna"],infoboard232NextView:["plansza_next_232","powiadomienie_o_push","view","-"],infoboard232NextClose:["plansza_next_232","powiadomienie_o_push","klik","x"],infoboard232NextGo:["plansza_next_232","powiadomienie_o_push","klik","dowiedz_sie_wiecej"],infoboard233NextView:["plansza_next_233","-","view","-"],infoboard233NextClose:["plansza_next_233","-","klik","x"],infoboard233NextGo:["plansza_next_233","-","klik","dowiedz_sie_wiecej"],infoboard234AView:["plansza_%systemName%_234A","bezpieczna_poczta_14dni","wyswietlenie","-"],infoboard234AClose:["plansza_%systemName%_234A","bezpieczna_poczta_14dni","klik","pozniej"],infoboard234AGo:["plansza_%systemName%_234A","bezpieczna_poczta_14dni","klik","zapisz"],infoboard234BView:["plansza_%systemName%_234B","bezpieczna_poczta_6m","wyswietlenie","-"],infoboard234BClose:["plansza_%systemName%_234B","bezpieczna_poczta_6m","klik","pozniej"],infoboard234BGo:["plansza_%systemName%_234B","bezpieczna_poczta_6m","klik","zapisz"],infoboard236View:["plansza_next_236","pakiet_dla_firm_14dni","view","-"],infoboard236Go:["plansza_next_236","pakiet_dla_firm_14dni","klik","przedluz"],infoboard236Close:["plansza_next_236","pakiet_dla_firm_14dni","klik","anuluj"],infoboard217View:["plansza_next_217","Plansza_premium","view","-"],infoboard217Remove:["plansza_next_217","Plansza_premium","klik","usun"],infoboard217Close:["plansza_next_217","Plansza_premium","klik","zamknij"],infoboard217Cancel:["plansza_next_217","Plansza_premium","klik","anuluj"],infoboard217More:["plansza_next_217","Plansza_premium","klik","dowiedz_sie_wiecej"],infoboard237View:["plansza_next_237","plansza_237_autopromo","view"],infoboard237Go:["plansza_next_237","plansza_237_autopromo","klik","wylacz_reklamy"],infoboard237Close:["plansza_next_237","plansza_237_autopromo","klik","nie_dziekuje"],infoboard240View:["plansza_next_240","plansza_240_blik","view"],infoboard240Go:["plansza_next_240","plansza_240_blik","klik","sprawdz"],infoboard240Close:["plansza_next_240","plansza_240_blik","klik","x"],infoboardBlockSmtpView:["blokada_smtp_next","-","view"],infoboardBlockSmtpClose:["blokada_smtp_next","-","klik","zamknij"],mobileOpenNavigation:["next","menu_foldery","view"],bubbleBillingView:["next","rachunki_nieaktywny_folder","view"],bubbleBillingClose:["next","rachunki_nieaktywny_folder","klik","zamknij"],bubbleBillingClick:["next","rachunki_nieaktywny_folder","klik","sprawdz"],bubbleBillingEmptyView:["next","rachunki_pusty_folder","view"],bubbleBillingEmptyClose:["next","rachunki_pusty_folder","klik","zamknij"],bubbleBillingEmptyClick:["next","rachunki_pusty_folder","klik","sprawdz"],swipeOpenNavigation:["next","swipe_menu_foldery","view"],swipeMsglistLeft:["next","swipe_wiadomosc_menu","view"],swipeMessageRight:["next","swipe_nastepna_wiadomosc","view"],swipeMessageLeft:["next","swipe_poprzednia_wiadomosc","view"],changePasswordViewBOK:["plansza_next_239","zmiana_hasla_bok","view","-"],changePasswordLinkBOK:["plansza_next_239","zmiana_hasla_bok","klik","wskazkowki"],changePasswordNextBOK:["plansza_next_239","zmiana_hasla_bok","klik","dalej"],changePasswordSavePasswordBOK:["plansza_next_239","zmiana_hasla_bok","klik","zapisz_haslo"],changePasswordSaveOptionsBOK:["plansza_next_239","zmiana_hasla_bok","klik","zapisz_opcje_odz","%s%"],changePasswordViewSMTP:["plansza_next_239","zmiana_hasla_smtp","view","-"],changePasswordLinkSMTP:["plansza_next_239","zmiana_hasla_smtp","klik","wskazkowki"],changePasswordNextSMTP:["plansza_next_239","zmiana_hasla_smtp","klik","dalej"],changePasswordSavePasswordSMTP:["plansza_next_239","zmiana_hasla_smtp","klik","zapisz_haslo"],changePasswordSaveOptionsSMTP:["plansza_next_239","zmiana_hasla_smtp","klik","zapisz_opcje_odz","%s%"],bokMailShowOnMessageList:["next","odebrane","view","imitacja_bok_naglowek"],bokMailShowMessage:["next","odebrane","view","imitacja_bok_instrukcja"],bokMailClose:["next","odebrane","klik","imitacja_bok_naglowek","x"],fakeMailShowOnMessageList:["next","odebrane","view","fake_wiadomosc_reklama_lista"],fakeMailShowMessage:["next","odebrane","view","fake_wiadomosc_reklama"],fakeMailClose:["next","odebrane","klik","fake_wiadomosc_reklama","x"],folderListScrollView:["%systemName%","lista_folderow","view","wiecej"],folderListScrollShow:["%systemName%","lista_folderow","klik","wiecej"],folderListScrollHide:["%systemName%","lista_folderow","klik","mniej"],empikBanerView:["next","baner_empik","view","fotoksiazka"],empikBanerClick:["next","baner_empik","klik","fotoksiazka"],empikBanerView2:["next","baner_empik","view","plakat"],empikBanerClick2:["next","baner_empik","klik","plakat"],empikBanerView3:["next","baner_empik","view","puzzle"],empikBanerClick3:["next","baner_empik","klik","puzzle"]},d={infoboard232IntView:["plansza_int_232","powiadomienie_o_push","view","-"],infoboard232IntClose:["plansza_int_232","powiadomienie_o_push","klik","x"],infoboard232IntGo:["plansza_int_232","powiadomienie_o_push","klik","dowiedz_sie_wiecej"],changePasswordViewIntBOK:["plansza_int_239","haslo_bok","view","-"],changePasswordCancelIntBOK:["plansza_int_239","haslo_bok","klik","przejdz_do_poczty"],changePasswordSuccessIntBOK:["plansza_int_239","haslo_bok","klik","zapisz"],changePasswordViewIntSMTP:["plansza_int_239","blokada_smtp","view","-"],changePasswordCancelIntSMTP:["plansza_int_239","blokada_smtp","klik","przejdz_do_poczty"],changePasswordSuccessIntSMTP:["plansza_int_239","blokada_smtp","klik","zapisz"]},e=function(a){function b(a,b){return a.indexOf(b)!==-1}var c=a.folderName,d=a.systemName,e=a.additionalParam,f=0,g=e instanceof Array;a.tracksList[a.code]=a.tracksList[a.code].map(function(h){return b(h,"%s%")?(h=h.replace("%s%",g?e[f]:e),f++):b(h,"%folderName%")?h=h.replace("%folderName%",c):b(h,"%customVar%")?h={rodo:a.rodoCookie}:b(h,"%systemName%")&&(h=h.replace("%systemName%",d)),h})},f=function(a){if(a.tracksList[a.code]){var b,c=a.tracksList[a.code].slice();return(a.additionalParam||a.folderName||a.systemName)&&e(a),b=a.tracksList[a.code],a.tracksList[a.code]=c,b}},g=function(){try{return window.rodoAPI.getStatus()}catch(a){return console.warn("rodoAPI.getStatus doesn't exist anymore"),window.rodoApiStatusPocztaMobileAndPremium?window.rodoApiStatusPocztaMobileAndPremium:4}};this.$get=["$stateParams","$cookies","ApplicationConfig","Tools",function(e,h,i,j){var k=function(){"int"===i.env.service.name&&(a=angular.merge(a,b),c=angular.merge(c,d))};k();var l=function(a){return j.removePolishDiacritics(a.toLowerCase()).split(" ").join("_")},m=function(){var a=i.folders[e.folderId];return a?l(a.name):""},n=function(a){var b=a.split("");return b[0]=b[0].toLowerCase(),b.join("")},o=function(){var a=i.env.service.name;return n(a)};return{getGA:function(b,c){return f({code:b,additionalParam:c,tracksList:a})},getIWA:function(a,b){var d=m(),e=g(),h=o();return f({code:a,additionalParam:b,tracksList:c,folderName:d,rodoCookie:e,systemName:h})},getPartialFolderIWA:function(a,b){var d=g(),e=o();return f({code:"partialOpenFolder",tracksList:c,folderName:a,rodoCookie:d,systemName:e,additionalParam:b})}}}]}),angular.module("nxt-webmail").factory("uiTinymceConfig",["$rootScope","ApplicationConfig","DialogManager","Track","$timeout","Tools",function(a,b,c,d,e,f){"use strict";var g=b.env.staticUrl+"/css/vendor/tinymce",h=b.env.staticUrl+"/js/tinymce",i=b.env.staticUrl+"/js/vendor/tinymce",j=!1;return{theme:"webmail",theme_url:h+"/themes/webmail/theme.min.js",skin:"webmail",skin_url:g+"/skins/webmail",autoresize_bottom_margin:20,plugins:"autoresize",external_plugins:{autoresize:i+"/plugins/autoresize/plugin.min.js",emoticons:h+"/plugins/emoticons/plugin.min.js",expand:h+"/plugins/expand/plugin.min.js",inlineimage:h+"/plugins/inlineimage/plugin.min.js",pasteurl:h+"/plugins/pasteurl/plugin.min.js",stationery:h+"/plugins/stationery/plugin.min.js",webmailcontentstyle:h+"/plugins/webmailcontentstyle/plugin.min.js",webmailfont:h+"/plugins/webmailfont/plugin.min.js",webmailtextcolor:h+"/plugins/webmailtextcolor/plugin.min.js"},menubar:!1,statusbar:!1,toolbar:"bold italic webmailfont underline webmailforecolor webmailcontentstyle stationery inlineimage emoticons | expand",content_css:g+"/content.css",forced_root_block:!1,paste_data_images:!0,browser_spellcheck:!0,init_instance_callback:function(g){var h=g.getElement(),i=angular.element(h)[0].isolateScope();g.on("BeforeGetContent",function(a){"text"!=a.format&&(a.format="raw")},!0),g.staticUrl=b.env.staticUrl,i.$on("tinymce:before-insert-image",function(a,b){g.focus(),g.insertContent('<img class="inpl-inline-attachment loading" data-inline-id="'+b.inlineId+'" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAWdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjA76PVpAAAADElEQVQYV2NAAwwMAAASAAGjJ+O6AAAAAElFTkSuQmCC">')}),i.$on("tinymce:insert-image",function(a,c){var d,e=b.env.uploadUrl+"/html/getattach,mid,"+c.mid+",mpid,"+c.mpid+",uid,"+b.env.uid+"?f=inline";d=new Image,d.onload=function(){var a=g.getBody().querySelector('[data-inline-id="'+c.inlineId+'"]');a&&angular.element(a).attr("src",e).attr("id","inpl-inline-attachment_"+c.mpid).attr("data-cidval",c.cid).removeClass("loading").removeAttr("data-mce-src"),g.execCommand("mceAutoResize"),i.$emit("composition:updateSize"),i.$emit("ac:update")},d.src=e}),i.$on("tinymce:insert-content",function(a,b){g.focus();var c=g.selection.getBookmark();g.setContent("<div>"+g.getContent()+b+"</div>"),g.selection.moveToBookmark(c),g.execCommand("mceAutoResize")}),i.$on("tinymce:autoresize",function(){g.execCommand("mceAutoResize")}),i.$on("tinymce:textmode-confirm",function(a,b){e(function(){c.confirm({title:"Czy na pewno?",message:"Zmieniasz tryb pracy edytora, czyli utracisz możliwość ustawienia czcionek, kolorów i obrazków w pisanej wiadomości.",confirm:"Zatwierdź",callback:function(){e(function(){g.fire("tinymce-textmode-confirmed",b)},0,!1)},callbackCancel:function(){e(function(){g.fire("tinymce-textmode-canceled",b)},0,!1)},callbackClose:function(){e(function(){g.fire("tinymce-textmode-canceled",b)},0,!1)}})},0)}),i.$on("tinymce:focus",function(){g&&g.focus()}),g.on("angular-broadcast",function(b){a.$broadcast(b.name,b.data)}),g.on("angular-emit",function(b){i.$emit(b.name,b.data),"tinymce:stationerySelected"==b.name&&(d.pushGACode("mailContentStationery",b.data.id),d.pushIWACode("mailContentStationery",b.data.id),a.$broadcast("bubble:close",4))}),g.on("focus",function(){i.$emit("tinymce:content:focus")}),g.on("ExecCommand",function(a){switch(a.command){case"FontName":d.pushGACode("mailContentFontTypeName",a.value);break;case"FontSize":d.pushGACode("mailContentFontSize",a.value);break;case"ForeColor":d.pushGACode("mailContentFontColor",a.value),d.pushIWACode("mailContentFontColor",a.value),g.editorContainer.querySelector(".mce-i-forecolor").style.color=a.value;break;case"InsertOrderedList":d.pushGACode("mailContentNumericList",a.value),d.pushIWACode("mailContentAlign","lista numerowana");break;case"InsertUnorderedList":d.pushGACode("mailContentPointList"),d.pushIWACode("mailContentAlign","lista punktowana");break;case"JustifyLeft":d.pushGACode("mailContentAlign","lewej"),d.pushIWACode("mailContentAlign","do lewej");break;case"JustifyRight":d.pushGACode("mailContentAlign","prawej"),d.pushIWACode("mailContentAlign","do prawej");break;case"JustifyCenter":d.pushGACode("mailContentAlign","środek"),d.pushIWACode("mailContentAlign","do srodka")}}),g.on("ExecCommand",function(){}),g.on("blur",function(){i.$emit("tinymce:content:blur")}),g.on("paste keyup",function(){j||i.$emit("composition:mark-as-modified")}),g.on("paste",function(a){e(function(){var a=document.createElement("style");a.type="text/css",a.innerHTML="#icselection13 {width: 100% !important; height: 100% !important; padding-top: 0px !important; overflow: visible !important;}",angular.element(g.iframeElement)[0].contentDocument.body.appendChild(a),g.execCommand("mceAutoResize"),i.$emit("composition:updateSize"),i.$emit("ac:update")},100,!1)}),g.on("change",function(){i.$emit("composition:onchange")}),g.Tools=f,i.$emit("tinymce:init");var k={"mce-i-bold":{tooltip:"Pogrubienie",trackGA:"mailContentBold",trackIWA:"mailContentBold",additionalClass:"btn-active-shadow"},"mce-i-italic":{tooltip:"Kursywa",trackGA:"mailContentItalic",trackIWA:"mailContentItalic",additionalClass:"btn-active-shadow"},"mce-i-webmailfont":{tooltip:"Rodzaj i wielkość czcionki",trackGA:"mailContentFontType"},"mce-i-underline":{tooltip:"Podkreślenie",trackGA:"mailContentUnderline",trackIWA:"mailContentUnderline",additionalClass:"btn-active-shadow"},"mce-i-forecolor":{tooltip:"Kolor tekstu",trackGA:"mailContentFontColor"},"mce-i-webmailcontentstyle":{tooltip:"Tworzenie list i wyrównanie tekstu",trackGA:"mailContentAlignClick"},"mce-i-stationery":{tooltip:"Papeterie",trackGA:"mailContentStationery"},"mce-i-inlineimage":{tooltip:"Wstaw obrazek",trackGA:"mailContentInsImg",trackIWA:"mailContentInsImg"},"mce-i-emoticons":{tooltip:"Wstaw emotikonę",trackGA:"mailContentInsEmot",trackIWA:"mailContentInsEmot"},"mce-i-expand":{tooltip:"Wyczyść formatowanie",trackGA:"mailContentClearFormat"}};Object.keys(k).forEach(function(a){var b=g.editorContainer.querySelector("."+a);k[a].tooltip&&(b.setAttribute("data-tooltip",k[a].tooltip),b.parentNode.setAttribute("data-tooltip",k[a].tooltip)),k[a].trackGA&&(b.setAttribute("data-track-click",k[a].trackGA),b.parentNode.setAttribute("data-track-click",k[a].trackGA)),k[a].trackIWA&&(b.setAttribute("data-track-click-iwa",k[a].trackIWA),b.parentNode.setAttribute("data-track-click-iwa",k[a].trackIWA)),k[a].additionalClass&&b.parentNode.classList.add(k[a].additionalClass)}),i.$on("tinymce:switched-editor-mode",function(a,b){var c=b.isHTML?"Wyczyść formatowanie":"Wielkość i kolor liter oraz inne opcje formatowania (tryb html)",e=b.isHTML?".mce-i-expand":".mce-i-collapse",f=g.container.querySelector(e);f.setAttribute("data-tooltip",c),f.parentNode.setAttribute("data-tooltip",c),d.pushGACode(b.isHTML?"mailContentEditorHtmlOn":"mailContentEditorHtmlOff"),d.pushGACode()}),i.$on("hideAllPanels",function(){tinymce.ui.FloatPanel.hideAll()}),i.$on("$destroy",function(){tinymce.ui.FloatPanel.hideAll(),g.off(),g.remove(),g.destroy(),g=null})}}}]),angular.module("nxt-avatar").provider("Avatar",function(){this.$get=["$http","ApplicationConfig",function(a,b){return{setAvatar:function(c){return a.put(b.env.pocztaApiUrl+"/v1/avatar/change",c)},addToAlbum:function(c){return a.post(b.env.pocztaApiUrl+"/v1/avatar/addToAlbum",c)}}}]}),angular.module("nxt-billing").provider("Billing",function(){"use strict";var a={isBill:1,notPaid:2,startPaid:4,paid:16},b=268435456;this.$get=["$http","Http","$rootScope","ApplicationConfig",function(c,d,e,f){function g(a,b){var g=[];return g=angular.isArray(a)?a.map(function(a){return{pname:a}}):[{pname:a}],c.put(f.env.billingServiceUrl+"/poczta/transaction/"+b,g,d.appendJsonRequestConfig({transformRequest:function(a){return a},headers:{"IPL-TOKEN":f.env.token}})).then(function(){e.$broadcast("service:billing:mark-as-paid",{pnames:a,state:b})})}return{STATES:a,FOLDER_ID:b,notificationInfo:function(){return c.get(f.env.billingServiceUrl+"/poczta/reminder",{headers:{"IPL-TOKEN":f.env.token}})},markAsPaid:function(b){g(b,a.paid)},markAsNotPaid:function(b){g(b,a.notPaid)},activate:function(){return c.post(f.env.mailSettings+"/v1/billing/activate",{},{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("Bubble",function(){"use strict";var a=[],b=[],c=1;this.$get=["$rootScope","ApplicationConfig","Track","$http","$state","$timeout",function(d,e,f,g,h,i){function j(a){return g.put("/bubble",a)}return function(){a=e.env.infoBoards.length>0||""===e.env.infoBoards?[]:e.env.bubbles}(),function(){if(!e.env.device.isMobile){var b={showSettings:function(){i(function(){h.go(".settings")},1500)}};if(a.length>0){var c=a[0].options.callbackBefore;c&&"function"==typeof b[c]&&b[c]()}}}(),{getBubbleToShow:function(c){if(b.indexOf(c)!==-1)return null;for(var d=0;d<a.length;d++)if(a[d].id==c)return b.push(c),a[d];return null},updateSetting:function(a){j(a)},updateSettingAsVisible:function(a){a<0||j({id:a,state:c})},showNotClosed:function(a){var c=b.indexOf(a);c>-1&&b.splice(c,1)},injectBubble:function(b){if(b.id>=0)throw"id should be less than 0";a=[{id:b.id?b.id:"",options:{isPc:"1",showOnlyOnce:"1",textField:b.textField?b.textField:"",template:"/common/views/bubble.html"},type:0,value:0,setting:null,name:b.name?b.name:"",priority:"1"}]}}}]}),angular.module("nxt-common").provider("Counter",function(){"use strict";function a(){var a=k.userFolderUnseen+k.folders[b];return c&&(a+=k.folders[c]),d&&(a+=k.folders[d]),e&&(a+=k.folders[e]),a}var b,c,d,e,f,g,h,i,j=!1,k={folders:{},userFolders:{},userFolderUnseen:0},l={},m=document.title;this.$get=["$rootScope","ApplicationConfig","Folder","MobileApp","$state","$stateParams",function(n,o,p,q,r,s){function t(){n.$broadcast("controller:counters:update");var b=a();document.title=m+(b>0?" ("+b+")":"")}return{init:function(){j||(j=!0,n.$on("service:longpoll:success",function(a,b){b.inLastHour&&(l.user[b.folderId]?(k.userFolderUnseen++,k.userFolders[b.folderId]?(k.userFolders[b.folderId]++,k.userFolders[b.folderId].total&&k.userFolders[b.folderId].total++):k.userFolders[b.folderId]=1):l.system[b.folderId]&&(k.folders[b.folderId]++,l.system[b.folderId].total++)),t()}),n.$on("controller:folder:seen",function(a,b){[f,g,i,h].indexOf(b)===-1&&(l.user&&l.user[b]?(p.touch(parseInt(b)),k.userFolderUnseen-=k.userFolders[b],k.userFolders[b]=0):l.system&&l.system[b]&&(p.touch(parseInt(b)),k.folders[b]=0),t())}),n.$on("controller:folder:update",function(a,b){var c=1,d=1;b.messages.length>0?b.messages.forEach(function(a){a.threadId>0?(c=a.undreadMsgCount,d=a.msgCount):(c=1,d=1),l.all[a.folderId]&&(l.all[a.folderId].total-=d),l.all[b.folderId]&&(l.all[b.folderId].total+=d)}):(l.all[b.folderId]&&(l.all[b.folderId].total+=l.all[r.params.folderId].total),l.all[r.params.folderId]&&(l.all[r.params.folderId].total=0)),n.$broadcast("controller:folder:seen",s.folderId)}),n.$on("controller:folder:update:delete",function(a,b){b.messages.forEach(function(a){l.all[a.folderId].total--})}))},update:function(a){function j(b){return a.all[b].unseen}function m(a){a.unseen?(k.userFolders[a.id]=a.unseen,k.userFolderUnseen+=a.unseen):k.userFolders[a.id]=0}l=a,b||(b=a.all.INBOX,c=a.all.SHOPPING,d=a.all.SOCIAL,e=a.all.BILLING,f=a.all.SPAM,g=a.all.DRAFTS,h=a.all.SENT,i=a.all.TRASH),k.folders[b]=j(b),k.folders[f]=j(f),k.folders[g]=j(g),k.folders[h]=j(h),k.folders[i]=j(i),c&&(k.folders[c]=j(c)),d&&(k.folders[d]=j(d)),e&&(k.folders[e]=j(e)),k.userFolderUnseen=0,Object.keys(a.user).forEach(function(b){var c=a.user[b];if(0===c.parentId&&(m(c),c.subfolders))for(var d=0;d<c.subfolders.length;d++)m(c.subfolders[d])}),t()},updateWithoutFolders:function(){this.update(l)},getCounters:function(){return k},getSumAllCounters:function(){var b=a();return o.env.device.isMobileApp&&q.onUnreadCountChange(b),b}}}]}),angular.module("nxt-common").service("FileClassFinder",function(){var a={zip:["zip","rar","7z","tar","gz","bz2","tgz","zipx"],web:["html","htm","css","js","php","xml"],vid:["asf","wm","wmv","wmp","avi","ifv","dat","mov","qt","mpg","mpeg","mpe","mpv","m1v","rm","ram","rl2","swf","vob","mp4","flv","rmvb","3gp","3g2","oggmovie"],txt:["txt","mobi","epub"],spr:["xls","xlsx","ods","csv"],pre:["ppt","pptx","odp"],pdf:["pdf"],oof:["ott","odm","ots","odg","otg","otp","odf","odc","odb"],mus:["aif","aiff","aifc","aifr","midi","mid","rmi","mp2","mp3","mpeg3","ogg","ra","vqf","wave","wav","wma","flac","amr","ac3","m4a"],mso:["dot","docm","dotx","dotm","xlt","xlm","xlsm","xltx","xltm","xlsb","xla","xlam","xll","xlw","pot","pps","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm"],img:["jpg","jpeg","gif","png","bmp","dib","cdr","tif","tiff","psd","pcx","ico"],cad:["dwg"],doc:["doc","docx","rtf","odt"],eml:["eml"]};this.getFileClass=function(b){for(var c in a)if(a.hasOwnProperty(c)&&a[c].indexOf(b.toLowerCase())!==-1)return c;return"undetected"},this.isImage=function(a){return["gif","jpg","jpeg","png","tif","tiff","ico","bmp"].indexOf(a.toLowerCase())!==-1},this.isVideo=function(a){return["mov","mp4"].indexOf(a.toLowerCase())!==-1}}),angular.module("nxt-common").service("Http",["$http",function(a){function b(a,b){return c||(c=angular.isArray(a)?angular.copy(a):[angular.copy(a)],c.shift()),[b].concat(c)}var c;this.appendJsonRequestConfig=function(c){return c.headers=c.headers||[],c.headers["X-HTTP-Body-Format-Json"]=!0,c.transformRequest&&(c.transformRequest=b(a.defaults.transformRequest,c.transformRequest)),c},this.ping=function(){return a.get("/ping")}}]),angular.module("nxt-common").provider("InfoBoards",function(){"use strict";var a=201,b=202,c=601,d=203,e=204,f=212,g=213,h=217,i=220,j=221,k=224,l=228,m=229,n=230,o=231,p=232,q=234,r=235,s=236,t=239,u=800,v=801,w=802,x=[],y={},z=!1;this.$get=["$rootScope","ApplicationConfig","DialogManager","Track","$http","Notification","$state","$stateParams","Messages","Setting","Folder","Bubble",function(A,B,C,D,E,F,G,H,I,J,K,L){function M(){I.deleteMailings().then(function(a){a.status&&A.$broadcast("folder:refresh")})}function N(){L.injectBubble({id:-1,textField:"Wypróbuj świąteczną skórkę!",name:"christmasSkin"}),G.go(".settings")}function O(){G.go("folder",{folderId:B.folders.SHOPPING,sort:null,search:null,searchf:null,filter:null,mode:null,withComposition:null,page:null})}function P(){A.$broadcast("folder:delegateMoveToFolder")}function Q(){A.$broadcast("folder:uncheckedAllMessages")}function R(){window.open(y.options.destUrl,B.env.device.isMobile?"_self":"_target")}function S(){var a,b=y.options;if(z&&(b=angular.extend(b,z)),y.id=parseInt(y.id),a={additionalClass:y.name,additionalData:b,template:!!y.options.template&&y.options.template,isHeaderHidden:void 0===y.options.isHeaderShow||!y.options.isHeaderShow,title:void 0!==y.options.title?y.options.title:"",message:void 0!==y.options.message?y.options.message:"",isModal:!b.notMaximize,callback:Z[y.options.displayCallback],success:Z[y.options.successCallback],callbackCancel:Z[y.options.cancelCallback],isBackgroundCloseable:!!y.options.isBackgroundCloseable},b.callbackClose&&(a.callbackClose=b.callbackClose),y.id===h&&1===B.env.adminBusinessPackType&&(a.title="Korzystasz z pakietu dla firm"),C.infoBoard(a),y.options.stat){var c;"iwa"===y.options.stat.type?(c=y.options.stat.display.split("|"),D.pushIWA(c)):"iwaCode"===y.options.stat.type?D.pushIWACode(y.options.stat.display):"ga"===y.options.stat.type?(c=y.options.stat.display.split("|"),D.pushGA(c)):"gemius"===y.options.stat.type&&D.pushGemius(y.options.stat.display)}}function T(a){var b=[e,f,i,j];return b.indexOf(a)!==-1}function U(b){var c=parseInt(b);a===c&&(z=B.env.premiumInfo,z=angular.extend(z,{mail:B.env.ownEmail,confirm:"Przedłuż teraz"})),l===c&&(z=B.env.businessPackInfo),T(c)&&(z={callbackClose:function(){W({id:b,state:B.boardStates.BOARD_STATE_SHOW,sValue:1})},appUrl:y.options.appUrl})}function V(){var a,b,c=B.hacks.isWindowsPhoneOS,d=B.hacks.isIOS&&B.env.isMobileApp;B.env.device.isPc&&(b="isPc"),B.env.device.isMobile&&(b="isMobile"),B.env.device.isMobileApp&&(b="isMobileApp");var e=function(a){return!c||"undefined"==typeof a.options.doNotShowOnWindowsPhoneOS},f=function(a){return!d||"undefined"==typeof a.options.doNotShowOnIOSApp};for(a=0;a<x.length;a++)if(x[a].options&&parseInt(x[a].options[b])&&e(x[a])&&f(x[a]))return x[a]}function W(a){return E.put("/infoBoard",a)}function X(a,b){a=a||y.id,!b&&y.options.blockShowRequest||W({id:a,state:B.boardStates.BOARD_STATE_SHOW,sValue:1})}function Y(a,b){var c={id:a};return b&&(c.isTrigger=1),E.get("/infoBoard",{params:c,transformResponse:function(a){var b;return B.env.device.isPc?b="isPc":B.env.device.isMobileApp?b="isMobileApp":B.env.device.isMobile&&(b="isMobile"),!!(a&&a.data&&a.data.options&&parseInt(a.data.options[b]))&&(y=a.data,S(),X(),a.data)}})}var Z={deleteMailings:M,changeSkinChristmas:N,acceptMovingToSpam:P,openPremiumSite:R,cancelMovingToSpam:Q,blikAdSuccessCallback:O};return{REMOVE_MAILING_BOARD_ID:u,SPAM_MAILING_BOARD_ID:v,SPAM_NOT_TRASH:w,PUSH_PROMPT:p,BILLING:o,SAFE_MAIL:q,init:function(a){if(x=a?[a]:B.env.infoBoards,y=V()){if(NXT_CONFIG.isInitInfoboardDisplay=!0,y.id=parseInt(y.id),y.type=parseInt(y.type),5===y.type)switch(y.id){case d:C.adultPermission({});break;case g:C.popTrashBar({additionalData:{cancel:function(a){a&&J.update({dontShowPopTrashBar:1})},success:function(a){a&&J.update({dontShowPopTrashBar:1}),K.restorepopped().then(function(){F.success("Przywrócono wiadomości usunięte POP3"),parseInt(H.folderId)!==B.folders.INBOX&&parseInt(H.folderId)!==B.folders.TRASH||(I.clearBuffer(),A.$broadcast("folder:refresh"))})}}});break;case o:location.href.indexOf("board=231")!==-1?B.env.hasBillingFolder?setTimeout(function(){G.go("folder",{folderId:B.folders.BILLING,sort:null,search:null,searchf:null,filter:null,mode:null,withComposition:null,page:null})}):C.billing(function(){X(o)},"z_linku"):C.billing(function(){X(o)},"nowy_mail_rachunek");break;default:U(y.id),S()}else if(6===y.type)switch(y.id){case c:C.dataSecurity({id:parseInt(y.id),isBlocking:1==y.options.isBlocking});break;case m:C.businessWebsiteComplete({id:parseInt(y.id),stat:y.options.stat});break;case q:C.safeMail({id:parseInt(y.id),isBlocking:1==y.options.isBlocking,title:y.options.title,description:y.options.description,stat:y.options.stat});break;case s:C.businessAccountExtensionInfoBoard({id:parseInt(y.id),template:y.options.template,additionalClass:y.name,isHeaderHidden:!0,stat:y.options.stat,additionalData:{destUrl:y.options.destUrl,isInNewWindow:!!y.options.isInNewWindow,stat:y.options.stat}}),D.pushIWACode(y.options.stat.display);break;case t:C.add({template:y.options.template,additionalClass:y.name,isModal:!0,isHeaderHidden:!0,additionalClasses:"change-password",message:y.options.message,additionalData:{stats:y.options.stat,description:y.options.description}});break;default:U(y.id),S()}else 7===y.type?C.multiBoards(y.options):y.id===k?C.birthdayRodo({}):y.id===n||y.id===l?(C.businessAccountDaysToEndInfoBoard({id:y.id,template:y.options.template,additionalClass:y.name,isHeaderHidden:!0,success:Z[y.options.successCallback],additionalData:{destUrl:y.options.destUrl,isInNewWindow:!!y.options.isInNewWindow,stat:y.options.stat}}),D.pushIWACode(y.options.stat.display,y.id)):y.id===r?(y.options.callbackClose=function(){W({id:y.id,state:B.boardStates.BOARD_STATE_SHOW,sValue:1})},C.surveyPlywak(y.options)):y.id===b?C.expiredInfo({id:parseInt(y.id),template:y.options.template,title:y.options.title,additionalClass:y.name}):(U(y.id),S());this.displayBoardTrigger(),this.clearInfoboardsQueque()}},clearInfoboardsQueque:function(){B.env.infoBoards=""},displayBoardTrigger:function(a,b){X(a,b)},updateSetting:function(a){W(a)},getBoardConfById:function(a){return E.get("/infoBoard",{params:{id:a}})},displayById:Y}}]}),angular.module("nxt-common").provider("MarketingData",function(){"use strict";this.$get=["ApplicationConfig","$http",function(a,b){return{updateAgreementData:function(c){return b.post(a.env.pocztaApiUrl+"/v1/marketingData/updateAdultAgreement?uid="+a.env.uid,c,{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("MobilePush",function(){"use strict";this.$get=["ApplicationConfig","$http","Http",function(a,b,c){return{register:function(a){return b.post("/mobilepush/register",a,c.appendJsonRequestConfig({transformRequest:function(a){return a},withCredentials:!0}))},unregister:function(a){return b["delete"]("/mobilepush/unregister",a,c.appendJsonRequestConfig({transformRequest:function(a){return a},withCredentials:!0}))}}}]}),angular.module("nxt-common").provider("PersonalData",function(){"use strict";this.$get=["ApplicationConfig","$http",function(a,b){return{getUserYear:function(){return b.get(a.env.pocztaApiUrl+"/v1/marketingData/read?uid="+a.env.uid,{withCredentials:!0})},setUserYear:function(c){return b.post(a.env.pocztaApiUrl+"/v1/personalData/updateBirthdate?uid="+a.env.uid,{birthDate:c.birthDate},{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("Profile",function(){"use strict";function a(){var a=document.cookie.replace(/(?:(?:^|.*;\s*)UPROFILE\s*\=\s*([^;]*).*$)|^.*$/,"$1");return a&&(a=decodeURIComponent(a),a=JSON.parse(a)),a}var b={IMAGE:1,TEXT:2};this.$get=["ApplicationConfig","$http",function(c,d){return{AVATAR_TYPE:b,updateAccountType:function(a){return d.post(c.env.pocztaApiUrl+"/v1/profileData/updateAccountType",{uid:c.env.uid,sid:c.env.sid,type:a},{withCredentials:!0})},getAvatarFromCookie:function(){var d="1006",e=a(),f=c.env.ownName.length>0?c.env.ownName.substr(0,1):c.env.ownEmail.substr(0,1),g={type:b.TEXT,data:c.env.avatarStyle,initial:f};return e&&e[d]&&e[d].e&&(g.type=b.IMAGE,g.data={id:e[d].a,ext:e[d].e}),g}}}]}),angular.module("nxt-common").provider("Retargeting",function(){"use strict";this.$get=["$rootScope","ApplicationConfig","$http","$cookies",function(a,b,c,d){function e(){return d.get(f)}var f="isRetargeting";return{getRetargeting:function(){if(b.env.isRetargeting&&!b.env.accountType&&!e()){var g=new Date,h=g.getTime(),i=h+72e5;g.setTime(i),c.get("/retargeting").then(function(c){if(c.address){var e=b.env.isAdultAgreement,h="https://rt.inistrack.net/d/rt.php?t=ic&p=interia&cid="+c.address,i="https://bo.goadservices.com/widget_mail_interia.php?partner=interia_mail&z="+(e?"1":"0")+"&hash="+c.address,j="https://mrtg.emailpartners.net/a/i/v/26bdsz/"+c.address,k={inis:h,go:i,playlink:j};d.put(f,1,{expires:g.toGMTString()}),a.$broadcast("retargeting:updateUrls",k)}})}}}}]}),angular.module("nxt-common").provider("Security",function(){"use strict";this.$get=["ApplicationConfig","$http","Http",function(a,b,c){return{getSecurityData:function(){return b.get(a.env.mailSettings+"/v1/recovery",{withCredentials:!0})},setSecurityData:function(d){return b.post(a.env.mailSettings+"/v1/recovery/poczta",d,c.appendJsonRequestConfig({transformRequest:function(a){return a},withCredentials:!0}))},changePassword:function(d,e){return b.post(a.env.mailSettings+"/v1/account/password/1",{oldPassword:d,newPassword:e},c.appendJsonRequestConfig({transformRequest:function(a){return a},withCredentials:!0}))},logout:function(){return b.post(a.env.loginUrl+"/poczta/rest/wyloguj",null,{withCredentials:!0})}}}]}),angular.module("nxt-common").provider("Setting",function(){"use strict";this.$get=["$http","Notification",function(a,b){return{get:function(){return a.get("/setting",{transformResponse:function(a){return a}})},update:function(c,d){return a.put("/setting",c).then(function(a){d&&b.success(d,a)})}}}]}),angular.module("nxt-common").service("Tools",["$rootScope",function(a){var b={1:"Poniedziałek",2:"Wtorek",3:"Środa",4:"Czwartek",5:"Piątek",6:"Sobota",7:"Niedziela"};this.stripTagsFormatBlockQuotes=function(a){if(!a||!a.length)return"";var b,c=a.replace(/&gt;/g,">").replace(/> +>/g,">>"),d=c.split(/(?=<\/?(?:address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)[^>]*>|<br\s*\/?>)/i),e="",f="";
return d.forEach(function(a,b,c){0===a.indexOf("<blockquote")?e+=">":0===a.indexOf("</blockquote")&&(e=e.substring(0,e.length-1)),c[b]=a.replace(/^<\/?[^>]*>\s*/,e+(e&&" ")).replace(/<\/?[^>]*>/gi,"")}),d.length>1?(f=b=d[0],d.forEach(function(a,c){c>0&&a!==b&&(f+="\n"+a),b=a})):1===d.length&&(f=d[0]),f},this.getSortString=function(a){a=a.toLocaleLowerCase();var b="1".charCodeAt(0),c="aąbcćdeęfghijklłmnńoópqrsśtuvwxyzźż".split(""),d=a.split("");return d=d.map(function(a){var d=c.indexOf(a);return d!==-1?String.fromCharCode(d+b):"0".charCodeAt(0)}),d.join("")},this.getTextOnly=function(a){if(!a)return"";var b=document.createElement("DIV");return b.innerHTML=a.replace(/<(?:.|\n)*?>/gm,""),b.textContent||b.innerText||""},this.formatDateForReply=function(a){var c=a.split(" "),d=c[0].split("-"),e=c[1].split(":"),f=new Date(d[0],d[1]-1,d[2],e[0],e[1]);return c[1]+" "+b[f.getDay()]+" "+c[0]},this.removeFromArray=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},this.extendArray=function(a,b){var c={},d=0;for(d=a.length-1;d>=0;--d)c[a[d]]=a[d];for(d=b.length-1;d>=0;--d)c[b[d]]=b[d];var e=[];for(var f in c)c.hasOwnProperty(f)&&e.push(c[f]);return e},this.removePolishDiacritics=function(a){var b=a.toLowerCase(),c={a:"[ą]",c:"ć",e:"[ę]",l:"[ł]",n:"ń",o:"[ó]",s:"ś",z:"[źż]"};for(var d in c)c.hasOwnProperty(d)&&(b=b.replace(new RegExp(c[d],"g"),d));return b},this.frameLoginSuccess=function(b){a.$broadcast("frame-login:success",b)},this.frameLoginFailed=function(){a.$broadcast("frame-login:failed")},this.setElementIsolateScope=function(a,b){a[0].isolateScope=function(){return b}},this.getVarietyVerbs=function(a,b){var c,d=a%10,e=a%100;return 1===parseInt(a)&&b[1]?c=b[0]:(0==a||d>=0&&d<=1||d>=5&&d<=9||e>10&&e<20)&&b[0]?c=b[2]:(e<10||e>20)&&d>=2&&d<=4&&b[2]&&(c=b[1]),c}}]),angular.module("nxt-common").provider("TooltipBubble",function(){"use strict";this.$get=["ApplicationConfig",function(a){var b=[];return b=[{id:0,title:"Bezpieczny nadawca",desc:"Ten symbol oznacza, że nadawca tej wiadomości został poprawnie zweryfikowany.",href:"int"===a.env.service.name?"http://help.int.pl/news-oznaczenie-bezpieczny-nadawca,nId,2451589":"http://pomoc.poczta.interia.pl/news-oznaczenie-bezpieczny-nadawca,nId,2450294",icon:"icon-padlock"},{id:1,desc:'Aby dostawać powiadomienia z folderu Oferty <a href="https://ustawienia.interia.pl/poczta/filtry" target="_blank" class="link">włącz<a/> go na koncie.'},{id:2,desc:'Aby dostawać powiadomienia z folderu Społeczności <a href="https://ustawienia.interia.pl/poczta/filtry" target="_blank" class="link">włącz<a/> go na koncie.'}],{getTooltipBubbleToShow:function(a){for(var c=0;c<b.length;c++)if(b[c].id===parseInt(a))return b[c];return null}}}]}),angular.module("nxt-common").service("Track",["ApplicationTrackEvent","ApplicationConfig",function(a,b){function c(a){return a.shift(),a[2]=a.slice(2),a=a.slice(0,3),a=a.map(function(a){return"object"==typeof a&&(a=JSON.stringify(a).replace(/[{|}]|\[|\]|"|'/g,"").replace(":","=")),a})}var d="poczta-PV_czesciowe",e=this,f={pushGA:function(){},pushGFK:function(){},pushGemius:function(){},pushIWA:function(){},pushGACode:function(){},pushIWACode:function(){},pushIWAandGA:function(){},pushPartialFolder:function(){}},g=function(b){var c=[];return c.gemius=[],c.gemius.inMobileApp=a.SEND_TRACK,b[3]&&b[3][0]&&b[3][0][0]&&(c.gemius.inMobileApp=b[3][0][0]),c};if(this.pushMobileApp=function(c){var d=g(c);if(d.gemius.inMobileApp==a.SEND_TRACK)try{var e=b.hacks.isIOS;e?window.webkit.messageHandlers.hitGemius.postMessage("hitGemius"):MobileAppConnector.sendGemiusHit()}catch(f){console.log("Only to use in mobileApp hitGemius",c)}},this.pushIwaCodeMobileApp=function(d,e){var f=a.getIWA(d,e);f=c(f),console.log("mobileApp IWA: ",f);try{var g=b.hacks.isIOS;g?window.webkit.messageHandlers.hitIWA.postMessage({category:f[0],action:f[1],label:f[2]}):MobileAppConnector.hitIWA(f[0],f[1],f[2])}catch(h){console.log("Only to use in mobileApp - pushIwaCodeMobileApp "+h)}},this.pushGA=function(a,c){if(c=[c||"b._trackEvent"],"undefined"!=typeof _gaq)if(a=c.concat(a),b.env.dev)console.log(a);else try{_gaq.push(a)}catch(d){console.log(d)}else console.log(a)},this.pushGFK=function(a){a&&(d=a)},this.pushGemius=function(a){b.env.dev?console.log("gemius",a):"undefined"!=typeof gemius_hit&&gemius_hit(a)},this.pushIWA=function(a){a.unshift("trackEvent"),b.env.dev?console.log("IWA",a):"undefined"!=typeof iwa&&iwa.apply(this,a)},this.pushIWACode=function(b,c){this.pushIWA(a.getIWA(b,c))},this.pushPartialFolder=function(b,c){this.pushIWA(a.getPartialFolderIWA(b,c))},this.pushGACode=function(b,c,d){this.pushGA(a.getGA(b,c)||b,d)},b.env&&b.env.isMobileApp)return f.pushGA=e.pushMobileApp,f.pushGACode=e.pushGACode,f.pushIWACode=e.pushIwaCodeMobileApp,f}]),angular.module("nxt-composition").factory("Compositions",["DialogManager","Track","$http","$rootScope","ApplicationConfig","ExternalAccount","Contact","Uploader","$state","Stationery","Tools","ApplicationData",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b){F=a,d.$broadcast("compositions:update-sender",b),G&&(G=!1,d.$broadcast("external-account:close"))}function n(a){var b=[];a&&a.forceUpdate?f.query().then(function(c){angular.isArray(c)&&(b=angular.copy(c)),m(b,a)}):(angular.isArray(l.get("ExternalAccount").data)&&(b=angular.copy(l.get("ExternalAccount").data)),m(b,a))}function o(c){if(c&&("ra"===c.opt||"e"===c.opt)&&c.mesg&&(c.singleInstanceId=c.mesg),c&&c.toActive){if("function"==typeof E)return void E(c.toActive);c.to=c.toActive,delete c.toActive}a.add({compositionConfig:c,title:"Nowa wiadomość",template:e.env.device.isMobile?"/dialog/views/dialog_composition_mobile.html":"/dialog/views/dialog_composition.html",dialogType:a.DialogTypes.COMPOSITION,isHeaderHidden:!!e.env.device.isMobile,isHeaderVisible:!0,callbackClose:function(){b.pushGACode("dialogNewMailClose"),b.pushIWACode("dialogNewMailClose")},callbackMinimize:function(){b.pushGACode("dialogNewMailMin")},callbackMaximize:function(a){a.hasClass("maximized")?(b.pushGACode("dialogNewMailFull"),b.pushIWACode("dialogNewMailFull")):b.pushGACode("dialogNewMailFullClose")}}),b.pushIWACode("partialOpenNewMsg"),d.$broadcast("composition:save")}function p(a){return a.attachments||(a.isGallery=0),c.post("/message/send",a).then(function(a){if(a.contacts&&a.contacts.length&&(d.$broadcast("service:composition:autoinsert-contact",a.contacts),e.env.device.isMobile)){var b=l.get("Contact").data;a.contacts.forEach(function(a){if("pomoc@firma.interia.pl"!==a.email){a.name=a.email.substr(0,a.email.indexOf("@")),a.score=9.89009141411e-7,a.type=g.CONTACT_TYPE_AUTOINSERT;var c=g.create(a);b.push(g.contactObjectToArray(c))}}),l.putBroadcast("Contact",{time:e.cacheTime,data:b})}return a})}function q(a){var c,f=["to","cc","bcc","prior","cntType","from"],j=["to","cc","bcc"],k=[],l=a.attachments,m=a.params,n=a.originalMessageRevealed,o=a.originalContent;switch(m.rawContent&&(k=h.getInlineAttachmentsIds(m.rawContent),k.forEach(function(a){l.indexOf(a)===-1&&l.push(a)})),c={mid:m.mid,to:m.to,fromId:m.from&&m.from.vsmtpId?m.from.vsmtpId:-1,fromEmail:m.from&&m.from.email?m.from.email:"",fromType:m.from&&m.from.type?m.from.type:"",cc:m.cc,bcc:m.bcc,subject:m.subject,prior:+m.prior,confirm:+m.confirm,content:m.content,isGallery:K,attachments:l.join(),cntType:m.isHTML?"html":null,originalContent:!n&&o,extAccType:m.from&&m.from.type?m.from.type:"",extAccId:m.from&&m.from.id&&m.from.id!=-1?Math.abs(m.from.id):null},m.mode){case"send":c=angular.extend(c,{optSend:1});break;case"reply":c=angular.extend(c,{optSend:1,opt:"ra"});break;case"save":c=angular.extend(c,{optSend:3,opt:"e"}),m.selectedSignature&&m.selectedSignature.id&&m.selectedSignature.id!==e.defaultSignatureId&&(c.signatureId=m.selectedSignature.id)}f.forEach(function(a){(!c[a]||angular.isArray(c[a])&&0===c[a].length)&&delete c[a]}),j.forEach(function(a){c[a]&&angular.isArray(c[a])&&(c[a]=c[a].map(function(a){return{name:a.name||"",email:a.email,type:a.type||g.CONTACT_TYPE_ALL,id:a.id||""}}))}),m.onBeforeStart&&m.onBeforeStart(),p(c).then(function(a){a?m.onSuccess&&(m.onSuccess(a),i.params.folderId==e.folders.SENT&&d.$broadcast("folder:refresh"),b.pushGACode("mailAutosaveConfirm")):m.onError&&m.onError()},function(a){m.onError&&m.onError(a)})}function r(a,b,c){var d="--";H||(d="");var e,f,g=c?"<br>":"\n",h=c?b.split("\n").join("<br>"):b,i=g+d+g+h+(c?"":g),j="",k="",l=c?'<div class="'+L+'"':"\n> \n> ",m=a.indexOf(l);return e=a.match(/<[^>]+(data-inpl-forward-mark|inpl-revealable)[^>]*>((?!<\/div>).)*<\/div>/),e&&e.length>0?(f=a.indexOf(e[0]),f!==-1&&(m=f,a=a.replace(/<[^>]+data-inpl-forward-mark[^>]*>((?!<\/div>).)*<\/div>/,"<br>"))):i=g+i,m===-1?j=a:(j=a.substring(0,m),k=a.substring(m)),j+i+k}function s(a,b,c){if(c){var d="<blockquote",e=b.indexOf(d)+d.length,f=b.substring(0,e),g=b.substring(e);return f+=' class="nxt-original-message-notrevealed"',b=f+g,a+b}return a+k.stripTagsFormatBlockQuotes(b)}function t(a,b){var c=b?"<br>":"\n";return a+c+c+"Rozdzielczość: "+screen.width+"x"+screen.height}function u(a){return a+" <public_gallery_body>"}function v(a,b){var c=b?"<br>":"\n";return a+c+c+c+c+c+c+"Platforma: "+navigator.platform+c+"User Agent: "+navigator.userAgent+c+"Rozdzielczość: "+screen.width+"x"+screen.height}function w(a){var b=["a","ul","ol","li","div","span"];return b.indexOf(a.split(".")[0])!==-1}function x(a,b){var c,d,e="send"===a,f="reply"===a;if(!e&&!f)return b;var g=e?"<[^>]+data-inpl-forward-mark[^>]*>((?!</div>).)*</div>":"<div\\s+class=."+L+".>",h=new RegExp(g,"g"),i=h.exec(b),j=null!==i&&i.index!==-1;j?(c=b.substr(0,i.index),d=b.substr(i.index)):c=b;var k=y(c);return j?k+d:k}function y(a){var b=/(?:https?:\/\/)?(?:[\da-z])(?:[\da-z-@]|\.(?!\.))+\.(?:[a-z]{2,})(?:\.[a-z]{2,})?(?:[\/\w\.\-?@!:;'&=#\+%_,ąćęłńóśżźĄĆĘŁŃÓŚŻŹäöüÄÖÜß]*)*\/?/gi;return a.replace(b,function(a){return w(a)?a:a.indexOf("http://")!==-1||a.indexOf("https://")!==-1?'<a href="'+a+'" target="_blank">'+a+"</a>":a.indexOf("@")!==-1?'<a href="mailto:'+a+'">'+a+"</a>":'<a href="http://'+a+'" target="_blank">'+a+"</a>"})}function z(a,b){return"save"!==a&&(!H&&I&&J||H&&b.config.selectedSignature&&b.config.selectedSignature.value&&b.config.selectedSignature.value.length)}function A(a,b){return b.config.originalContent&&!b.config.originalMessageRevealed}function B(a,b){return"save"!==a&&b.config.isHTML&&angular.isObject(b.config.selectedStationery)}function C(a,b){return b.config.recipients.to&&1==b.config.recipients.to.length&&"pomoc@firma.interia.pl"==b.config.recipients.to[0].email&&!b.config.recipients.cc.length&&!b.config.recipients.bcc.length}function D(a,b){return b.config.attachments.length&&b.config.isHTML}var E,F,G=!1,H=e.getConfigAppModule("composition")&&e.getConfigAppModule("composition").actions.signature,I=e.signatures[-1],J=e.signatures[-2],K=1==e.env.publicGalleryEnabled&&e.env.device.isPc?1:0,L="inpl-collapsed";return d.$on("directive:publicGallery:isGallery",function(a,b){K=b}),d.$on("directive:emailinput:focus",function(a,b){E=b.addEmailFn}),n(),{get:function(a){return c.postPreserveCache("/message",a)},save:p,addSignature:function(a){return c.postPreserveCache("/signature",a)},addComposition:function(a){a&&a.ids&&a.ids.length?(a.ids=a.ids.map(function(a){return parseInt(a)}),a.to=a.to||[],g.cachedQuery().then(function(b){b.forEach(function(b){var c=g.contactArrayToObject(b);a.ids.indexOf(c.id)!==-1&&a.to.push(c)}),o(a)})):o(a)},removeComposition:a.remove,updateExternalAccounts:n,getStoredExternalAccounts:function(){var a,b=[],c=[];if(angular.isArray(F))for(a=0;a<F.length;a++)b.indexOf(F[a].email)===-1&&(c.push(F[a]),b.push(F[a].email));else c=F;return c},waitForNewAccount:function(){G=!0},sendMessage:function(a,b){var c=b.config.recipients.to,d=b.config.recipients.cc,f=b.config.recipients.bcc,g=b.config.subject,h=b.config.rawContent,i=h,k={};e.env.device.isMobile&&(i=x(a,i)),D(a,b)&&(i=u(i)),z(a,b)&&(k=H?b.config.selectedSignature.value:b.config.isHTML?I.value:J.value,i=r(i,k,b.config.isHTML)),A(a,b)&&(i=s(i,b.config.originalContent,b.config.isHTML)),B(a,b)&&(i=j.applyBeforeSend(b.config.selectedStationery,i)),C(a,b)&&(i=e.env.device.isMobile?v(i,b.config.isHTML):t(i,b.config.isHTML)),q({attachments:b.config.attachments,originalMessageRevealed:b.config.originalMessageRevealed,originalContent:b.config.originalContent,params:{mode:a,mid:b.config.compositionId,from:b.config.sender,to:c,cc:d,bcc:f,subject:g||"",prior:b.config.important,confirm:b.config.requireConfirm,content:i,selectedSignature:b.config.selectedSignature,rawContent:h,isHTML:b.config.isHTML,onBeforeStart:b.onBeforeStart,onSuccess:b.onSuccess,onError:b.onError}})}}}]),angular.module("nxt-composition").service("Sender",["ApplicationConfig",function(a){function b(a,b,c,d){if(b&&b.length&&c)for(var e=0;e<b.length;e++)if(c===b[e].email)return a.setIfChangingSenderAllowed(d),a.setFilteredAccounts(b),b[e];return null}this.autoSelectSender=function(c){var d,e,f=a.prefs.defaultAccount,g=c.accounts;if(g&&g.length){if(c.senderConfig)if((c.senderConfig.isSent||c.senderConfig.isDraft)&&c.senderConfig.fromEmail){if(d=b(c,g,c.senderConfig.fromEmail,!1),null!==d)return d}else if(!c.senderConfig.isSent){if(angular.isArray(c.senderConfig.recipientsEmails))for(e=0;e<c.senderConfig.recipientsEmails.length;e++)if(d=b(c,g,c.senderConfig.recipientsEmails[e],!1),null!==d)return d;if(c.senderConfig.multipopAccountHeader&&c.senderConfig.multipopAccountHeader.indexOf("@")!==-1&&(d=b(c,g,c.senderConfig.multipopAccountHeader,!1),null!==d))return d;if(c.senderConfig.envelopeToHeader&&(d=b(c,g,c.senderConfig.envelopeToHeader,!1),null!==d))return d}for(e=0;e<g.length;e++)if(parseInt(f,10)===g[e].vsmtpId||f===g[e].email)return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[e];for(e=0;e<g.length;e++)if(g[e].isOwnEmail||g[e].ownEmail)return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[e];return c.setIfChangingSenderAllowed(!0),c.setFilteredAccounts(g),g[0]}}}]),angular.module("nxt-composition").service("Stationery",["ApplicationConfig",function(a){var b=["background-color","background-image","color","font-family","font-size","link","font-style"];this.applyBeforeSend=function(c,d){var e,f,g=c.template,h="",i="";return b.forEach(function(b){b in c.bodyStyle&&(f=c.bodyStyle[b],"background-image"===b?i+=' background="'+f.replace(/\%STATIC_URL\%/g,a.env.staticUrl).replace("url(","").replace(")","")+'"':"link"===b?i+=' alink="'+f+'" link="'+f+'" vlink="'+f+'"':"color"===b?(i+=' text="'+f+'"',h+=" color:"+f+";"):h+=" "+b+":"+f.replace(/\%STATIC_URL\%/g,a.env.staticUrl)+";")},this),c.bodyStyle["font-style"]||(h+="font-style:normal;"),g=g.replace(/style='/g,"style='"+h).replace(/\%MAIL_BODY\%/g,d).replace(/\%STATIC_URL\%/g,a.env.staticUrl),e='<body marginwidth="0" marginheight="0" topmargin="0" leftmargin="0" rightmargin="0" bottommargin="0" '+i+' style="padding:0;margin:0"'+h+">"+g+"</body>"}}]),angular.module("nxt-composition").service("Uploader",["ApplicationConfig","FileUploader","$rootScope","$timeout","FileClassFinder","Notification","Track","$window",function(a,b,c,d,e,f,g,h){var i=0,j=!1,k=!1,l=!1,m=a.env.device.isMobile,n=a.env.service&&"int"==a.env.service.name,o=a.env.isCorp,p=!!a.env.accountType,q=!n&&!o,r=function(a){return a.imgCount=0,a.otherCount=0,a.showGalleryPanel=!1,a.queue.forEach(function(b){"img"===b.className?(a.showGalleryPanel=!0,a.imgCount++):a.otherCount++}),a};this.getUploader=function(j){function o(a,b,c){g.pushGACode(a),f.setOnClickCallback(b,s(a+"Click",c)),f.error(b)}function s(a,b){return function(){g.pushGACode(a),h.open(b,"_blank")}}return j.attachments=[],j.uploader=new b({scope:j,alias:"attach",withCredentials:!0,autoUpload:!1}),j.uploader.updateUploadUrls=function(){j.uploadUrl=a.env.uploadUrl+"/next/addattachswf,markmsg,"+j.compositionId+",attId,2-0,uid,"+a.env.uid+"?redir_host="+location.host,j.inlineUploadUrl=a.env.uploadUrl+"/next/addattachswf,markmsg,"+j.compositionId+",attId,2-0,inline,1,uid,"+a.env.uid+"?redir_host="+location.host},j.uploader.updateUploadUrls(),j.uploader.queueLength=0,j.uploader.MAX_TOTAL_SIZE=100,j.uploader.MAX_ITEMS_COUNT=50,j.uploader.updateTotalSize=function(){if(j.uploader.queueLength=j.uploader.queue.filter(function(a){return!a.isInline}).length,j.uploader.queueLength?j.uploader.totalSize=j.uploader.queue.filter(function(a){return!a.isInline}).map(function(a){return a._file.size}).reduce(function(a,b){return a+b})/1048576:j.uploader.totalSize=0,j.uploader.isTotalSizeExceeded=j.uploader.totalSize>j.uploader.MAX_TOTAL_SIZE,j.uploader.isItemsCountExceeded=j.uploader.queue.filter(function(a){return!a.isInline}).length>j.uploader.MAX_ITEMS_COUNT,!m){var b=[{type:"plakat",url:"https://www.empikfoto.pl/wystroj-wnetrz/fotoplakaty?utm_source=interia&utm_medium=banner&utm_campaign=plakaty",img:"/css/images/empik/plakaty.jpg",alt:"Empik Foto - Plakaty",track:{click:"empikBanerClick2",view:"empikBanerView2"}},{type:"puzzle",url:"https://www.empikfoto.pl/wszystkie-produkty/puzzle_rodzaje?utm_source=interia&utm_medium=banner&utm_campaign=puzzle",img:"/css/images/empik/puzzle.jpg",alt:"Empik Foto - Puzzle",track:{click:"empikBanerClick3",view:"empikBanerView3"}}];if(p||1!==j.uploader.queueLength||"img"!==j.uploader.queue[0].className)j.attachmentPromo=!1;else{var c=b[Math.floor(2*Math.random())];j.attachmentPromo=c,g.pushGACode(c.track.view),g.pushIWACode(c.track.view)}j.isIngPdf=a.env.ing&&!p&&1===j.uploader.queueLength&&"pdf"===j.uploader.queue[0].extension,j.isIngPdf&&g.pushGACode("ingPdfView")}},j.uploader.updateUploadedSize=function(){j.uploader.queueLength=j.uploader.queue.filter(function(a){return!a.isInline}).length,j.uploader.queueLength?j.uploader.uploadedSize=j.uploader.queue.filter(function(a){return!a.isInline}).map(function(a){return a._file.size*(a.progress/100)}).reduce(function(a,b){return a+b})/1048576:j.uploader.uploadedSize=0},j.uploader.updateUploadedCount=function(){j.uploader.uploadedCount=j.uploader.queue.filter(function(a){return!a.isInline}).filter(function(a){return a.isUploaded}).length},j.uploader.removeAttachment=function(a,b){var e;a.isRemoving||(a.isRemoving=!0,e=j.attachments.indexOf(a.mimePartIndex),e>-1&&j.attachments.splice(e,1),0===j.attachments.length&&j.$emit("composition:enableSending"),d(function(){"undefined"!=typeof a&&(j.uploader.cancelItem(a),j.uploader.removeFromQueue(a)),"img"==a.className&&(j.uploader.imgCount--,c.$broadcast("directive:publicGallery:removeAttachment")),c.$broadcast("composition:mark-as-modified"),j.uploader.updateUploadedCount(),j.uploader.updateUploadedSize(),j.uploader.updateTotalSize(),j.uploader.isItemsCountExceeded||j.uploader.isTotalSizeExceeded||(j.uploader.uploadAll(),j.$emit("composition:enableSending"))}),b||(g.pushGACode("deleteAttach"),g.pushIWACode("deleteAttach")))},j.uploader.removeAllAttachments=function(){j.uploader.queue.filter(function(a){return!a.isInline}).forEach(function(a){j.uploader.removeAttachment(a,!0)}),j.$emit("composition:enableSending"),k=!0,f.success("uploader:all-attachments-removed"),g.pushGACode("deleteAllAttach"),g.pushIWACode("deleteAllAttach")},j.uploader.downloadAttachment=function(b,c){j.uploader.downloadUrl=a.env.uploadUrl+"/next/getattach,mid,"+j.compositionId+",mpid,"+j.attachments[c]+",uid,"+a.env.uid+",/"+b._file.name.trim()+"?f="+b._file.name.trim(),window.location.href=j.uploader.downloadUrl},j.uploader.loadAttachments=function(a){if(a.attach&&a.attach.list)for(var b=0;b<a.attach.list.length;b++)j.uploader.queue.push({_file:{name:a.attach.list[b].name,size:parseInt(a.attach.list[b].size,10),mid:a.mid,mpid:a.attach.list[b].mpid,remote:!0},className:e.getFileClass(a.attach.list[b].name.split(".").pop()),progress:100,isUploaded:!0,isSuccess:!0,mimePartIndex:a.attach.list[b].mpid,extension:a.attach.list[b].name.split(".").pop(),_destroy:function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input}}),j.attachments.push(a.attach.list[b].mpid);else{if(!a.uploaderQueue||!a.attachments)return;j.uploader.queue=a.uploaderQueue,j.attachments=a.attachments}j.uploader=r(j.uploader),j.uploader.draftMessage="e"===a.opt,j.uploader.updateTotalSize(),j.uploader.updateUploadedSize(),j.uploader.updateUploadedCount(),d(function(){j.$emit("ac:update")},0,!1)},j.uploader.onAfterAddingAll=function(){if(j.isSaving){for(var a=j.uploader.getNotUploadedItems(),b=0;b<a.length;b++)j.uploader.removeFromQueue(a[b]);j.$emit("composition:enableSending"),j.$on("directive:composition:saved-finish",function(){a.length&&d(function(){for(var b=0;b<a.length;b++)a[b].url=j.uploadUrl;j.uploader.queue=j.uploader.queue.concat(a),j.uploader.uploadAll(),j.$emit("composition:disableSending"),a=[]},0,!1)})}},j.uploader.onAfterAddingFile=function(a){j.$emit("composition:disableSending");var b=angular.isObject(a._file)?a._file:a.file,c=b.name.split(".").pop();c&&(a.extension=c,a.className=e.getFileClass(c)),j.uploader.updateTotalSize(),d(function(){j.$emit("ac:update"),j.scrollToUploadManager()},0,!1),a.isInline&&(a.inlineId=i,i++,j.$broadcast("tinymce:before-insert-image",{inlineId:a.inlineId})),a.batchNumber=0},j.uploader.onProgressItem=function(){j.uploader.updateUploadedSize()},j.uploader.onSuccessItem=function(a,b){if(f.close("uploader:adding-attachments"),b&&b.status!==!1&&b.data&&b.data.files){if(a.mimePartIndex=b.data.files[0].index,a.isInline){if(j.attachments.indexOf(a.mimePartIndex)>-1)return;j.$broadcast("tinymce:insert-image",{mid:j.compositionId,mpid:a.mimePartIndex,f:b.data.files[0].name,inlineId:a.inlineId,cid:b.data.files[0].cid}),a.remove()}j.attachments.push(a.mimePartIndex),j.$emit("composition:updateSize"),l=!1}else l=!0,j.uploader.removeAttachment(a),f.setReplaceParams([b.msg]),f.error("composition:add-attachment-error-reasone")},j.uploader.onCancelItem=function(a){if(l=!0,j.uploader.removeAttachment(a),m){var b="",c="",d="";q?(b="addAttachmentErrorBugExternalAppNext",c="composition:add-attachment-error-bug-external-app-next",d="https://play.google.com/store/apps/details?id=pl.interia.poczta_next&referrer=utm_source%3Dnext_mobilny_blad%26utm_medium%3Dkomunikat_bledu_zalacznik%26utm_campaign%3Dnext_mobilny_blad_zalacznik%26anid%3Dadmob",o(b,c,d)):n?(b="addAttachmentErrorBugExternalAppInt",c="composition:add-attachment-error-bug-external-app-int",d="https://play.google.com/store/apps/details?id=pl.int.poczta&referrer=utm_source%3Dint_mobilny_blad%26utm_medium%3Dkomunikat_bledu_zalacznik%26utm_campaign%3Dint_mobilny_blad_zalacznik%26anid%3Dadmob",o(b,c,d)):f.error("composition:add-attachment-error-bug-external-app")}else f.error("composition:add-attachment-error")},j.uploader.onProgressAll=function(){j.uploader.updateUploadedCount(),c.$broadcast("directive:publicGallery:progressall")},j.uploader.onCompleteAll=function(){j.uploader.updateUploadedCount(),l||(j.$emit("composition:enableSending"),k||f.success("uploader:all-attachments-added"),k=!1),c.$broadcast("composition:mark-as-modified"),c.$broadcast("directive:publicGallery:completeUpload")},j.uploader.onAfterAddingAll=function(){j.uploader.queue.forEach(function(a,b,c){c[b].batchNumber++}),j.uploader=r(j.uploader),j.uploader.queue.sort(function(a,b){var c=a.className,d=b.className,e=a.batchNumber,f=b.batchNumber;return e===f?"img"===c&&"img"!==d?-1:"img"!==c&&"img"===d?1:0:e<f?1:-1}),j.uploader.isItemsCountExceeded||j.uploader.isTotalSizeExceeded||j.uploader.uploadAll()},j.showUploader=!0,j.uploader},this.getInlineAttachmentsIds=function(a){var b=document.createElement("div"),c=[];return b.innerHTML=a,Array.prototype.forEach.call(b.querySelectorAll(".inpl-inline-attachment"),function(a){var b=a.id;b&&c.push(b.split("_").pop())}),c},this.fakeFileInputClick=function(a){if(!j){j=!0;var b;document.createEvent&&(b=document.createEvent("MouseEvent"),b.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),d(function(){a.dispatchEvent(b)})),d(function(){j=!1},1e3,!1)}}}]),angular.module("nxt-composition").service("UploaderResize",["$rootScope",function(a){"use strict";function b(a,b){return a.lastModifiedDate=new Date,a.name=b,a}var c,d,e=1920,f=1280;this.resize=function(g){var h=g;window.URL=window.URL;var i=document.createElement("img");i.src=window.URL.createObjectURL(h),i.onload=function(){c=i.width,d=i.height,c>d?c>e&&(d*=e/c,c=e):d>f&&(c*=f/d,d=f);var g=document.createElement("canvas");g.width=c,g.height=d;var j=g.getContext("2d");j.drawImage(i,0,0,c,d),h.name.match(/jpg.*/)||name.match(/jpeg.*/)?g.toBlob(function(c){var d=b(c,h.name);h.size<d.size?a.$broadcast("resizeCanvas",h):a.$broadcast("resizeCanvas",d)},"image/jpg",.95):g.toBlob(function(c){var d=b(c,h.name);h.size<d.size?a.$broadcast("resizeCanvas",h):a.$broadcast("resizeCanvas",d)},"image/png",1),window.URL.revokeObjectURL(i.src)}}}]),angular.module("nxt-contact").provider("Contact",function(){"use strict";var a=1,b=2,c=3,d=4,e=5,f=7,g=!1,h=!1,i=-2;this.$get=["$http","$rootScope","$q","FileUploader","Notification","ApplicationConfig","Track","Tools","ApplicationData",function(j,k,l,m,n,o,p,q,r){function s(a,b){var c,d,e=[],f=[];return a&&a!==b&&(e=e.concat(a.toLowerCase().split(/[^\wąćęłńóśźż]/))),b&&(e=e.concat(b.toLowerCase().split(/[^\w]/)),b.indexOf("@")!==-1&&(e.push(b.toLowerCase()),c=b.toLowerCase().split("@")[0],d=c.match(/(\d+)/g),angular.isArray(d)&&(e=e.concat(d)))),e=e.filter(function(a){return!!a}),e=e.map(function(a){return/^.*[ąćęłńóśźż]+.*$/.test(a)&&f.push(a),q.removePolishDiacritics(a)}),f.length&&(e=e.concat(f)),e}function t(a){return a&&a.length&&a.forEach(function(a,b,c){c[b][G.WORDS]=s(a[G.NAME],a[G.EMAIL])}),a}function u(a){return a.toLowerCase().replace(/_(\w)/g,function(a){return a.toUpperCase().replace("_","")})}function v(a){var b,c="NOTE,PHONES,EMAILS,WORDS".split(","),d={id:a[G.ID],avatar:a[G.AVATAR],email:a[G.EMAIL],name:a[G.NAME],score:a[G.SCORE],type:a[G.TYPE],groups:a[G.GROUPS]||[],isReadonly:a[G.IS_READONLY],sortName:a[G.SORT_NAME]};return c.forEach(function(c){b=a[G[c]],"undefined"!=typeof b&&(d[u(c)]=b)}),d}function w(a){var b,c=[],d="ID,AVATAR,EMAIL,NAME,SCORE,TYPE,SORT_NAME,IS_READONLY,IS_ON_BLACKLIST,EMAILS,GROUPS,PHONES,NOTE,WORDS".split(",");return d.forEach(function(d){b=a[u(d)],"undefined"!=typeof b&&(c[G[d]]=b)}),c}function x(a){a&&a.length&&a.forEach(function(a,b,c){angular.isObject(a)&&!angular.isArray(a)&&(c[b]=w(a))})}function y(a){return{data:(10*Math.random()+1)%16|0,type:2,initial:a?a.substr(0,1):""}}function z(a){a=a||{};var b=y(a.email),c={name:a.name||"",email:a.email||"",score:a.score||0,emails:a.emails||[],groups:a.groups||[],phones:a.phones||[],avatar:a.avatar||[b],note:a.note||"",isReadonly:!0};return a.id&&(c.id=a.id),c}function A(a){var b,c,d=o.env.isCorp,e=-1;if(!g){if(g=r.get("SpecialContacts"),!angular.isArray(g.data))return void(g=!1);g=g.data,x(g)}for(c=0;c<g.length;c++)if(g[c][G.ID]===-666){b=angular.copy(g[c]);break}for(c=0;c<a.length;c++)if(a[c][G.ID]===-666){e=c;break}b&&e>=0?a[e]=b:d||a.push(b)}function B(a){for(var b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b}function C(){return j.get("/contact",{params:{type:c,ver:2,addFake:1},transformResponse:function(a){return a&&a.data?(A(a.data),a.data=B(a.data),a.data=a.data.map(function(a){return a[G.IS_READONLY]=a[G.TYPE]==d||a[G.TYPE]==e,"undefined"==typeof a[G.SORT_NAME]&&(a[G.SORT_NAME]=q.getSortString(a[G.NAME])),a}),a.data=t(a.data),a.data.sort(D),H.resolve(a.data),r.putBroadcast("Contact",{time:o.cacheTime,data:a.data}),h=!0):H.reject("Brak kontaktów"),a}})}function D(a,b){return a[G.SCORE]>b[G.SCORE]?-1:a[G.SCORE]<b[G.SCORE]?1:0}function E(a,b){return a[G.SORT_NAME]<b[G.SORT_NAME]?-1:a[G.SORT_NAME]>b[G.SORT_NAME]?1:0}var F=new m({url:"/next/contact-import",removeAfterUpload:!0,withCredentials:!0,headers:{"X-XSRF-TOKEN":o.env.uid,"X-Requested-With":"XMLHttpRequest"}}),G=o.ContactKeys,H=l.defer();return F.onAfterAddingFile=function(a){k.$broadcast("service:contacts:import:addfile",a.file)},C(),{CONTACT_TYPE_STANDARD:a,CONTACT_TYPE_AUTOINSERT:b,CONTACT_TYPE_ALL:c,CONTACT_TYPE_CORPORATE:d,CONTACT_TYPE_EMPLOYEE:e,CONTACT_TYPE_FAKE:f,EMAIL_TYPE_PRIVATE:1,EMAIL_TYPE_BUSINESS:2,EMAIL_TYPE_OTHER:3,PHONE_TYPE_PRIVATE:0,PHONE_TYPE_BUSINESS:1,PHONE_TYPE_OTHER:2,EMPLOYEE_GROUP_ID:i,query:C,cachedQuery:function(){return H.promise},get:function(a){var b=this;return j.get("/contact/:id?type=:type",{params:a,transformResponse:function(a){return a.data&&(a.data.isReadonly=a.data.type==d||a.data.type==e,a.data.emails&&a.data.emails.length>0&&a.data.emails.push({type:b.EMAIL_TYPE_OTHER,value:a.data.email})),a}})},search:function(a){return j.get("/contact",{transformResponse:function(b){return b.data&&(b.data=b.data.filter(function(b){return b.email===a}).pop(),b.data&&(b.data.isReadonly=b.data.type==d||b.data.type==e)),b}})},create:function(a){a=a||{};var b=this.createAvatar(a.email),d={name:a.name||"",score:a.score||0,emails:[],groups:[],phones:[],avatar:a.avatar||[b]};return a.id&&(d.id=a.id),a.email&&(d.email=a.email,d.emails.push({type:this.EMAIL_TYPE_OTHER,value:a.email})),d.sortName=q.getSortString(d.name),d.words=s(d.name,a.email),d.type=a.type||c,d},createFake:z,createAvatar:y,save:function(a){return j.post("/contact",a,{transformRequest:function(a){return void 0===a.id&&a.emails.length&&(a.email=a.emails[0].value,a.type=a.emails[0].type),a.name&&(a.sortName=q.getSortString(a.name)),a}}).then(function(b){void 0===a.id?(b.isNew=!0,b=angular.extend(a,b),n.success("service:contact:save",a),p.pushGACode("contactActionAdd")):n.success("service:contact:edit")})},deleteContact:function(a){return j["delete"]("/contact",{ids:[a.id]}).then(function(){n.success("service:contact:delete",a)})},deleteContacts:function(a){return j["delete"]("/contact",a,{transformRequest:function(a){return a=a.map(function(a){return a.id}),{ids:a}}}).then(function(){n.success("service:contacts:delete")})},importContacts:function(){var a=l.defer(),b=a.promise;return F.onSuccessItem=function(b,c){c.status===!1?(n.error(c.msg),a.reject(c.msg)):(o.cacheTime=Date.now(),c.msg||(c.msg="service:contacts:import:succes"),n.success(c.msg,c.data),a.resolve(c.data))},F.uploadAll(),b},getContactDictionary:s,initDictionary:t,convertSpecialContactsToArrays:x,contactArraysToObjects:function(a){return a.map(v)},contactArrayToObject:v,contactObjectToArray:w,popularitySorter:D,alphabeticSorter:E,mapCompositionContacts:function(a,b){var c=a.to||[],d=a.cc||[],e=a.bcc||[];if(angular.isArray(c)||(c=[c]),a.from&&angular.isArray(a.from)&&(c=c.concat(a.from)),a.envelopeTo?(c=c.filter(function(b){return b.email!==a.envelopeTo}),d=d.filter(function(b){return b.email!==a.envelopeTo}),e=e.filter(function(b){return b.email!==a.envelopeTo})):c=c.filter(function(b){return b.email!==a.envelopeTo}),c=c.filter(function(a){return a.email!==b.email}),0===c.length&&a.from&&1===a.from.length){var f=b;"Ja"===a.from[0].name&&(f=a.from[0]),c.push(f)}return{to:c,cc:d,bcc:e}},countContacts:function(a){var b=0;return a&&(angular.isArray(a.to)&&(b+=a.to.length),angular.isArray(a.cc)&&(b+=a.cc.length),angular.isArray(a.bcc)&&(b+=a.bcc.length)),b},filterOutOwnContacts:function(a,b){var c=[];if(!angular.isArray(a)&&angular.isObject(a)&&(a=[a]),b&&b.length&&a&&a.length)for(var d=0;d<a.length;d++)b.indexOf(a[d].email.toLowerCase())!==-1||a[d].ommitInReply||c.push(a[d]);return c},getUplouder:function(){return F},getContactByGroup:function(a,b){return a.filter(function(a){return a[G.GROUPS].indexOf(b)!=-1})},isNotEmpty:function(a,b){for(var c=0;c<a.length;c++)if(a[c][G.GROUPS].indexOf(b)!=-1)return!0;return!1},isCachedQueryAlreadyResolved:function(){return h},isNotEmployeeFilter:function(a){return a[G.TYPE]===e&&a[G.GROUPS].indexOf(i)===-1&&a[G.GROUPS].push(i),a[G.TYPE]!==e}}}]}),angular.module("nxt-contact").provider("ContactGroup",function(){"use strict";this.$get=["$http","Contact","ApplicationData","ApplicationConfig",function(a,b,c,d){function e(){return a.get("/group",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.words=b.getContactDictionary(a.name),a})),c.putBroadcast("ContactGroup",{time:d.cacheTime,
data:a}),a}})}return e(),{create:function(){return{id:-1,name:""}},query:e,save:function(b,c){b.id===-1&&delete b.id;var d=b.id?"put":"post";return a[d]("/group",b,{transformRequest:function(a){return a.cIds=c.map(function(a){return a.id}),a},transformResponse:function(a){return a&&a.data&&void 0===b.id&&(a.data=angular.extend(b,a.data),a.data.isNew=!0),a}})},"delete":function(b){return a["delete"]("/group",b)}}}]}),angular.module("nxt-crop").factory("CropArea",["CropCanvas",function(a){var b=function(b,c){this._ctx=b,this._events=c,this._minWidth=58,this._minHeight=40,this._cropCanvas=new a(b),this._image=new Image,this._x=0,this._y=0,this._wSize=0,this._hSize=0,this._aspectRadio=1};return b.prototype.getImage=function(){return this._image},b.prototype.setImage=function(a){this._image=a},b.prototype.getX=function(){return this._x},b.prototype.setX=function(a){this._x=a,this._dontDragOutside()},b.prototype.setAspectRadio=function(a){this._aspectRadio=a,this._dontDragOutside()},b.prototype.getY=function(){return this._y},b.prototype.setY=function(a){this._y=a,this._dontDragOutside()},b.prototype.getWidth=function(){return this._wSize},b.prototype.setWidth=function(a){this._wSize=Math.max(this._minWidth,a),this._dontDragOutside()},b.prototype.getHeight=function(){return this._hSize},b.prototype.setHeight=function(a){this._hSize=Math.max(this._minHeight,a),this._dontDragOutside()},b.prototype.getMinWidth=function(){return this._minWidth},b.prototype.setMinWidth=function(a){this._minWidth=a,this._wSize=Math.max(this._minWidth,this._wSize),this._dontDragOutside()},b.prototype.getMinHeight=function(){return this._minHeight},b.prototype.setMinHeight=function(a){this._minHeight=a,this._hSize=Math.max(this._minHeight,this._hSize),this._dontDragOutside()},b.prototype._dontDragOutside=function(){var a=this._ctx.canvas.height,b=this._ctx.canvas.width;this._wSize>b&&(this._wSize=b),this._hSize>a&&(this._hSize=a),this._x<this._wSize/2&&(this._x=this._wSize/2),this._x>b-this._wSize/2&&(this._x=b-this._wSize/2),this._y<this._hSize/2&&(this._y=this._hSize/2),this._y>a-this._hSize/2&&(this._y=a-this._hSize/2)},b.prototype._drawArea=function(){},b.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._wSize,this._hSize,this._drawArea)},b.prototype.processMouseMove=function(){},b.prototype.processMouseDown=function(){},b.prototype.processMouseUp=function(){},b}]),angular.module("nxt-crop").factory("CropAreaSquare",["CropArea",function(a){"use strict";var b=function(b,c,d){a.apply(this,arguments),this._resizeCtrlBaseRadius=7,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartWidth=0,this._posResizeStartHeight=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcSquareCorners=function(){var a=this._wSize/2,b=this._hSize/2;return[[this._x-a,this._y-b],[this._x+a,this._y-b],[this._x-a,this._y+b],[this._x+a,this._y+b]]},b.prototype._calcSquareDimensions=function(){var a=this._wSize/2,b=this._hSize/2;return{left:this._x-a,top:this._y-b,right:this._x+a,bottom:this._y+b}},b.prototype._isCoordWithinArea=function(a){var b=this._calcSquareDimensions();return a[0]>=b.left&&a[0]<=b.right&&a[1]>=b.top&&a[1]<=b.bottom},b.prototype._isCoordWithinResizeCtrl=function(a){for(var b=this._calcSquareCorners(),c=-1,d=0,e=b.length;d<e;d++){var f=b[d];if(a[0]>f[0]-this._resizeCtrlHoverRadius&&a[0]<f[0]+this._resizeCtrlHoverRadius&&a[1]>f[1]-this._resizeCtrlHoverRadius&&a[1]<f[1]+this._resizeCtrlHoverRadius){c=d;break}}return c},b.prototype._drawArea=function(a,b,c,d){var e=d/2,f=c/2;a.rect(b[0]-f,b[1]-e,c,d)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var b=this._calcSquareCorners(),c=0,d=b.length;c<d;c++){var e=b[c];this._cropCanvas.drawIconResizeCircle(e,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===c?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var e,f;switch(this._resizeCtrlIsDragging){case 0:e=-1,f=-1,c="nwse-resize";break;case 1:e=1,f=-1,c="nesw-resize";break;case 2:e=-1,f=1,c="nesw-resize";break;case 3:e=1,f=1,c="nwse-resize"}var g=(a-this._posResizeStartX)*e,h=(b-this._posResizeStartY)*f,i=this._posResizeStartWidth+g,j=this._posResizeStartHeight+h;Math.abs(g)>Math.abs(h)?j=this._posResizeStartHeight+g/this._aspectRadio:i=this._posResizeStartWidth+h*this._aspectRadio;var k,l,m=this._ctx.canvas.height,n=this._ctx.canvas.width,o=this._wSize,p=this._hSize;n/m<this._aspectRadio?(this._wSize=Math.min(Math.max(this._minWidth,i),n),k=(this._wSize-o)/2,this._hSize=this._wSize/this._aspectRadio,l=(this._hSize-p)/2):(this._hSize=Math.min(Math.max(this._minHeight,j),m),l=(this._hSize-p)/2,this._wSize=this._hSize*this._aspectRadio,k=(this._wSize-o)/2),this._x+=k*e,this._y+=l*f,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,d=!0,this._events.trigger("area-resize")}else{var q=this._isCoordWithinResizeCtrl([a,b]);if(q>-1){switch(q){case 0:c="nwse-resize";break;case 1:c="nesw-resize";break;case 2:c="nesw-resize";break;case 3:c="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=q,d=!0}else this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){var c=this._isCoordWithinResizeCtrl([a,b]);c>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=c,this._resizeCtrlIsHover=c,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartWidth=this._wSize,this._posResizeStartHeight=this._hSize,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},b}]),angular.module("nxt-crop").factory("CropCanvas",function(){"use strict";var a=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],b=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],c=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],d=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],e=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],f=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],g=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],h=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],i={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(j){var k=function(a,b,c){return[c*a[0]+b[0],c*a[1]+b[1]]},l=function(a,b,c,d){j.save(),j.fillStyle=b,j.beginPath();var e,f=k(a[0],c,d);j.moveTo(f[0],f[1]);for(var g in a)g>0&&(e=k(a[g],c,d),j.lineTo(e[0],e[1]));j.lineTo(f[0],f[1]),j.fill(),j.closePath(),j.restore()};this.drawIconMove=function(a,b){l(e,i.moveIconFill,a,b),l(f,i.moveIconFill,a,b),l(g,i.moveIconFill,a,b),l(h,i.moveIconFill,a,b)},this.drawIconResizeCircle=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeCircleStroke,j.lineWidth=2,j.fillStyle=i.resizeCircleFill,j.beginPath(),j.arc(a[0],a[1],d,0,2*Math.PI),j.fill(),j.stroke(),j.closePath(),j.restore()},this.drawIconResizeBoxBase=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeBoxStroke,j.lineWidth=2,j.fillStyle=i.resizeBoxFill,j.fillRect(a[0]-d/2,a[1]-d/2,d,d),j.strokeRect(a[0]-d/2,a[1]-d/2,d,d),j.restore()},this.drawIconResizeBoxNESW=function(a,d,e){this.drawIconResizeBoxBase(a,d,e),l(b,i.resizeBoxArrowFill,a,e),l(c,i.resizeBoxArrowFill,a,e)},this.drawIconResizeBoxNWSE=function(b,c,e){this.drawIconResizeBoxBase(b,c,e),l(a,i.resizeBoxArrowFill,b,e),l(d,i.resizeBoxArrowFill,b,e)},this.drawCropArea=function(a,b,c,d,e){var f=a.width/j.canvas.width,g=a.height/j.canvas.height,h=b[0]-c/2,k=b[1]-d/2;j.save(),j.strokeStyle=i.areaOutline,j.lineWidth=2,j.beginPath(),e(j,b,c,d),j.stroke(),j.clip(),c>0&&d>0&&j.drawImage(a,h*f,k*g,c*f,d*g,h,k,c,d),j.beginPath(),e(j,b,c,d),j.stroke(),j.clip(),j.restore()}}}),angular.module("nxt-crop").service("CropEXIF",function(){"use strict";function a(a){return!!a.exifdata}function b(a,b){b=b||a.match(/^data\:([^\;]+)\;base64,/im)[1]||"",a=a.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;g<d;g++)f[g]=c.charCodeAt(g);return e}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){200!=this.status&&0!==this.status||b(this.response)},c.send()}function d(a,d){function g(b){var c=e(b),g=f(b);a.exifdata=c||{},a.iptcdata=g||{},d&&d.call(a)}var h;if(a.src)if(/^data\:/i.test(a.src)){var i=b(a.src);g(i)}else if(/^blob\:/i.test(a.src))h=new FileReader,h.onload=function(a){g(a.target.result)},c(a.src,function(a){h.readAsArrayBuffer(a)});else{var j=new XMLHttpRequest;j.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";g(j.response),j=null},j.open("GET",a.src,!0),j.responseType="arraybuffer",j.send(null)}else window.FileReader&&(a instanceof window.Blob||a instanceof window.File)&&(h=new FileReader,h.onload=function(a){g(a.target.result)},h.readAsArrayBuffer(a))}function e(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;for(var c,d=2,e=a.byteLength;d<e;){if(255!=b.getUint8(d))return!1;if(c=b.getUint8(d+1),225==c)return k(b,d+4,b.getUint16(d+2)-2);d+=2+b.getUint16(d+2)}}function f(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;for(var c=2,d=a.byteLength,e=function(a,b){return 56===a.getUint8(b)&&66===a.getUint8(b+1)&&73===a.getUint8(b+2)&&77===a.getUint8(b+3)&&4===a.getUint8(b+4)&&4===a.getUint8(b+5)};c<d;){if(e(b,c)){var f=b.getUint8(c+7);f%2!==0&&(f+=1),0===f&&(f=4);var h=c+8+f,i=b.getUint16(c+6+f);return g(a,h,i)}c++}}function g(a,b,c){for(var d,e,f,g,h,i=new DataView(a),k={},l=b;l<b+c;)28===i.getUint8(l)&&2===i.getUint8(l+1)&&(g=i.getUint8(l+2),g in p&&(f=i.getInt16(l+3),h=f+5,e=p[g],d=j(i,l+5,f),k.hasOwnProperty(e)?k[e]instanceof Array?k[e].push(d):k[e]=[k[e],d]:k[e]=d)),l++;return k}function h(a,b,c,d,e){var f,g,h,j=a.getUint16(c,!e),k={};for(h=0;h<j;h++)f=c+12*h+2,g=d[a.getUint16(f,!e)],k[g]=i(a,f,b,c,e);return k}function i(a,b,c,d,e){var f,g,h,i,k,l,m,n=a.getUint16(b+2,!e),o=a.getUint32(b+4,!e),p=a.getUint32(b+8,!e)+c;switch(n){case 1:case 7:if(1==o)m=a.getUint8(b+8,!e);else{for(f=o>4?p:b+8,g=[],i=0;i<o;i++)g[i]=a.getUint8(f+i);m=g}break;case 2:f=o>4?p:b+8,m=j(a,f,o-1);break;case 3:if(1==o)m=a.getUint16(b+8,!e);else{for(f=o>2?p:b+8,g=[],i=0;i<o;i++)g[i]=a.getUint16(f+2*i,!e);m=g}break;case 4:if(1==o)m=a.getUint32(b+8,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getUint32(p+4*i,!e);m=g}break;case 5:if(1==o)k=a.getUint32(p,!e),l=a.getUint32(p+4,!e),h=Number(k/l),h.numerator=k,h.denominator=l,m=h;else{for(g=[],i=0;i<o;i++)k=a.getUint32(p+8*i,!e),l=a.getUint32(p+4+8*i,!e),g[i]=Number(k/l),g[i].numerator=k,g[i].denominator=l;m=g}break;case 9:if(1==o)m=a.getInt32(b+8,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getInt32(p+4*i,!e);m=g}break;case 10:if(1==o)m=a.getInt32(p,!e)/a.getInt32(p+4,!e);else{for(g=[],i=0;i<o;i++)g[i]=a.getInt32(p+8*i,!e)/a.getInt32(p+4+8*i,!e);m=g}}}function j(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}function k(a,b){if("Exif"!=j(a,b,4))return!1;var c,d,e,f,g,i=b+6;if(18761==a.getUint16(i))c=!1;else{if(19789!=a.getUint16(i))return!1;c=!0}if(42!=a.getUint16(i+2,!c))return!1;var k=a.getUint32(i+4,!c);if(k<8)return!1;if(d=h(a,i,i+k,m,c),d.ExifIFDPointer){f=h(a,i,i+d.ExifIFDPointer,l,c);for(e in f)if(f.hasOwnProperty(e)){switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":f[e]=o[e][f[e]];break;case"ExifVersion":case"FlashpixVersion":f[e]=String.fromCharCode(f[e][0],f[e][1],f[e][2],f[e][3]);break;case"ComponentsConfiguration":f[e]=o.Components[f[e][0]]+o.Components[f[e][1]]+o.Components[f[e][2]]+o.Components[f[e][3]]}d[e]=f[e]}}if(d.GPSInfoIFDPointer){g=h(a,i,i+d.GPSInfoIFDPointer,n,c);for(e in g)if(g.hasOwnProperty(e)){switch(e){case"GPSVersionID":g[e]=g[e][0]+"."+g[e][1]+"."+g[e][2]+"."+g[e][3]}d[e]=g[e]}}return d}var l=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},m=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},n=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},o=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},p={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(b,c){return!((b instanceof Image||b instanceof HTMLImageElement)&&!b.complete)&&(a(b)?c&&c.call(b):d(b,c),!0)},this.getTag=function(b,c){if(a(b))return b.exifdata[c]},this.getAllTags=function(b){if(!a(b))return{};var c,d=b.exifdata,e={};for(c in d)d.hasOwnProperty(c)&&(e[c]=d[c]);return e},this.pretty=function(b){if(!a(b))return"";var c,d=b.exifdata,e="";for(c in d)d.hasOwnProperty(c)&&(e+="object"==typeof d[c]?d[c]instanceof Number?c+" : "+d[c]+" ["+d[c].numerator+"/"+d[c].denominator+"]\r\n":c+" : ["+d[c].length+" values]\r\n":c+" : "+d[c]+"\r\n");return e},this.readFromBinaryFile=function(a){return e(a)}}),angular.module("nxt-crop").factory("CropHost",["$document","CropAreaSquare","CropEXIF",function(a,b,c){"use strict";var d=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}};return function(e,f,g,h){function i(){t.clearRect(0,0,t.canvas.width,t.canvas.height),null!==u&&(t.drawImage(u,0,0,t.canvas.width,t.canvas.height),t.save(),t.fillStyle="rgba(0, 0, 0, 0.65)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),v.draw())}var j=h.cropX,k=h.cropY,l=h.cropWidth,m=h.cropHeight;h.cropAspectRatio=l/m;var n,o=h.resultImageWidth,p=h.resultImageHeight,q=h.cropDataInPercentage,r=h.cropResetWrapperSelector,s=r?a[0].querySelector(r):null,t=null,u=null,v=null,w=[50,50],x=[500,500],y=o,z=p,A=j,B=l,C=k,D=m,E=h.cropAspectRatio,F=0,G="image/png",H=null,I=function(){if(null!==u){v.setImage(u);var a=[u.width,u.height],b=u.width/u.height,c=a;c[0]>x[0]?(c[0]=x[0],c[1]=c[0]/b):c[0]<w[0]&&(c[0]=w[0],c[1]=c[0]/b),c[1]>x[1]?(c[1]=x[1],c[0]=c[1]*b):c[1]<w[1]&&(c[1]=w[1],c[0]=c[1]*b),e.prop("width",c[0]).prop("height",c[1]).css({"margin-left":-c[0]/2+"px","margin-top":-c[1]/2+"px"});var d=A,f=B,g=C,j=D;q&&(d=A/1e3*u.width,f=B/1e3*u.width,g=C/1e3*u.height,j=D/1e3*u.height);var k=void 0===A||void 0===B||void 0===C||void 0===D;if(F>1||k){var l=y,m=z,n=y/z,o=u.width/u.height;o>n?(m=u.height-30,l=m*n):(l=u.width-30,m=l/n),(l<20||m<20)&&(l=1.25*y,m=1.25*z),d=u.width/2-l/2,f=l,g=u.height/2-m/2,j=m}E=h.cropAspectRatio=q?f/j:E,v.setX(0),v.setY(0),v.setWidth(0),v.setHeight(0),v.setAspectRadio(E),v.setX(d+f/2||t.canvas.width/2),v.setY(g+j/2||t.canvas.height/2),t.canvas.width/t.canvas.height<E?(v.setWidth(Math.min(f,t.canvas.width)),v.setHeight(v.getWidth()/E)):(v.setHeight(Math.min(j,t.canvas.height)),v.setWidth(v.getHeight()*E))}else e.prop("width",0).prop("height",0).css({"margin-top":0});i()},J=function(a){return angular.isDefined(a.changedTouches)?a.changedTouches:a.originalEvent.changedTouches},K=function(a){if(null!==u){var b,c,e=d(t.canvas);if("touchmove"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseMove(b-e.left,c-e.top),s){var f=s.getBoundingClientRect().left,g=s.getBoundingClientRect().top,h=s.getBoundingClientRect().width,j=s.getBoundingClientRect().height;(b<f||c<g||b>f+h||c>g+j)&&M(a)}i()}},L=function(a){if(a.preventDefault(),a.stopPropagation(),null!==u){var b,c,e=d(t.canvas);"touchstart"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseDown(b-e.left,c-e.top),i()}},M=function(a){if(null!==u){var b,c,e=d(t.canvas);"touchend"===a.type?(b=J(a)[0].pageX,c=J(a)[0].pageY):(b=a.pageX,c=a.pageY),v.processMouseUp(b-e.left,c-e.top),i()}};this.getResultImageDataURI=function(){var a,b;return b=angular.element("<canvas></canvas>")[0],a=b.getContext("2d"),b.width=y,b.height=z,null!==u&&a.drawImage(u,(v.getX()-v.getWidth()/2)*(u.width/t.canvas.width),(v.getY()-v.getHeight()/2)*(u.height/t.canvas.height),v.getWidth()*(u.width/t.canvas.width),v.getHeight()*(u.height/t.canvas.height),0,0,y,z),null!==H?b.toDataURL(G,H):b.toDataURL(G)},this.getCropData=function(){if(null===u)return{x:0,y:0,width:10,height:10};var a=v.getX()-v.getWidth()/2,b=u.width/t.canvas.width,c=v.getWidth(),d=v.getY()-v.getHeight()/2,e=u.height/t.canvas.height,f=v.getHeight(),g=1e3;return{x:q?~~(a/u.width*g):a*b,y:q?~~(d/u.height*g):d*e,width:q?~~(c/u.width*g):c*b,height:q?~~(f/u.height*g):f*e}},this.setNewImageSource=function(a){if(u=null,I(),g.trigger("image-updated"),a){var b=new Image,d=a.split("|");a=d[0];var e=d[1];e!==n&&F++,n=e,b.crossOrigin="anonymous",b.onload=function(){g.trigger("load-done"),c.getData(b,function(){var a=c.getTag(b,"Orientation");if([3,6,8].indexOf(a)>-1){var d=document.createElement("canvas"),e=d.getContext("2d"),f=b.width,h=b.height,i=0,j=0,k=0;switch(a){case 3:i=-b.width,j=-b.height,k=180;break;case 6:f=b.height,h=b.width,j=-b.height,k=90;break;case 8:f=b.height,h=b.width,i=-b.width,k=270}d.width=f,d.height=h,e.rotate(k*Math.PI/180),e.drawImage(b,i,j),u=new Image,u.src=d.toDataURL("image/png")}else u=b;I(),g.trigger("image-updated")})},b.onerror=function(){g.trigger("load-error")},g.trigger("load-start"),b.src=a}},this.setMaxDimensions=function(a,b){if(x=[a,b],null!==u){var c=[u.width,u.height],d=u.width/u.height,f=c;f[0]>x[0]?(f[0]=x[0],f[1]=f[0]/d):f[0]<w[0]&&(f[0]=w[0],f[1]=f[0]/d),f[1]>x[1]?(f[1]=x[1],f[0]=f[1]*d):f[1]<w[1]&&(f[1]=w[1],f[0]=f[1]*d),e.prop("width",f[0]).prop("height",f[1]).css({"margin-left":-f[0]/2+"px","margin-top":-f[1]/2+"px"})}else e.prop("width",0).prop("height",0).css({"margin-top":0});i()},this.setResultImageSize=function(a,b){a=parseInt(a,10),b=parseInt(b,10),isNaN(a)||(y=a),isNaN(b)||(z=b)},this.setResultImageFormat=function(a){G=a},this.setResultImageQuality=function(a){a=parseFloat(a),!isNaN(a)&&a>=0&&a<=1&&(H=a)},this.setAreaType=function(){var a=v.getWidth(),c=v.getHeight(),d=v.getMinWidth(),e=v.getMinHeight(),f=v.getX(),j=v.getY(),k=b;v=new k(t,g,h),v.setMinWidth(d),v.setMinHeight(e),v.setWidth(a),v.setHeight(c),v.setX(f),v.setY(j),null!==u&&v.setImage(u),i()},t=e[0].getContext("2d"),v=new b(t,g,h),a.on("mousemove",K),e.on("mousedown",L),a.on("mouseup",M),a.on("touchmove",K),e.on("touchstart",L),a.on("touchend",M),this.destroy=function(){a.off("mousemove",K),e.off("mousedown",L),a.off("mouseup",K),a.off("touchmove",K),e.off("touchstart",L),a.off("touchend",K),e.remove()}}}]),angular.module("nxt-crop").factory("CropPubSub",function(){"use strict";return function(){var a={};this.on=function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},this.trigger=function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}),angular.module("nxt-dialog").service("DialogManager",["$rootScope","$location","ApplicationConfig","$timeout","$http","$interval","Track","MarketingData","Security","Notification","PersonalData","Setting","ServiceWorker","Agreement","Billing","Tools","$state",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){return a.message=a.message||"",a.callback=a.callback||function(){},a.callbackCancel=a.callbackCancel||function(){},a.callbackClose=a.callbackClose||function(){},a.callbackMaximize=a.callbackMaximize||function(){},a.callbackMinimize=a.callbackMinimize||function(){},a.isModal=void 0===a.isModal||a.isModal,a.isMovable=!1,a.isMinimizable=!1,a.isMaximizable=!1,a}var s=0,t={},u=this;this.DialogTypes={COMPOSITION:{name:"composition",limit:5},OTHER:{name:"other",limit:100},CONFIRM:{name:"confirm",limit:100},SESSION_EXPIRED:{name:"session-expired",limit:1},USER_THEME:{name:"user-theme",limit:1,forceId:1e4},SPECIAL_BOARD:{name:"special-board",limit:1,forceId:10001}},this.add=function(b){if(b.compositionConfig&&b.compositionConfig.singleInstanceId&&!c.env.device.isMobile)for(var d in t)if(t.hasOwnProperty(d)&&t[d].compositionConfig&&t[d].compositionConfig.singleInstanceId&&t[d].compositionConfig.singleInstanceId===b.compositionConfig.singleInstanceId)return void a.$broadcast("dialog:blink",d);var e=b.compositionConfig,f=b.title,h=b.message||"Komunikat",i=b.template||"/dialog/views/dialog_default.html",j=b.dialogType||this.DialogTypes.OTHER,k=j.forceId||b.forceId||j.name+"_"+ ++s,l=0,m=j.limit;for(var n in t)t.hasOwnProperty(n)&&t[n].dialogType===j&&l++;l>=m||(t[k]={id:k,title:f,template:i,dialogType:j,message:h,callback:b.callback,success:b.success,callbackCancel:b.callbackCancel||function(){},callbackClose:b.callbackClose||function(){},callbackMaximize:b.callbackMaximize||function(){},callbackMinimize:b.callbackMinimize||function(){},confirm:b.confirm||"OK",cancel:b.cancel||"Anuluj",isModal:void 0!==b.isModal&&b.isModal,isMinimizable:void 0===b.isMinimizable||b.isMinimizable,isMaximizable:void 0===b.isMaximizable||b.isMaximizable,isMovable:void 0===b.isMovable||b.isMovable,isClosable:void 0===b.isClosable||b.isClosable,isHeaderVisible:void 0!==b.isHeaderVisible&&b.isHeaderVisible,isBackgroundCloseable:void 0!==b.isBackgroundCloseable&&b.isBackgroundCloseable,compositionConfig:e,folders:b.folders||[],additionalData:b.additionalData||{},isHeaderHidden:b.isHeaderHidden,additionalClasses:b.additionalClasses,isBlocking:b.isBlocking,boards:b.boards||{}},1014===b.code&&g.pushIWACode("infoboardBlockSmtpView"))},this.confirm=function(a){a=r(a),a.message=a.message||"Czy na pewno?",a.dialogType=this.DialogTypes.CONFIRM,a.template=a.template||"/dialog/views/dialog_confirm.html",a.additionalData=a.additionalData||{},this.add(a)},this.folderConfirm=function(a){a=r(a),a.message=a.message||"Czy na pewno?",a.dialogType=this.DialogTypes.OTHER,a.template="/dialog/views/dialog_folder_confirm.html",this.add(a)},this.info=function(a){a=r(a),a.dialogType=this.DialogTypes.OTHER,a.template="/dialog/views/dialog_info.html",a.isClosable=!1,this.add(a)},this.mobileCalendar=function(b){b=r(b),b.dialogType=this.DialogTypes.OTHER,b.template="/dialog/views/dialog_mobile_calendar.html",b.additionalClasses="mobile-calendar",b.isClosable=!1,b.isHeaderHidden=!0,this.add(b),d(function(){a.$digest()},0,!1)},this.infoBoard=function(a){a=r(a),a.template=a.template?a.template:"/dialog/views/dialog_info_board.html",a.dialogType=this.DialogTypes.OTHER,a.additionalClasses="board"+(a.additionalClass?" "+a.additionalClass:""),a.isClosable=!1,this.add(a),a.callback&&a.callback()},this.userTheme=function(b){b=r(b),b.dialogType=this.DialogTypes.USER_THEME,b.template="/dialog/views/dialog_user_themes.html",b.additionalClasses="user-themes",b.isClosable=!0,b.isMinimizable=!0,b.isHeaderHidden=!c.env.device.isPc,b.isModal=!1,b.isHeaderVisible=!0,this.add(b),d(function(){a.$digest()},0,!1)},this.dataSecurity=function(b){b=r(b),b.title="Bezpieczna poczta",b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_data_security.html",b.additionalClasses="data-security",b.isClosable=!!c.env.device.isMobile,b.isHeaderHidden=c.env.device.isPc,b.additionalData={saveSpec:function(d,f){i.setSecurityData({email:f,mobile:d,password:""}).then(function(d){d?(j.success("security:saved-success"),a.$broadcast("directive:dialog:close-composition"),e.put("/infoBoard",{id:b.id,state:c.boardStates.BOARD_STATE_ACCEPT,sValue:1})):j.error(d.msg?d.msg:"Wystąpił błąd")})["catch"](function(a){a.data&&a.data.data.recovery&&a.data.data.recovery.email[0]&&j.error(a.data.data.recovery.email[0])}),b.isBlocking?g.pushIWA(["plansza_uzupelnij","plansza_blokujaca","klik","zapisz"]):g.pushIWA(["plansza_uzupelnij","plansza_z_wyborem","klik","zapisz"])},validate:function(a,b){return!(void 0===a||void 0===b||a.length||b.length)},phonePattern:c.patterns.phone,emailPattern:c.patterns.email},b.callbackCancel=function(){g.pushIWA(["plansza_uzupelnij","plansza_z_wyborem","klik","pozniej"]),g.pushGemius(".W2VVGthySxZTKCF8TbQwaSdHQKGLccDueJIEMgIv9T.t7")},b.callbackClose=function(){g.pushIWA(["plansza_uzupelnij","plansza_z_wyborem","klik","zamknij"])},g.pushGemius("Bx01NOO4uSrOJ3BPbLkQLZaEHQIppccD3qpIEIdCZzv.77"),i.getSecurityData().then(function(a){a&&(b.additionalData.tel=a.mobile,b.additionalData.mail=a.email)}),this.add(b),b.isBlocking?g.pushIWA(["plansza_uzupelnij","plansza_blokujaca","view","-"]):g.pushIWA(["plansza_uzupelnij","plansza_z_wyborem","view","-"])},this.safeMail=function(b){function d(a){return void 0!==a&&a.length>0}b=r(b),b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_safe_mail.html",b.additionalClasses="data-security",b.isClosable=!1,b.isHeaderHidden=c.env.device.isPc,b.additionalData={saveSpec:function(d,f){i.setSecurityData({email:f,mobile:d,password:""}).then(function(d){d?(j.success("security:saved-success"),a.$broadcast("directive:dialog:close-composition"),l.update({onlyQuestionRecovery:2}),e.put("/infoBoard",{id:b.id,state:c.boardStates.BOARD_STATE_ACCEPT,sValue:1})):j.error(d.msg?d.msg:"Wystąpił błąd")})["catch"](function(a){a.data&&a.data.data.recovery&&a.data.data.recovery.email[0]&&j.error(a.data.data.recovery.email[0])}),g.pushIWACode(b.stat.go)},validate:function(a,b){return!(d(a)||d(b))},phonePattern:c.patterns.phone,emailPattern:c.patterns.email,isBlocking:b.isBlocking,description:b.description
},b.callbackCancel=function(){g.pushIWACode(b.stat.close)},i.getSecurityData().then(function(a){a&&(b.additionalData.tel=a.mobile,b.additionalData.mail=a.email)}),g.pushIWACode(b.stat.display),this.add(b)},this.businessWebsiteComplete=function(b){b=r(b),b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_business_website_complete.html",b.additionalClasses="business-website-complete-data",b.isClosable=!1,b.isHeaderHidden=!0,b.additionalData={fillData:function(){a.$broadcast("directive:dialog:close-composition"),e.put("/infoBoard",{id:b.id,state:c.boardStates.BOARD_STATE_ACCEPT,sValue:1}),g.pushIWACode(b.stat.prepare,b.id),c.env.device.isMobile?window.open("https://ustawienia-firmowe.interia.pl/#/strona-www?scroll=contentForm","_self"):window.open("https://ustawienia-firmowe.interia.pl/#/strona-www?scroll=contentForm","_blank")}},b.callbackCancel=function(){g.pushIWACode(b.stat.close,b.id)},g.pushIWACode(b.stat.display,b.id),this.add(b)},this.businessAccountDaysToEndInfoBoard=function(a){a=r(a),a.additionalData.extrasDaysToEnd=c.env.businessPackInfo.extrasDaysToEnd,a.additionalData.extrasDaysFromStart=c.env.businessPackInfo.extrasDaysFromStart,a.additionalData.daysToEndDomainRegister=14-c.env.businessPackInfo.extrasDaysFromStart,a.additionalData.daysToEndDomainRegister=0===a.additionalData.daysToEndDomainRegister?1:a.additionalData.daysToEndDomainRegister,a.additionalClasses="board "+a.additionalClass,a.isClosable=!1,this.add(a)},this.birthdayRodo=function(b){b=r(b),b.title="Uzupełnienie pełnej daty urodzin",b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_birthday_rodo.html",b.additionalClasses="birthday-rodo",b.isClosable=!1,b.isHeaderHidden=c.env.device.isPc,b.additionalData={months:[{value:"Styczeń",key:"01"},{value:"Luty",key:"02"},{value:"Marzec",key:"03"},{value:"Kwiecień",key:"04"},{value:"Maj",key:"05"},{value:"Czerwiec",key:"06"},{value:"Lipiec",key:"07"},{value:"Sierpień",key:"08"},{value:"Wrzesień",key:"09"},{value:"Październik",key:"10"},{value:"Listopad",key:"11"},{value:"Grudzień",key:"12"}],sendDate:function(c){if(void 0===c||void 0===b.additionalData.month)return void j.error("personalData:validate-birthday-error");var d=c.year||b.additionalData.userAge,f=c.day>=1&&c.day<=31,h=d>1900&&d<=(new Date).getFullYear();if(1===c.day.length&&(c.day="0"+c.day),!f||!h)return void j.error("personalData:validate-birthday-error");var i=d+"-"+b.additionalData.month.key+"-"+c.day;k.setUserYear({birthDate:i}).then(function(b){1==b.status?(j.success("security:saved-success"),a.$broadcast("directive:dialog:close-composition"),e.put("/infoBoard",{id:224,state:1,sValue:1})):j.error("personalData:validate-birthday-error")}),g.pushIWA(["Plansza","data_urodzenia","klik","zapisz",d])}},k.getUserYear().then(function(a){a.data&&(b.additionalData.userAge=a.data.birthYear)}),this.add(b),g.pushIWA(["Plansza","data_urodzenia","view","-","-"])},this.adultPermission=function(b){b=r(b),b.title="Zgoda na treści dla pełnoletnich",b.dialogType=this.DialogTypes.SPECIAL_BOARD,b.template="/dialog/views/dialog_adult_permission.html",b.additionalClasses="adult-permission",b.isClosable=!1,b.isHeaderHidden=c.env.device.isPc,b.additionalData={save:function(b){return!b||b.no===!1&&b.yes===!1?void j.error("marketingData:validate-error"):(b.yes===!0?(b=1,g.pushIWA(["Plansza","Pelnoletni","klik","tak"])):(b=0,g.pushIWA(["Plansza","Pelnoletni","klik","nie"])),void h.updateAgreementData({adultAgreement:b,withCredentials:!1}).then(function(b){1==b.status?(j.success("marketingData:saved-success"),a.$broadcast("directive:dialog:close-composition"),e.put("/infoBoard",{id:203,state:1,sValue:1})):j.error(b.msg)}))}},this.add(b),g.pushIWA(["Plansza","Pelnoletni","view","-"])},this.popTrashBar=function(a){a=r(a),a.template="/dialog/views/dialog_pop_trash.html",a.isModal=!1,a.isHeaderHidden=!0,a.additionalData=a.additionalData||{},a.additionalClasses="dialog-popTrash",this.add(a)},this.sessionExpiredDialog=function(a){if(NXT_CONFIG.env.isMobileApp)try{NXT_CONFIG.env.device.isIOS?window.webkit.messageHandlers.sessionExpired.postMessage("sessionExpired"):MobileAppConnector.sessionExpired()}catch(d){console.log("Only to use in mobileApp - sessionExpired")}else g.pushIWA(["plansza","wygasla_sesja","view","-"]),a=r(a),a.dialogType=this.DialogTypes.SESSION_EXPIRED,a.template="/dialog/views/dialog_session_expired.html",a.isClosable=!1,a.isHeaderHidden=!0,a.additionalClasses="session-expired force-css-center",a.additionalData={loginUrl:c.env.loginUrl,ownEmail:c.env.ownEmail,loginReferer:b.protocol()+"://"+b.host()+"/next/framelogin",loginFailedReferer:b.protocol()+"://"+b.host()+"/next/frameloginfailed",formTarget:"loginFrame",fromHTTP:"http"===b.protocol()},a.additionalData.onLogin=function(){a.additionalData.ownEmail!==c.env.ownEmail&&(a.additionalData.formTarget="",a.additionalData.loginReferer=a.additionalData.loginFailedReferer=b.protocol()+"://"+b.host())},this.add(a)},this.multiBoards=function(a){a=r(a),a.dialogType=this.DialogTypes.SPECIAL_BOARD,a.isHeaderHidden=!0,a.additionalClasses="multi-board",a.template="/dialog/views/multiBoards/dialog_multiBoard_template.html",this.add(a)},this.pushSettings=function(){function b(){return"denied"===m.getPermissionState()||m.isPromptClosed()?3:"prompt"===m.getPermissionState()?2:1}function d(){return c.hacks.isFirefox?"Kliknij <b>odbieraj</b> w lewym górnym rogu przeglądarki.":c.hacks.isChrome?"Kliknij <b>zezwalaj</b> w lewym górnym rogu przeglądarki.":""}var e=c.env.isCorp,f={};f=r(f),f.title="Ustawienia powiadomień",f.dialogType=this.DialogTypes.SPECIAL_BOARD,f.template="/dialog/views/dialog_push_settings.html",f.additionalClasses="push-settings-dialog push-settings-dialog__"+b(),f.isClosable=!1,f.additionalData={folders:angular.copy(m.getFolders()),foldersInfo:{1:{isShow:1,trackName:"odebrane"},2:{isShow:!e,tooltipBubble:c.env.hasShoppingFolder?-1:1,type:c.env.hasShoppingFolder?"":"inactive",trackName:"oferty"},3:{isShow:!e,tooltipBubble:c.env.hasSocialFolder?-1:2,type:c.env.hasSocialFolder?"":"inactive",trackName:"spolecznosci"},4:{isShow:c.env.hasCustomFolder,trackName:"folder_prywatny"}},trackFolder:function(a,b){g.pushIWACode(a?"pushSettingCheckboxOn":"pushSettingCheckboxOff",b)},step:b(),cancel:function(){g.pushIWACode("pushSettingCancel"),a.$broadcast("directive:dialog:close-composition")},save:function(){g.pushIWACode("pushSettingSave"),m.setWebpushInfo(f.additionalData.folders),a.$broadcast("directive:dialog:close-composition")},close:function(){g.pushIWACode("pushSettingClose",f.additionalData.step),a.$broadcast("directive:dialog:close-composition")},moreCallback:function(){g.pushIWACode("pushSettingMore")},moreUrl:c.env.service&&"int"===c.env.service.name?"https://help.int.pl/news-jak-wlaczyc-powiadomienia-pocztowe-w-przegladarce,nId,2632877":"https://pomoc.poczta.interia.pl/news-jak-wlaczyc-powiadomienia-pocztowe-w-przegladarce,nId,2632364",interfaceName:c.env.service.name,promptInfo:d()},g.pushIWACode("pushSettingView",f.additionalData.step),this.add(f)},this.billing=function(b,d){function e(){var a=m.additionalData.step;return 0===a?"autopromo":"informacje_"+a}function h(){b(),f.cancel(i),a.$broadcast("directive:dialog:close-composition")}var i,j=5e3,k=4,m={};b=b||function(){},n.getAgreement(c.env.billing.agreementId).then(function(a){m.additionalData.desc=a.data}),m=r(m),m.isHeaderHidden=!0,m.template=c.env.device.isMobile?"/billing/views/board_mobile.html":"/billing/views/board.html",m.additionalData={step:0,setStep:function(a){var b=m.additionalData.step+a;b>=1&&b<=k&&(1===a?g.pushIWACode("infoboardPaymentChangeNext",e()):g.pushIWACode("infoboardPaymentChangePrev",e()),m.additionalData.step=b,g.pushIWACode("infoboardPaymentInfoDisplay",e()),f.cancel(i))},check:function(){m.additionalData.step=1,g.pushIWACode("infoboardPaymentCheck",d),g.pushIWACode("infoboardPaymentInfoDisplay",e()),i=f(function(){m.additionalData.step===k?m.additionalData.step=1:m.additionalData.step++,g.pushIWACode("infoboardPaymentInfoDisplay",e())},j),b()},turnOn:function(){0===m.additionalData.step?g.pushIWACode("infoboardPaymentTurnOnStep0",d):g.pushIWACode("infoboardPaymentTurnOn",e()),h(),o.activate().then(function(){a.$broadcast("folders:refresh",function(){q.go("folder",{folderId:o.FOLDER_ID})})})},closeLink:function(){g.pushIWACode("infoboardPaymentCloseLink",d),h(),l.update({billing_status:3})},desc:""},m.additionalClasses="billing-dialog",this.add(m),g.pushIWACode("infoboardPaymentInfoDisplayStep0",d)},this.surveyPlywak=function(a){var b=0===Math.round(Math.random())?"394355":"382641";a=r(a),a.additionalData={},a.dialogType=this.DialogTypes.OTHER,a.additionalClasses="board survey-plywak"+(a.additionalClass?" "+a.additionalClass:""),a.additionalData.url="https://www.webankieta.pl/ankieta/"+b+"/badanie-ankietowe-nt-aplikacji-nowa-poczta-interia.html?external_key="+NXT_CONFIG.env.ownHashEmail,a.isHeaderHidden=!0,a.isModal=!1,this.add(a)},this.businessAccountExtensionInfoBoard=function(a){function b(){var a=new Date(c.env.businessPackInfo.expiredDate),b=a.getDate(),d=a.getMonth()+1,e=a.getFullYear();return("0"+b).slice(-2)+"."+("0"+d).slice(-2)+"."+e}var d=14+c.env.businessPackInfo.extrasDaysToEnd;d>0&&(d+=p.getVarietyVerbs(d,[" dzień"," dni"," dni"])),a=r(a),a.additionalClasses="board "+a.additionalClass,Object.assign(a.additionalData,{toEnd:d,expiryDate:b()}),a.callback=function(){g.pushIWACode(a.stat.go),window.open(a.additionalData.destUrl,"_blank")},a.callbackCancel=function(){g.pushIWACode(a.stat.close)},this.add(a)},this.expiredInfo=function(a){var b="int"===c.env.service.name||c.env.isYoung;a.additionalClasses="board "+a.additionalClass,a.isModal=!0,a.isClosable=!1,a.isMaximizable=!1,a.isMinimizable=!1,a.additionalData={regulations:b?"rozdz. X pkt 3b":"rozdz. XII 4b",regulationsUrl:b?"//p.iplsc.com/-/0009GR8ODII3TX9E.pdf":"//info.poczta.interia.pl/regulamin",regulationsOldUrl:b?"//p.iplsc.com/-/0007BOVJI3XGFTSL.pdf":"//p.iplsc.com/-/0007BOVH6YAL3N03.pdf"},this.add(a)},a.$on("http:response:error:sessionExpired",function(){u.sessionExpiredDialog({message:"Sesja wygasła"})}),this.confirmFolderFreeze=function(a,b){this.confirm({message:"Operacja, którą chcesz wykonać może chwilę potrwać.",callback:a,callbackCancel:b,callbackClose:b})},this.remove=function(a){delete t[a]},this.removeUserTheme=function(){delete t[this.DialogTypes.USER_THEME.forceId]},this.getList=function(){return t},this.isCompositionOpen=function(){var a=0;for(var b in t)t[b].dialogType&&"composition"===t[b].dialogType.name&&a++;return!!a}}]),angular.module("nxt-external-account").provider("ExternalAccount",function(){"use strict";this.$get=["$http","$rootScope","Notification","ApplicationConfig",function(a,b,c,d){function e(a){return a=a||"",f(a)?a.substring(a.indexOf("@")+1,a.lastIndexOf(".")):j}function f(a){return i=d.aliasDomains,d.env.adminBusinessPackType==d.ADMIN_BUSINESS_TYPE.ADMIN?"hub.pl"==g(a)?i.indexOf(h(a))===-1:i.indexOf(g(a))===-1:d.env.adminBusinessPackType==d.ADMIN_BUSINESS_TYPE.SUBACCOUNT||(d.env.isCorp?i.indexOf(g(a))===-1:i.indexOf(h(a))===-1)}function g(a){return a=a||"",a.substr(a.indexOf("@")+1).toLowerCase()}function h(a){var b=g(a),c=b.split(".");return c.length>2&&(b=c[c.length-2]+"."+c[c.length-1]),b}var i=d.aliasDomains;0===d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail);var j=d.env.service?d.env.service.name:"interia";return{query:function(c,f){var g=f?{id:c||d.folders.INBOX,time:(new Date).getTime()}:{id:c||d.folders.INBOX};return a.get("/extacclist/:id",{params:g,transformResponse:function(a){if(a&&a.data){var b=0;a.data=a.data.map(function(a){return a.service=e(a.email),a.unread=a.totalMsg-a.readMsg,a.defaultSent=a.email===d.prefs.defaultAccount,a.isAlias="alias"===a.type,"0"===a.allowSend&&(b=1),a}),d.env.hasErrorInExternalAccounts=b}return a}}).then(function(a){return b.$broadcast("external-account:service:query",a),a})},getDomain:g,getMainDomain:h,isExternalDomain:f,getService:e,isAlias:function(b){return a.get("/extacc",{transformResponse:function(a){return!!a.data&&a.data.some(function(a){return a.email==b&&"alias"==a.type})}})},isExternalAccount:function(b){return a.get("/extacc",{transformResponse:function(a){return!(!a||!a.data)&&a.data.some(function(a){return a.email==b&&"account"==a.type})}})},checkAliasAvailability:function(c){return a.get("/extacc/checkAlias",{params:{email:c},transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.email=a.login+"@"+a.domain,a})),a}}).then(function(a){return b.$broadcast("external-account:service:checkAvailability",a),a})},get:function(c){return a.get("/extacc/:id",{params:c,transformResponse:function(a){return a&&a.data&&"alias"==a.data.type&&(a.data.id=a.data.id*-1),a}}).then(function(a){return b.$broadcast("external-account:service:get",a),a})},saveAlias:function(b,e){var f=b.isAlias?"put":"post";return b.method="alias",a[f]("/extacc",b).then(function(a){"1"==b.defaultSent?d.prefs.defaultAccount=b.email:b.email==d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),c.success(e?e:"external-account:service:save",a)})},saveAccount:function(b,e){var f=b.id?"put":"post";return a[f]("/extacc",b).then(function(a){return"1"==b.defaultSent?d.prefs.defaultAccount=b.email:b.email==d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),c.success(e?e:"external-account:service:save",a),a})},deleteAlias:function(b){return a["delete"]("/extacc",{email:b,method:"alias"}).then(function(a){c.success("external-account:service:deleteAlias",a)})},deleteAccount:function(b,d){var e={id:b};return d&&(e.deleteMessages=1),a["delete"]("/extacc",e).then(function(a){c.success("external-account:service:deleteAccount",a)})},settings:function(c){return a.get("/extacc/settings",{params:{email:c}}).then(function(a){return b.$broadcast("external-account:service:settings",a),a})},getInteriaDomains:function(){return a.post(d.env.pocztaApiUrl+"/v1/account/getDomains",{serviceId:d.env.service.id,sid:d.env.sid,uid:d.env.uid})}}}]}),angular.module("nxt-filter").provider("Blacklist",function(){"use strict";var a=1,b=2;this.$get=["$http",function(c){return{query:function(){return c.get("/bwlist")},search:function(a){return c.get("/bwlist",{transformResponse:function(b){return b&&b.data&&(b.data=b.data.filter(function(b){return b===a}).pop()),b}})},addToBlacklist:function(a){return c.post("/bwlist",{email:a.email,color:b})},removeFromBlacklist:function(a){return c["delete"]("/bwlist",{email:a.email,color:b})},addToWhitelist:function(b){return c.post("/bwlist",{email:b.email,color:a})}}}]}),angular.module("nxt-filter").provider("QuickFilter",function(){"use strict";this.$get=["$http","Notification",function(a,b){return{get:function(){return a.get("/quickfilter",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.filters),a}})},create:function(c){return a.post("/quickfilter",c).then(function(a){a.filterId?b.success("filtr:service:quickCreate",a):b.success("filtr:service:quickUpdate",a)})}}}]}),angular.module("nxt-folder").provider("Attachments",function(){"use strict";function a(a){var b=a.indexOf("interia.pl");b===-1&&(b=a.indexOf("int.pl"));var c=a.substring(0,b-1)+"-stream."+a.substring(b);return c}this.$get=["$http","$rootScope","$q","$state","ApplicationConfig",function(b,c,d,e,f){return{openAtt:function(b,c){"eml"===c.extension?(e.go("messageEml",{messageId:c.mid,mpid:c.mpid}),b.preventDefault(),b.stopPropagation()):"pdf"===c.extension?(f.hacks.isAndroid&&!f.env.isMobileApp||f.hacks.isIOS&&f.env.isMobileApp?window.location.href=c.urlDownload:(f.hacks.isAndroid||f.hacks.isIOS)&&window.open(c.url),f.hacks.isIOS&&b.preventDefault()):"mov"!==c.extension&&"mp4"!==c.extension||!f.hacks.isIOS?f.hacks.isAndroid&&!f.env.isMobileApp||f.hacks.isIOS&&f.env.isMobileApp?window.location.href=c.urlDownload:(f.hacks.isAndroid||f.hacks.isIOS)&&(f.env.isMobileApp&&f.hacks.isAndroid&&!f.env.appSupportedOpenFiles?window.open(c.urlDownload):window.open(c.url)):window.open(a(c.url),"_self")},getStreamUrl:function(b){return a(b)}}}]}),angular.module("nxt-folder").provider("Folder",function(){"use strict";function a(b,c){var d,e=[];for(d=0;d<b.length;d++)e.push({name:c+b[d].name,id:b[d].id}),b[d].subfolders&&(e=e.concat(a(b[d].subfolders,"_"+c)));return e}var b;this.$get=["$stateParams","$http","$rootScope","Notification","ApplicationConfig","Track","ApplicationData","Bugtracker",function(c,d,e,f,g,h,i,j){function k(a){return a.isInbox=a.id===g.folders.INBOX,a.isSent=a.id===g.folders.SENT,a.isDrafts=a.id===g.folders.DRAFTS,a.isTrash=a.id===g.folders.TRASH,a.isSpam=a.id===g.folders.SPAM,a}function l(a){return!(a.isSystem||a.isShopping||a.isSocial||a.isBilling)}return{query:function(){return d.get("/folder",{transformResponse:function(a){return a&&a.data&&(a.data=a.data.map(function(a){return a.id==b&&(a.unseen=0),a})),a}})},queryAsMap:function(){return d.get("/folder",{transformResponse:function(a){if(a&&a.data){var b={all:g.folders,system:g.folders,user:{}};a.data.forEach(function(a){b.all[a.id]=a,l(a)?(b.user[a.id]=a,Array.isArray(a.subfolders)?a.subfolders.forEach(function(a){b.all[a.id]=a,b.user[a.id]=a}):a.subfolders=[]):(b.system[a.id]=a,a.isShopping?(b.all.SHOPPING=a.id,b.system.SHOPPING=a.id):a.isSocial?(b.all.SOCIAL=a.id,b.system.SOCIAL=a.id):a.isBilling&&(b.all.BILLING=a.id,b.system.BILLING=a.id))}),a.data=b}return a}})},get:function(a){return d.get("/folder/:id",{params:a,transformResponse:function(a){return a&&a.data&&(a.data=k(a.data)),a}})},operation:function(a,b){c.filter&&(a.filter=c.filter);var e=b?"putPreserveCache":"put";return d[e]("/folder/oper",a)},save:function(a){return a.oper=a.id>0?"update":"create",a.folderId=a.id,this.operation(a).then(function(b){return e.$broadcast("service:folder:save",b),"create"===a.oper&&a.parentId>0?h.pushGACode("selectOptSubfolder"):"create"===a.oper&&h.pushGACode("addSubFolder"),b})},deleteFolder:function(a){return this.operation({oper:"delete",folderId:a}).then(function(a){e.$broadcast("service:folder:deleted",a)})},deleteMessages:function(a){var b={oper:"purge"};return b.folderId=a&&a.folderId?a.folderId:c.folderId,b.folderId!=g.folders.SPAM&&b.folderId!=g.folders.TRASH||(b.real=1),this.operation(b).then(function(){f.success("service:folder:delete",b.folderId)})},moveToFolder:function(a,b){return this.operation({oper:"movemesg",destinationId:a}).then(function(){a==g.folders.TRASH?f.success("service:messages:move-to-trash"):f.success("service:messages:move"),e.$broadcast("controller:folder:update",{folderId:a,messages:b}),e.$broadcast("service:message:move",{messages:b})})},moveToUnSpam:function(a){return this.moveToFolder(g.folders.INBOX,a)},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a[0].isStarred}).then(function(){e.$broadcast("service:messages:favorite",{messages:a})})},markAsRead:function(a){return this.operation({oper:"setread"}).then(function(){e.$broadcast("service:messages:read",{messages:a})})},markAsUnread:function(a){return this.operation({oper:"setunread"}).then(function(){e.$broadcast("service:messages:unread",{messages:a})})},touch:function(a){return b=a,this.operation({oper:"touch",folderId:a})},restorepopped:function(){return this.operation({oper:"restorepopped"})},getFlatFoldersList:function(){return d.get("/folder",{transformResponse:function(b){return b.data=a(b.data,""),b}})},getAdditionalSystemsFolderInfo:function(a){return k(a)},isUsersFolder:l,getCachedFolderById:function(a){for(var b=i.get("Folder").data,c=0;c<b.length;c++){var d=b[c];if(d.id==a)return k(b[c]);if(d.subfolders)for(var e=0;e<d.subfolders.length;e++)if(d.subfolders[e].id==a)return k(d.subfolders[e])}return j.send({message:"Proba pobrania nieistniejacego folderu: "+a}),{id:1,isShopping:!1,isSocial:!1,isBilling:!1,isSystem:!0,name:"",parentId:0,read:0,subfolders:!1,total:0,unread:0,unseen:0}}}}]}),angular.module("nxt-folder").factory("MessageCommander",["Folder","Messages","Message",function(a,b,c){"use strict";var d=function(){this.currentState=null,this.defaultState=this.STATE_MESSAGES,this.setNextActionState(this.defaultState)};return d.prototype={STATE_FOLDER:"state-folder",STATE_MESSAGES:"state-messages",STATE_MESSAGE:"state-message",setNextActionState:function(d){switch(d){case"state-folder":this.currentState=a;break;case"state-messages":this.currentState=b;break;case"state-message":this.currentState=c;break;default:throw new Error("Unknow state ["+d+"]!")}},markAsRead:function(a){var b=this.currentState.markAsRead(a);return this.setNextActionState(this.defaultState),b},markAsUnread:function(a){var b=this.currentState.markAsUnread(a);return this.setNextActionState(this.defaultState),b},markAsFavorite:function(a){var b=this.currentState.markAsFavorite(a);return this.setNextActionState(this.defaultState),b},moveToFolder:function(a,b){var c=this.currentState.moveToFolder(a,b);return this.setNextActionState(this.defaultState),c},moveToUnSpam:function(a){var b=this.currentState.moveToUnSpam(a);return this.setNextActionState(this.defaultState),b},deleteMessages:function(a){var b=this.currentState.deleteMessages(a);return this.setNextActionState(this.defaultState),b},listUnsubscribe:function(a){var b=this.currentState.listUnsubscribe(a);return this.setNextActionState(this.defaultState),b}},new d}]),angular.module("nxt-folder").provider("Messages",function(){"use strict";function a(a,b){var c,d=a.length;for(c=0;c<d&&(a[c].longpollMessage&&a[c].rawDate>b);c+=1);return c}function b(a){var b=["id","extaccId","filter","search","searchf","sort"];if(1==a.page||i=={})return!0;for(var c=0;c<b.length;c++)if(i[b[c]]!=a[b[c]])return!0;return!1}function c(a){for(var b=a.length,c=0;c<b;c++)if(a[c].msgCount>1)return 1===b?"thread":"threads";return 1===b?"message":"messages"}var d=1,e=1,f=25,g=50,h=[],i={};this.$get=["$http","$rootScope","$q","Notification","ApplicationConfig","Contact","$stateParams","Bugtracker","Http","Tools",function(j,k,l,m,n,o,p,q,r,s){return{PACK_SIZE:f,PACK_SIZE_REQUEST:g,query:function(a){var c=this,d=[];c.isActiveBuffer(a)?(b(a)&&(c.clearBuffer(),i=angular.copy(a)),a.psize=g,d=c.getFromBuffer(a.page,f)):1==a.page&&(e=1);var h=function(){return d&&0===d.length};if(h()){(n.env.device.isMobile||parseInt(a.id)===n.folders.BILLING)&&(a.withTreading=0),a.ver=2;var k=a.page;c.isActiveBuffer(a)&&(a.page=e);var l={params:a,transformResponse:function(b){var d=!1;return b&&b.data?(a.page=k,b.meta&&(d=b.meta.pagination),b.data.messages&&(b.data=b.data.messages),c.isActiveBuffer(a)?(1===a.page&&c.clearBuffer(),c.saveToBuffer(b.data),e++,{data:{messages:c.getFromBuffer(a.page,f),pagination:d}}):{data:{messages:b.data,pagination:d}}):b}};return a.search&&(l.cache=!1),j.get("/folder/:id/mails",l)}return c.preparePromise({messages:d})},search:function(a,b){var c=angular.copy(b);return c.isSearch=!0,a.search&&(c.subject=a.search),a.ver=2,j.postPreserveCache("/folder/:id/mails",c,{params:a,transformResponse:function(a){var b=!1;return a.meta&&(b=a.meta.pagination),a.data&&a.data.messages&&(a.data=a.data.messages),e++,{data:{messages:a.data,pagination:b}}}})},createFromLongPollResponse:function(a){var b=new Date(1e3*a.rawDate);return o.search(a.fromEmail).then(function(b){b?a.avatarList=b.avatar:a.avatarList=o.createAvatar(a.fromName||a.fromEmail)}),a.unseen=!0,a.date=b.getHours()+":"+((b.getMinutes()<10?"0":"")+b.getMinutes()),a.formatDate="dziś, "+a.date,a.hasAtta=a.attachments,a.priority=a.priority==d&&"high",a},operation:function(a){return j.put("/mails/oper",a,r.appendJsonRequestConfig({transformRequest:function(a){return a.messages=a.messages.map(function(a){return{id:a.id,folderId:a.folderId,threadId:a.threadId}}),a}}))["catch"](function(b){var c="Mails operation error";q.send({message:c+" | Data: "+JSON.stringify(a),exception:new Error(c),cause:JSON.stringify(b)})})},deleteMessages:function(a){var b={oper:"delmail",messages:a};return a.every(function(a){return a.folderId===n.folders.SPAM||a.folderId===n.folders.TRASH})&&(b.real=!0),this.operation(b).then(function(){1===a.length?m.success("service:message:delete"):(m.setReplaceParams([a.length]),m.success("service:messages:delete")),k.$broadcast("controller:folder:update:delete",{messages:a})})},moveToFolder:function(a,b){return this.operation({oper:"movemesg",destinationId:a,messages:b}).then(function(){var d=n.folders[a].name,e=c(b);b.length>1?"threads"===e?m.setReplaceParams([b.length,s.getVarietyVerbs(b.length,["wątek","wątki","wątków"]),d]):m.setReplaceParams([b.length,d]):m.setReplaceParams([d]),a==n.folders.TRASH?m.success("service:"+e+":move-to-trash"):m.success("service:"+e+":move"),k.$broadcast("controller:folder:update",{folderId:a,messages:b}),k.$broadcast("service:message:move",{messages:b})})},moveToUnSpam:function(a){return this.moveToFolder(n.folders.INBOX,a)},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a[0].isStarred,messages:a,folderId:p.folderId}).then(function(){return k.$broadcast("service:messages:favorite",{messages:a}),a})},markAsRead:function(a){return this.operation({oper:"setread",messages:a}).then(function(){k.$broadcast("service:messages:read",{messages:a})})},markAsUnread:function(a){return this.operation({oper:"setunread",messages:a}).then(function(){k.$broadcast("service:messages:unread",{messages:a})})},generateUniqueId:function(a){return a.id?a.uniqueId="m"+a.id:a.threadId&&a.threadId!=-1?a.uniqueId="t"+a.threadId:a.uniqueId="r"+Math.floor(1e11*Math.random()),a},saveToBuffer:function(a){var b=h.slice(0,a.length);a&&angular.isArray(a)&&!angular.equals(b,a)&&(h=h.concat(a))},preparePromise:function(a){var b=l.defer(),c=b.promise;return c.then=function(b){return b(a),c},c},getFromBuffer:function(a,b){if(h){var c=a>1?(a-1)*b:0,d=a>1?a*b:b;return h.slice(c,d)}return[]},clearBuffer:function(){h=[],e=1},isActiveBuffer:function(a){return!(a.search&&""!==a.search||a.extaccId)},unShiftMessage:function(a){h.length&&h.unshift(a)},insertMessageByDate:function(b,c){if(c.length){for(var d=0;d<c.length;d++)if(c[d].uniqueId===b.uniqueId)return c;var e=a(c,b.rawDate);c.splice(e,0,b),h=c}else c.length||c.push(b);return c},getUniqueId:function(a){return a.threadId&&a.threadId!==-1?"t"+a.threadId:"m"+a.id},listUnsubscribe:function(a){return this.operation({oper:"unsubscribe",messages:a})},deleteMailings:function(){return j.put("/folder/oper",{oper:"delmailings"})}}}]}),angular.module("nxt-folder").factory("Search",["$stateParams","$state","$q","$http","$rootScope","Track","Messages",function(a,b,c,d,e,f,g){"use strict";var h=[],i=!0,j={phrase:a.search,historyPhrase:a.searchf,filters:null},k=function(a){return Object.keys(a).forEach(function(b){a[b]||delete a[b]}),a};return e.$on("$stateChangeStart",function(a,b,c,d,e){j.phrase=c.search,j.historyPhrase=c.searchf,e.folderId!=c.folderId&&(j.filters=null)}),{search:function(a,b){j.phrase=a||null,j.historyPhrase=null,j.filters=b?k(b):{},a&&h.indexOf(a)===-1&&(i=!0),this.refresh()},isSearch:function(){return!!(this.getPhrase()||this.getHistoryPhrase()||this.isAdvanced())||!(!this.isSearchInContent()||!this.getPhrase())},searchInContent:function(a,b){b=b||{},b.isSearchInContent=!0,this.search(a,b)},searchHistory:function(a){j.phrase=null,j.historyPhrase=a,j.filters=null,this.refresh()},refresh:function(){a.search!=j.phrase||j.historyPhrase||a.searchf?b.go("folder",{sort:null,filter:null,mode:null,search:j.phrase,searchf:j.historyPhrase}):b.reload()},getPhrase:function(){return j.phrase},getHistoryPhrase:function(){return j.historyPhrase},isAdvanced:function(){return!this.areFiltersEmpty()},isSearchInContent:function(){return!!this.getFilter("isSearchInContent")},getFilters:function(){return j.filters||{}},getFilter:function(a){var b=this.getFilters();return b[a]},areFiltersEmpty:function(){var a=this.getFilters();return!a||angular.equals(a,{})||angular.equals(a,{isSearchInContent:!0})},clearAll:function(){g.clearBuffer(),this.clearPhrase(),this.clearHistoryPhrase(),this.clearFilters()},clearPhrase:function(){j.phrase=null},clearHistoryPhrase:function(){j.historyPhrase=null},clearFilters:function(){j.filters={}},suggestions:function(){var a=c.defer(),b=a.promise;return i?(d.get("/search-history",{cache:!1}).then(function(b){h=b,a.resolve(b)}),i=!1):a.resolve(h),b},removeSuggestion:function(a){return f.pushGACode("delSuggestItem"),d["delete"]("/search-history",{ph:a})}}}]),angular.module("nxt-message").provider("Message",function(){"use strict";function a(a,b){var c,d;return a.headers&&(c=a.headers.filter(function(a){return 0===a.indexOf(b)}),c&&c.length&&(d=c.pop().split(": ").pop()),d)?d:null}this.$get=["$http","$rootScope","Notification","ApplicationConfig","Blacklist","$stateParams","FileClassFinder","VideoEmbed","Bugtracker","Http",function(b,c,d,e,f,g,h,i,j,k){function l(b){var c,d,f,g,i,j,k,l,m={},n=[],o=[],p=[],q=b,r=0,s=0,t=0,u={Do:[],DW:[],UDW:[]};q.recipientsStringsObject={Do:"",DW:"",UDW:""},q.fullRecipientsTooltipTexts={Do:"",DW:"",UDW:""},q.originalRecipients=[],k=[q.mimeParts||[],q.mimePartsThumb||[]],k.forEach(function(a,b){if(angular.isArray(a)&&a.length)for(c=0;c<a.length;c++)g=a[c].name.match(/(.+)\.([^\.]+)/),g&&3===g.length?(i=g[1],j=g[2]):(i=a[c].name,j=""),m[a[c].mpid]={name:a[c].name,shortName:i,className:h.getFileClass(j),size:a[c].size,url:a[c].url,urlDownload:a[c].urlDownload,isImage:!1,extension:j.toLowerCase(),mid:a[c].mid,mpid:a[c].mpid},e.env.device.isPc&&"pdf"!=m[a[c].mpid].extension&&(m[a[c].mpid].url=a[c].urlDownload),1===b&&(m[a[c].mpid].isImage=h.isImage(j),m[a[c].mpid].thumbnail=a[c].thumbUrl),m[a[c].mpid].isVideo=h.isVideo(j)}),k.forEach(function(a){if(angular.isArray(a)&&a.length)for(c=0;c<a.length;c++)m[a[c].mpid].isImage?o.push(m[a[c].mpid]):p.push(m[a[c].mpid])}),n=o.concat(p);for(d in m)m.hasOwnProperty(d)&&r++;return q.subject&&q.subject.length?(f=decodeURIComponent(q.subject.replace(/[^a-zA-Z _0-9ąćęłńóśżźĄĆĘŁŃÓŚŻŹäöüÄÖÜß]+/g,"")),f.length||(f="załączniki")):f="załączniki",[{list:q.to,name:"Do"},{list:q.cc,name:"DW"},{list:q.bcc,name:"UDW"}].forEach(function(a){angular.isArray(a.list)&&(u[a.name]=a.list.map(function(a){return a.name||a.email}),q.recipientsStringsObject[a.name]=u[a.name].join(", "),q.fullRecipientsTooltipTexts[a.name]+=a.name+": ",q.fullRecipientsTooltipTexts[a.name]+=a.list.map(function(a){return a.name&&a.name!==a.email?a.name+" ("+a.email+")":a.email}).join(", "))}),q.from&&(q.fromTooltipText=q.from.name?q.from.name+" ("+q.from.email+")":q.from.email),angular.isArray(q.to)&&(s=q.to.length),angular.isArray(q.cc)&&(t=q.cc.length),s&&(q.originalRecipients=q.originalRecipients.concat(q.to.map(function(a){return a.email}))),t&&(q.originalRecipients=q.originalRecipients.concat(q.cc.map(function(a){return a.email}))),l=a(q,"X-Multipop-Account"),q.envelopeTo=a(q,"X-IPL-Envelope-To"),q.isSent=q.folderId===e.folders.SENT,q.getAllAttachmentsUrl=e.env.uploadUrl+"/html/getattach,mid,"+q.id+",all,1,fid,undefined,uid,"+e.env.uid+"?f="+f+".zip",q.attachments=n,q.attachmentsLength=r,q.senderConfig={fromEmail:q.from&&q.from.email,recipientsEmails:q.originalRecipients,multipopAccountHeader:l,envelopeToHeader:q.envelopeTo,isSent:q.isSent},l?(q.originalRecipients.push(l),q):0===s&&0===t&&q.envelopeTo?(q.originalRecipients.push(q.envelopeTo),q):1===s&&0===t&&!l&&q.envelopeTo&&q.envelopeTo!==q.to[0].email?(q.originalRecipients=[q.envelopeTo],q.to[0].ommitInReply=!0,q):q}return{get:function(a){return b.get("/mail/:id",{params:a,transformResponse:function(a){return a&&a.data&&(a.data=l(a.data),a.data.atta=[],a.data.mimeParts&&(a.data.atta=a.data.atta.concat(a.data.mimeParts)),a.data.mimePartsThumb&&(a.data.atta=a.data.atta.concat(a.data.mimePartsThumb))),a}})},getThread:function(a){return b.get("/thread/"+a+"?sorder=asc&folderId="+g.folderId)},operation:function(a){return b.put("/mails/oper",a,k.appendJsonRequestConfig({transformRequest:function(a){return a.messages=[{id:a.message.id,folderId:a.message.folderId,threadId:a.message.threadId}],delete a.message,a}}))["catch"](function(b){var c="Mails operation error";j.send({message:c+" | Data: "+JSON.stringify(a),
exception:new Error(c),cause:JSON.stringify(b)})})},moveToFolder:function(a,b){return b.threadId=null,this.operation({oper:"movemesg",destinationId:a,message:b}).then(function(){var f=e.folders[a].name;d.setReplaceParams([f]),a===e.folders.TRASH?d.success("service:message:move-to-trash"):d.success("service:message:move"),c.$broadcast("controller:folder:update",{folderId:a,messages:[b]}),c.$broadcast("service:message:move",{messages:[b]})})},moveToUnSpam:function(a){return this.moveToFolder(e.folders.INBOX,a)},deleteMessage:function(a){return this.operation({oper:"delmail",real:!0,message:a}).then(function(){d.success("service:message:delete"),c.$broadcast("controller:folder:update:delete",{messages:[a]})})},markAsFavorite:function(a){return this.operation({oper:"star",isStarred:!a.isStarred,message:a}).then(function(b){return c.$broadcast("service:message:favorite",{message:a}),b})},showImages:function(a){return b.post("/logunblock",{email:a.from.email}).then(function(){c.$broadcast("service:message:show-images")})},alwaysShowImages:function(a){return f.addToWhitelist({email:a.from.email}).then(function(){a.imgProtect=!1,c.$broadcast("service:message:show-images-always")})},messageUnsubscribe:function(a){return this.operation({oper:"unsubscribe",message:a})}}}]}),angular.module("nxt-message").factory("VideoEmbed",["$q","$http","$sce",function(a,b,c){"use strict";function d(a){return a.replace(/H(\d)M/,"H0$1M").replace(/M(\d)S/,"M0$1S").replace(/[HM]/g,":").replace(/[^\d\:]/g,"")}NXT_CONFIG.env.googleApiKey||"AIzaSyCfCCQsyehWuEt8RmAEG5d1Qtd8houD_Z";return{query:function(e){var f=[];return e.items.forEach(function(a){var g=b.get(e.url,{cache:!0,params:{url:a},transformResponse:function(a){return a&&a.items&&a.items.length&&(a.thumbnail_url=a.items[0].snippet.thumbnails.high.url,a.html=a.items[0].player.embedHtml,a.htmlSafe=c.trustAsHtml(a.html),a.duration=d(a.items[0].contentDetails.duration),a.name=a.items[0].snippet.title,a.thumbUrl=a.thumbnail_url,a.title=a.name),a}});f.push(g)}),a.all(f)},find:function(a){var b=[];return b}}}]),angular.module("nxt-notification").provider("Notification",function(){"use strict";this.$get=["$rootScope","ApplicationMessage","$timeout","ScopeService",function(a,b,c,d){var e,f={};return{TYPE_SUCCESS:"success",TYPE_INFO:"info",TYPE_ERROR:"error",notify:function(e,f,g,h,i){var j,k,l={};return g&&a.$broadcast(e,g),k=b.get(e,this.getReplaceParams())||e,h&&(l=b.getOptions(h)),j=l&&l.broadcast?l.broadcast:"service:notification:new",c(function(){d.safeApply(a,function(){a.$broadcast(j,{type:f,code:h,messageId:e,message:l&&l.message?l.message:k,title:l&&l.title?l.title:"",noClose:i})})},0,!1),this},success:function(a,b){return this.notify(a,this.TYPE_SUCCESS,b)},successNoClose:function(a,b){return this.notify(a,this.TYPE_SUCCESS,b,void 0,!0)},info:function(a,b){return this.notify(a,this.TYPE_INFO,b)},error:function(a,b,c){return this.notify(a,this.TYPE_ERROR,b,c)},setReplaceParams:function(a){e=a},getReplaceParams:function(){var a=e;return e="",a},setOnClickCallback:function(a,b){f[a]=b},getOnClickCallback:function(a){return f[a]?f[a]:function(){}},close:function(b){a.$broadcast("service:notification:close",{messageId:b})},on:function(b,c){c=c||function(){},b.forEach(function(b){a.$on(b,function(a,b){c(b,a)})})}}}]}),angular.module("nxt-public-gallery").provider("Gallery",function(){"use strict";this.$get=["$http",function(a){return{changeState:function(a,b){var c={mId:a,state:b};return this.update(c)},update:function(b){return a.put("/gallery",b)}}}]}),angular.module("nxt-settings").provider("Theme",function(){"use strict";this.$get=["$http","ApplicationConfig",function(a,b){return{query:function(){return a.get("/theme")},get:function(b){return a.get("/theme/:id",{params:b})},select:function(b){var c={id:b};return a.put("/theme",{jsonParams:JSON.stringify(c)})},cropUserTheme:function(c,d,e,f,g,h){return a.post(b.env.pocztaApiUrl+"/v1/attachment/crop",{attachmentId:c,x:d,y:e,width:f,height:g,uid:h,sid:NXT_CONFIG.env.sid},{withCredentials:!0})},selectUserThemeJSON:function(b){var c={id:b.id,attachment:b.attachment,attachmentCropped:b.attachmentCropped,attachmentExt:b.attachmentExt,x:b.x||0,y:b.y||0,width:b.width,height:b.height};return a.put("/theme",{jsonParams:JSON.stringify(c)})},changeSkin:function(a){var c,d=document.getElementById("theme-stylesheet"),e=document.getElementById("userBackground");e&&2!=a.type&&(e.innerHTML=""),null===d&&(d=document.createElement("link"),d.id="theme-stylesheet",d.rel="stylesheet","ds"===b.env.name?(d.type="text/less",less.sheets.push(d)):d.type="text/css",document.querySelector("head").appendChild(d)),d.setAttribute("href",b.env.staticUrl+"/css/"+a.cssFile),"ds"===b.env.name&&(less.sheets.length&&(c=less.sheets[0].nextSibling,c&&c.parentNode.removeChild(c)),less.refresh())}}}]}),angular.module("nxt-settings").provider("ThemeUploader",function(){"use strict";var a=!1;this.$get=["FileUploader","$http","$rootScope","$timeout","ApplicationConfig","FileClassFinder",function(b,c,d,e,f,g){function h(){var a,b=f.env.uploadPortal,c={};for(a in b)if(b.hasOwnProperty(a)){if("url"===a)continue;c["__"+a]=b[a]}return c.uid=f.env.uid,c.sid=f.env.sid,c}var i=f.env.pocztaApiUrl+"/v1/attachment/fileUpload",j=h();return{getUploader:function(c){return j=h(),c.uploader=new b({scope:c,url:i,method:"POST",queueLimit:1,autoUpload:!1,withCredentials:!0,formData:[j]}),c.uploadUrl=i,c.uploader.fileInputClick=function(b,c){if(!a){a=!0;var d;document.createEvent&&(d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),e(function(){c.dispatchEvent(d)})),e(function(){a=!1},1e3,!1)}},c.uploader.queueLength=0,c.uploader.MAX_TOTAL_SIZE=10,c.uploader.MAX_ITEMS_COUNT=1,c.uploader.updateTotalSize=function(){c.uploader.queueLength=c.uploader.queue.length,c.uploader.queueLength?c.uploader.totalSize=c.uploader.queue.map(function(a){return a.file.size}).reduce(function(a,b){return a+b})/1048576:c.uploader.totalSize=0,c.uploader.isTotalSizeExceeded=c.uploader.totalSize>c.uploader.MAX_TOTAL_SIZE,c.uploader.isItemsCountExceeded=c.uploader.queue.length>c.uploader.MAX_ITEMS_COUNT},c.uploader.updateUploadedSize=function(){c.uploader.queueLength=c.uploader.queue.length,c.uploader.queueLength?c.uploader.uploadedSize=c.uploader.queue.map(function(a){return a.file.size*(a.progress/100)}).reduce(function(a,b){return a+b})/1048576:c.uploader.uploadedSize=0},c.uploader.updateUploadedCount=function(){c.uploader.uploadedCount=c.uploader.queue.filter(function(a){return a.isUploaded}).length},c.uploader.onAfterAddingFile=function(a){var b=a.file.name.split(".").pop();b&&(a.extension=b,a.className=g.getFileClass(b)),c.uploader.updateTotalSize(),a.batchNumber=0,c.afterAddingFile&&c.afterAddingFile()},c.uploader.onAfterAddingAll=function(){c.uploader.queue.forEach(function(a,b,c){c[b].batchNumber++}),c.uploader.isItemsCountExceeded||c.uploader.isTotalSizeExceeded?c.afterAddingAll&&c.afterAddingAll(c.uploader.isItemsCountExceeded,c.uploader.isTotalSizeExceeded):(c.uploader.uploadAll(),c.afterAddingAll&&c.afterAddingAll())},c.uploader.onProgressItem=function(){c.uploader.updateUploadedSize(),c.afterProgress&&c.afterProgress()},c.uploader.onProgressAll=function(){c.uploader.updateUploadedCount(),c.afterProgressAll&&c.afterProgressAll()},c.uploader.onSuccessItem=function(a,b){if(b&&b.result&&b.result.data&&b.result.data.id){var d=b.result.data.id,e=b.result.data.ext;c.afterSuccess&&c.afterSuccess(d,e)}else c.afterError&&c.afterError(b)},c.uploader.onCompleteAll=function(){c.uploader.updateUploadedCount(),c.afterCompleteAll&&c.afterCompleteAll()},c.showUploader=!0,c.uploader},getUserThemeMiniature:function(a){return c.get("/theme/:id",{params:a})}}}]}),angular.module("nxt-avatar").directive("nxtAvatar",["ApplicationConfig","$rootScope","Profile","$timeout",function(a,b,c,d){"use strict";function e(a){var b,c={};return angular.isString(a)?(b=a.split("|"),1===a.indexOf("|")?(c.type=2,c.initial=b[0],c.data=parseInt(b[1])):(c.type=1,c.data={id:b[0],ext:b[1]})):c=a,c}return{restrict:"A",scope:{avatars:"=?nxtAvatarList",contactName:"=?nxtAvatarContactName",contactEmail:"=?nxtAvatarContactEmail",senderInfo:"=?nxtMessageSenderInfo",options:"=?nxtAvatarOptions"},controller:["$scope",function(b){return b.options=b.options||{},b.IMG_CLASS=b.options.imgClass||a.env.avatarBaseImgClass,b.AVATAR_TYPE=c.AVATAR_TYPE,b.BASE_URL=a.env.avatarBaseUrl,b.avatarApiBaseUrl=a.env.avatarApiUrl,b.avatarFromApiEnablead=a.env.avatarFromApiEnablead,b.options.isOwnAvatar&&(b.avatars=c.getAvatarFromCookie()),b.avatars=e(b.avatars),b.$watch("avatars",function(a){a&&!Array.isArray(a)&&(b.avatars=[a])}),Array.isArray(b.avatars)?b.avatar=b.avatars[0]:b.avatar=b.avatars,a.env.avatarType=b.avatars.type,b}],link:function(c,e){function f(d){if(c.contactName&&c.contactName&&c.options.isCardEnabled&&a.env.device.isPc){d.stopPropagation();var f=e[0].getBoundingClientRect(),g={top:f.top,left:f.left};b.$broadcast("directive:avatar:toggleAvatarCard",{position:g,avatars:c.avatars,senderInfo:c.senderInfo,contact:{name:c.contactName,email:c.contactEmail}})}}var g,h=800;c.toggleAvatarCard=function(a){"click"==a.type?f(a):(d.cancel(g),g=d(function(){f(a)},h))},c.leaveAvatarCard=function(){d.cancel(g)}},templateUrl:function(b,c){return c.nxtAvatarIsThread&&a.env.threading?"/avatar/views/avatar.html":a.env.device.isMobile?"/avatar/views/avatarSimpleMobile.html":"/avatar/views/avatarSimple.html"}}}]),angular.module("nxt-avatar").directive("nxtAvatarCard",["$rootScope","Folder","ApplicationData","$stateParams","Track","ScopeService",function(a,b,c,d,e,f){"use strict";var g=1;return{restrict:"A",replace:!0,scope:{contact:"=?nxtAvatarContact"},controller:["$scope","Compositions","Search","Contact","Blacklist",function(b,c,d,f,h){return b.getContactInfo=function(){f.search(b.contact.email).then(function(a){a&&(b.contactId=a.id,a.id===-666&&(a.isReadonly="true"),b.contact.isReadonly=a.isReadonly),b.isOnContactlist=!!a}),h.search(b.contact.email).then(function(a){b.isOnBlacklist=!!a})},b.createNewMessage=function(){c.addComposition({toActive:b.contact,allowOwnEmails:!0}),e.pushGACode("avatarCardNewMessage"),e.pushIWACode("avatarCardNewMessage")},b.showMailingHistory=function(){d.searchHistory(b.contact.email),e.pushGACode("avatarCardShowMessages"),e.pushIWACode("avatarCardShowMessages")},b.addContact=function(){a.$broadcast("directive:contact:new-form",{name:b.contact.name,email:b.contact.email,avatar:b.avatars}),e.pushGACode("avatarCardAddToContactsList"),e.pushIWACode("avatarCardAddToContactsList")},b.deleteContact=function(){f.deleteContact({id:b.contactId}).then(function(){b.isOnContactlist=!1}),e.pushIWACode("avatarCardRemoveFromContactsList")},b.addToBlacklist=function(){h.addToBlacklist(b.contact).then(function(){b.isOnBlacklist=!0}),e.pushGACode("avatarCardBlockThisUser"),e.pushIWACode("avatarCardBlockThisUser")},b.removeFromBlacklist=function(){h.removeFromBlacklist(b.contact).then(function(){b.isOnBlacklist=!1}),e.pushIWACode("avatarCardUnblockThisUser")},b.addNewFilter=function(){a.$broadcast("controller:filter:quickdialog",{email:b.contact.email}),e.pushGACode("avatarCardFilterMessages"),e.pushIWACode("avatarCardFilterMessages")},b.goToContact=function(){a.$broadcast("controller:contact:goto",{id:b.contactId})},b.quickFilterInBox=function(){a.$broadcast("controller:filter:quick",{email:b.contact.email,folderId:g}),e.pushIWACode("avatarCardDeliverToInbox")},b}],link:function(a,b){a.$on("directive:avatar:toggleAvatarCard",function(b,c){a.senderInfo=c.senderInfo,a.show(c)}),a.$watch("isShow",function(a){a||b.css({opacity:"0"})}),a.show=function(g){var h;setTimeout(function(){h=b[0].offsetHeight,g.position.top+h>=document.body.offsetHeight?(a.isMenuDown=!0,b.css({top:g.position.top-h+54+"px",left:g.position.left+5+"px"})):(a.isMenuDown=!1,b.css({top:g.position.top-4+"px",left:g.position.left+5+"px"})),b.css({opacity:"1"}),f.safeApply(a)},0),g.contact.id===-666&&(g.contact.isReadonly="true"),a.contact=g.contact,a.avatars=g.avatars,a.getContactInfo(),a.isShow=!0;var i=c.get("Folder");a.isMove=!0;var j=d.folderId;e.pushGACode("avatarCardShow"),e.pushIWACode("avatarCardShow");for(var k=0;k<i.data.length;k++)if(j==i.data[k].id&&(i.data[k].isSocial===!0||i.data[k].isShopping===!0))return a.isMove=!1,a}},templateUrl:"/avatar/views/avatarCard.html"}}]),angular.module("nxt-billing").directive("nxtBillingNotification",["$state","Billing","ApplicationConfig","ScopeService","$interval","Track",function(a,b,c,d,e,f){"use strict";var g=1e4,h={1:"overdue",2:"new",3:"not-paid"},i=null,j=!1;return{restrict:"A",scope:{},link:function(d,k){var l,m,n;b.notificationInfo().then(function(a){function b(a){var b="";a.senders&&(b=a.senders.split("; ").filter(function(a,b,c){return c.indexOf(a)===b}).join(", ")),d.counter=a.num,d.desc=b,d.type=h[a.type],"new"===d.type?f.pushIWACode("billingReminderNewView"):"overdue"===d.type?f.pushIWACode("billingReminderOverdueView"):f.pushIWACode("billingReminderOldView")}function c(a){return a.senders+" "+a.num}l=a[0],m=a[1],n=a[2];var o=0===m.num&&0===l.num&&0===n.num;l.num=c(l)!==window.sessionStorage.getItem("overdue")?l.num:0,m.num=c(m)!==window.sessionStorage.getItem("new")?m.num:0,n.num=c(n)!==window.sessionStorage.getItem("not-paid")?n.num:0,j&&(o=!0,j.overdueInfo<l.num?o=!1:m.num>0?o=!1:n.num>0?o=!1:l.num>0&&(o=!1)),o?k.remove():0!==m.num&&0!==l.num||0!==m.num&&0!==n.num||0!==l.num&&0!==n.num?(b(0!==m.num?m:0!==n.num?n:l),i=e(function(){0===n.num||d.type!==h[2]&&d.type!==h[1]?0===l.num||d.type!==h[3]&&d.type!==h[2]?0!==m.num&&d.type!==h[2]&&b(m):b(l):b(n)},g)):m.num>0?b(m):n.num>0?b(n):l.num>0&&b(l)}),d.openBilling=function(){a.go("folder",{folderId:c.folders.BILLING,sort:null,search:null,searchf:null,filter:null,mode:null,withComposition:null,page:null}),j={overdueInfo:l.num,newInfo:m.num,unPaidInfo:n.num},"new"===d.type?f.pushIWACode("billingReminderNewClick"):"overdue"===d.type?f.pushIWACode("billingReminderOverdueClick"):f.pushIWACode("billingReminderOldClick"),f.pushPartialFolder("rachunki","-")},d.closeBillingNotification=function(a,b,c){d.type=!1,window.sessionStorage.setItem(a,c+" "+b)},d.$on("$destroy",function(){i&&e.cancel(i)})},templateUrl:"/billing/views/notification.html"}}]),angular.module("nxt-billing").directive("nxtBillingPanel",["Billing","Track","ApplicationConfig",function(a,b,c){"use strict";return{restrict:"A",scope:{billing:"=?nxtBillingPanel",panelType:"@nxtBillingPanelType"},controller:["$scope",function(d){function e(){return"message"===d.panelType?"podglad_wiad":"lista_wiad"}d.STATES=a.STATES,d.isLoading=!1,d.isDisplay=parseInt(d.billing.state)!==a.STATES.isBill,d.markAsPaid=function(){a.markAsPaid(d.billing.pname),b.pushIWACode("billingMarkPaid",e())},d.markAsNotPaid=function(){a.markAsNotPaid(d.billing.pname),b.pushIWACode("billingMarkNotPaid",e())},d.pay=function(a){d.isLoading=!0,a.preventDefault(),a.stopPropagation(),b.pushIWACode("billingPay",e()),window.location.replace(c.env.billing.url+"/?document="+d.billing.pname)}}],templateUrl:"/billing/views/panel.html"}}]),angular.module("nxt-common").directive("nxtAdPlace",["$location","$rootScope",function(a,b){"use strict";return{restrict:"A",scope:{placement:"@nxtAdPlace",isDeviceDependent:"=?nxtAdDeviceDependent",folderName:"=?nxtAdFolder"},controller:["$scope","ApplicationConfig","Tools",function(a,b,c){var d=b.getConfigAppModule("ads");return d&&d.actions&&d.actions&&d.actions.adsSlotEnabled===!1?(a.adsSloatsOff=!0,a):(a.isPremiumAcc=!!b.env.accountType,a.isDeviceDependent=void 0===a.isDeviceDependent||a.isDeviceDependent,a.getUrl=function(){var d=b.env.advKeyword;return a.folderName&&(d+=";"+c.removePolishDiacritics(a.folderName.toLowerCase()).split(" ").join("_")),"/"+b.env.baseUrl+"/adv,advKeyword,"+d+",adType,"+a.getPlacement()},a.getUrlForPremium=function(){return a.getUrl()+"_premium"},a.getPlacement=function(){var c=a.placement,d=b.env.device;return a.isDeviceDependent&&d.isPc&&(c+="_web"),!d.isMobile||"box300x250"!=c&&"box600x450"!=c||(c+="_tablet"),NXT_CONFIG.env.isMobileApp&&(c+="_app"),c},a)}],link:function(c,d){function e(e){var f=document.createElement("iframe");f.setAttribute("frameBorder",0),f.setAttribute("id",c.placement),f.setAttribute("allowTransparency","true"),f.onload=function(){b.$broadcast("adplace:onload:"+c.placement)},a.hash()&&(e+="#"+a.hash()),f.src=e;var g=document.createElement("div");g.appendChild(f),d.append(g),b.$on("isapp:adv:rodo",function(a,b){localStorage.setItem("adoceanRodoKeyword","rodo_"+b),f.src+=" "})}if(d.addClass("ad ad--"+c.placement),!c.adsSloatsOff){var f=c.isPremiumAcc?c.getUrlForPremium():c.getUrl();e(f)}}}}]),angular.module("nxt-common").directive("nxtAdvClose",["Track","ApplicationConfig","Profile","Notification",function(a,b,c,d){"use strict";function e(a){return a[Math.floor(Math.random()*a.length)]}var f=3;return{restrict:"A",link:function(g,h,i){function j(){var a=k[0].offsetWidth;a<=700&&a>648?h.css("width","650px"):a<=648?h.css("width","500px"):h.css("width","700px")}var k=h.parent(),l=i.nxtAdvCloseName,m=1;g.premiumTest=function(){a.pushGA(["Oznaczanie_reklam","klik","aktywacja_premium_"+l]),c.updateAccountType(f).then(function(a){1==a.status?(g.premiumTestReady=!0,b.env.accountType=0,b.isShowAdDescription=!1):d.error(a.msg)})},g.closeAd=function(){b.env.premiumInfo.premiumInPast?(m=e([1,3]),g.isClose=m,a.pushGA(["Oznaczanie_reklam","klik-X",l]),a.pushGA(["Oznaczanie_reklam","wyswietlenie",l+"-v"+m])):(g.$parent.isPremiumTest=!0,g.isClose=!0,m=0,a.pushGA(["Oznaczanie_reklam","wyswietlenie","aktywacja_premium_"+("giga"==l?"big":"small")]));var c=angular.element(document.getElementById(h[0].parentElement.getAttribute("nxt-ad-place")));c.css("visibility","hidden")},g.click=function(){switch(m){case 2:a.pushGA(["Oznaczanie_reklam","klik_wylacz_je",l+"-v2"]);break;case 1:case 3:a.pushGA(["Oznaczanie_reklam","klik_spr",l+"-v"+m])}},i.nxtAdvCloseColumnResize&&g.$on("directive:column-resize:change-size",function(){j()})}}}]),angular.module("nxt-common").directive("nxtAutofocus",["$parse","$timeout",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){function f(){b(function(){var a=d.val().length,b=d[0];b.selectionStart=a,b.selectionEnd=a,b.focus()})}var g=a(e.nxtAutofocus);c.$watch(g,function(a){a!==!1&&f()})}}}]),angular.module("nxt-common").directive("nxtAutoresize",function(){"use strict";var a=document.body;return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=window.getComputedStyle(c[0]),g=angular.element("<span></span>").css({"border-left-style":f.getPropertyValue("border-left-style"),"border-left-width":f.getPropertyValue("border-left-width"),"border-right-style":f.getPropertyValue("border-right-style"),"border-right-width":f.getPropertyValue("border-right-width"),"font-size":f.getPropertyValue("font-size"),"padding-right":f.getPropertyValue("padding-right"),paddingLeft:"5px",visibility:"hidden",position:"absolute"})[0];b.$watch(function(){return e.$modelValue},function(b){g.textContent=b,a.appendChild(g);var d=g.getBoundingClientRect().width;c.css("width",(d>=20?d:20)+"px"),a.removeChild(g)})}}}),angular.module("nxt-common").directive("nxtBindHtmlCompile",["$compile",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(function(){return b.$eval(d.nxtBindHtmlCompile)},function(d){c.html(d),a(c.contents())(b)})}}}]),angular.module("nxt-common").directive("nxtBokMail",["$stateParams","$timeout","$state","$rootScope","$http","ApplicationConfig","Track","Search",function(a,b,c,d,e,f,g,h){"use strict";return{restrict:"A",replace:!0,templateUrl:function(a,b){return"item"===b.bokMailTemplate?"/common/views/bokMailMsgListItem.html":"message"===b.bokMailTemplate?"/common/views/bokMailMessage.html":void 0},link:function(i,j,k){function l(){b(function(){parseInt(a.folderId)===f.folders.INBOX?(i.activeBokMail=!0,"item"===k.bokMailTemplate&&g.pushIWACode("bokMailShowOnMessageList"),r||a.openFromNotification||!(f.visitCounter>1||t)||i.openBokMailMessage()):d.$broadcast("message:auto-open-message")},100,!0)}var m=238,n=2,o="bokMail",p=f.env.staticUrl,q=f.env.isCorp,r=f.env.device.isMobile,s=sessionStorage.getItem(o),t=f.env.accountType,u=parseInt(a.folderId)===f.folders.INBOX,v=h.isSearch(),w="int"===f.env.service.name;q||!u||v||("message"===k.bokMailTemplate&&g.pushIWACode("bokMailShowMessage"),i.openBokMailMessage=function(){i.isSeenBokMail=!0,i.isOpenBokMail=!0,c.go("message",{messageId:0,specialMessageType:n})},i.closeBokItem=function(){d.$broadcast("message:auto-open-message"),sessionStorage.setItem(o,"0"),e.put("/infoBoard",{id:m,state:f.boardStates.BOARD_STATE_SHOW,sValue:1}),i.activeBokMail=!1,i.isOpenBokMail=!1,g.pushIWACode("bokMailClose")},i.bokMailImage=p+"/css/images/bokMail/"+(w?"int.gif":"next.gif"),s?s&&1===parseInt(s)&&l():e.get("/infoBoard",{params:{id:m,isTrigger:1},transformResponse:function(a){a&&a.data&&a.data.id?(sessionStorage.setItem(o,"1"),l()):a&&null===a.data&&sessionStorage.setItem(o,"0")}}))}}}]),angular.module("nxt-common").directive("nxtBubble",["ApplicationConfig","Bubble","$compile","$state","$timeout","$templateRequest","Track","DialogManager",function(a,b,c,d,e,f,g,h){"use strict";var i=a.env.device.isMobile,j=function(a,b,c,d){if(b){var e=a[0].getBoundingClientRect(),f=document.body.offsetWidth,g=document.body.offsetHeight,h=10,i=25;c||(c=[0,0]);var j=c[0],k=c[1];if(d){var l=b[0].getBoundingClientRect();l.right+h>f?b.css({left:e.width/2-l.width+i+j+"px"}).removeClass("bubble--right").addClass("bubble--left"):b.css({left:e.width/2-i+j+"px"}),l.bottom+h>g?b.css({top:-(l.height+h+k)+"px"}).removeClass("bubble--bottom").addClass("bubble--top"):b.css({top:e.height+h+k+"px"})}else b&&b.css({position:"fixed",left:e.left+j+"px",top:e.top+e.height+k+"px"});b.addClass("bubble--set")}},k=function(a,b){if(b){var c;"iwa"==b.type?(c=b[a].split("|"),g.pushIWA(c)):"iwaCode"===b.type?g.pushIWACode(b[a]):"ga"==b.type?(c=b[a].split("|"),g.pushGA(c)):"gemius"==b.type&&g.pushGemius(b[a])}};return{restrict:"A",replace:!1,terminal:!1,scope:{bubbleId:"@nxtBubble",bubbleExtraPaddings:"=nxtBubbleExtraPadd",fixed:"=nxtBubbleFixed"},controller:["$scope",function(a){a.templateParams={}}],link:function(a,d){if(!i){var g,l={openBilling:function(){h.billing(!1,"po_kliku_w_dymek")}};a.clickLink=function(b,c){k("click",a.bubbleData.options.stat),c&&(b.stopPropagation(),b.preventDefault(),l[c]())},a.bubbleData=b.getBubbleToShow(a.bubbleId),a.bubbleData&&(a.bubbleData.options.showOnlyOnce=parseInt(a.bubbleData.options.showOnlyOnce),a.bubbleData.options.updateSettingAfterShow=parseInt(a.bubbleData.options.updateSettingAfterShow),f(a.bubbleData.options.template).then(function(f){g=angular.element(f),d.append(g),c(g)(a),e(function(){j(d,g,a.bubbleExtraPaddings,a.fixed),a.bubbleData.options.updateSettingAfterShow&&b.updateSettingAsVisible(a.bubbleId),k("display",a.bubbleData.options.stat)},0,!1)})),a.close=function(){k("close",a.bubbleData.options.stat),a.templateParams.closedBubble=!0,(a.bubbleData.options.showOnlyOnce||a.templateParams.notInform)&&b.updateSettingAsVisible(a.bubbleId)},a.$on("bubble:close",function(c,d){a.templateParams.closedBubble||a.bubbleId!=d||(a.templateParams.closedBubble=!0,b.updateSettingAsVisible(a.bubbleId))}),a.$on("folderListScroll:resize",function(){j(d,g,a.bubbleExtraPaddings,a.fixed),setTimeout(function(){j(d,g,a.bubbleExtraPaddings,a.fixed)},1050)}),a.$on("$destroy",function(){!a.bubbleData||a.templateParams.closedBubble||a.bubbleData.options&&a.bubbleData.options.updateSettingAfterShow||b.showNotClosed(a.bubbleId)})}}}}]),angular.module("nxt-common").directive("nxtColumnsResize",["$document","$rootScope","$timeout","$window","ApplicationConfig","Track",function(a,b,c,d,e,f){"use strict";var g,h,i,j,k,l=85,m=90,n=l+m,o=285,p=618,q=o+p,r=n+q,s=432,t=332,u=545,v=285;return{restrict:"A",replace:!0,templateUrl:"/common/views/columnsResize.html",controller:["$scope",function(a){function f(){D=a.getLeftColumn().offsetWidth<=t,J=a.getRightColumn().offsetWidth<=u,P=a.getLeftColumn().offsetWidth<=s,C!==D&&(b.$broadcast("directive:column-resize:left-column-"+(D?"min":"greater")),e.env.isLeftColumnMin=D,C=D),I!==J&&(b.$broadcast("directive:column-resize:right-column-"+(J?"min":"greater")),e.env.isRightColumnMin=J,I=J),O!==P&&(b.$broadcast("directive:column-resize:left-pre-column-"+(P?"min":"greater")),e.env.isLeftPreColumnMin=P,O=P)}function m(){i=document.querySelector(".section--message-list"),j=document.querySelector(".section--message"),k=document.querySelector(".column-size-change-slider")}function q(){h=document.documentElement.clientWidth;var b=Math.max(h,r),d=b-n,e=g/100*d,f=(100-g)/100*d,i=g,j="%",k=100-g,l="%";e<=o?(k=Math.max(d-o,0),l="px"):f<=p&&(i=Math.max(d-p,0),j="px"),angular.element(document.body).addClass("on-resizing"),a.setStyles(i,j,k,l),c(function(){angular.element(document.body).removeClass("on-resizing")},500)}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;return a.setStyles=function(b,c,d,e){function g(){w=document.querySelector("#columns-style"),null===w&&(w=document.createElement("style"),w.type="text/css",w.id="columns-style",document.querySelector("head").appendChild(w))}function j(){if("%"===c?y=A:"px"===c&&(y=B),"%"===e?E=G:"px"===e&&(E=H),0!==b&&(b=b||y),c=c||z,0!==d&&(d=d||E),e=e||F,"%"===c){var a=(h-n)*b/100;M=Math.max(a,o)+l+"px"}else M=b+l+"px"}function k(){w.innerHTML=".section--message-list {width: "+b+c+";} .section--message {width: "+d+e+";} .ad--box600x450 {left: "+M+";}",h=document.documentElement.clientWidth,N=Math.max(h,r),i&&a.getLeftColumn().getBoundingClientRect().top>10&&q()}function m(){"%"===c?A=b:"px"===c&&(B=b),"%"===e?G=d:"px"===e&&(H=d),y=b,z=c,E=d,F=e}K=L,L=""+b+c+d+e,L!==K&&(g(),j(),k(),m(),f())},a.getLeftColumn=function(){return i||m(),i},a.getRightColumn=function(){return j?j=document.querySelector(".section--message")||j:m(),j},a.resizeHandler=function(){if(null!==g){angular.element(document.body).addClass("on-resizing"),h=document.documentElement.clientWidth;var d=a.getLeftColumn().offsetWidth;d<=o?(d=d<v?v:d,a.setStyles(null,null,Math.max(h-d-n,0),"px")):a.setStyles(null,null,100-parseFloat(A),"%");var e=a.getRightColumn.offsetWidth;e<=p?a.setStyles(Math.max(h-e-n,0),"px",null,null):a.setStyles(100-parseFloat(G),"%",null,null),c.cancel(x),x=c(function(){angular.element(document.body).removeClass("on-resizing"),b.$broadcast("service:message:resize-handler"),b.$broadcast("directive:column-resize:change-size")},500)}else f()},d.localStorage&&c(function(){try{g=d.localStorage.getItem("savedLeftWidthInPers"),m(),null!==g&&(q(),b.$broadcast("service:message:resize-handler"),b.$broadcast("directive:column-resize:change-size"))}catch(a){}},1e3),angular.element(window).on("resize",a.resizeHandler),a}],link:function(e,i){function j(b){b.stopPropagation(),a.off("mousemove",k),a.off("mouseup",j),angular.element(document.body).removeClass("on-moving"),f.pushIWACode("columnResize")}function k(a){0!==a.which&&0!==a.buttons||j(a),a.stopPropagation(),l(a),m()}function l(a){z=Math.max(o,Math.min(w+(a.clientX-x),y)),g=z/(u-n)*100;var f=e.getLeftColumn().offsetWidth,h=e.getRightColumn().offsetWidth;f+h!==q&&(e.setStyles(g,"%",100-g,"%"),c.cancel(s),s=c(function(){if(d.localStorage)try{d.localStorage.setItem("savedLeftWidthInPers",g),b.$broadcast("service:message:resize-handler")}catch(a){}},1e3))}function m(){c.cancel(t),t=c(function(){b.$broadcast("directive:column-resize:change-size")},50)}var s,t,u,v,w,x,y,z;i.on("mousedown",function(b){angular.element(document.body).addClass("on-moving"),h=document.documentElement.clientWidth,w=e.getLeftColumn().offsetWidth,x=b.clientX,u=Math.max(h,r),v=u-n,y=u-p-n,a.on("mousemove",k),a.off("mouseup",j),a.on("mouseup",j)})}}}]),angular.module("nxt-common").directive("nxtDamageMessage",["Track","ApplicationConfig","$timeout",function(a,b,c){"use strict";var d="is-damage-message";return{restrict:"A",link:function(e,f){function g(){h[0].style.marginTop=f[0].offsetHeight+"px"}var h;b.env.isDamage&&(b.env.device.isMobile&&(c(function(){h=document.querySelectorAll(".section--message-list"),h[0].style.marginTop=f[0].offsetHeight+"px"},150,!1),document.body.classList.add(d),angular.element(window).on("resize",g)),e.isClose=!1,e.close=function(){e.isClose=!0,b.env.device.isMobile&&(document.body.classList.remove(d),h[0].style.marginTop="initial")},a.pushGA(["blad_tresci_na_stronie","view","problem_z_zawartoscia"]),a.pushIWA(["blad","zaladowanie_tresci","view","problem_z_zawartoscia"]),e.$on("$destroy",function(){angular.element(window).off("resize",g)}))},templateUrl:b.env.isDamage?"/common/views/damageMessage.html":""}}]),angular.module("nxt-common").directive("nxtDropdown",["$rootScope","ApplicationConfig","$timeout",function(a,b,c){"use strict";function d(a,b){var c=a[0].querySelectorAll(b),d=[];try{d=[].slice.call(c)}catch(e){for(var f=0;f<c.length;f++)d.push(c[f])}return d}function e(a){d(a,"ul").forEach(function(a){var b=a.parentNode,c=angular.element(b);angular.element(a).hasClass("ui-select-choices")||angular.element(a).hasClass("ui-select-choices--single")||c.addClass("dropdown-nav dropdown-nav--next").attr("data-label",g(b)).off()})}function f(a,b,c){if(c=c||function(){return!0},a[0].hasChildNodes())for(var d,e=a.children(),f=0;f<e.length;f++)d=angular.element(e[f]),c(d)&&(b?angular.element(d).addClass("isHidden"):angular.element(d).removeClass("isHidden"))}function g(a){var b=a.firstChild;return"#text"===b.nodeName?b.nodeValue.trim():""}function h(a,b){var c=a.firstChild;"#text"===c.nodeName&&(c.nodeValue=b)}var i="Wróć",j=angular.element(document.body);return j.on("click",function(d){(!b.env.device.isMobile&&!angular.element(d.target).hasClass("dropdown-nav--prev")||b.env.device.isMobile&&!angular.element(d.target).hasClass("scroll-no-hide"))&&c(function(){a.$broadcast("directive:dropdown:hideAll")},0,!1)}),a.$on("message:iframe:touch",function(){c(function(){a.$broadcast("directive:dropdown:hideAll")},0,!1)}),{restrict:"EA",scope:{dropdown:"@nxtDropdown",dropdownIcon:"@nxtDropdownIcon",dropdownStyle:"@?nxtDropdownStyle",dropdownChange:"=?nxtDropdownChange",dropdownOnclose:"@nxtDropdownOnclose"},controller:["$scope",function(a){return a.dropdownIcon=a.dropdownIcon||"arrowdown",a}],link:function(g,k){var l,m;k.addClass("dropdown non-selectable").parent().addClass("dropdown-icon dropdown-icon--"+g.dropdownIcon),"right"===g.dropdown&&k.addClass("dropdown--right"),g.dropdownStyle&&k.addClass("dropdown--"+g.dropdownStyle),g.$on("directive:dropdown:hideAll",function(){k.hasClass("dropdown--mouseover")||(k.hasClass("dropdown--active")&&g.dropdownOnclose&&a.$broadcast(g.dropdownOnclose),k.removeClass("dropdown--active"),k.parent().removeClass("dropdown-icon--arrowup"))}),g.$watch("dropdownChange",function(a){a&&setTimeout(function(){e(k)},100)}),b.env.device.isMobile&&g.$on("directive:dropdown:hideAll-force",function(){k.removeClass("dropdown--active"),k.parent().removeClass("dropdown-icon--arrowup")}),e(k),k.on("click",function(a){m||(m=k[0].getBoundingClientRect().top),l||(l=90*(document.body.offsetHeight-m)/100);var d=angular.element(a.target);d.css("max-height",l+"px");var e=d.hasClass("force-no-hide");if(d.hasClass("dropdown-nav")){var g=d.parent();if(d.hasClass("dropdown-nav--next")?(e?(g.children().addClass("isHidden"),f(k,!0,function(a){return a.hasClass("no-hidden")})):f(g,!0,function(a){return!a.hasClass("no-hidden")}),h(d[0],i),b.env.device.isMobile&&(k.addClass("dropdown--mouseover"),c(function(){k.removeClass("dropdown--mouseover")},500,!1))):(e&&f(k,!1,function(a){return a.hasClass("no-hidden")}),g.children().removeClass("isHidden"),h(d[0],d.attr("data-label"))),d.toggleClass("dropdown-nav--next dropdown-nav--prev").removeClass("isHidden"),!g.hasClass("dropdown")){var j=g.parent();j.hasClass("dropdown-nav--inactive")?h(j[0],i):h(j[0],""),j.toggleClass("dropdown-nav--inactive")}var n=d.children(),o=n.eq(n.length-1);o.toggleClass("isVisible")}}).parent().on("click",function(e){var f=angular.element(e.target);
"FORM"===f.prop("nodeName")||f.prop("form")||f.hasClass("ui-select-match")||f.hasClass("ui-select-match-chosen")||f.hasClass("ui-select-choices-row-inner")||f.parent().hasClass("ui-select-match-chosen")||f.parent().hasClass("ui-select-choices-row-inner")||(k.hasClass("dropdown--active")||(d(k,".isVisible").forEach(function(a){a.className=a.className.replace("isVisible","").trim()}),d(k,".isHidden").forEach(function(a){a.className=a.className.replace("isHidden","").trim()}),d(k,".dropdown-nav--inactive").forEach(function(a){a.className=a.className.replace("dropdown-nav--inactive","").trim()}),d(k,".dropdown-nav--prev").forEach(function(a){a.className=a.className.replace("dropdown-nav--prev","dropdown-nav--next"),h(a,a.getAttribute("data-label"))})),f.hasClass("dropdown-nav")||(k.toggleClass("dropdown--active"),b.env.device.isMobile&&(f.parent().parent().hasClass("force-no-hide")||f.parent().hasClass("force-no-hide"))&&k.addClass("dropdown--active"),k.parent().toggleClass("dropdown-icon--arrowup")),k.hasClass("dropdown--active")?(j.triggerHandler("dropdownopen",f[0]),b.env.device.isMobile||a.$broadcast("tooltip:hide")):(g.dropdownOnclose&&a.$broadcast(g.dropdownOnclose),j.triggerHandler("dropdownclose",f[0])),b.env.device.isMobile&&f[0].className.indexOf("dropdown-icon")>-1&&k.addClass("dropdown--mouseover")),b.env.device.isMobile&&(f[0].className.indexOf("dropdown-icon")>-1||f[0].className.indexOf("dropdown-nav--next")>-1)&&c(function(){k.removeClass("dropdown--mouseover")},500,!1)}),k.on("touchend",function(a){var b=angular.element(a.target);b.hasClass("dropdown-nav--next")||b.hasClass("dropdown-nav--prev")||b.hasClass("scroll-no-hide")||(c(function(){k.removeClass("dropdown--active")},100,!1),k.parent().removeClass("dropdown-icon--arrowup"))}),b.env.device.isMobile||(k.parent().on("mouseenter",function(){k.addClass("dropdown--mouseover")}).on("mouseleave",function(){k.removeClass("dropdown--mouseover")}),k.on("mouseover",function(a){"LI"===a.target.nodeName?angular.element(a.target).addClass("is-active"):"LI"===a.target.parentNode.nodeName&&angular.element(a.target.parentNode).addClass("is-active")}).on("mouseout",function(a){"LI"===a.target.nodeName?angular.element(a.target).removeClass("is-active"):"LI"===a.target.parentNode.nodeName&&angular.element(a.target.parentNode).removeClass("is-active")})),g.$on("$destroy",function(){k.off(),k.parent().off()})}}}]),angular.module("nxt-common").directive("nxtFakeMail",["$stateParams","$timeout","$state","$rootScope","ApplicationConfig","Track",function(a,b,c,d,e,f){"use strict";var g={},h=!1,i=!1,j="item",k="message",l=e.env.ownHashEmail;return{restrict:"A",replace:!0,templateUrl:function(a,b){return b.fakeMailTemplate===j?"/common/views/fakeMailMsgListItem.html":b.fakeMailTemplate===k?"/common/views/fakeMailMessage.html":void 0},link:function(k,m){k.isHtmlFile=h,k.isHtmlImage=i,k.fakeMailData=g;var n=3,o=2,p=3,q=function(){var a=document.createElement("script"),b="fake-message-expand",c=document.getElementById(b);c&&c.remove(),a.id=b,a.innerHTML=k.fakeMailData.expand,document.body.appendChild(a)};k.fakeMailData=g,k.openFakeMailMessage=function(){k.isSeenFakeMailMsg=!0,k.isOpenFakeMailMsg=!0,c.go("message",{messageId:0,specialMessageType:n}),k.fakeMailData.type===p&&q(),f.pushIWACode("fakeMailShowMessage")},k.isShowFakeMail=function(){var a=sessionStorage.getItem(l),b=new Date,c=+b;return!(a&&!(a&&c>a))&&(sessionStorage.removeItem(l),!0)},k.closeMessage=function(){d.$broadcast("message:auto-open-message"),k.activeFakeMail=!1,k.isOpenFakeMailMsg=!1;var a=2,b=new Date,c=b.setTime(b.getTime()+60*a*60*1e3),e=+c;sessionStorage.setItem(l,e),f.pushIWACode("fakeMailClose")},k.createFakeMail=function(c){b(function(){k.fakeMailData=c,h=k.isHtmlFile=k.fakeMailData.type===o,i=k.isHtmlImage=k.fakeMailData.type===p,k.isShowFakeMail()&&parseInt(a.folderId)===e.folders.INBOX&&(k.activeFakeMail=!0,g=k.fakeMailData,k.fakeMailData.msgItemStyle=k.fakeMailData.msgItemStyle||0,parseInt(a.folderId)===e.folders.INBOX?!e.env.device.isMobile&&!a.openFromNotification&&e.visitCounter>1&&k.openFakeMailMessage():d.$broadcast("message:auto-open-message"),m.fakeMailTemplate===j&&f.pushIWACode("fakeMailShowOnMessageList"))},200,!0)};var r=d.$on("ads:create:fake-message",function(a,b){k.createFakeMail(b)});k.$on("$destroy",function(){r()})}}}]),angular.module("nxt-common").directive("nxtFocusin",["$parse","$timeout","ScopeService",function(a,b,c){return{scope:!1,link:function(d,e,f){var g=a(f.nxtFocusin),h=null,i=function(){b(function(){c.safeApply(d,function(){g(d)})},0,!1)};navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?e[0].addEventListener("focus",i,!0):e.on("focusin",i),e.on("click",function(){document.activeElement!==document.body?h=document.activeElement:h&&h.focus()}),d.$on("$destroy",function(){navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?e[0].removeEventListener("focus",i,!0):e.off()})}}}]),angular.module("nxt-common").directive("nxtFocusout",["$parse","ScopeService",function(a,b){return{scope:!1,link:function(c,d,e){var f=a(e.nxtFocusout),g=!1,h=function(){g||b.safeApply(c,function(){f(c)})};d.on("mouseenter",function(){g=!0}).on("mouseleave",function(){g=!1}).on("keyup",function(a){var b=a?a.keyCode:window.event.which;27===b&&(g=!1,document.activeElement.blur())}),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?d[0].addEventListener("blur",h,!0):d.on("focusout",h),c.$on("$destroy",function(){navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?d[0].removeEventListener("blur",h,!0):d.off()})}}}]),angular.module("nxt-common").directive("nxtInjectAttr",function(){"use strict";return{restrict:"A",scope:{attrKey:"@nxtInjectAttr",attrValue:"=?nxtInjectAttrValue",showIf:"=nxtInjectAttrIf"},link:function(a,b){a.showIf&&b.attr(a.attrKey,a.attrValue)}}}),angular.module("nxt-common").directive("nxtLoadingIndicator",["$timeout","ApplicationConfig",function(a,b){var c=b.env.device.isMobile?0:300;return{restrict:"A",scope:{isLoading:"=nxtLoadingIndicator"},link:function(b,d,e){var f,g,h,i;b.$watch("isLoading",function(b){b?i=a(function(){f||(f=angular.element(document.createElement("div")).addClass("nxt-loading-indicator no-animate").css({display:"block"}),g=angular.element(document.createElement("div")).addClass("indicator"),f.append(g),h=angular.element(document.createElement("div")).addClass("indicator-text").css({display:"none"}),f.append(h),d.append(f)),e.nxtLoadingIndicatorText&&e.nxtLoadingIndicatorText.length?h.css({display:"block"}).text(e.nxtLoadingIndicatorText):h.css({display:"none"}).text(""),f.css({display:"block"})},c,!1):(a.cancel(i),f&&f.css({display:"none"}))}),b.$on("$destroy",function(){a.cancel(i),f=g=h=null})}}}]),angular.module("nxt-common").directive("nxtPickadate",["$rootScope","$timeout","ApplicationConfig",function(a,b,c){"use strict";return{restrict:"A",link:function(a,d,e){function f(){for(var c=angular.element(d[0].querySelector(".pickadate"))[0].isolateScope(),f=0;f<c.dates.length;f++)new Date(c.dates[f].date)>=new Date(a.filters.date_from)&&new Date(c.dates[f].date)<=new Date(a.filters.date_to)?c.dates[f].classNames[0]="check-dates":("pickadate-disabled"!==c.dates[f].classNames[0]&&(c.dates[f].classNames[0]="pickadate-enabled"),"filters.date_to"===e.ngModel&&new Date(a.filters.date_from)>new Date(c.dates[f].date)&&(c.dates[f].classNames[0]="pickadate-disabled"),"filters.date_from"===e.ngModel&&new Date(a.filters.date_from)<new Date(c.dates[f].date)&&new Date(a.filters.date_from)<new Date(a.filters.date_to)&&(c.dates[f].classNames[0]="pickadate-disabled"));b(function(){a.$digest()},0,!1)}function g(){"filters.date_from"===e.ngModel?a.datePickerToShow=!1:a.datePickerFromShow=!1,b(function(){a.$digest()},0,!1)}var h,i;d.on("click",function(){if(g(),a.isMobile&&angular.element(event.target).hasClass("input--date")&&(angular.element(event.target).attr("type","text"),blur()),c.hacks.isIpad){var b=document.getElementsByClassName("pickadate-wrapper");angular.element(b[0]).addClass("pickadate-wrapper--ipad"),angular.element(b[1]).addClass("pickadate-wrapper--ipad")}new Date(a.filters.date_from)>new Date(a.filters.date_to)&&(a.filters.date_from=i),new Date(a.filters.date_to)<new Date(a.filters.date_from)&&(a.filters.date_to=h),h=a.filters.date_to,i=a.filters.date_from,f()}),a.focusElement=function(a){b(function(){var b=document.querySelector(a);b&&b.focus()},100,!1)},d.on("keydown",function(c){if(173===c.keyCode||189===c.keyCode){if("filters.date_from"===e.ngModel){var d=document.getElementById("search-date-from");d.value=d.value+"-"}if("filters.date_to"===e.ngModel){var f=document.getElementById("search-date-to");f.value=f.value+"-"}c.preventDefault()}8!==c.keyCode&&46!==c.keyCode||("filters.date_from"===e.ngModel?a.filters.date_from="undefined":a.filters.date_to="undefined",b(function(){a.$digest()},0,!1),c.preventDefault())}),a.today=function(b){var c=new Date;c=c.toISOString().substring(0,10),a.filters[b]=c},a.closePicker=function(c){b(function(){a[c]=!1,a.focusElement("#search"),a.$digest()},400,!1)},a.$on("$destroy",function(){d.off()})}}}]),angular.module("nxt-common").directive("nxtPlaceholder",function(){"use strict";return{require:"ngModel",restrict:"A",scope:{placeholder:"@nxtPlaceholder"},link:function(a,b,c,d){var e=angular.element('<div class="input-placeholder" data-placeholder="'+a.placeholder+'"></div>');b.parent().append(e),a.$watch(function(){d.$modelValue&&d.$modelValue.length>0?e.css({display:"none"}):e.css({display:"block"})})}}}),angular.module("nxt-common").directive("nxtRemarketing",["$stateParams","$timeout","$state","$rootScope","ApplicationConfig",function(a,b,c,d,e){"use strict";var f;return{restrict:"A",replace:!0,templateUrl:function(a,b){return"item"===b.remarketingTemplate?e.env.device.isMobile?"/common/views/remarketingMsgListMobileItem.html":"/common/views/remarketingMsgListItem.html":"message"===b.remarketingTemplate?"/common/views/remarketingMessage.html":void 0},link:function(g){function h(){for(var a=0;a<g.remarketingData.products.length;a++)!function(){var b=g.remarketingData.products[a],c=new Image;c.onload=function(){var a=this;b.image.width=a.width,b.image.height=a.height},c.src=b.image.url}()}g.remarketingData=f;var i=1;g.openRemarketingMessage=function(){g.isSeenRemarketingMsg=!0,g.isOpenRemarketingMsg=!0,c.go("message",{messageId:0,specialMessageType:i})},g.closeRemarketing=function(){d.$broadcast("message:auto-open-message"),localStorage.setItem("remarketingClosedTime",e.env.lastLoginTimestamp),g.activeRemarketing=!1,g.isOpenRemarketingMsg=!1},g.createAd=function(i){b(function(){parseInt(localStorage.getItem("remarketingClosedTime"))!==e.env.lastLoginTimestamp&&(g.activeRemarketing=!0,g.remarketingData=i,h(),f=g.remarketingData,g.$digest(),parseInt(a.folderId)===e.folders.SHOPPING?e.env.device.isMobile||a.openFromNotification||(g.isOpenRemarketingMsg=!0,c.go("message",{messageId:0,specialMessageType:1})):d.$broadcast("message:auto-open-message"))},300,!0)};var j=d.$on("ads:create:message",function(a,b){g.createAd(b)});g.$on("$destroy",function(){j()})}}}]),angular.module("nxt-common").directive("nxtRetargeting",function(){"use strict";return{restrict:"A",replace:!0,template:'<div><img ng-src="{{retargetingUrls.inis}}" style="width: 1px; height: 1px"><img ng-src="{{retargetingUrls.go}}" style="width: 1px; height: 1px"><img ng-src="{{retargetingUrls.playlink}}" style="width: 1px; height: 1px"></div>',link:function(a){a.$on("retargeting:updateUrls",function(b,c){a.retargetingUrls=c})}}}),angular.module("nxt-common").directive("nxtScrollDetector",["$timeout","ApplicationConfig","$window",function(a,b,c){"use strict";var d=b.env.device.isMobile?0:300;return{restrict:"A",link:function(e,f,g){function h(){var f;a.cancel(j),j=a(function(){f=b.hacks.AndroidVersion<4.1?c.scrollY+300:l.scrollTop,f+l.offsetHeight>=l.scrollHeight-3&&e.$emit(k+":bottom")},d,!1)}var i=[];if(!f.attr("nxt-attached-scroll-detectors")||!g.nxtScrollDetector||(i=f.attr("nxt-attached-scroll-detectors").split(" "),i.indexOf(g.nxtScrollDetector)===-1)){var j,k=g.nxtScrollDetector||"scroll-detector",l=f[0];g.nxtScrollDetector&&(i.push(g.nxtScrollDetector),f.attr("nxt-attached-scroll-detectors",i.join(" "))),f.on("scroll",h),b.hacks.AndroidVersion<4.1&&(f.css("overflow","inherit"),f.off("scroll",h)),e.$on("$destroy",function(){f.off("scroll",h)})}}}}]),angular.module("nxt-common").directive("nxtScrollToFocus",["$timeout","ApplicationConfig",function(a,b){"use strict";var c=300,d=30;return{restrict:"A",link:function(e,f,g){if(b.env.device.isMobile&&!b.hacks.isIOS){var h=document.getElementsByClassName(g.nxtScrollToFocus);f.on("focus",function(){var e=f[0].offsetTop;a(function(){b.hacks.isAndroidDefault&&angular.element(h[0]).css("padding-bottom",c+"px"),h[0].scrollTop=e-d},500,!1)}),b.hacks.isAndroidDefault&&f.on("focusout",function(){angular.element(h[0]).css("padding-bottom","")}),e.$on("$destroy",function(){f.off()})}}}}]),angular.module("nxt-common").directive("nxtStopTouchPropagation",function(){return{restrict:"A",link:function(a,b){b.on("touchstart touchmove touchend",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}).directive("nxtStopTouchPropagationBrowser",function(){return{restrict:"A",link:function(a,b,c){var d=c.nxtStopTouchPropagationBrowser;navigator.userAgent.toLowerCase().indexOf(d)>-1&&b.on("touchstart touchmove touchend",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}).directive("nxtStopClickPropagation",function(){return{restrict:"A",link:function(a,b){b.on("click",function(a){a.stopPropagation(),a.preventDefault()}),a.$on("$destroy",function(){b.off()})}}}),angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["uiTinymceConfig","Tools","ScopeService",function(a,b,c){a=a||{};var d=0;return{priority:10,require:"ngModel",link:function(e,f,g,h){var i,j,k,l=function(){h.$setViewValue(f.val()),c.safeApply(e)};b.setElementIsolateScope(f,e),g.id||g.$set("id","uiTinymce"+d++),i=g.uiTinymce?e.$eval(g.uiTinymce):{},j={setup:function(a){a.on("init",function(){h.$render()}),e.$on("ui-tinymce:update-model",function(){a.save(),l()}),a.on("ExecCommand",function(){a.save(),l()}),i.setup&&(e.$eval(i.setup),delete i.setup)},mode:"exact",elements:g.id},angular.extend(j,a,i),setTimeout(function(){tinymce.init(j)}),h.$render=function(){k||(k=tinymce.get(g.id)),k&&k.setContent(h.$viewValue||"")}}}}]),angular.module("nxt-common").directive("nxtTooltip",function(){"use strict";var a=500,b=15,c=null;return{restrict:"A",replace:!0,template:'<div class="tooltip"></div>',scope:{},controller:["$scope","ApplicationConfig",function(a,b){a.isMobile=b.env.device.isMobile}],link:function(d,e){function f(){clearTimeout(c),e.removeClass("tooltip--active tooltip--right tooltip--left tooltip--top")}if(!d.isMobile){var g=document.getElementById("wrapper");angular.element(g).on("mouseover",function(d){var f=d.target;if(f.hasAttribute("data-tooltip-in-parents"))do if(f=f.parentNode,f===g||f.hasAttribute("data-tooltip-stop-propagation"))return;while(!f.getAttribute("data-tooltip"));var h,i,j=f.getBoundingClientRect(),k=(f.getAttribute("data-tooltip")||"").trim(),l=f.hasAttribute("data-tooltip-instant"),m=f.getAttribute("data-tooltip-fixed-position")||"",n=g.offsetWidth,o=g.offsetHeight,p=f.hasAttribute("data-tooltip-top"),q=f.hasAttribute("data-tooltip-right"),r=f.hasAttribute("data-tooltip-left"),s=parseInt(f.getAttribute("data-tooltip-horizontal-offset"))||0;k.length&&(clearTimeout(c),c=setTimeout(function(){if(e.html(k).css({left:"auto",right:"auto",top:"auto",maxWidth:"none"}).addClass("tooltip--active"),n-j.left<e[0].offsetWidth+s||q?(h="right",e.css("right",n-j.right+s+"px").addClass("tooltip--right")):n-j.left===n||r?(h="left",e.css("left",j.left-e[0].offsetWidth/2+j.width+s+"px").addClass("tooltip--left")):(h="center",e.css("left",j.left-e[0].offsetWidth/2+j.width/2+s+"px")),i=e[0].getBoundingClientRect(),"right"===h?e.css("max-width",i.right-b+"px"):e.css("max-width",n-i.left-b+"px"),p||j.bottom+e[0].offsetHeight>o?e.css("top",j.top-g.offsetTop-e.prop("offsetHeight")+"px").addClass("tooltip--top"):e.css("top",j.bottom-g.offsetTop+"px"),m){var a=parseInt(m.split(",")[0],10),c=parseInt(m.split(",")[1],10);e.css("left",j.left+a+"px").css("top",j.top-g.offsetTop+c+"px"),e.removeClass("tooltip--right tooltip--left tooltip--top")}},l?0:a))}).on("mouseout",f).on("wheel",f),d.$on("tooltip:hide",f)}}}}),angular.module("nxt-common").directive("nxtTooltipBubble",["TooltipBubble","ScopeService",function(a,b){"use strict";var c=15;return{restrict:"A",replace:!0,templateUrl:"/common/views/tooltipBubble.html",controller:["$scope","ApplicationConfig",function(a,b){a.isMobile=b.env.device.isMobile}],link:function(d,e){function f(a){if(g){var b=e[0].getBoundingClientRect(),c=h?b.top:b.top-35,f=h?b.bottom+35:b.bottom,i=b.left,j=b.right;(a.clientX<i||a.clientX>j||a.clientY<c||a.clientY>f)&&d.close()}}var g=!1,h=!1;if(d.close=function(){e.css({opacity:0,display:"none"}).removeClass("bubble--top"),g=!1},d.$on("ui-events:click",function(){d.close()}),!d.isMobile){var i=document.getElementById("wrapper");angular.element(i).on("mouseover",function(f){var j,k,l=f.target,m=l.getBoundingClientRect(),n=(l.getAttribute("data-tooltip-bubble")||"").trim(),o=a.getTooltipBubbleToShow(n),p=i.offsetWidth,q=i.offsetHeight;o&&(d.close(),e.css({display:"block",left:"auto",right:"auto",top:"auto",maxWidth:"none",zIndex:1115,opacity:1}),g=!0,p-m.left<e[0].offsetWidth?(j="right",e.css("right",p-m.right+"px").addClass("tooltip--right")):p-m.left===p?(j="left",e.css("left",m.left-e[0].offsetWidth/2+m.width+"px").addClass("tooltip--left")):(j="center",e.css("left",m.left-20+"px")),k=e[0].getBoundingClientRect(),"right"===j?e.css("max-width",k.right-c+"px"):e.css("max-width",p-k.left-c+"px"),m.bottom+e[0].offsetHeight>q?(e.css("top",m.top-i.offsetTop-e.prop("offsetHeight")+"px").addClass("bubble--top"),h=!0):(e.css("top",m.bottom-i.offsetTop+15+"px"),h=!1),b.safeApply(d,function(){d.bubbleContent=o.desc,d.bubbleTitleIcon=o.icon,d.bubbleTitle=o.title,d.bubbleLinkHref=o.href}))}).on("mouseout",f).on("wheel",d.close)}}}}]),angular.module("nxt-common").directive("nxtTrack",["Track","ApplicationConfig",function(a,b){return{restrict:"A",replace:!0,scope:!1,controller:["$scope","Track",function(a,b){a.pushTrackCode=function(a){b.pushGACode(a)}}],link:function(c,d){var e=b.env.device.isMobile,f=function(b){var c=e&&"click"===b?"touchstart":b;d.on(c,function(c,d){var e=d||c.target,f=(e.getAttribute("data-track-"+b)||"").trim(),g="",h=e.getAttribute("data-track-"+b+"-iwa");f.length>0&&(g=(e.getAttribute("data-track-"+b+"-att")||"").trim(),g.length>0&&(g=g.split("^")),a.pushGACode(f,g)),h&&a.pushIWACode(h)})};f("click"),b.env&&!b.env.isMobileApp&&f("change"),f("dropdownopen"),c.$on("$destroy",function(){d.off()})}}}]),angular.module("nxt-common").directive("nxtUiEvents",["$rootScope",function(a){"use strict";var b={27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down"},c=Object.keys(b);return{restrict:"A",controller:["$scope",function(a){return this.events=a.events=["click","keydown"],a}],link:function(d,e){d.events.forEach(function(d){e.on(d,function(d){var e=d.__UiEvents__||{},f=d.keyCode+"";if(c.indexOf(f)!==-1){var g=b[f];a.$broadcast("ui-events:"+d.type+":"+g,e)}else"click"==d.type&&a.$broadcast("ui-events:click",{})})}),d.$on("$destroy",function(){e.off()})}}}]),angular.module("nxt-common").directive("nxtUiEventsData",function(){"use strict";return{require:"^?nxtUiEvents",restrict:"A",scope:{data:"=?nxtUiEventsData"},link:function(a,b,c,d){d&&(d.events.forEach(function(c){b.on(c,function(b){b.__UiEvents__=a.data})}),a.$on("$destroy",function(){b.off()}))}}}),angular.module("nxt-common").directive("nxtUploadButtonHover",["$window","$timeout","ApplicationConfig",function(a,b,c){"use strict";var d=500,e="notHover";return{restrict:"A",link:function(f,g){c.env.device.isMobile||(g.on("click",function(){g.addClass(e);var c=a.onfocus;a.onfocus=function(){b(function(){g.removeClass(e)},d,!1),a.onfocus=c}}),f.$on("$destroy",function(){g.off()}))}}}]),angular.module("nxt-composition").directive("nxtAutoCenterVertically",["ApplicationConfig",function(a){return{restrict:"A",link:function(b,c){function d(){var a,b=c[0].getBoundingClientRect(),d=document.getElementById("wrapper").clientHeight;b.bottom>d&&(a=(d-b.height)/2,c.css({top:a+"px"}))}a.env.device.isMobile||b.$on("ac:update",d)}}}]),angular.module("nxt-composition").directive("nxtAutoGrow",["$timeout",function(a){var b=15,c=65;return{restrict:"A",link:function(d,e,f){function g(){l=e.prop("scrollHeight"),m=e.prop("offsetHeight"),l>m&&(k=l+b,e.css({height:k+"px"}),d.$emit("composition:updateSize"))}function h(){a.cancel(n),n=a(g,200,!1)}function i(){k||(k=c,e.css({height:k+"px"})),g(),e.on("change",h)}function j(){e.css(""),e.off("change",h)}var k,l,m,n;f.$observe("nxtAutoGrow",function(a){a===!0||"true"===a?i():a!==!1&&"false"!==a||j()}),d.$on("$destroy",j),d.$on("auto-grow:grow",g)}}}]),angular.module("nxt-composition").directive("nxtAutogrowInput",["$timeout","$rootScope",function(a,b){var c=130,d=25,e=5;return{restrict:"A",link:function(f,g){function h(){t=s.getBoundingClientRect(),o=s.querySelectorAll(".email-input-plain-element"),o.length&&(p=o[o.length-1]),q=r.getBoundingClientRect(),q&&q.left&&(q=q.left)}function i(){u=1,r.style.width=t.right-q-c+"px",r.style.height=u*d+e+"px",v=!1}function j(){r.style.width=t.width-c+"px",v=!0}function k(){u++,r.style.height=u*d+e+"px"}function l(){a(function(){r.offsetHeight<r.scrollHeight?(h(),v?k():j()):""===r.value&&(h(),i())},350,!1)}function m(){r.style.width=t.width-c+"px",a(function(){h(),i()},350,!1)}function n(){g[0].blur(),scrollTo(0,0),a(function(){l()},400,!1)}var o,p,q,r=g[0],s=r.parentNode,t=s.getBoundingClientRect(),u=1,v=!0;m(),g.on("keyup paste",l),angular.element(window).on("orientationchange",n),f.$on("eip:reset-input",m),b.$on("service:message:resize-handler",function(){m()}),f.$on("$destroy",function(){angular.element(window).off("orientationchange",n)})}}}]),angular.module("nxt-composition").directive("nxtCthumbnail",["ApplicationConfig",function(a){return{restrict:"A",scope:{cthumbnail:"=nxtCthumbnail"},link:function(b,c){if(window.CanvasRenderingContext2D&&(window.URL||window.webkitURL)){var d=c[0].querySelector("canvas"),e=d.getContext("2d"),f=new Image;d.width=155,d.height=136,f.onload=function(){var a,b,c,g,h,i=d.width,j=d.height;f.width>i||f.height>j?(h=Math.max(i/f.width,j/f.height),a=Math.round(h*f.width),b=Math.round(h*f.height)):(a=f.width,b=f.height),c=Math.round((i-a)/2),g=Math.round((j-b)/2),e.fillStyle="#fff",e.fillRect(0,0,i,j),e.drawImage(f,c,g,a,b)},b.$watch("cthumbnail",function(){b.cthumbnail&&b.cthumbnail.remote&&/\.(jpe?g|gif|png)$/i.test(b.cthumbnail.name)?f.src=a.env.uploadUrl+"/html/getattach,mid,"+b.cthumbnail.mid+",mpid,"+b.cthumbnail.mpid+",uid,"+a.env.uid+",min,1,nc,1?f="+b.cthumbnail.name:b.cthumbnail&&b.cthumbnail.type&&b.cthumbnail.type.match("image.*")&&(window.URL?f.src=URL.createObjectURL(b.cthumbnail):window.webkitURL&&(f.src=webkitURL.createObjectURL(b.cthumbnail)))})}else b.$watch("cthumbnail",function(){b.cthumbnail&&b.cthumbnail.remote&&/\.(jpe?g|gif|png)$/.test(b.cthumbnail.name)&&c.css({"background-image":"url("+a.env.uploadUrl+"/html/getattach,mid,"+b.cthumbnail.mid+",mpid,"+b.cthumbnail.mpid+",uid,"+a.env.uid+",min,1,nc,1?f="+b.cthumbnail.name+")"})})},template:"<canvas></canvas>"}}]),angular.module("nxt-composition").directive("nxtComposition",["Compositions","Uploader","Notification","$timeout","ApplicationConfig","Track","$state","$rootScope","Tools","$stateParams","$interval","Contact","Sender","ExternalAccount","ScopeService",function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p){var q=48;return{restrict:"A",scope:{mode:"@nxtMode",dialogid:"@nxtDialogid",defaults:"=nxtDefaults"},link:function(r,s){function t(){r.sender=n.autoSelectSender({accounts:r.accounts,senderConfig:Y,setIfChangingSenderAllowed:function(a){ia=a},setFilteredAccounts:function(a){r.filteredAccounts=a}})}function u(a){if(r.$parent&&r.$parent.$parent&&r.$parent.$parent.params&&r.$parent.$parent.params.compositionConfig&&!angular.isUndefined(r.$parent.$parent.params.compositionConfig[a]))return r.$parent.$parent.params.compositionConfig[a]}function v(){r.$emit("directive:emailinput:focus",{addEmailFn:null})}function w(){return!na.some(function(a){return a})}function x(a){na[a]=!0,r.isSendingEnabled=w()}function y(a){na[a]=!1,r.isSendingEnabled=w()}function z(){return aa?r.isSimplified?aa.innerHTML:aa.value:""}function A(a){return r.isSimplified?void(aa.innerHTML+="<br><br>"+a):r.isHTML?void r.$broadcast("tinymce:insert-content","<br><br>"+a):(aa.value+="\n\n"+j.stripTagsFormatBlockQuotes(a),void r.$broadcast("auto-grow:grow"))}function B(a){c.success("composition:message-sent"),a&&a.mid&&parseInt(a.mid)>0&&r.$emit("composition:sent",{originalMessageId:r.defaults&&r.defaults.mesg,newMessageId:a.mid,threadId:a.thId})}function C(){return{recipients:r.recipients,subject:r.subject,selectedSignature:r.selectedSignature,isHTML:r.isHTML,originalContent:r.originalContent,originalMessageRevealed:r.originalMessageRevealed,selectedStationery:r.selectedStationery,attachments:r.attachments,compositionId:r.compositionId,sender:r.sender,important:r.isImportant,requireConfirm:r.requireConfirm,rawContent:z()}}function D(){var a=b.getUploader(r);r.uploader||(r.uploader=a.uploader),r.inlineUploader||(r.inlineUploader=a.inlineUploader),e(function(){ba=ga.querySelector(".composition-upload-button--normal"),ca=ga.querySelector(".composition-upload-button--inline"),da=ga.querySelector(".composition-wrapper"),ea=angular.element(da.parentNode)},0,!1)}function E(){a.sendMessage("send",{onBeforeStart:function(){ea.addClass("sending")},onSuccess:function(b){r.dialogid?(a.removeComposition(r.dialogid),c.success("composition:message-sent"),r.$emit("dialog:remove-shadow")):B(b),i.$broadcast("tooltip:hide"),parseInt(k.folderId)===parseInt(f.folders.DRAFTS)&&"e"===r.opt&&i.$broadcast("folder:refresh"),r.sending=!1},onError:function(){ea.removeClass("sending"),c.error("composition:sending-error"),r.$emit("dialog:remove-shadow"),r.sending=!1},config:C()})}function F(){a.sendMessage("reply",{onBeforeStart:function(){ea.addClass("sending")},onSuccess:function(b){r.dialogid?(a.removeComposition(r.dialogid),c.success("composition:message-sent"),r.$emit("dialog:remove-shadow")):B(b),f.env.device.isMobile||i.$broadcast("tooltip:hide"),parseInt(k.folderId)===parseInt(f.folders.DRAFTS)&&"e"===r.opt&&i.$broadcast("folder:refresh"),r.sending=!1},onError:function(){ea.removeClass("sending"),c.error("composition:sending-error"),r.$emit("dialog:remove-shadow"),r.sending=!1},config:C()})}function G(a){var b;r.singleTo=a.to,b=m.mapCompositionContacts(a,r.sender),r.to=b.to,r.cc=b.cc,r.bcc=b.bcc,r.isReplyingToSingle===!0&&H()}function H(){r.allTo=r.to,r.allCc=r.cc,r.to=r.singleTo,r.cc=null}function I(a){var b=a.body,c="<blockquote",d=b.indexOf(c),e=b.substring(0,d),f=b.substring(d),g=f.substring(0,70);return g.indexOf("nxt-original-message-notrevealed")!==-1&&(a.body=e,f=f.replace(/ class="nxt-original-message-notrevealed"/,""),a.originalContent=f,a.originalMessageRevealed=!1),a}function J(b){f.env.isSpammer&&r.dialogid&&a.removeComposition(r.dialogid),a.get(b).then(function(a){r.isCompositionActive=!0,r.$emit("composition:activated"),angular.isObject(b.relatedDraft)?P(angular.extend(b.relatedDraft,{mid:d.mid})):"ra"===b.opt?(a.to&&delete a.to,a.replyTo&&delete a.replyTo,a.cc&&delete a.cc,a.bcc&&delete a.bcc,P(a)):P("e"===b.opt?I(a):b.opt?a:angular.extend(a,b))},function(){r.dialogid&&a.removeComposition(r.dialogid)})}function K(a){var b={to:"to",cc:"cc",bcc:"bcc",subject:"subject",body:"content",originalContent:"originalContent",compositionId:"compositionId",opt:"opt",autoFocusContent:"autoFocusContent"};a=a||{},a.signatureId&&f.signatures[a.signatureId]&&(r.selectedSignature=f.signatures[a.signatureId]);for(var c in b)a.hasOwnProperty(c)&&(a[c]&&a[c].length||angular.isObject(a[c])||"boolean"==typeof a[c])&&(r[b[c]]=a[c]);angular.isObject(a.senderConfig)&&!angular.isObject(Y)&&(Y=a.senderConfig,t()),e(function(){"embeded"!==r.mode&&("ra"===r.opt||r.autoFocusContent?r.focusEditor():(_||(_=ga.querySelector('[nxt-name="composition-to"] .email-input-plain-input')),_&&_.focus())),r.updateTitle()},150)}function L(a){var b=r.isHTML?"<br>":"\n",c=["",'<div style="display:none" data-inpl-forward-mark></div>',"------ Wiadomość oryginalna ------","Temat: "+j.getTextOnly(a.org_subject),"Data: "+j.getTextOnly(a.org_date),"Nadawca: "+a.org_from,"Adresat: "+a.org_to];return a.org_cc&&c.push("DW: "+a.org_cc),c.push(b),c.join(b)}function M(a){var b=r.isHTML?"<br>":"\n",c=["Temat: "+j.getTextOnly(a.org_subject),"Data: "+j.getTextOnly(a.org_date),"Nadawca: "+a.org_from,"Adresat: "+a.org_to];return a.org_cc&&c.push("DW: "+a.org_cc),c.push(b),c.join(b)}function N(a){return['<div class="inpl-collapsed">',a,"</div>"].join("")}function O(a){var b,c,d=a;return"ra"!==d.opt||d.noParamsRequest?"f"===d.opt?(b=document.createElement("div"),b.innerHTML=d.body,c=b.querySelector("blockquote"),c.className="noHidden",c.insertAdjacentHTML("beforebegin",L(d)),d.body=b.innerHTML):"e"===d.opt&&d.from&&(d.senderConfig={fromEmail:d.from,isDraft:!0},delete d.from):(d.to=d.replyTo,f.prefs.attachOnReply&&(r.originalContent=N(M(d)+d.body)),d.body=""),d}function P(a){if(void 0!==a.gallery&&(r.isGalleryState=a.gallery.state),r.compositionId=a.messageId||a.mid,K(O(a)),D(),r.uploader.loadAttachments(a),la=r.attachments.length,f.env.isMobileApp){r.attachmentsFullSize+=1048576*r.uploader.totalSize||0;try{MobileAppConnector.onCompositionComplete(r.compositionId,f.env.uid)}catch(b){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}}function Q(a,b){var c=angular.copy(b);return c.allowOwnEmails||[c.cc,c.bcc,c.from,c.to].forEach(function(a,b,c){c[b]=m.filterOutOwnContacts(a,X)}),c.senderConfig&&(Y=c.senderConfig),t(),c.noActivation===!0?void G(c):("undefined"==typeof c.noActivation&&G(c),void(c.noParamsRequest?(r.isCompositionActive=!0,P(c)):J(c)))}function R(){r.isModified&&!Z&&r.save(),oa&&clearInterval(oa)}function S(){r.isSimplified&&angular.element(document.body).addClass("displaying-simplified-composition"),r.accounts=a.getStoredExternalAccounts(),angular.isArray(r.accounts)&&(X=r.accounts.map(function(a){return a.email.toLowerCase()})),angular.isObject(r.defaults)?r.$watchCollection("defaults",function(a){Q(null,a)}):(t(),r.$on("composition:defaultsProvided",Q)),angular.isObject(r.defaults)||r.$emit("composition:getDefaults")}function T(){r.isSaving=!0}function U(){r.isSaving=!1,i.$broadcast("directive:composition:saved-finish")}function V(a){if(sessionStorage)try{var b=sessionStorage.getItem("extAccReq");if(null!==b){var c=JSON.parse(b).accs;return c.indexOf(a)!==-1}}catch(d){}return!1}function W(){var a,b;if(window.getSelection&&(a=window.getSelection(),a.getRangeAt&&a.rangeCount)){b=a.getRangeAt(0),b.deleteContents();var c=document.createElement("div");c.innerHTML="<br>";for(var d,e,f=document.createDocumentFragment();d=c.firstChild;)e=f.appendChild(d);b.insertNode(f),1==e.previousSibling.length?e.previousSibling.remove():1==e.previousSibling.previousSibling.length&&e.previousSibling.previousSibling.remove(),e&&(b=b.cloneRange(),b.setStartAfter(e),b.collapse(!0),a.removeAllRanges(),a.addRange(b))}}var X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga=s[0],ha={UPLOADING:1,NO_COMPOSITION_ID:2},ia=!1,ja=!1,ka=!1,la=0,ma=r.$parent&&r.$parent.$parent&&r.$parent.$parent.params&&r.$parent.$parent.params.compositionConfig&&r.$parent.$parent.params.compositionConfig.singleInstanceId,na=[],oa=null;r.isSimplified=f.env.device.isMobile,r.isMobile=f.env.device.isMobile,r.mailConfirmAllowed=f.env.mailConfirmAllowed,r.staticUrl=f.env.staticUrl,r.managerError=!0,f.env.device.isMobile&&(r.$on("composition:enableAutosave",function(){fa=!1,r.markCompositionAsModified();
}),r.$on("resizeCanvas",function(a,b){r.uploader.addToQueue(b,{url:r.uploadUrl})}),r.$on("document",function(a,b){r.uploader.addToQueue(b,{url:r.uploadUrl})})),r.markCompositionAsModified=function(){fa||(r.isModified=!0,l.cancel($),$=l(function(){r.isModified&&!Z&&r.save({showError:!1})},3e4))},r.markCompositionAsUnmodified=function(){r.isModified=!1,l.cancel($)},r.markCompositionAsUnmodified(),r.isHTML=!0,r.isSendingEnabled=!0,r.isImportant=!1,r.requireConfirm=!1,r.recipients=[],r.isSaving=!1,r.attachmentsFullSize=0,r.publicGalleryEnabled=1==f.env.publicGalleryEnabled,r.isReplyingToSingle=u("isReplyingToSingle"),r.isReplyingToSingle=angular.isUndefined(r.isReplyingToSingle)?f.env.replyOption:r.isReplyingToSingle,r.focusEditor=function(a){r.compositionId?e(function(){r.isHTML?f.env.device.isMobile?aa?aa.focus():setTimeout(function(){aa&&aa.focus()},200):r.$broadcast("tinymce:focus"):aa.focus(),"undefined"!=typeof a&&a!==!0||ga.scrollIntoView(!1),f.env.device.isMobile&&aa&&(document.body.scrollTop=document.documentElement.scrollTop=aa.offsetTop-(f.hacks.isIOS?0:q))},0,!1):ka=!0},r.mobileFocus=function(){var a=document.documentElement.scrollTop,b=0;oa=window.setInterval(function(){b++,(a!=document.documentElement.scrollTop||b>=50)&&(document.documentElement.scrollTop=a,clearInterval(oa))},10)},r.popOutComposition=function(){var b;r.compositionId?b={noParamsRequest:r.isCompositionActive,messageId:r.compositionId,from:r.sender,to:r.recipients.to,cc:r.recipients.cc,bcc:r.recipients.bcc,subject:r.subject,prior:r.isImportant,confirm:r.requireConfirm,body:z(),originalContent:r.originalContent,isHTML:r.isHTML,uploaderQueue:r.uploader&&r.uploader.queue,attachments:r.attachments,opt:r.opt,originalRecipients:r.defaults&&r.defaults.originalRecipients,singleInstanceId:r.defaults&&r.defaults.mesg}:(b=angular.copy(r.defaults),"undefined"!=typeof b.noActivation&&delete b.noActivation),a.addComposition(b)},r.toggleImportant=function(){return r.isImportant=!r.isImportant,r.isImportant&&(g.pushGACode("mailToggleImportant"),g.pushIWACode("mailToggleImportant")),r.isImportant},r.toggleDisplayed=function(){return r.requireConfirm=!r.requireConfirm},r.sendButtonClickHandler=function(){!f.env.device.isMobile&&r.isHTML&&r.$broadcast("ui-tinymce:update-model"),l.cancel($),Z=!0,r.$broadcast("composition:validateAndAddContact"),e(function(){r.isSendingEnabled&&(m.countContacts(r.recipients)>0?(r.sending=!0,f.hacks.isIOS&&(ga.querySelector('[nxt-name="composition-to"] .email-input-plain-input').blur(),r.scrollToTop()),"ra"===r.opt?F():E(),g.pushGACode("sendMail"),g.pushIWACode("sendMail","embeded"===r.mode?"otwarty_mail":"nowe_okno")):(c.error("composition:no-recipients"),ga.querySelector('[nxt-name="composition-to"] .email-input-plain-input').focus())),r.$digest()},0,!1)},r.save=function(b){if(!f.env.device.isMobile&&r.isHTML&&r.$broadcast("ui-tinymce:update-model"),r.isSendingEnabled){b=b||{};var d=void 0===b.showError||b.showError;T(),a.sendMessage("save",{onSuccess:function(a){if(a.attach.list){r.attachments=[];for(var b=0;b<a.attach.list.length;b++)r.attachments.push(a.attach.list[b].mpid),r.uploader.queue[b]&&(r.uploader.queue[b].mimePartIndex=a.attach.list[b].mpid)}a.mid&&(r.compositionId=a.mid),d&&c.success("composition:message-saved"),r.markCompositionAsUnmodified(),"e"!==r.opt&&(i.$broadcast("directive:newcomposition:save"),r.opt="e"),ma&&i.$broadcast("composition:saved",ma),parseInt(k.folderId)===parseInt(f.folders.DRAFTS)&&i.$broadcast("folder:refresh"),U()},onError:function(){d&&c.error("composition:saving-error"),U()},config:C()})}},r.updateTitle=function(){r.$emit("dialog:update-title",r.subject||"Nowa wiadomość")},r.$on("composition:set-data",function(a,b){var c=b.field,d=b.value;p.safeApply(i,function(){r[c]=d,r.markCompositionAsModified()})}),r.emailInputsBlurred=function(){r.$broadcast("directive:emailinput:blur"),v()},r.revealOriginalMessage=function(){g.pushIWACode("messageThreadRevealOriginalMessage"),r.originalMessageRevealed=!0,A(r.originalContent)};var pa=function(a){if(sessionStorage)try{var b=sessionStorage.getItem("extAccReq");if(null!==b){var c=JSON.parse(b).accs,d=c.indexOf(a);d!==-1&&c.splice(d,1),sessionStorage.setItem("extAccReq",JSON.stringify({accs:c}))}}catch(e){}};if(r.setSender=function(b){1===parseInt(b.allowSend)?(r.sender=b,r.markCompositionAsModified(),i.$broadcast("hideAllPanels")):V(b.email)?o.query(1,!0).then(function(d){var e=d.filter(function(a){return b.email===a.email})[0];e&&1===parseInt(e.allowSend)?(a.updateExternalAccounts(),r.setSender(e),pa(b.email)):c.error("external-account::noactive")}):c.error("external-account::noactive"),g.pushIWACode("changeSenderMail")},r.activateComposition=function(){if(!r.isCompositionActive&&angular.isObject(r.defaults)){var a=angular.copy(r.defaults);r.isCompositionActive=!0,a.noActivation=!1,Q(null,a)}},r.scrollToUploadManager=function(){if(da){var a=da.scrollHeight;(r.uploader.isItemsCountExceeded||r.uploader.isTotalSizeExceeded)&&(a-=da.getElementsByClassName("upload-manager")[0].offsetHeight),da.scrollTop=a}},r.scrollToTop=function(){da&&e(function(){da.scrollTop=0},150,!1)},r.loopFocus=function(){var a;ga.querySelector(".composition-all-recipients.ng-hide")?a=ga.querySelector('[nxt-name="composition-to"] .email-input-plain-input'):r.$parent.id&&(a=ga.querySelector(".composition-subject")),a?a.focus():r.focusEditor(!1)},r.replyToSingle=function(){r.$broadcast("composition:removeAllContacts"),r.isReplyingToSingle=!0,r.singleTo&&H()},r.replyToAll=function(){r.$broadcast("composition:removeAllContacts"),r.isReplyingToSingle=!1,r.allTo&&(r.to=r.allTo),r.allCc&&(r.cc=r.allCc)},r.addAccount=function(){r.$emit("dialog:demaximize"),a.waitForNewAccount(),ja=!0,h.current.name.indexOf(".external-account.configure")==-1&&h.go(".external-account.configure")},r.fileUploadClick=function(){if(ba||(ba=ga.querySelector(".composition-upload-button--normal")),b.fakeFileInputClick(ba,r),f.env.isMobileApp){l.cancel($),fa=!0;try{MobileAppConnector.onChooseFiles(r.compositionId,f.env.uid,r.attachmentsFullSize)}catch(a){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}},r.inputMobileButton=function(){if(f.env.isMobileApp){l.cancel($),fa=!0;try{MobileAppConnector.onChooseFiles(r.compositionId,f.env.uid,r.attachmentsFullSize)}catch(a){console.log("MobileAppConnector.onChooseFiles - only to use in mobileApp")}}else f.hacks.isIOS?r.fileUploadClick():document.getElementById("fakeMobileInput").click()},r.close=function(){r.managerError=!1},f.hacks.isIOS)var qa=angular.element(document.querySelectorAll(".dialog-header")),ra=angular.element(document.querySelectorAll(".composition-simplified-toolbar"));r.absoluteHeader=function(){f.env.device.isMobile&&f.hacks.isIOS&&(qa.css("position","absolute"),ra.css("position","absolute"))},r.fixedHeader=function(){f.env.device.isMobile&&f.hacks.isIOS&&(qa.css("position","fixed"),ra.css("position","fixed"))},r.onKeyUp=function(a){if(r.markCompositionAsModified(),f.hacks.isAndroid&&f.hacks.AndroidVersion>5){var b=a.keyCode;13==b&&W()}},r.$on("directive:dialog:close",function(){r.isModified&&g.pushGACode("mailAutosaveClose")}),f.env.device.isMobile||(r.$on("tinymce:stationerySelected",function(a,b){r.selectedStationery=b}),r.$on("tinymce:button:inlineimage",function(){b.fakeFileInputClick(ca),i.$broadcast("tooltip:hide")}),r.$on("tinymce:content:focus",function(){r.activateComposition(),ea.addClass("focus"),r.emailInputsBlurred(),i.$broadcast("hideAllPanels")}),r.$on("tinymce:content:blur",function(){ea.removeClass("focus")}),r.$on("tinymce:switched-editor-mode",function(a,b){e(function(){r.isHTML=b.isHTML,r.isHTML||(r.originalMessageRevealed||(r.originalContent=j.stripTagsFormatBlockQuotes(r.originalContent)),r.$broadcast("auto-grow:grow")),r.markCompositionAsUnmodified(),r.$digest()},0,!1)}),r.$on("directive:dialog:toggle",function(){e(function(){r.focusEditor(),r.$broadcast("tinymce:autoresize")},150,!1)})),f.env.device.isMobile?r.close=function(){i.$broadcast("directive:dialog:close-composition")}:(r.$on("composition:scroll-to-top",r.scrollToTop),r.$on("composition:popout",r.popOutComposition),r.$on("composition:forced-focus",r.focusEditor)),r.$on("composition:save",function(){r.isModified&&r.save()}),r.$on("composition:mark-as-modified",r.markCompositionAsModified),r.$on("composition:send-mail",r.sendButtonClickHandler),r.$on("compositions:update-sender",function(b,c){var d;if(r.accounts=a.getStoredExternalAccounts(),r.filteredAccounts=r.accounts,d=r.accounts.some(function(a){r.sender.email=a.email}),d||t(),c&&(c.isGlobal&&ia||ja))for(var e=0;e<r.filteredAccounts.length;e++)r.filteredAccounts[e].email===c.addedAccountEmail&&(r.sender=r.filteredAccounts[e])}),r.$on("composition:updateRecipients",function(a,b){r.recipients=b}),r.$on("composition:disableSending",function(){x(ha.UPLOADING)}),r.$on("composition:enableSending",function(){y(ha.UPLOADING)}),r.$on("$destroy",function(){l.cancel($),r.isModified&&!Z&&r.save(),v(),angular.element(document.body).removeClass("displaying-simplified-composition")}),r.$watch("compositionId",function(a){return a?(y(ha.NO_COMPOSITION_ID),ka&&e(function(){r.focusEditor(!1)},300,!1),aa=ga.querySelector(".composition-content"),angular.element(aa).one("change",r.markCompositionAsModified),void r.uploader.updateUploadUrls()):void x(ha.NO_COMPOSITION_ID)}),NXT_CONFIG.env.isMobileApp&&(r.$on("composition:add:attachment",function(a,b){r.attachmentsFullSize+=b.attach.totalSize,b.mid=r.compositionId,p.safeApply(i,function(){r.uploader&&(r.uploader.loadAttachments(b),la=b.attach.list.length)})}),r.isUploadOnlyImages=f.hacks.isIOS),angular.element(window).on("beforeunload",R),S()},templateUrl:function(){return f.env.device.isMobile?"/composition/views/composition_mobile.html":"/composition/views/composition.html"}}}]),angular.module("nxt-composition").directive("nxtContextAwareOverflow",function(){var a=2;return{restrict:"A",scope:{params:"=nxtContextAwareOverflow"},link:function(b,c){var d=c[0],e=d,f=Math.ceil;b.params.checkParent&&(e=d.parentNode),b.$watchCollection("params",function(b){if(b&&b.string){var c,g=angular.copy(b),h=angular.copy(b.string),i=g.string.length,j=f(i/2);if(d.innerHTML="",d.appendChild(document.createTextNode(g.string+" "+g.suffix)),c=e.offsetWidth,g.string.length>3&&c+a<e.scrollWidth){d.innerHTML="",d.appendChild(document.createTextNode(h+"... "+g.suffix));do c<e.scrollWidth?i-=j:i+=j,j=f(j/2),d.innerHTML="",d.appendChild(document.createTextNode(h.substring(0,i)+"... "+g.suffix));while(j>1||c<e.scrollWidth)}}})}}}),angular.module("nxt-composition").directive("nxtEmailDragzone",["$rootScope","ApplicationConfig","ApplicationData",function(a,b,c){"use strict";return{restrict:"A",scope:{message:"=nxtEmailDragzone"},link:function(a,d){function e(){var b=a.$parent.messages;return b.filter(function(a){return a.checked})}function f(a){a.preventDefault()}var g,h;g=document.getElementsByTagName("body")[0],d.on("dragstart",function(i){return g.addEventListener("dragover",f),g.addEventListener("drop",f),h=document.getElementById("drag-info"),b.hacks.isPcIE===!0||b.hacks.isEdge===!0?i.target.style.opacity="0.4":i.dataTransfer.setDragImage(h,-5,0),b.hacks.isFirefox===!0&&i.dataTransfer.setData("text/uri-list",i.target),d.find("input")[0].checked?(a.checkedMessages=e(),c.putDragMessage(a.checkedMessages)):c.putDragMessage(a.message),!1}),d.bind("dragend",function(a){b.hacks.isPcIE!==!0&&b.hacks.isEdge!==!0||(this.style.opacity="1"),g.removeEventListener("dragover",f),g.removeEventListener("drop",f),c.deleteDragMessage(),a.preventDefault()}),a.$on("$destroy",function(){d.unbind("dragstart"),d.unbind("dragend")})}}}]),angular.module("nxt-composition").directive("nxtEmailDropzone",["$rootScope","$state","ApplicationConfig","ApplicationData","Track",function(a,b,c,d,e){"use strict";return{restrict:"A",scope:!1,link:function(b,f,g){function h(a,b){if(b)return e.pushGACode("moveMesToUserFolderDrag_Drop"),void e.pushIWACode("moveDrag_Drop","folder uzytkownika");switch(a){case"1":e.pushGACode("moveMesToInboxDrag_Drop"),e.pushIWACode("moveDrag_Drop","odebrane");break;case"3":e.pushGACode("moveMesToTrashDrag_Drop"),e.pushIWACode("moveDrag_Drop","kosz");break;case"8388608":e.pushGACode("moveMesToSocialDrag_Drop"),e.pushIWACode("moveDrag_Drop","oferty");break;case"16777216":e.pushGACode("moveMesToSocialDrag_Drop"),e.pushIWACode("moveDrag_Drop","społeczności");break;case"-2":e.pushGACode("moveMesToSpamDrag_Drop"),e.pushIWACode("moveDrag_Drop","spam")}}var i;c.env.device.isMobile||(f.bind("dragenter",function(a){c.hacks.isPcIE===!0&&a.preventDefault()}),f.bind("dragover",function(a){if(void 0!==d.getDragMessage())return f.children().addClass("navigation-button--active"),f.find("a")[0].style.cursor="pointer",i=document.querySelector(".navigation-button--user-folder"),a.target==i?(b.$parent.userFolders.length>=1&&(a.preventDefault(),b.openFolderList()),!1):void a.preventDefault()}),f.bind("dragleave",function(a){f.children().removeClass("navigation-button--active"),a.preventDefault()}),f.bind("drop",function(c){return f.children().removeClass("navigation-button--active"),g.nxtEmailDropzoneUserFolder?(c.preventDefault(),!1):(d.getDragMessage().length>=1?a.$broadcast("message:move-by-drag&drop",g.nxtEmailDropzoneFolderid):a.$broadcast("message:move-by-drag&drop",g.nxtEmailDropzoneFolderid,d.getDragMessage()),h(g.nxtEmailDropzoneFolderid,b.folder),void c.preventDefault())}),b.$on("$destroy",function(){f.unbind("dragenter"),f.unbind("dragover"),f.unbind("dragleave"),f.unbind("drop")}))}}}]),angular.module("nxt-composition").directive("nxtEmailInputPlain",["$timeout","Contact","ContactGroup","Track","ApplicationConfig","ApplicationData",function(a,b,c,d,e,f){return{restrict:"A",scope:{name:"@nxtName",basevalue:"=nxtBasevalue",isEditing:"=nxtIsEditing"},link:function(c,g){function h(a){if(a)for(var b=0;b<L.length;b++)if(L[b][c.ContactKeys.EMAIL]===a){if(L[b][c.ContactKeys.EMAIL]===L[b][c.ContactKeys.NAME])break;return L[b][c.ContactKeys.NAME]}return null}function i(a){if(a)for(var b=0;b<L.length;b++)if(L[b][c.ContactKeys.EMAIL]===a)return L[b][c.ContactKeys.ID];return null}function j(a){if(a)for(var b=0;b<L.length;b++)if(L[b][c.ContactKeys.EMAIL]===a)return L[b][c.ContactKeys.TYPE]||1;return null}function k(b){a(function(){c.selectedContacts.forEach(function(a){a.email===b.email&&(a.isAnimationEnabled=!0,a.isNewlyAdded=!1)}),c.$digest()},300,!1),a(function(){c.selectedContacts.forEach(function(a){a.email===b.email&&(a.isAnimationEnabled=!1)})},700,!1)}function l(a,b,e){var f,g=angular.copy(a);if((!b||"users@interia.pl"!=g.email)&&g.email){for(g.isAnimationEnabled=!1,c.isSuggestHidden=!0,f=0;f<c.selectedContacts.length;f++)if(c.selectedContacts[f].email===g.email)return void(b||(c.selectedContacts[f].isNewlyAdded=!0,k(g),c.focusInput()));for(b||(g.isNewlyAdded=!0),g.name=g.name||h(g.email),g.id=g.id||i(g.email),g.type=g.type||j(g.email),c.selectedContacts.push(g),f=0;f<L.length;f++)L[f][c.ContactKeys.EMAIL]===g.email&&(L[f][c.ContactKeys.IS_FORCED_HIDDEN]=!0);if(c.$emit("directive:emailinput:recipientsupdated"),c.$emit("emailinput:contactAdded",{listName:c.name.split("-").pop(),contact:g}),b||(k(g),c.$emit("composition:mark-as-modified")),!e)switch(c.name.split("-").pop()){case"cc":d.pushGACode("newMailDW");break;case"bcc":d.pushGACode("newMailUDW")}}}function m(a){var b=a.replace(/^mailto:|^\s+|\s+$/g,"").replace(/[,;]$/g,"");if(b.indexOf("<")===-1&&b.indexOf("(")===-1)/^\S+@\S+\.\S+$/.test(b)&&(l({email:b}),c.resetInput());else{var d,e=b.match(/^(.*)[<\(](\S+@\S+\.\S+)[\>\)]$/);null!==e&&e[2].length&&(d={email:e[2]},e[1].length&&(d.name=e[1].replace(/^\s+|\s+$/g,"")),l(d),c.resetInput())}}function n(){var a=H.val().replace(/,/g,";").replace(/^\s+|\s+$/g,"").split(";");a.forEach(m)}function o(){var a=H.val().replace(/^\s+|\s+$/g,"");m(a)}function p(a,b){angular.isArray(a)?a.forEach(function(a){l(a,b,!0)}):angular.isObject(a)&&l(a,b,!0),c.$broadcast("eip:reset-input")}function q(){c.contacts&&c.contacts.length?(c.selectedContactIndex=0,c.selectedGroupIndex=null):(c.selectedGroupIndex=0,c.selectedContactIndex=null)}function r(){var a=c.$parent.allRecipients.to.concat(c.$parent.allRecipients.bcc,c.$parent.allRecipients.cc),b=a.map(function(a){return a.email});return b}function s(){var a=0,d=H.val().toLowerCase(),e=30;c.inputNodeLength=d.length,d.length&&(L.forEach(function(b,e,f){!b[c.ContactKeys.IS_FORCED_HIDDEN]&&r().indexOf(b[c.ContactKeys.EMAIL])===-1&&b[c.ContactKeys.WORDS]&&b[c.ContactKeys.WORDS].some(function(a){return a.indexOf(d)!==-1})?(f[e][c.ContactKeys.IS_HIDDEN]=!1,a++):f[e][c.ContactKeys.IS_HIDDEN]=!0}),c.suggestLength=a,c.isContactFromSuggestSelected=!!a,c.isSuggestHidden=!1,c.contacts=[],c.contacts=L.filter(function(a){return!a[c.ContactKeys.IS_FORCED_HIDDEN]&&!a[c.ContactKeys.IS_HIDDEN]&&e>0&&(e--,!0)}),c.groups=[],M.forEach(function(a){a.words.some(function(a){return a.indexOf(d)!==-1})&&b.isNotEmpty(L,a.id)&&c.groups.push(a)}),q())}function t(){null!==c.selectedContactIndex?c.selectedContactIndex==c.contacts.length-1&&c.groups.length?(c.selectedContactIndex=null,c.selectedGroupIndex=0):c.selectedContactIndex=(c.selectedContactIndex+1)%c.contacts.length:c.selectedGroupIndex==c.groups.length-1&&c.contacts.length?(c.selectedGroupIndex=null,c.selectedContactIndex=0):c.selectedGroupIndex=(c.selectedGroupIndex+1)%c.groups.length}function u(){null!==c.selectedContactIndex?0===c.selectedContactIndex&&c.groups.length?(c.selectedContactIndex=null,c.selectedGroupIndex=c.groups.length-1):c.selectedContactIndex=(c.selectedContactIndex-1)%c.contacts.length:0===c.selectedGroupIndex&&c.contacts.length?(c.selectedGroupIndex=null,c.selectedContactIndex=c.contacts.length-1):c.selectedGroupIndex=(c.selectedGroupIndex-1)%c.groups.length}function v(){return c.selectedContacts.length&&c.selectedContacts[c.selectedContacts.length-1].isHighlighted}function w(){c.selectedContacts.length&&(c.selectedContacts[c.selectedContacts.length-1].isHighlighted=!0)}function x(){c.selectedContacts.length&&(c.selectedContacts[c.selectedContacts.length-1].isHighlighted=!1)}function y(){c.selectedContacts.length&&""===H.val()&&(v()?(H.val(c.removeContact(c.selectedContacts.length-1).email),c.focusInput()):w())}function z(a){if(e.env.device.isMobile){var b=a.val();a.val(""),a.val(b)}}function A(a){var b=a.charCodeAt(a.length-1);switch(b){case 59:b=e.keyCodes.SEMICOLON;break;case 44:b=e.keyCodes.COMMA}return b}function B(a){a.stopPropagation(),a.preventDefault();var b,d=a.target;do{if(b=d.getAttribute("data-email"),d.hasAttribute("nxt-simple-dropdown-content"))return;d=d.parentNode}while(!b);H.val(b),o(),c.focusInput()}function C(b){a.cancel(K),K=a(function(){B(b)},200,!1)}function D(){a.cancel(K)}function E(){var a;if(c.selectedContacts&&c.selectedContacts.length)for(a=c.selectedContacts.length-1;a>=0;a--)c.removeContact(a)}function F(a){var b;for(b=0;b<c.selectedContacts.length;b++)c.selectedContacts[b].email===a&&c.removeContact(b,!0)}function G(a){var b;for(b=0;b<c.selectedContacts.length;b++)a.indexOf(c.selectedContacts[b].email)!==-1&&c.removeContact(b,!0)}var H,I,J,K,L=[],M=[];if(c.ContactKeys=e.ContactKeys,L=angular.copy(f.get("Contact").data),M=f.get("ContactGroup").data.data,H=angular.element(g[0].querySelector("input.email-input-plain-input")),c.selectedContactIndex=null,c.selectedGroupIndex=null,c.selectedContacts=[],c.groups=[],c.contacts=[],c.resetInput=function(){H.val(""),c.inputEmail="",c.$broadcast("eip:reset-input")},c.focusInput=function(){a(function(){g[0].querySelector(".email-input-plain-input").focus(),z(H)},100,!1)},c.inputChange=function(a){var b=a.keyCode;if(e.hacks.isAndroid&&(0!=b&&229!=b||(b=A(H.val()))),b!==e.keyCodes.TAB){if(b===e.keyCodes.ARROW_DOWN)return void t();if(b===e.keyCodes.ARROW_UP)return void u();b===e.keyCodes.SPACE||b===e.keyCodes.COMMA||b===e.keyCodes.NEWLINE||b===e.keyCodes.SEMICOLON?(a.preventDefault(),null!==c.selectedGroupIndex&&c.groups[c.selectedGroupIndex]?c.addGroupContacts(c.groups[c.selectedGroupIndex].id):(c.isContactFromSuggestSelected&&H.val(c.contacts[c.selectedContactIndex][c.ContactKeys.EMAIL]),o(),x())):b===e.keyCodes.BACKSPACE?y():x(),s(),c.$broadcast("simpleDropDown:updateDropdownPosition")}},c.inputTab=function(a){var b=a.keyCode;b===e.keyCodes.TAB&&H.val().length&&(a.preventDefault(),c.isContactFromSuggestSelected&&H.val(c.contacts[c.selectedContactIndex][c.ContactKeys.EMAIL]),o(),x(),s(),c.$broadcast("simpleDropDown:updateDropdownPosition"))},c.pasteHandler=function(){a(function(){n()},50)},e.hacks.isIOS){var N=angular.element(document.querySelectorAll(".dialog-header")),O=angular.element(document.querySelectorAll(".composition-simplified-toolbar"));angular.element(window).on("resize",function(){a(function(){var a=window.innerWidth>0?window.innerWidth:screen.width;N[0].style.width=a+"px",O[0].style.left=a-8+"px",O[0].style.right="initial"},100,!1)})}c.blurHandler=function(){a.cancel(I),I=a(function(){o(),c.$digest()},300,!1),c.$emit("directive:emailinput:blur"),e.env.device.isMobile&&e.hacks.isIOS&&(N.css("position","fixed"),O.css("position","fixed"))},c.focusHandler=function(){c.isEditing=!0,a.cancel(I),z(H),c.$emit("directive:emailinput:focus",{addEmailFn:p}),e.env.device.isMobile&&e.hacks.isIOS&&(N.css("position","absolute"),O.css("position","absolute"))},c.removeContact=function(a,b){var e=c.selectedContacts[a];x(),c.selectedContacts.splice(a,1);for(var f=0;f<L.length;f++)L[f][c.ContactKeys.EMAIL]===e.email&&(L[f][c.ContactKeys.IS_FORCED_HIDDEN]=!1);return c.$emit("emailinput:contactRemoved",{listName:c.name.split("-").pop(),contact:e}),d.pushGACode("newMailDelContact"),d.pushIWACode("newMailDelContact"),b||c.focusInput(),e},c.suggestHoverHandler=function(a){c.selectedContactIndex=a,c.selectedGroupIndex=null},c.suggestGroupHoverHandler=function(a){c.selectedGroupIndex=a,c.selectedContactIndex=null},c.addGroupContacts=function(a){for(var d=b.getContactByGroup(L,a),e=0;e<d.length;e++)m(d[e][c.ContactKeys.NAME]+" <"+d[e][c.ContactKeys.EMAIL]+">")},c.$on("composition:removeAllContacts",E),c.$on("composition:removeContactByEmail",function(a,b){F(b)}),c.$on("composition:removeContactsByEmails",function(a,b){G(b)}),c.$on("composition:validateAndAddContact",function(){o()}),c.$on("composition:validateAddContact",function(a,b){c.name==="composition-"+b.listName&&l(b.contact)}),c.$on("applicationData:put:contact",function(){L=angular.copy(f.get("Contact").data)}),c.$on("applicationData:put:contactgroup",function(){M=angular.copy(f.get("ContactGroup").data.data)}),J=g[0].querySelector("[nxt-simple-dropdown-content]"),J&&(angular.element(J).on("click",B),angular.element(J).on("touchstart",C),angular.element(J).on("touchmove",D)),c.$watch("basevalue",function(){p(c.basevalue,!0)}),g.on("copy",function(){try{var a,c=window.getSelection(),d=c+"",e=document.createElement("div"),f="",g=b.contactArraysToObjects(L);d=d.replace(/ /gi,";"),d=d.split(";"),a=!1;for(var h=0;h<d.length;h++)if(/\S+@\S+\.\S+/.test(d[h]))f+=d[h]+";";else{for(var i=0;i<g.length;i++)if(g[i].name==d[h]){f+=g[i].email+";",a=!0;break}a||(f+=d[h]+";")}e.style.position="absolute",e.style.left="-99999px",document.body.appendChild(e),e.innerHTML=f,c.selectAllChildren(e),window.setTimeout(function(){document.body.removeChild(e)},100)}catch(j){}}),c.$on("$destroy",function(){g.off("copy"),angular.element(window).off("resize")})},templateUrl:"/composition/views/emailInputPlain.html"}}]),angular.module("nxt-composition").directive("nxtEmailInputPlainGroup",["$timeout","Contact","ApplicationConfig","Track",function(a,b,c,d){return{restrict:"A",transclude:!0,scope:{to:"=nxtTo",cc:"=nxtCc",bcc:"=nxtBcc",embeded:"=nxtEmbeded"},link:function(e,f){function g(a,b){["to","cc","bcc"].indexOf(a)!==-1&&(e.allRecipients[a].some(function(a){return a.email===b.email})||e.allRecipients[a].push(b))}function h(a,b){if(["to","cc","bcc"].indexOf(a)!==-1){var c,d=e.allRecipients[a];for(c=0;c<d.length;c++)d[c].email===b.email&&d.splice(c,1)}}function i(a){var b=[];return a.forEach(function(a){b.push(a.name||a.email)}),b.join("; ")}function j(){var a=e.allRecipients,b=[i(a.to),i(a.cc),i(a.bcc)].filter(function(a){return!!a}).join("; ");return b}function k(b,c,d){e[b]=!0,a(function(){if(d){var a=f[0].querySelector("."+c+" .email-input-plain-input");a&&a.focus()}e.$emit("composition:updateSize")},50,!1)}function l(){e.allRecipients.cc.length||(e.isCCShown=!1),e.allRecipients.bcc.length||(e.isBCCShown=!1)}function m(){return b.countContacts(e.allRecipients)>0}var n,o=f[0].querySelector(".composition-all-recipients");e.allRecipients={to:[],cc:[],bcc:[]},f.on("click",function(a){e.focusInputEmail(a)}),e.focusInputEmail=function(b){b.preventDefault(),b.stopPropagation();var d=e.isCCShown||e.isBCCShown?b.target.querySelector(".email-input-plain-input"):f[0].querySelector(".email-input-plain-input");d&&(c.hacks.isIpad||c.hacks.isIOS?d.focus():a(function(){d.focus()},300,!1))},e.showCC=function(a){k("isCCShown","composition-cc",a),d.pushIWACode("newMailShowCC")},e.showBCC=function(a){k("isBCCShown","composition-bcc",a),d.pushIWACode("newMailShowBCC")},e.startEditing=function(){e.isEditing=!0},e.save=function(){e.$emit("composition:save")},e.popOut=function(){e.$emit("composition:popout")},e.$on("directive:emailinput:blur",function(){var d=5;a.cancel(n),n=a(function(){m()&&(e.isEditing=!1,l(),c.env.device.isPc&&a(function(){o||(o=f[0].querySelector(".composition-all-recipients")),o.offsetWidth<o.scrollWidth-d?e.recipientsCounter=b.countContacts(e.allRecipients):e.recipientsCounter=0,e.$digest()},0,!1)),e.$digest()},500,!1)}),e.$on("directive:emailinput:focus",function(){a.cancel(n)}),e.$watch("cc",function(a){a&&a.length&&e.showCC(!1)}),e.$watch("bcc",function(a){a&&a.length&&e.showBCC(!1)}),e.$on("emailinput:contactAdded",function(b,c){g(c.listName,c.contact),e.recipients=j(),a.cancel(n),e.isEditing=!0,e.$emit("composition:updateRecipients",e.allRecipients)}),e.$on("emailinput:contactRemoved",function(b,c){h(c.listName,c.contact),e.recipients=j(),a.cancel(n),e.isEditing=!0,e.$emit("composition:updateRecipients",e.allRecipients)}),e.startEditing()},templateUrl:function(){return c.env.device.isMobile?"/composition/views/emailInputPlainGroup_mobile.html":"/composition/views/emailInputPlainGroup.html"}}}]),angular.module("nxt-composition").directive("nxtFileDropzone",["Track",function(a){"use strict";var b;return{restrict:"A",link:function(c,d){var e,f=function(){c.dropzone=!1,b=void 0,c.$evalAsync()};d.bind("dragenter",function(d){d.preventDefault(),d.stopPropagation(),c.activateComposition(),b=angular.element(document.querySelector(".composition-actions-dropzone")),e=setInterval(function(){void 0!==b&&(c.dropzone=!0,clearInterval(e))},100),c.$evalAsync(),b.bind("drop",function(){f(),a.pushGACode("addAttachDrag_Drop"),a.pushIWACode("addAttachDrag_Drop")})}),d.bind("dragleave",function(a){a.preventDefault(),a.stopPropagation(),a.target==b[0]&&f()}),c.$on("$destroy",function(){clearInterval(e),d.unbind("dragenter"),d.unbind("dragleave"),d.unbind("drop")})}}}]),angular.module("nxt-composition").directive("nxtInfoBar",["Compositions","$timeout","ScopeService",function(a,b,c){"use strict";return{restrict:"A",controller:["$scope","$rootScope",function(d,e){var f=d.message;d.isLoadingOpenMessage=!1,d.resendMail=function(){d.isLoadingOpenMessage=!0,d.$on("composition:save",function(){d.isLoadingOpenMessage=!1}),b(function(){c.safeApply(e,function(){a.addComposition({opt:"e",mesg:d.message.deliveryReport.msgId,folder:f.folderId}),d.isLoadingOpenMessage=!1})},0)},d.openComposition=function(b,c){var d=[];return b.stopPropagation(),b.preventDefault(),c&&c.length?(c=c.split(";"),angular.forEach(c,function(a){d.push({email:a,name:a})}),a.addComposition({to:d})):a.addComposition(),!0}}],link:function(a,c){var d,e=function(){var e=a.message.deliveryReport;a.deliveryReport=e,a.deliveryReport.multiAddress=!1,a.deliveryReport.isDate=!1,e.failures&&e.failures.addresses&&e.addresses.length>1&&(a.deliveryReport.multiAddress=!0),e.date&&e.hour&&(a.deliveryReport.isDate=!0),b(function(){var b=c[0].querySelector(".message-failed-resend");b&&(d=angular.element(b),d.on("click",function(b){a.resendMail(),b.stopPropagation(),b.preventDefault()}))},0)};a.message.deliveryReport&&(e(),a.$on("$destroy",function(){c.off(),d&&d.off()}))},templateUrl:function(a){return a.templateUrl||"/composition/views/failureBar.html"}}}]),angular.module("nxt-composition").directive("nxtMobileInputChange",["UploaderResize","$rootScope","Notification",function(a,b,c){"use strict";return{require:"ngModel",restrict:"A",link:function(d,e,f,g){function h(d){d.target.files.length>1&&c.successNoClose("uploader:adding-attachments");var e=Array.from(d.target.files);document.getElementById("fakeMobileInput").value=null,e.forEach(function(c,d){c.name.match(/.(jpg|jpeg|png|gif)$/i)?(a.resize(c),delete e[d]):(b.$broadcast("document",c),delete e[d])})}e.bind("change",h),d.$watch(function(){return g.$viewValue},function(a){a||e.val("")}),d.$on("$destroy",function(){e.unbind("change",h)})}}}]),angular.module("nxt-composition").directive("nxtMovable",["$document","$timeout","$rootScope","ApplicationConfig",function(a,b,c,d){var e=120,f=[60,45,30,15,0],g=0,h=3,i=0;return{restrict:"A",link:function(j,k,l){function m(b){b.stopPropagation(),a.off("mousemove",n),a.off("mouseup",m),angular.element(document.body).removeClass("on-moving"),k.removeClass("moving"),j.$broadcast("movable:moved")}function n(a){0!==a.which&&0!==a.buttons||m(a),a.stopPropagation(),k.css({top:Math.max(h,Math.min(s+(a.clientY-u),w-h))+"px",left:Math.max(h,Math.min(t+(a.clientX-v),x-h))+"px"}),E=k[0].getBoundingClientRect()}function o(){var a,b,c,d;F=!0,a=E.left,b=E.width,c=E.top,d=E.height,z=(a+b/2)/B,A=(c+d/2)/C}function p(){var a,b,c;F=!1,a=k[0].getBoundingClientRect(),b=a.width,c=a.height,B=document.documentElement.clientWidth,C=document.documentElement.clientHeight,k.css({left:Math.max(h,Math.min(B-b-h,B*z-b/2))+"px",top:Math.max(h,Math.min(C-c-h,C*A-c/2))+"px"}),E=k[0].getBoundingClientRect()}function q(){F||o(),clearTimeout(y),y=setTimeout(p,500)}if(!d.env.device.isMobile){var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=!1,G=f.pop()||0,H="false"!==l.nxtMovable,I=++e,J=++g,K=document.getElementById("wrapper");if(i=J,r=k[0].querySelectorAll("[nxt-movable-handler]")||k,r=angular.element(r),b(function(){B=K.clientWidth,C=K.clientHeight,D=k[0].getBoundingClientRect(),E={top:.5*(C-D.height)+G,right:D.right,bottom:D.bottom,left:.5*(B-D.width)+G,width:D.width,height:D.height},k.css({zIndex:I,top:E.top+"px",left:E.left+"px"}),b(function(){j.$broadcast("composition:loaded")},50,!1)},150,!1),H){r.on("mousedown",function(b){c.$broadcast("hideAllPanels"),k.hasClass("maximized")||k.hasClass("minimized")||(angular.element(document.body).addClass("on-moving"),k.addClass("moving"),s=parseInt(k.css("top"),10)||k.prop("offsetTop"),t=parseInt(k.css("left"),10)||k.prop("offsetLeft"),u=b.clientY,v=b.clientX,w=document.documentElement.clientHeight-k.prop("offsetHeight"),x=document.documentElement.clientWidth-k.prop("offsetWidth"),a.on("mousemove",n),a.off("mouseup",m),a.on("mouseup",m))});var L=function(){i!==J&&(c.$broadcast("movable:blur",J),I=e,k.css({zIndex:I}),i=J,c.$broadcast("movable:all-move-back"))};k.on("mousedown",L),j.$on("movable:show-on-top",L),j.$on("movable:all-move-back",function(){i!==J&&I===e&&(I--,k.css({zIndex:I}))}),a.on("mouseup",m)}angular.element(window).on("resize",q),j.$on("movable:blur",function(a,b){J===b&&c.$broadcast("composition:save")}),j.$on("$destroy",function(){f.push(G),a.off("mousemove",n),a.off("mouseup",m),r.off(),k.off(),angular.element(window).off("resize",q),e--})}}}}]),angular.module("nxt-composition").directive("nxtScrollIntoViewOnFocus",["ApplicationConfig",function(a){var b=5;return{restrict:"A",link:function(c,d){function e(){f=d[0].getBoundingClientRect(),f&&window.scrollTo(0,f.top+b)}var f;a.env.device.isMobile&&(d.on("focus",e),c.$on("$destroy",function(){d.off("focus",e)}))}}}]),angular.module("nxt-composition").directive("nxtSignature",["Tools","Compositions","Notification","Track","ApplicationConfig","$timeout",function(a,b,c,d,e,f){
return{scope:{selectedSignature:"=nxtSelectedSignature"},restrict:"A",link:function(g,h){function i(){g.setSignature()}var j=h[0],k=j.querySelector(".composition-signature-add textarea"),l=j.querySelector(".composition-signature-add-name-input");g.signatureAllow=e.getConfigAppModule("composition")&&e.getConfigAppModule("composition").actions.signature,g.isEditingSignature=!1,g.signatures=e.signatures||{},g.editSignature=function(){g.isEditingSignature=!0,f(function(){k.focus()},50,!1)},g.clearSignature=function(){g.isEditingSignature=!1,l.value="",k.value=""},g.saveSignature=function(e){g.isTooLong&&e.stopPropagation();var f={name:a.getTextOnly(l.value),value:a.getTextOnly(k.value)};return f.value.length?f.name.length?(g.signatures[Date.now()]=f,g.changeSignature(f),g.clearSignature(),void b.addSignature(f).then(function(){c.success("composition:signature-saved"),d.pushGACode("addSignature")},function(){c.error("composition:saving-signature-error")})):(c.error("composition:empty-signature-name"),void l.focus()):(c.error("composition:empty-signature"),void k.focus())},g.setSignature=function(){for(var a in g.signatures)g.signatures.hasOwnProperty(a)&&parseInt(a,10)===e.defaultSignatureId&&(g.selectedSignature=g.signatures[parseInt(a,10)])},g.changeSignature=function(a){g.selectedSignature=a,d.pushGACode("selectSignature"),d.pushIWACode("selectSignature"),g.$emit("composition:mark-as-modified")},g.$on("directive:dialog:toggle",function(){f(function(){j.scrollIntoView()},150,!1)}),g.updateName=function(){g.isTooLong=g.signatureName.length>=50},i()},templateUrl:"/composition/views/signature.html"}}]),angular.module("nxt-composition").directive("nxtSimpleDropdown",["$document","$rootScope","$timeout","ApplicationConfig",function(a,b,c,d){"use strict";return{restrict:"A",scope:{nxtSimpleDropdownOpened:"="},link:function(e,f,g){function h(){A||(a.on("click",m),A=!0)}function i(){A&&(a.off("click",m),A=!1)}function j(){B||(w.on("click",l),B=!0)}function k(){B&&(w.off("click"),B=!1)}function l(a){b.$broadcast("hideAllPanels"),z=!0,o(),f.addClass("nxt-simple-dropdown-opened"),C||(h(),k()),a&&a.stopPropagation()}function m(a){z=!1,f.removeClass("nxt-simple-dropdown-opened"),C||(i(),j()),a&&a.stopPropagation()}function n(){"undefined"!=typeof g.nxtSimpleDropdownOpened&&(C=!0),m()}function o(){if(z&&(r||(r=Math.max(document.documentElement.clientHeight,window.innerHeight||0)),t=v.getBoundingClientRect(),x.css({width:v.offsetWidth+"px",maxHeight:r-t.bottom-y+"px"}),null!==v.getAttribute("data-position-absolute")?(s=v.offsetParent,s&&x.css({position:"absolute",top:s.offsetHeight+"px",left:s.offsetLeft+"px"})):d.env.device.isMobile||x.css({top:t.bottom+"px",left:t.left+"px"}),d.env.device.isMobile&&window.screen&&window.screen.height)){var a=48,b=window.screen.height-window.screen.height%a;x.css({maxHeight:b+"px"})}}function p(){c.cancel(u),o()}function q(){c.cancel(u),u=c(function(){o(),e.$digest()},150,!1)}var r,s,t,u,v=f[0].querySelector("[nxt-simple-dropdown-activator]")||f[0],w=angular.element(v),x=angular.element(f[0].querySelector("[nxt-simple-dropdown-content]")),y=5,z=!1,A=!1,B=!1,C=!1;e.$on("hideAllPanels",function(){m()}),e.$on("movable:moved",p),e.$on("simpleDropDown:updateDropdownPosition",p),angular.element(window).on("scroll orientationchange",q),e.$watch("nxtSimpleDropdownOpened",function(a){a?l():m()}),e.$on("$destroy",function(){w.off(),a.off("click",m),angular.element(window).off("scroll orientationchange",q)}),n()}}}]),angular.module("nxt-composition").directive("nxtSimpleDropdownUpdateOnScroll",function(){"use strict";return{restrict:"A",link:function(a,b){b.on("scroll",function(){var b=document.getElementsByClassName("sticky")[0],c=angular.element(document.getElementsByClassName("message-section-container"))[0],d=c.scrollTop,e=angular.element(b).parent(),f=e.prop("offsetTop");b&&d>f?document.getElementsByClassName("sticky")[0].classList.add("active"):b&&document.getElementsByClassName("sticky")[0].classList.remove("active"),a.$broadcast("simpleDropDown:updateDropdownPosition")}),a.$on("$destroy",function(){b.off("scroll")})}}}),angular.module("nxt-composition").directive("nxtUpdateCompositionSize",["ApplicationConfig","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){if(!c.isSimplified&&!a.env.device.isMobile){var e,f,g,i,j,k,l,m,n,o,p=5,q=.9,r=!c.isFloatWindow&&c.rightColumnMin&&c.isHTML?102:64,s=document.getElementById("wrapper").clientHeight,t=150,u=0;h&&(c.isSimplified?(e=null,r=0,f=h.querySelector(".simplified-content-input"),g=h.querySelector(".composition-subject-wrapper"),q=1,t=a.env.device.isMobile?80:130):(e=h.querySelector(".mce-toolbar-grp"),f=h.querySelector("iframe"),g=h.querySelector(".composition-subject-wrapper")),c.dialogid&&(k=document.querySelector('[nxt-id="'+c.dialogid+'"]'),k&&(l=k.getBoundingClientRect(),o=angular.element(k).hasClass("maximized")),m=document.querySelector('[nxt-id="'+c.dialogid+'"] .dialog-header'),n=m&&m.offsetHeight||65),e&&(f&&g&&o?(i=e.getBoundingClientRect(),j=g.getBoundingClientRect(),Array.prototype.forEach.call(h.querySelectorAll("[nxt-count-height]"),function(a){u+=a.offsetHeight}),f.style.minHeight=i.top-j.bottom-u-p+"px"):f&&f.style.minHeight&&(f.style.minHeight=null),t=r+n,angular.element(e).css({height:!c.isFloatWindow&&c.rightColumnMin?71:r+"px"}),d.css({marginBottom:r+"px"}))),"embeded"!==c.mode&&(d.css({maxHeight:q*s-t+"px"}),a.env.device.isMobile&&d.css({maxHeight:s-r+"px"}),l&&b(function(){l.bottom>s&&c.$emit("ac:update")},0,!1))}}function f(){var a;c.isFloatWindow||(a=c.rightColumnMin&&c.isHTML?102:64,d.css({marginBottom:a+"px"}))}function g(a){b(function(){c.isFloatWindow||(c.rightColumnMin=a,f(),c.$digest())},0,!1)}var h=d[0];c.isFloatWindow="embeded"!==c.mode,c.rightColumnMin=a.env.isRightColumnMin,a.env.device.isSmarthpone||(c.$on("composition:onchange",e),c.$on("directive:dialog:toggle",function(){b(e,100,!1)}),c.$on("tinymce:switched-editor-mode",function(a,d){b(function(){c.isHTML=d.isHTML,f(),d.isHTML&&e(),c.$digest()},0,!1)}),c.$on("tinymce:init",function(){e(),b(e,1500,!1)}),c.$on("composition:updateSize",e),c.$on("directive:column-resize:right-column-min",function(){g(!0)}),c.$on("directive:column-resize:right-column-greater",function(){g(!1)})),c.$on("$destroy",function(){angular.element(window).off("resize",e)}),angular.element(window).on("resize",e),e()}}}]),angular.module("nxt-contact").directive("nxtContact",["Contact","Blacklist","ContactGroup","ApplicationConfig","Search","$rootScope","Compositions","Folder","Track",function(a,b,c,d,e,f,g,h,i){"use strict";var j=[{id:a.EMAIL_TYPE_PRIVATE,name:"Prywatny"},{id:a.EMAIL_TYPE_BUSINESS,name:"Służbowy"},{id:a.EMAIL_TYPE_OTHER,name:"Inny"}],k=[{id:a.PHONE_TYPE_PRIVATE,name:"Prywatny"},{id:a.PHONE_TYPE_BUSINESS,name:"Służbowy"},{id:a.PHONE_TYPE_OTHER,name:"Inny"}];return{restrict:"EA",replace:!0,scope:{contact:"=?nxtContactData",isExpanded:"=?nxtContactIsExpanded",isGroupEdited:"=?nxtContactIsGroupEdited",selectedGroup:"=?nxtContactSelectedGroup",isModeExpanded:"=?nxtContactIsModeExpanded",isModeSelect:"=?nxtContactIsModeSelect"},templateUrl:"/contact/views/contact.html",controller:["$scope",function(d){return d.isModeExpanded=void 0===d.isModeExpanded||d.isModeExpanded,c.query().then(function(a){d.groups=a}),b.query().then(function(a){d.contact.isOnBlacklist=a.indexOf(d.contact.email)!==-1}),d.edit=function(){f.$broadcast("directive:contact:edit",d.contact)},d.createNewMessage=function(){g.addComposition({to:d.contact,allowOwnEmails:!0})},d.newMessage=function(a){i.pushGACode("contactListClick"),i.pushIWACode("contactListNewMessage"),g.addComposition({toActive:a,allowOwnEmails:!0})},d.showMailingHistory=function(){e.searchHistory(d.contact.email)},d.addNewFilter=function(){f.$broadcast("controller:filter:quickdialog",{email:d.contact.email})},d.addToBlacklist=function(){b.addToBlacklist(d.contact).then(function(){d.contact.isOnBlacklist=!0})},d.removeFromBlacklist=function(){b.removeFromBlacklist(d.contact).then(function(){d.contact.isOnBlacklist=!1})},d.deleteContact=function(){a.deleteContact(d.contact)},d.getEmailType=function(a){var b="";return j.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},d.getGroupName=function(a){var b="";return d.groups.some(function(c){return c.id==a&&(b=c.name,!0)}),b},d.getPhoneType=function(a){var b="";return k.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},d.addToSelectedGroup=function(){void 0===d.contact.originalGroups&&(d.contact.originalGroups=d.contact.groups.slice()),d.contact.groups.push(d.selectedGroup.id),d.$emit("contact:add-to-selected-group",d.contact),i.pushGACode("contactAddToGroup"),i.pushIWACode("contactAddToGroup")},d.removeFromSelectedGroup=function(){void 0===d.contact.originalGroups&&(d.contact.originalGroups=d.contact.groups.slice());var a=d.contact.groups.indexOf(d.selectedGroup.id);d.contact.groups.splice(a,1),d.$emit("contact:remove-from-selected-group",d.contact)},d.$watch("isExpanded",function(b){b&&!d.contact.isLoaded&&d.contact.id&&a.get({id:d.contact.id,type:d.contact.type}).then(function(a){d.contact=angular.extend(d.contact,a),d.contact.isLoaded=!0})}),d.$watch("isGroupEdited",function(a){a&&(d.isExpanded=!1,d.isInSelectedGroup=d.contact.groups.indexOf(d.selectedGroup.id)!==-1)}),d.$on("controller:contact:group-edit:cancel",function(){d.contact.originalGroups&&(d.contact.groups=d.contact.originalGroups)}),d.$on("controller:contact:goto",function(a,b){b.id===d.contact.id&&(d.isExpanded=!0)}),d}]}}]),angular.module("nxt-contact").directive("nxtContactEdit",["Contact","ContactGroup","ApplicationConfig","Notification",function(a,b,c,d){"use strict";var e=[{id:a.EMAIL_TYPE_PRIVATE,name:"Prywatny"},{id:a.EMAIL_TYPE_BUSINESS,name:"Służbowy"},{id:a.EMAIL_TYPE_OTHER,name:"Inny"}],f=[{id:a.PHONE_TYPE_PRIVATE,name:"Prywatny"},{id:a.PHONE_TYPE_BUSINESS,name:"Służbowy"},{id:a.PHONE_TYPE_OTHER,name:"Inny"}];return{restrict:"EA",replace:!0,scope:{contact:"=?nxtContactData"},templateUrl:"/contact/views/edit.html",controller:["$scope",function(g){function h(){var a,b=g.contact.emails.length;for(a=0;a<b;a++)if(g.contact.emails[a].id===-666)return!0;return!1}var i=angular.copy(g.contact,i),j=i.emails.filter(function(a){return i.email==a.value}).pop(),k={email:!1,groups:!1,tel:!1};return g.emailPattern=c.patterns.email,g.phonePattern=c.patterns.phone,g.specialCharsPattern=c.patterns.specialChars,g.isCorp=c.env.isCorp,g.contact.newEmail||(g.contact.newEmail={}),g.contact.newGroup||(g.contact.newGroup=null),g.contact.newPhone||(g.contact.newPhone={}),g.groups=[],g.EMAIL_GROUPS=[],b.query().then(function(a){g.groups=a,g.EMAIL_GROUPS=a,g.EMAIL_GROUPS=[{id:null,name:"Brak wybranej grupy"}].concat(g.EMAIL_GROUPS)}),g.$on("service:contact-group:save",function(a,b){g.groups.push(b)}),g.getEmailType=function(a){var b="";return e.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},g.getGroupName=function(a){var b="";return g.groups.some(function(c){return c.id==a&&(b=c.name,!0)}),b},g.getPhoneType=function(a){var b="";return f.some(function(c){return c.id==a.type&&(b=c.name,!0)}),b},g.setDefaultEmail=function(a){g.contact.email=g.contact.emails[a].value,j=g.contact.emails[a]},g.deleteEmail=function(a){g.contact.emails.splice(a,1)},g.deletePhone=function(a){g.contact.phones.splice(a,1)},g.addNewEmail=function(){void 0!==g.contact.newEmail.type&&g.contact.newEmail.value&&(g.contact.emails.push(g.contact.newEmail),g.contact.newEmail={})},g.addToGroup=function(){g.contact.newGroup&&(g.contact.groups.push(g.contact.newGroup),g.contact.newGroup=null)},g.addNewPhone=function(){void 0!==g.contact.newPhone.type&&g.contact.newPhone.value&&(g.contact.phones.push(g.contact.newPhone),g.contact.newPhone={})},g.removeFromGroup=function(a){g.contact.groups.splice(a,1)},g.submit=function(){return g.addNewEmail(),g.addToGroup(),g.addNewPhone(),!g.isCorp&&h()?(d.error("service:contact:save:specialContact"),!1):void a.save(g.contact).then(function(a){g.contact=angular.extend(g.contact,a),delete g.contact.newEmail,delete g.contact.newGroup,delete g.contact.newPhone,g.$emit("directive:contact:edit-save",g.contact)})},g.selectClose=function(a,b){k[b]&&(a.focusser=angular.element('<span style="display:none;"></span>'),a.close(!0)),k[b]=!k[b]},g.reset=function(){g.$emit("directive:contact:close"),g.contact.id&&(g.contact=angular.copy(i,g.contact))},g.$on("controller:contact:edit-cancel",function(){g.reset()}),g.$on("controller:contact:has-contact-change",function(){var a=!angular.equals(i,g.contact);g.$emit("directive:contact:has-contact-change",a)}),g.$watch("contact",function(a){a.avatar[0].initial=(a.name||"").substr(0,1),a.emails&&(a.email=a.emails.filter(function(a){return!!j&&a.type==j.type}).pop(),a.email?a.email=a.email.value:a.emails[0]&&(a.email=a.emails[0].value),g.EMAIL_TYPES=e.filter(function(b){return!a.emails.some(function(a){return b.id===a.type})})),g.EMAIL_TYPES.length&&void 0===g.contact.newEmail.type&&(g.contact.newEmail.type=g.EMAIL_TYPES[0].id),a.phones&&(g.PHONE_TYPES=f.filter(function(b){return!a.phones.some(function(a){return b.id===a.type})})),g.PHONE_TYPES.length&&void 0===g.contact.newPhone.type&&(g.contact.newPhone.type=g.PHONE_TYPES[0].id),a.groups&&(g.EMAIL_GROUPS=g.groups.filter(function(b){return a.groups.indexOf(b.id)===-1}),g.EMAIL_GROUPS=[{id:null,name:"Brak wybranej grupy"}].concat(g.EMAIL_GROUPS))},!0),g}]}}]),angular.module("nxt-crop").directive("nxtImgCrop",["$timeout","CropHost","CropPubSub","ScopeService",function(a,b,c,d){"use strict";return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",resultImageWidth:"=",resultImageHeight:"=",resultImageFormat:"@",resultImageQuality:"=",resultDoNotUpdate:"=",cropX:"=",cropY:"=",cropWidth:"=",cropHeight:"=",cropDataInPercentage:"=",cropResetWrapperSelector:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(a){a.events=new c}],link:function(c,e){var f=c.events;c.cropInitParams={cropX:c.cropX,cropY:c.cropY,cropWidth:c.cropWidth||190,cropHeight:c.cropHeight||95,cropDataInPercentage:c.cropDataInPercentage||!1,cropResetWrapperSelector:c.cropResetWrapperSelector||"",resultImageWidth:c.resultImageWidth||180,resultImageHeight:c.resultImageHeight||90};var g,h=new b(e.find("canvas"),{},f,c.cropInitParams),i=function(a){var b={};if(a.resultDoNotUpdate)return b={resultImage:null,cropData:h.getCropData()},void a.onChange({$dataURI:b});var c=h.getResultImageDataURI();if(g!==c){g=c,angular.isDefined(a.resultImage)&&(a.resultImage=c);var d=h.getCropData();b={resultImage:a.resultImage,cropData:d},a.onChange({$dataURI:b})}},j=function(b){return function(){a(function(){d.safeApply(c,function(a){b(a)})})}};f.on("load-start",j(function(a){a.onLoadBegin({})})).on("load-done",j(function(a){a.onLoadDone({})})).on("load-error",j(function(a){a.onLoadError({})})).on("area-move area-resize",j(function(a){a.changeOnFly&&i(a)})).on("area-move-end area-resize-end image-updated",j(function(a){i(a)})),c.$watch("image",function(){h.setNewImageSource(c.image)}),c.$watch("areaType",function(){h.setAreaType(c.areaType),i(c)}),c.$watch("resultImageHeight",function(){h.setResultImageSize(c.resultImageWidth,c.resultImageHeight),i(c)}),c.$watch("resultImageFormat",function(){h.setResultImageFormat(c.resultImageFormat),i(c)}),c.$watch("resultImageQuality",function(){h.setResultImageQuality(c.resultImageQuality),i(c)}),c.$watch(function(){return[e[0].clientWidth,e[0].clientHeight]},function(a){a[0]>0&&a[1]>0&&(h.setMaxDimensions(a[0],a[1]),i(c))},!0),c.$on("$destroy",function(){h.destroy()})}}}]),angular.module("nxt-composition").directive("nxtAutoHeight",["$timeout",function(a){var b,c=112;return{restrict:"A",link:function(d,e){function f(){a(function(){var a=e.parent().parent()[0].getBoundingClientRect().height-c;e.css({height:a+"px"})},50,!1)}function g(){a.cancel(b),b=a(function(){f()},100)}f(),angular.element(window).on("resize",g),d.$on("$destroy",g)}}}]),angular.module("nxt-dialog").directive("nxtDialog",["DialogManager","$rootScope","$timeout","ApplicationConfig","$state","Track","$window",function(a,b,c,d,e,f,g){return{restrict:"A",transclude:!0,scope:{params:"=nxtParams",title:"@nxtTitle",template:"@nxtTemplate",id:"@nxtId"},link:function(h,i,j){function k(){i.parent().removeClass("maximized-wrapper")}function l(){i.parent().toggleClass("maximized-wrapper")}function m(){c(function(){i.addClass("moving")},200),c(function(){i.removeClass("moving")},400),c(function(){i.addClass("moving")},600),c(function(){i.removeClass("moving")},800),h.$broadcast("composition:forced-focus")}switch(h.links=d.links,h.isCorp=d.env.isCorp,h.data={},h.minimized=!1,h.maximized=!1,h.params.additionalClasses&&i.addClass(h.params.additionalClasses),h.params.isModal&&(i.parent().addClass("maximized-wrapper"),h.params.isBackgroundCloseable&&angular.element(i.parent()).on("click",function(){h.close()})),h.$on("composition:getDefaults",function(){var a=h.params.compositionConfig||{opt:"n"};h.$broadcast("composition:defaultsProvided",a)}),h.params.dialogType){case a.DialogTypes.CONFIRM:i.addClass("dialog--confirm");break;case a.DialogTypes.SPECIAL_BOARD:i.addClass("dialog--special-board")}h.remove=function(){h.$broadcast("directive:dialog:close"),i.parent().removeClass("maximized-wrapper"),a.remove(j.nxtId)},h.close=function(){b.$broadcast("tooltip:hide"),h.remove(),h.params.callbackClose()},h.cancel=function(){h.remove(),h.params.callbackCancel()},h.success=function(){h.params.success?h.params.success.call(h,h.data):(h.remove(),h.params.callback.call(null,h.data))},h.folderConfirmSuccess=function(a,b,c,d){h.params.callback(a,b,c,d),h.close()},h.toggleMaximize=function(){i.toggleClass("maximized"),l(),i.removeClass("minimized"),h.$broadcast("directive:dialog:toggle",i.hasClass("maximized")),h.$broadcast("simpleDropDown:updateDropdownPosition"),h.maximized=i.hasClass("maximized"),h.minimized=i.hasClass("minimized"),b.$broadcast("hideAllPanels"),h.params.callbackMaximize(i),h.$broadcast("composition:scroll-to-top")},h.toggleMinimize=function(){i.toggleClass("minimized"),i.removeClass("maximized"),k(),h.$broadcast("directive:dialog:toggle",i.hasClass("maximized")),h.$broadcast("simpleDropDown:updateDropdownPosition"),h.maximized=i.hasClass("maximized"),h.minimized=i.hasClass("minimized"),b.$broadcast("hideAllPanels"),h.params.callbackMinimize(i),f.pushIWACode("dialogNewMailMin",h.minimized?"minimalizuj":"_przywroc")},h.unMinimize=function(){h.minimized&&h.toggleMinimize()},h.pushStat=function(a,b){b&&("iwa"==a?(b=b.split("|"),f.pushIWA(b)):"iwaCode"==a?f.pushIWACode(b):"ga"==a?(b=b.split("|"),f.pushGA(b)):"gemius"==a&&f.pushGemius(b))},h.pushStatIWACode=function(a,b){f.pushIWACode(a,b)},h.openNewTab=function(a){d.hacks.isIOS&&a.indexOf("itunes.apple.com/app/apple-store/")!=-1?g.open(a,"_self"):g.open(a,"_blank")},h.$on("dialog:update-title",function(a,b){h.title=b}),h.$on("composition:loaded",function(){i.removeClass("loading")}),d.env.device.isMobile||(h.$on("dialog:demaximize",function(){h.maximized&&h.toggleMaximize()}),h.$on("dialog:remove-shadow",k),h.$on("dialog:blink",function(a,b){h.params&&h.params.id===b&&(m(),h.$emit("movable:show-on-top"))})),h.$on("directive:dialog:close-composition",function(){h.close()}),h.$on("frame-login:success",function(g,i){i.login!==d.env.ownEmail?location.href=location.href.split("?")[0]:h.params.dialogType===a.DialogTypes.SESSION_EXPIRED&&c(function(){d.env.uid=i.uid,d.env.sid=i.sid,d.cacheTime=Date.now(),b.$broadcast("frame-login:success-ready"),e.go(e.current,{iwa_source:"log_sesja"},{reload:!0}),f.pushIWA(["plansza","wygasla_sesja","klik","zaloguj"]),h.close()},0)}),h.$on("frame-login:failed",function(){i.addClass("frame-login-failed")}),h.$on("$destroy",function(){angular.element(i.parent()).off("click")})},templateUrl:function(){return d.env.device.isMobile?"/dialog/views/dialog_mobile.html":"/dialog/views/dialog.html"}}}]),angular.module("nxt-dialog").directive("nxtDialogList",function(){"use strict";return{restrict:"A",scope:{},controller:["$scope","DialogManager","ApplicationConfig",function(a,b,c){return a.dialogs=b.getList(),a.isMobile=c.env.device.isMobile,a.mailConfirmAllowed=c.env.mailConfirmAllowed,a}],templateUrl:"/dialog/views/dialogList.html"}}),angular.module("nxt-folder").directive("nxtAttachments",["$q","$rootScope","$timeout","ApplicationConfig","ApplicationData","Attachments","FileClassFinder",function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=a/(b/p),d=2*p;return c>d&&(c=d),c}function i(a,b){var c;a.thumbsCnt?(c=document.createElement("img"),c.className="msglist-attachments-thumbnail",d.env.device.isMobile||c.setAttribute("data-tooltip",a.name),c.onload=function(){b.resolve(!0)},c.src=a.thumbUrl,c.style.width=h(a.imgWidth,a.imgHeight)+"px",c.__attachmentName__=a.name):(c=document.createElement("div"),c.className="msglist-attachments-thumbnail msglist-attachments-thumbnail--icon icon-file-image",d.env.device.isMobile||c.setAttribute("data-tooltip",a.name),c.setAttribute("data-extension",a.extension),c.__attachmentName__=a.name);var e=document.createElement("li");e.className="msglist-attachments-item";var f=e.appendChild(c);return f.parentNode.style.width=f.style.width,e}var j=5,k=["p7s"],l=42,m=30,n=d.env.device.isMobile?-4:2,o="-33px",p=40;return{restrict:"EA",replace:!0,templateUrl:"/folder/views/attachments.html",scope:{message:"=nxtAttachmentsData",attachmentsCollapsed:"=nxtAttachmentsCollapsed"},controller:["$scope","$state",function(a,b){return a.attachments=a.message.atta,a.isCollapsed=void 0===a.attachmentsCollapsed||a.attachmentsCollapsed,a.isMoreAttachments=!1,a.attachments=a.attachments.map(function(a){if(a.extension=a.name.split(".").pop().toLowerCase(),a["class"]=g.getFileClass(a.extension),d.env.device.isPc&&"pdf"!==a.extension&&(a.url=a.urlDownload),k.indexOf(a.extension)!==-1&&(a.isHidden=!0),a.imgInfo){var b=a.imgWidth,c=a.imgHeight;switch(a.imgInfo.orientation){case 5:case 6:case 7:case 8:a.imgWidth=c,a.imgHeight=b}}return a}),a.images=a.attachments.filter(function(a){return"image"==a.type}),a.openSlideshow=function(c){var d=c.target;if(d.__attachmentName__){var e=a.message.atta.filter(function(a){return"image"===a.type});b.go(".slideshow",{attachments:e,attachmentName:d.__attachmentName__}),c.preventDefault(),c.stopPropagation()}},a.openAtt=function(a,b){f.openAtt(a,b)},a.stopDownload=function(a){d.hacks.isFirefox&&e.getIsRequesting()&&(a.preventDefault(),a.stopPropagation())},a}],link:function(e,f){function g(){var a=angular.element(f[0].lastElementChild),b=(f[0].scrollWidth-m)%l+n;a.css("right",b+"px")}function h(){c.cancel(q),q=c(function(){e.loadImages()},100)}var k=f.children()[0],p=null;e.isOverflow=function(){return f[0].offsetHeight<k.offsetHeight},e.loadImages=function(){var b,c,h=0,l=[];if(e.isOverflow()===!1){for(;e.images.length&&(h<j||e.isCollapsed===!1);)c=a.defer(),l.push(c.promise),b=i(e.images.shift(),c),p=p?k.insertBefore(b,p.nextSibling):k.insertBefore(b,k.firstChild),h++;l.length&&a.all(l).then(function(){e.loadImages()}),e.isCollapsed&&(e.isMoreAttachments=!1)}else e.isMoreAttachments=!0;d.hacks.isAndroidDefault&&angular.element(f[0]).css({"margin-right":o}),e.isMoreAttachments===!0&&g()};var q;angular.element(window).on("resize",h),b.$on("service:message:resize-handler",function(){h()}),e.$watch("isCollapsed",function(a){a===!1&&c(function(){e.loadImages()},0)}),e.loadImages(),e.$on("$destroy",function(){angular.element(window).off("resize",h)})}}}]),angular.module("nxt-folder").directive("nxtListAdv",["$timeout","ScopeService",function(a,b){"use strict";var c=15e3;return{restrict:"A",link:function(d){function e(){b.safeApply(d,function(){d.isOpen=!1})}d.isOpen=!0,a(function(){e()},c,!1)}}}]),angular.module("nxt-folder").directive("nxtMobileCalendarInput",["$rootScope","DialogManager",function(a,b){"use strict";return{restrict:"A",scope:{ngModel:"=",nxtMobileCalendarMax:"=",nxtMobileCalendarMin:"="},link:function(c,d,e){function f(){b.mobileCalendar({additionalData:{date:c.ngModel,inputName:e.nxtMobileCalendarInput,maxDate:c.nxtMobileCalendarMax,minDate:c.nxtMobileCalendarMin}}),a.$broadcast("directive:mobile-calendar:change-state",!0)}d.on("click",function(){f()}),c.$on("$destroy",function(){d.off()})}}}]).directive("nxtMobileCalendar",["$rootScope",function(a){"use strict";var b=["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"];return{restrict:"A",scope:{},link:function(c,d,e){function f(){c.day=o.getDate(),c.month=b[o.getMonth()],c.year=o.getUTCFullYear()}function g(a){var b=angular.copy(o);return b.setDate(o.getDate()+a),b}function h(a){var b=angular.copy(o);return b.setMonth(o.getMonth()+a),b}function i(a){var b=angular.copy(o);return b.setYear(o.getFullYear()+a),b}function j(a,b){var d=m(p),e=a(-1);e<d?c.inactiveArrows[b]=!0:c.inactiveArrows[b]=!1}function k(a,b){var d=m(q),e=new Date,f=a(1);f>d||f>e?c.inactiveArrows[b]=!0:c.inactiveArrows[b]=!1}function l(){p&&(j(g,"dayDown"),j(h,"monthDown"),j(i,"yearDown")),k(g,"dayUp"),k(h,"monthUp"),k(i,"yearUp")}function m(a){var b=a.split("-");return new Date(b[0],b[1]-1,b[2])}function n(){return o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2)}var o,p=e.nxtMobileCalendarMin,q=e.nxtMobileCalendarMax;c.inactiveArrows={dayUp:!1,dayDown:!1,monthUp:!1,monthDown:!1,yearUp:!1,yearDown:!1},o=e.nxtMobileCalendarDate?m(e.nxtMobileCalendarDate):q?m(q):new Date,f(),l(),c.changeDay=function(a){o=g(a),l(),f()},c.changeMonth=function(a){o=h(a),l(),f()},c.changeYear=function(a){o=i(a),l(),f()},c.success=function(){"dateFrom"==e.nxtMobileCalendar?a.$broadcast("directive:mobile-caledar:set-date-from",n()):"dateTo"==e.nxtMobileCalendar&&a.$broadcast("directive:mobile-caledar:set-date-to",n()),c.$parent.success()},c.cancel=function(){a.$broadcast("directive:mobile-calendar:change-state",!1),c.$parent.cancel()}},templateUrl:"/folder/views/mobile_calendar.html"}}]),angular.module("nxt-folder").directive("nxtScrollToLastPos",["$timeout","ApplicationConfig",function(a,b){"use strict";var c,d=3e3,e=0,f=0;return{restrict:"A",scope:{firstMessage:"=nxtScrollToLastPos"},link:function(g,h){if(b.env.isMobileApp){var i=h[0];h.on("touchend",function(){e=i.scrollTop,f=Date.now(),g.firstMessage&&(c=g.firstMessage.uniqueId)}),g.$on("folder:scroll:last-pos",function(){a(function(){Date.now()-f<d||(g.firstMessage&&g.firstMessage.uniqueId!==c?i.scrollTop=0:i.scrollTop=e)},0)}),g.$on("$destroy",function(){h.off("touchend")})}}}}]),angular.module("nxt-folder").directive("nxtScrollToPage",["$timeout",function(a){"use strict";return{restrict:"A",link:function(b,c){var d=c[0];b.$on("folder:scroll:page",function(c,e){a(function(){var a=document.getElementById("message-"+e.id);a?(d.scrollTop=a.parentElement.parentElement.offsetTop,b.$broadcast("scrollToPage:ready")):d.scrollTop=d.scrollHeight},0)})}}}]),angular.module("nxt-folder").directive("nxtSearch",["Folder","Search","Track","ApplicationConfig","$rootScope","$timeout","$stateParams","$filter",function(a,b,c,d,e,f,g,h){"use strict";return{restrict:"EA",replace:!0,scope:{isExpanded:"=?nxtSearchIsExpanded"},templateUrl:function(){return d.env.device.isMobile?"/folder/views/search_mobile.html":"/folder/views/search.html"},controller:["$scope",function(i){function j(){return h("filter")(i.suggestions,i.phrase)}function k(){return j().length<i.phraseLimit?j().length:i.phraseLimit}function l(){i.selectedSuggestIndex=(i.selectedSuggestIndex+1)%k()}function m(){i.selectedSuggestIndex=i.selectedSuggestIndex>0?(i.selectedSuggestIndex-1)%k():k()-1}var n=!1,o=!1;return i.datePattern=d.patterns.date,i.isMobile=d.env.device.isMobile,i.phrase=b.getPhrase(),i.historyPhrase=b.getHistoryPhrase(),i.filters=b.getFilters(),i.suggestions=[],i.selectedSuggestIndex=-1,i.phraseLimit=5,i.folders=[],i.historyPhrase&&(i.filters.from=i.historyPhrase,i.filters.to=i.historyPhrase),i.isSearchFormActive=!1,i.areFiltersEmpty=b.areFiltersEmpty(),i.isSearchAdvanced=i.historyPhrase||!i.areFiltersEmpty,i.isExpanded=i.isExpanded||i.phrase||i.historyPhrase||!i.areFiltersEmpty,i.leftColumnMin=d.env.isLeftColumnMin,i.leftPreColumnMin=d.env.isLeftPreColumnMin,i.open=function(){i.isExpanded===!1&&f(function(){document.querySelector("#search").focus()},250,!1),f(function(){i.isSearchFormActive=!0,i.isExpanded=!0,d.isSearchExpanded=!0,i.loadSuggestions()},0,!1)},i.labelClick=function(a){i.isExpanded?(i.search(),a.preventDefault()):i.open()},i.close=function(){f(function(){i.isSearchFormActive=!1,d.env.device.isMobile||(i.datePickerToShow=!1),i.isSearchAdvanced&&i.isSearchFormActive?(i.isSearchAdvanced=!1,c.pushGACode("searcherAdvanceClose")):(i.isSearchFormActive=!1,i.isExpanded=!1,d.isSearchExpanded=!1,i.clearAll(),c.pushGACode("searcherClose"),c.pushIWACode("searcherClose"))},0)},i.focusOut=function(){d.env.device.isMobile?o||(i.isSearchFormActive=!1,i.phrase||angular.equals(i.filters,{})===!1||(i.isExpanded=!1,d.isSearchExpanded=!1)):(g.search||(i.phrase="",i.filters={}),i.phrase||(i.isExpanded=!1,d.isSearchExpanded=!1),i.isSearchFormActive=!1,i.datePickerToShow=!1,i.datePickerFromShow=!1)},a.query().then(function(a){var b=a.filter(function(a){return"Wszystkie foldery"==a.name});b.length||a.unshift({name:"Wszystkie foldery",folder:null,id:null}),i.folders=a}),i.loadSuggestions=function(){b.suggestions().then(function(a){i.suggestions=a})},d.env.device.isMobile||(e.$on("directive:column-resize:left-column-min",function(){i.leftColumnMin=!0}),e.$on("directive:column-resize:left-column-greater",function(){i.leftColumnMin=!1}),e.$on("directive:column-resize:left-pre-column-min",function(){i.leftPreColumnMin=!0}),e.$on("directive:column-resize:left-pre-column-greater",function(){i.leftPreColumnMin=!1})),d.env.device.isMobile&&(e.$on("directive:mobile-caledar:set-date-from",function(a,b){i.filters.date_from=b,o=!1}),e.$on("directive:mobile-caledar:set-date-to",function(a,b){i.filters.date_to=b,o=!1}),e.$on("directive:mobile-calendar:change-state",function(a,b){o=b}),e.$on("directive:search:close",function(){i.close()})),i.search=function(){!i.phrase&&angular.equals(i.filters,{})||(b.clearFilters(),i.isSearchAdvanced&&angular.equals(i.filters,{})===!1?b.search(i.phrase,i.filters):i.filters.isSearchInContent?b.search(i.phrase,{isSearchInContent:!0}):angular.equals(i.filters,{})===!1?b.search(i.phrase,i.filters):b.search(i.phrase))},i.searchSuggestion=function(a){i.phrase=a,i.search()},i.searchFrom=function(a){i.filters={from:a},i.searchSuggestion()},i.searchTo=function(a){i.filters={to:a},i.searchSuggestion()},i.clearAll=function(){i.phrase=b.getPhrase(),(i.isSearchAdvanced||i.phrase||i.historyPhrase||angular.equals(i.filters,{})===!1)&&(b.clearAll(),b.refresh())},i.removeSuggestion=function(a){var d=i.suggestions[a];b.removeSuggestion(d).then(function(){i.suggestions.splice(a,1)}),c.pushIWACode("removeSuggestSearch")},i.selectSearchFolder=function(a){n&&(a.focusser=angular.element('<span style="display:none;"></span>'),a.close(!0)),n=!n},i.keyUp=function(a){var b=a.keyCode;return b===d.keyCodes.ARROW_DOWN?void l():b===d.keyCodes.ARROW_UP?void m():void 0},i.keyDown=function(a){var b=a.keyCode;b===d.keyCodes.NEWLINE&&i.selectedSuggestIndex!=-1&&(a.preventDefault(),i.searchSuggestion(j()[i.selectedSuggestIndex]))},i}],link:function(a,b){var c=b[0].querySelector("#search");a.blur=function(){c.blur()},a.$watchCollection("filters",function(){var b="Szukaj",c=[];a.phrase||angular.equals(a.filters,{})||(a.filters.from&&c.push("Od: "+a.filters.from),a.filters.to&&c.push("Do: "+a.filters.to),c.length||!a.filters.date_from&&!a.filters.date_to||(c.push("Zakres dat:"),a.filters.date_from&&c.push(a.filters.date_from),a.filters.date_to&&c.push("- "+a.filters.date_to)),!c.length&&a.filters.folder&&a.folders.some(function(b){return b.id==a.filters.folder&&(c.push("Szukaj w: "+b.name),!0)}),b=c.join(" ")),a.placeholder=b})}}}]),angular.module("nxt-message").directive("nxtAddClassWhenOverflowed",["$timeout",function(a){
"use strict";return{restrict:"A",link:function(b,c,d){a(function(){c.prop("offsetHeight")<c.prop("scrollHeight")&&c.addClass(d.nxtAddClassWhenOverflowed)},50,!1)}}}]),angular.module("nxt-message").directive("nxtMessageIframe",["$rootScope","$timeout","ApplicationConfig","InfoBoards","DialogManager","Track","Compositions","ScopeService","$http",function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m="inpl-get-adjustMailbox-links",n="inpl-get-adjustMailbox",o="inpl-get-adjustMailbox-img",p="inpl-get-adjustMailbox-map",q=[];return{restrict:"EA",replace:!0,template:'<iframe src="about:blank" frameBorder="0"></iframe>',scope:{message:"=?nxtMessageIframeData"},link:function(r,s){function t(){return R||(N=M.contentDocument||M.contentWindow.document,Array.prototype.forEach.call(N.body.querySelectorAll("[data-inpl-src]"),function(a){S.push(angular.element(a))}),R=!0),S}function u(){M.style.width="100%",b(function(){N&&N.body&&b(function(){if(N&&N.body){M.style.width=N.body.scrollWidth+"px";for(var b=N.getElementsByTagName("table"),c=[],d=0;d<b.length;d++)c.push(b[d].scrollWidth);var e=Math.max.apply(null,c);N.body.scrollWidth<e&&(M.style.width=e+"px");var f=Math.max(N.body.scrollHeight,N.body.offsetHeight);M.style.height=f+"px"}a.$broadcast("directive:scale-image")},0,!1)},0,!1)}function v(a){b.cancel(K),a=a||100,K=b(u,a,!1)}function w(){var a,b;O||(O=!0,J=N.querySelector(".inpl-collapsed"),J&&(b=J.querySelector("blockquote")),J&&b&&b.classList.contains("nxt-original-message-notrevealed")&&(a=J.getBoundingClientRect(),J=angular.element(J),!J||J.hasClass("noHidden")||r.message.forwardedFrom||(Q=J.attr("style"),J.removeAttr("style"),J.attr("title","Wyświetl treść wiadomości"),J.addClass("hiddenBlockquote"),M.style.height=a.top+30+"px",J.on("click",function(){var a=angular.element(this);J.off("click"),a.removeClass("hiddenBlockquote"),a.attr("style",Q),a.attr("title",""),v()}))))}function x(b){if("UPDATE_SIZE"===b.data&&N){var d=c.env.currentThemeSaved||c.env.themeSelected,e=102===d.id&&!c.env.device.isMobile;angular.element(window).off("message",x);var f=N.querySelector("head"),g=angular.element(f),h=N.getElementsByTagName("base").length>=1;h||g.append('<base target="_blank" />');var i=N.querySelector("#iframe-outside-style");null===i&&(i=document.createElement("style"),i.type="text/css",i.id="iframe-outside-style",f.appendChild(i));var j=""+e+"_"+a.isGallery+"_"+r.message.msgType;if(j!==L){var k,l="body.inpl-mailing{background-color:rgba(255,255,255,.7)}";try{var m=window.getComputedStyle(N.querySelector("body"),null).backgroundColor.match(/\d{1,3}/g);angular.isArray(m)&&m.length>=3||(m=[0,0,0,0]),k=.299*m[0]+.587*m[1]+.114*m[2]}catch(b){k=0}var n=230;k<n&&(l+="body.inpl-not-mailing{color:#FFF}body.inpl-not-mailing a{color:#318FCD}body.inpl-not-mailing .content1,body.inpl-not-mailing .content2{color:black;background-color:#f7f8f9}");var o="html{overflow-y:hidden;white-space: normal;}";o+=c.hacks.isIOS?"":"html{word-wrap:break-word;word-break: break-all;}",o+=e?l:"",o+="body.inpl-not-mailing{font-family:Roboto,sans-serif;font-size:14px;line-height:1.4em;margin:1px}pre{white-space:pre-wrap;word-wrap:break-word}.hiddenBlockquote>*{display:none!important}.hiddenBlockquote{margin:5px 0 0;overflow:hidden;height:16px;width:23px}.hiddenBlockquote:before{display:block!important;border:1px solid #D7D7D7;background-color:#F7F7F7;color:#757575;width:21px;height:14px;line-height:14px;font-size:14px;text-align:center;cursor:pointer;cursor:hand;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;content:'•••'}[data-nxt-blocked-image] {cursor: default !important;}",o+=2===a.isGallery?".public_gallery_body{-webkit-filter:grayscale(1);filter:grayscale(1)}":"",o+="@media screen and (max-width:605px){body.inpl-mailing{-webkit-text-size-adjust:none}.inpl-mailing table.tableC{width:100%;height:auto}.inpl-mailing table{max-width:100%}.inpl-mailing table:first-of-type{width:100%;height:auto}}",i.innerHTML=o}L=j,w(),v()}}function y(a){a.stopPropagation(),a.preventDefault()}function z(){var a;P||(a=t(),a.forEach(function(a){a.on("click",y)}))}function A(){for(var b=N.getElementsByTagName("a"),c=0;c<b.length;c++){var d=b[c];d.getAttribute("href")&&"mailto:"==d.getAttribute("href").substring(0,7).toLowerCase()&&(d.onclick=function(b){var c=b.target.getAttribute("href").substring(7);h.safeApply(a,g.addComposition({to:{email:c},autoFocusContent:!0})),b.preventDefault()})}}function B(a){var b=q.indexOf(a);b!==-1&&q.splice(b,1)}function C(a){var b,d=t(),e=[],f=[];if(a=a||!1,P)d.forEach(function(a){a.removeAttr("src"),a.attr("data-nxt-blocked-image")}),P=!1,a&&B(r.message.id),M.style.height=0,v();else{for(d.forEach(function(a){a.on("load",function(){c.env.device.isMobile?v(500):v()}),a.attr("src",a.attr("data-inpl-src")),a.removeAttr("data-nxt-blocked-image"),a.off("click",y)}),document.querySelectorAll&&(e=N.body.querySelectorAll("[data-inpl-style]"),f=N.body.querySelectorAll("[data-inpl-background]")),b=0;b<e.length;b++)e[b].setAttribute("style",e[b].getAttribute("data-inpl-style")),e[b].removeAttribute("data-inpl-style");for(b=0;b<f.length;b++)f[b].setAttribute("background",f[b].getAttribute("data-inpl-background")),f[b].removeAttribute("data-inpl-background");a&&q.push(r.message.id),P=!0}r.$emit("message:forced-show-images",P)}function D(){v(500)}function E(){var a=N.body.querySelector(".public_gallery_body");a&&(a.querySelector(":first-child").onclick=function(){f.pushIWACode("messageOpenPublicGallery")},a.querySelector(".public_gallery_body_img").onclick=function(){f.pushIWACode("messageOpenPublicGalleryPhoto")})}var F,G,H,I,J,K,L,M=s[0],N=null,O=!1,P=!1,Q="",R=!1,S=[],T=null,U=null,V=null,W=null;r.messageIframe=r.message.content,r.confirmMessageDisplay=function(a){e.confirm({title:"Potwierdzenie odczytu",message:"Nadawca prosi o potwierdzenie odczytania tej wiadomości.<br>Czy chcesz wysłać takie potwierdzenie?",confirm:"Tak",cancel:"Nie",callback:function(){var b=a.message;i.post("/mail/"+b.id+"/confirm")}})},r.$watch("messageIframe",function(b){if(b&&(M.contentDocument||M.contentWindow)&&(M.onload=function(){v(),z();var b=M.contentDocument||M.contentWindow.document;if(k=function(){var a=document.getElementsByClassName("sticky")[0],b=angular.element(document.getElementsByClassName("message-section-container"))[0],c=b.scrollTop,d=angular.element(a).parent(),e=d.prop("offsetTop");a&&c>e?document.getElementsByClassName("sticky")[0].classList.add("active"):a&&document.getElementsByClassName("sticky")[0].classList.remove("active")},b.body.addEventListener("touchmove",k,!1),b.body.onclick=function(b){a.$broadcast("ui-events:click",{panel:"message",target:b.currentTarget}),b.target.className.indexOf("nxt-slideshow")===-1&&b.target.parentNode.className.indexOf("nxt-slideshow")===-1||(b.preventDefault(),r.$emit("message:content:open-slideshow"),f.pushGACode("welcomeMailingDetails")),a.$broadcast("message:iframe:touch")},b.body.querySelector("a.nxt-slideshow")&&f.pushGACode("welcomeMailingShow"),E(),angular.element(b.body).addClass(r.message&&r.message.isMailing?"inpl-mailing":"inpl-not-mailing"),r.message.isMailing){var d=M.contentWindow.document.querySelectorAll(".inpl-inline-attachment");1==d.length&&(d[0].style.maxWidth="100%",d[0].style.height="initial",c.hacks.isIE&&(d[0].style.width="100%",d[0].style.height="auto"))}if(c.env.isMobileApp)for(var e=M.contentWindow.document.querySelectorAll("a"),g=0;g<e.length;g++)e[g].setAttribute("target","_top");a.$broadcast("message:iframe:onload")},angular.element(window).on("message",x),M.style.height=0,N=M.contentDocument||M.contentWindow.document,q.indexOf(r.message.id)!==-1?(P=!0,N.write(b.replace(/<img ([^>]* )?src="(.*?)"([^>]* )?data-inpl-src="(.*?)"/g,'<img $1src="$4"$2data-inpl-src="$4"')),r.$emit("message:forced-show-images",!0)):N.write(b.replace(/<img ([^>]* )?data-inpl-src="(.*?)"/g,'<img $1data-inpl-src="$2" data-nxt-blocked-image')),N.write("<script>if (parent && parent.postMessage) {parent.postMessage('UPDATE_SIZE', '*');}</script>"),N.close(),A(),T=N.getElementById(m),T&&(function(){if(c.env.device.isMobile&&c.hacks.isIOS&&!c.env.device.isMobileApp)for(var a=N.getElementsByTagName("a"),b=0;b<a.length;b++){var d=a[b];d.href.startsWith("https://itunes.apple.com/app/")&&(d.onclick=function(a){window.location="https://itunes.apple.com/app/apple-store/id1141842988?pt=584558&ct=mail_powitalny_but&mt=8&ls=1",a.preventDefault()})}}(),T.style.display="block",U=N.getElementById(n)))){c.env.device.isMobile||(U.onclick=function(a){d.getBoardConfById(210).then(function(a){e.multiBoards(a.options)}),a.preventDefault()});try{V=N.getElementById(o),V.removeAttribute("usemap"),W=N.getElementById(p),W.parentNode.removeChild(W)}catch(g){}}}),F=a.$on("service:message:show-images",function(){C(!0)}),H=a.$on("service:message:show-images-always",function(){P=!1,C(!0)}),G=a.$on("service:message:resize-handler",function(){D()}),I=a.$on("settings:theme:adjust-iframe-style",function(){var a={data:"UPDATE_SIZE"};x(a)}),angular.element(window).on("resize",D),r.$on("$destroy",function(){var a;R&&(a=t(),a.forEach(function(a){a.off("click"),a.off("load")})),s.unbind(),N&&N.body&&(N.body.onclick=null,N.body.removeEventListener("touchstart",j),N.body.removeEventListener("touchmove",k),N.body.removeEventListener("touchend",l)),M.onload=null,N=null,F(),H(),G(),I(),angular.element(window).off("message",x),J&&"function"==typeof J.off&&J.off("click"),angular.element(window).off("resize",D)});var X=r.message;X.confirm&&!X.ifRead&&r.confirmMessageDisplay(r)}}}]),angular.module("nxt-message").directive("nxtScaleMessage",["ApplicationConfig","Track","$timeout","$interval","$window",function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l,m,n=!1,o=150,p=5e3;return{restrict:"A",scope:{sender:"=?nxtScaleMessageSender"},link:function(q,r){function s(){k=(new Date).getTime(),h=f[0].offsetWidth,i=f[0].scrollWidth,h<i&&(n||(j=angular.element("<div></div>"),j.addClass("scale-button"),f.parent().append(j),b.pushIWACode("messageShowMagnifier",q.sender)),n=!0,u())}function t(b){var d;a.hacks.isAndroidDefault&&f.css({position:"",overflow:"","-webkit-transform":"",transform:"","-webkit-transform-origin":"",transformOrigin:"",height:"",minHeight:""}),c(function(){g&&g[0]&&(d=g[0].offsetHeight*b,f.css({position:"relative",overflow:"","-webkit-transform":"scale("+b+")",transform:"scale("+b+")","-webkit-transform-origin":"top left",transformOrigin:"top left",height:d+"px",minHeight:d+"px"}),(a.env.device.isPc||a.env.device.isIOS&&e.screen.width>=768)&&(f.css({width:i+"px",height:""}),f.next().css({marginTop:-g[0].offsetHeight+d+"px"})),m=g[0].offsetHeight)},0)}function u(a){w();var b=h/i;m=g[0].offsetHeight,t(b),l=d(function(){var a=(new Date).getTime()-k>p;g&&g[0]&&g[0].offsetHeight==m?a&&w():t(b)},o,l),j.removeClass("scale-button--zoomout"),j.off().on("click",v),NXT_CONFIG.isMessageScaleUp=!1,a&&a.stopPropagation()}function v(c){c&&b.pushIWACode("messageZoomInMagnifier",q.sender),w(),f.css({"-webkit-transform":"",transform:"",height:f[0].scrollHeight+"px",minHeight:f[0].scrollHeight+"px",overflow:"scroll"}),(a.env.device.isPc||a.env.device.isIOS&&e.screen.width>=768)&&(f.css({minHeight:f[0].scrollHeight+15+"px",overflowY:"hidden",width:""}),f.next().css({marginTop:0})),a.hacks.isAndroidDefault&&(f.css({height:"",minHeight:"",overflow:""}),a.hacks.AndroidVersion>4.3&&f.css({"overflow-x":"scroll","overflow-y":"scroll"})),j.addClass("scale-button--zoomout"),j.off().on("click",u),NXT_CONFIG.isMessageScaleUp=!0,c&&c.stopPropagation()}function w(){l&&d.cancel(l)}q.$parent.firstFullMessage.isMailing||(f=angular.element(r[0]),g=f[0].getElementsByTagName("iframe"),q.$on("directive:scale-image",function(){g?s():c(function(){g=f[0].getElementsByTagName("iframe"),g&&s()},1e3)}),q.$on("$destroy",function(){j&&j.off(),n=!1,w(),NXT_CONFIG.isMessageScaleUp=!1}))}}}]),angular.module("nxt-navigation").directive("nxtFolderListScroll",["$timeout","$window","ApplicationConfig","ScopeService","Track",function(a,b,c,d,e){"use strict";var f=c.env.service&&"int"===c.env.service.name,g=f?130:139,h=40,i=52,j="navigationIsHidden";return{restrict:"A",link:function(f,k){function l(){var a=s[s.length-1].offsetHeight;return Math.floor((r-a-i-h)/t)}function m(){k.css({height:r+"px"}),v=l(),d.safeApply(f,function(){f.switcherVisible=v<s.length-2});for(var a=v;a<s.length-1;a++)angular.element(s[a]).css({display:"none"});k.css({height:"inherit"})}function n(){v=l(),d.safeApply(f,function(){f.switcherVisible=v<s.length-2});for(var a=0;a<s.length-1;a++)angular.element(s[a]).css({display:"block"});k.css({height:r+"px"})}function o(){s&&(q=k.parent().parent()[0].offsetHeight,r=q-g,f.isHidden&&r<u?(n(),m()):n())}if(f.switcherVisible=!1,!c.env.device.isMobile){if(f.isHidden=!0,b.localStorage)try{b.localStorage.getItem(j)&&(f.isHidden="true"===b.localStorage.getItem(j),f.isHidden&&e.pushIWACode("folderListScrollView"))}catch(p){}var q,r,s,t,u,v;if(a(function(){s=k.find("li"),u=k[0].offsetHeight,t=s[0].offsetHeight,q=k.parent().parent()[0].offsetHeight,r=q-g,o()}),f.toogle=function(){var a=f.isHidden?"folderListScrollShow":"folderListScrollHide";if(f.isHidden?n():m(),e.pushIWACode(a),f.isHidden=!f.isHidden,b.localStorage)try{b.localStorage.setItem(j,f.isHidden)}catch(c){}},"undefined"!=typeof ResizeObserver){var w=new ResizeObserver(function(){o()});w.observe(k.parent().parent()[0])}else f.$on("folderListScroll:resize",function(){setTimeout(function(){o()},1050)}),angular.element(window).on("resize",o),f.$on("$destroy",function(){angular.element(window).off("resize",o)})}}}}]),angular.module("nxt-notification").directive("nxtMailNotification",["$interval","$rootScope","$timeout","ApplicationConfig","Messages",function(a,b,c,d,e){"use strict";function f(){!k&&h&&(k=!0,h.play(),h.addEventListener("ended",g))}function g(){k=!1,h.removeEventListener("ended",g)}var h,i=d.folders.SPAM,j=d.folders.MAILINGI,k=!1;return{restrict:"A",replace:!0,templateUrl:"/notification/views/mailNotification.html",scope:{},controller:["$scope","Folder","Message",function(a,b,c){return a.messages=[],a.$on("service:longpoll:success",function(b,d){d.inLastHour&&c.get({id:d.id,leaveAsUnread:!0}).then(function(b){b.folderId!==i&&b.folderId!==j&&(a.messages.push(b),f())})}),a.$on("folder:controller:showAvatars",function(){a.avatarsShowed=d.env.showAvatars}),b.queryAsMap().then(function(b){a.foldersMap=b.all}),a}],link:function(f){function i(a){for(var b=0;b<f.messages.length;b++)a.uniqueId==e.getUniqueId(f.messages[b])&&f.messages.splice(b,1)}f.activeIndex=0,f.avatarsShowed=d.env.showAvatars,f.prev=function(){f.activeIndex=f.activeIndex-1,f.activeIndex<0&&(f.activeIndex=f.messages.length-1)},f.next=function(){f.messages.length&&(f.activeIndex=(f.activeIndex+1)%f.messages.length)},f.remove=function(){f.messages=[],f.activeIndex=0},f.openMessage=function(a){f.$emit("controller:folder:open-message",a),f.remove()},f.markAsFavorite=function(a){f.$emit("controller:folder:mark-as-favorite",a),f.$emit("message-to-folder:star-message-on-list",a)},f.$on("service:messages:move-to-trash",function(a,b){i(b.messages[0])}),b.$on("ui-events:click",function(){f.messages.length&&c(f.remove,5e3)}),a(f.next,5e3),f.audioNotification=d.env.audioNotificationId,f.audioNotification&&(f.audioFile=d.env.staticUrl+"/au/"+f.audioNotification,c(function(){h=document.getElementById("audioNotification"),h||c(function(){h=document.getElementById("audioNotification")},500)},0)),f.$on("$destroy",function(){h&&(h.removeEventListener("ended",g),h=null)})}}}]),angular.module("nxt-notification").directive("nxtMainNotification",["$interval","$timeout","$rootScope","DialogManager","$http","ApplicationConfig","MobileApp","Notification","$state","Track",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){function a(){i.go("^")}b(function(){d.confirm({message:'Przekroczono limit transferu.<br> Skontaktuj się z <a href="mailto:pomoc@firma.interia.pl" class="link">Biurem Obsługi Klienta</a>',callback:a,callbackClose:a,additionalClasses:"transferLimit",confirm:"Zamknij"}),c.$digest()},0,!1)}var l=2,m=0,n=document.title,o={2602:k,2603:k};return c.$on("ui-events:click",function(){m&&(m=0,document.title=n)}),{restrict:"A",replace:!0,templateUrl:"/notification/views/mainNotification.html",scope:{},controller:["$scope","$timeout","Notification",function(b,c,d){b.notifications=[],b.removeNotification=function(a){b.notifications.splice(a,1)},b.removeNotificationByMessageId=function(a){for(var c=0;c<b.notifications.length;c++)if(b.notifications[c].messageId===a){b.notifications.splice(c,1);break}},f.env.device.isMobile&&b.$on("notification:remove:all",function(){b.notifications=[]}),b.$on("http:response:error",function(a,b){404!==b.status&&(b.data&&b.data.msg?f.env.isMobileApp&&Object.keys(o).indexOf(b.data.code.toString())!=-1?o[b.data.code]():d.error(b.data.msg,!1,b.data.code):f.env.isMobileApp?"/next/ping"!==b.config.url.slice(-10)&&g.connectionError():d.error("Problem z połączeniem internetowym, proszę odświeżyć stronę"))}),b.stopInterval=function(){void 0!==b.interval&&(a.cancel(b.interval),b.interval=void 0)},b.timeToClose=function(a){c(function(){b.removeNotificationByMessageId(a)},6e3)}}],link:function(a){a.$on("service:notification:new",function(b,c){a.callback=h.getOnClickCallback(c.messageId);var d=a.notifications.some(function(a){return a.message==c.message});d===!1&&(a.notifications.length>l&&(a.stopInterval(),a.notifications.shift()),f.env.device.isMobile&&document.getElementsByClassName("section--folder")[0]&&(document.getElementsByClassName("notification-container")[0].style.top=0),a.notifications.push(c),c.noClose||a.timeToClose(c.messageId))}),a.$on("service:notification:info",function(a,b){d.info({title:b.title,message:b.message.split("\n").join("<br>"),confirm:"Zamknij",additionalClasses:"notification-info",code:b.code,success:function(){1014===b.code&&j.pushIWACode("infoboardBlockSmtpClose"),this.remove()}})}),a.$on("service:notification:close",function(b,c){a.removeNotificationByMessageId(c.messageId)}),a.$on("$destroy",function(){a.stopInterval()})}}}]),angular.module("nxt-public-gallery").directive("nxtPublicGallery",["ApplicationConfig","$rootScope","Gallery","Track","$timeout",function(a,b,c,d,e){"use strict";var f=0,g=1;return{restrict:"A",scope:{message:"=?nxtPublicGalleryMessage",options:"=?nxtPublicGalleryOptions"},controller:["$scope",function(b){if(a.env.device.isPc){switch(b.options=b.options||{},b.isGallery=!0,b.galleryOn=!0,b.stateCss="",b.env=a.env,b.links=a.links,b.message&&(b.message.folderId!=a.folders.SENT&&(b.galleryOn=!1),b.isGallery=b.message.gallery.state,b.isContent=b.message.gallery.content),void 0!==b.$parent.isGalleryState&&(b.isGallery=b.$parent.isGalleryState,b.isGalleryDraft=!0),b.isGallery){case 0:b.stateCss="disabled";break;case 2:b.stateCss="block"}return b}}],link:function(a,h){var i=!1,j=!1;a.compositionId=a.$parent.compositionId||a.message.id,a.isSaving=!1,e(function(){if(a.isGallery&&a.message){var b=document.createElement("div"),c=document.getElementById("public-gallery-content");c&&(c.appendChild(b).innerHTML=a.message.gallery.content,d.pushGemius("16LrQGMyZMOkG555zOOOKPUIzXaRwKcS3ijYddoo46..L7"))}},0,!1),a.changeState=function(d){if(d==g&&c.changeState(a.compositionId,g),a.message)c.changeState(a.message.id,d).then(function(){a.isGallery=d;var b=angular.element(h[0].querySelector(".public-gallery-panel"));1==d&&b.hasClass("disabled")&&b.removeClass("disabled"),0===d&&b.addClass("disabled")});else{a.isGallery=d;var e=angular.element(h[0].querySelector(".public-gallery-panel"));1==d&&e.hasClass("disabled")&&(e.removeClass("disabled"),b.$broadcast("directive:publicGallery:isGallery",d)),0===d&&(c.changeState(a.compositionId,f),e.addClass("disabled"),b.$broadcast("directive:publicGallery:isGallery",d))}},a.hitGemius=function(a){d.pushGemius(a)},a.openMenu=function(){if(!i){a.compositionId=a.$parent.compositionId||a.message.id;var d=angular.element(h[0].querySelector(".public-gallery-panel-options")).hasClass("dropdown-icon--arrowup");d&&0!==a.isGallery&&(c.changeState(a.compositionId,g),i=!0)}j&&(a.isSaving=!0,j=!1,b.$broadcast("composition:save"))},b.$on("directive:publicGallery:completeUpload",function(){a.isSaving=!1}),b.$on("directive:publicGallery:progressall",function(){a.isSaving=!0}),b.$on("directive:publicGallery:removeAttachment",function(){j=!0}),b.$on("directive:composition:saved-finish",function(){a.compositionId=a.$parent.compositionId||a.message.id,a.isSaving=!1})},templateUrl:function(){return"/public-gallery/views/main.html"}}}]),angular.module("nxt-settings").directive("nxtCarousel",["$rootScope","$state","$timeout","ApplicationConfig","ApplicationData","Theme",function(a,b,c,d,e,f){return{restrict:"A",transclude:!0,templateUrl:"/settings/views/carousel.html",link:function(a,g,h){function i(){a.carouselMode||a.isWizard||(a.fakeThemes=[],c.cancel(s),s=c(function(){var b=t.querySelector(".settings-skin:last-child");if(b)for(var c=b.offsetWidth,d=b.offsetHeight,e=parseInt(window.getComputedStyle(b).marginRight,10),f=t.offsetWidth,g=t.offsetHeight,h=t.querySelectorAll(".settings-skin").length+1,i=Math.floor(f/(c+e))*Math.floor(g/d)-h,j=0;j<i;j++)a.fakeThemes[j]=j},50))}function j(){var a=parseInt(l());k(!1,a,!1),i()}function k(b,c,d){if(q){var e=q.offsetWidth*z-2*y,f=v+c-(e-50),g=f>=-w;a.disabledPrev=c>=0,a.disabledNext=f<=0,a.withoutButtons=a.disabledPrev&&a.disabledNext,d&&(b?c<=0&&r.css({marginLeft:c+"px"}):g&&r.css({marginLeft:c+"px"}))}}function l(){return r.css("margin-left")||"0px"}function m(){c(function(){q=document.querySelector(".settings-container"),p=t.querySelector(".settings-skins"),o=t.querySelector(".settings-skins-carousel"),r=angular.element(o),k(!1,0,!1),i(),angular.element(window).on("resize",j),a.$digest()},0,!1)}function n(){c(function(){angular.element(window).off("resize",j),a.$digest()},0,!1)}var o,p,q,r,s,t=g[0],u=0,v=0,w=134,x=d.env.device.isPc;a.isWizard=a.$parent.isWizard=h.nxtCarouselWizard,a.carouselMode=!d.env.device.isMobile&&!a.isWizard;var y=x?39:19,z=x?.52:1;d.env.currentThemeSelected=d.env.currentThemeSelected||d.env.themeSelected,d.env.lastThemeSelected=d.env.lastThemeSelected||d.env.themeSelected,d.env.currentThemeSaved=d.env.currentThemeSaved||d.env.themeSelected,d.env.currentUserThemeSaved=d.env.currentUserThemeSaved||d.env.themesUser[0],a.themeSelected=d.env.currentUserThemeSaved,a.activeId=d.env.currentThemeSelected.id,a.carouselWithoutButtons=!1,a.disabledPrev=!0,a.disabledNext=!1,a.withoutButtons=a.disabledPrev&&a.disabledNext,a.isIOS=d.hacks.isIOS,a.isIpad=d.hacks.isIpad,a.isCorp=d.env.isCorp,a.hideUserSkinSelect=a.isCorp,a.fakeThemes=[],a.hasUserHadOwnSkin=function(){return void 0!==a.themeSelected},a.themeBaseUrl=d.env.attachBaseUrl,a.themeSelected&&(a.themeSelected.thClass="C422",a.themeSelected.thXLClass="C459"),f.query().then(function(b){a.themes=b,d.env.userThemes=a.themes.filter(function(a){return"2"===a.type}),a.themes=a.themes.filter(function(a){return"2"!==a.type}),u=a.themes.length,v=(u+(a.hideUserSkinSelect?0:1))*w,m()}),a.addTheme=function(){a.$broadcast("controller:settings:addTheme")},a.selectTheme=function(c){a.activeId=c.id,d.env.currentThemeSelected=c,a.isWizard&&(a.$parent.selectedTheme=c),a.$broadcast("controller:settings:selectTheme",{theme:c,isSave:!a.isWizard}),a.isWizard||b.go("^")},a.selectDefaultTheme=function(){a.selectTheme(a.themes[0])},a.selectPreviousUserTheme=function(){angular.extend(a.themeSelected,e.getUserSkinMainObject(a.themeSelected.id)[0]),a.$emit("controller:settings:setAndSaveUserTheme",a.themeSelected),b.go("^")},a.$on("settings:close",function(){n()}),a.prev=function(){var a=parseInt(l())+w;k(!0,a,!0)},a.next=function(){a.$broadcast("bubble:close",-1);var b=parseInt(l())-w;k(!1,b,!0)}}}}]),angular.module("nxt-settings").directive("nxtTheme",["$rootScope","$state","$timeout","ApplicationData","ApplicationConfig","Notification","Theme","ThemeUploader","Track","DialogManager",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l={cFullHD:"C124",c640px:"C117",c480px:"C121"};return{restrict:"A",controller:["$scope",function(b){return b.$on("controller:settings:selectTheme",function(c,d){g.changeSkin(d.theme),d.isSave&&(g.select(d.theme.id).then(function(){b.clearAllUserThemesSelected(),e.env.currentThemeSaved=d.theme,a.$broadcast("settings:theme:adjust-iframe-style")}),i.pushGACode("settingPanelChangeSkin",d.theme.name),i.pushIWACode("settingPanelChangeSkin",d.theme.name))}),b.$on("controller:settings:setAndSaveUserTheme",function(a,c){b.setUserTheme(c.id,c.attachment,c),g.changeSkin(c),b.updateUserBackground(),b.saveUserTheme(c)}),b}],link:function(h){function i(a){return e.env.attachBaseUrl+"/-/"+(e.env.currentThemeSelected.attachmentCropped||e.env.currentThemeSelected.attachment)+"-"+a+"."+e.env.currentThemeSelected.attachmentExt}function m(){c(function(){n=document.querySelector("#userBackground")},0,!1)}var n;h.openUserThemeWindow=function(){return h.isWizard?void(h.$parent.userThemeStep=1):(j.userTheme({title:"Prześlij swoje zdjęcie tła"}),h.$broadcast("settings:close"),void b.go("^"))},h.saveUserTheme=function(b,c){g.selectUserThemeJSON(b).then(function(){c&&f.success("uploader:theme-added"),h.clearPreviousUserThemeSelected(),e.env.currentThemeSaved=e.env.currentThemeSelected,e.env.currentUserThemeSaved=e.env.currentThemeSelected,a.$broadcast("settings:theme:adjust-iframe-style")})},h.setUserTheme=function(a,b,c){var f=d.getUserSkinMainObject(a)[0];e.env.currentThemeSelected={name:f.name,id:a,cssName:f.cssName,cssFile:f.cssFile,type:"2",attachment:b||e.env.currentThemeSelected.attachment,attachmentCropped:c?c.attachmentCropped:e.env.currentThemeSelected.attachmentCropped,x:c?c.x:e.env.currentThemeSelected.x,y:c?c.y:e.env.currentThemeSelected.y,width:c?c.width:e.env.currentThemeSelected.width,height:c?c.height:e.env.currentThemeSelected.height,attachmentExt:"jpg"};var h=101===e.env.currentThemeSelected.id?"white":"black",j=101===e.env.currentThemeSelected.id?"-F10":"-F9",m=i(l.cFullHD+j);return k="body, .contact-new-form, .contact-container, .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+i(l.cFullHD+j)+") no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }",k+="@media (min-width: 890px) { .isMobile .msglist-section-container { background: transparent; }}",k+="body.isAndroidBrowser, .isAndroidBrowser .contact-new-form, .isAndroidBrowser .contact-container, .isAndroidBrowser .settings-user-info:before, .isAndroidBrowser.isMobile .msglist-section-container, .isAndroidBrowser.isMobile .message-header { background-attachment: scroll !important; }",k+="@media (max-width: 640px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+i(l.c640px+j)+") no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }}",k+="@media (max-width: 640px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll !important; }}",k+="@media (max-width: 480px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+i(l.c480px+j)+") no-repeat left top !important; background-size: cover !important; background-attachment: fixed !important; background-color: "+h+" !important; }}",k+="@media (max-width: 480px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll !important; }}",e.env.lastThemeSelected=e.env.currentThemeSelected,b||g.changeSkin(e.env.currentThemeSelected),m},h.updateUserBackground=function(){var a=document.createTextNode(k);n.appendChild(a)},h.clearPreviousUserThemeSelected=function(){for(;n.childNodes.length>=2;)n.removeChild(n.firstChild)},h.clearAllUserThemesSelected=function(){for(;n.childNodes.length>=1;)n.removeChild(n.firstChild)},h.clearCurrentUserThemeSelected=function(){for(var a="2"===e.env.currentThemeSaved.type?1:0;n.childNodes.length>a;)n.removeChild(n.lastChild);g.changeSkin(e.env.currentThemeSaved)},h.showLoader=function(){a.$broadcast("directive:theme:showLoader")},m()}}}]),angular.module("nxt-settings").directive("nxtUserTheme",["$rootScope","$state","$timeout","ApplicationData","ApplicationConfig","Theme","ThemeUploader","DialogManager","Notification",function(a,b,c,d,e,f,g,h,i){"use strict";var j,k={cFullHD:"C124",c640px:"C117",c480px:"C121"};return{restrict:"A",controller:["$scope",function(a){return a}],link:function(b,l){function m(){c(function(){s=u.querySelector(".upload-butt"),t=document.querySelector("#userBackground"),b.$digest()},0,!1),n()}function n(){b.uploader=g.getUploader(b)}function o(a){return e.env.attachBaseUrl+"/-/"+(e.env.currentThemeSelected.attachmentCropped||e.env.currentThemeSelected.attachment)+"-"+a+"."+e.env.currentThemeSelected.attachmentExt}function p(){c(function(){b.showLoadingIndicator=!0,b.$digest()},0,!1)}function q(){c(function(){b.showLoadingIndicator=!1,b.$digest()},0,!1)}function r(a){if("undefined"==typeof a)return a;var b=d.getUserSkinMainObject(a.id)[0],c={name:b.name,id:a.id,cssName:b.cssName,cssFile:b.cssFile,type:"2",attachment:a.attachment,attachmentCropped:a.attachmentCropped,attachmentExt:a.attachmentExt,x:a.x,y:a.y,width:a.width,height:a.height,thXLClass:"C306"};return c}var s,t,u=l[0];b.themeMiniatureExt="jpg",b.USER_THEME_LIGHT_TYPE=101,b.USER_THEME_DARK_TYPE=102,b.selectedUserThemeId=b.USER_THEME_DARK_TYPE,b.previewTheme=r(e.env.currentUserThemeSaved)||{},b.cropData={x:b.previewTheme.x,y:b.previewTheme.y,width:b.previewTheme.width,height:b.previewTheme.height,boxWidth:173,boxHeight:98},b.isWizard&&(b.cropData.boxWidth=137,b.cropData.boxHeight=89),b.userThemeId=b.previewTheme.id||b.USER_THEME_LIGHT_TYPE,b.themeBaseUrl=e.env.attachBaseUrl,b.cropFullBackgroundImage=b.themeBaseUrl+"/-/"+b.previewTheme.attachment+"-"+b.previewTheme.thXLClass+"."+b.previewTheme.attachmentExt+"|"+b.previewTheme.attachment,b.afterCropImage="",b.changeSkinPhase=0,b.onChange=function(a){b.afterCropImage=a.resultImage,b.cropData=a.cropData},b.hasUserHadOwnSkin=function(){return Boolean(b.previewTheme.attachment)},b.$watch("userThemeId",function(a,c){angular.equals(a,c)||b.setUserTheme(a)}),b.addUserTheme=function(){b.uploader.fileInputClick(u.querySelector(".skin-upload-frame--normal"),s)},b.setUserTheme=function(a,c){var e=d.getUserSkinMainObject(a)[0];b.previewTheme={name:e.name,id:a,cssName:e.cssName,cssFile:e.cssFile,type:"2",attachment:c||b.previewTheme.attachment,attachmentExt:"jpg",thXLClass:"C306"},b.cropFullBackgroundImage=b.themeBaseUrl+"/-/"+b.previewTheme.attachment+"-"+b.previewTheme.thXLClass+"."+b.previewTheme.attachmentExt+"|"+b.previewTheme.attachment},b.goToFirstSkinPhase=function(){b.changeSkinPhase=0},b.goToSecondSkinPhase=function(){b.changeSkinPhase=1},b.cropAndSaveUserTheme=function(){var a={};a.id=b.userThemeId,a.attachment=b.userThemeAttachment||b.previewTheme.attachment,a.attachmentExt=b.themeMiniatureExt,b.cropUserTheme(a),b.isWizard&&b.nextStep(!0)},b.cropUserTheme=function(a){var c=~~b.cropData.x,d=~~b.cropData.y,g=~~b.cropData.width,h=~~b.cropData.height;f.cropUserTheme(a.attachment,c,d,g,h,e.env.uid).then(function(c){var d=c.cropped.attachmentId,e=c.cropped.x||e,f=c.cropped.y||f,g=c.cropped.width||g,h=c.cropped.height||h;
d&&(b.previewTheme.attachmentCropped=a.attachmentCropped=d,b.previewTheme.x=a.x=e,b.previewTheme.y=a.y=f,b.previewTheme.width=a.width=g,b.previewTheme.height=a.height=h,b.saveUserTheme(a))},function(){b.close()})},b.saveUserTheme=function(c){f.selectUserThemeJSON(c).then(function(){i.success("uploader:theme-added"),e.env.currentThemeSelected=b.previewTheme,e.env.currentThemeSaved=e.env.currentThemeSelected,e.env.currentUserThemeSaved=e.env.currentThemeSelected;var c=101===e.env.currentThemeSelected.id?"white":"black",d=101===e.env.currentThemeSelected.id?"-F10":"-F9";j="body, .contact-new-form, .contact-container, .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+o(k.cFullHD+d)+") no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+c+"; }",j+="@media (min-width: 890px) { .isMobile .msglist-section-container { background: transparent; }}",j+="body.isAndroidBrowser, .isAndroidBrowser .contact-new-form, .isAndroidBrowser .contact-container, .isAndroidBrowser .settings-user-info:before, .isAndroidBrowser.isMobile .msglist-section-container, .isAndroidBrowser.isMobile .message-header { background-attachment: scroll; }",j+="@media (max-width: 640px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+o(k.c640px+d)+") no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+c+"; }}",j+="@media (max-width: 640px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll; }}",j+="@media (max-width: 480px) { body.isMobile, .isMobile .contact-new-form, .isMobile .contact-container, .isMobile .settings-user-info:before, .isMobile .msglist-section-container, .isMobile .message-header { background: url("+o(k.c480px+d)+") no-repeat left top; background-size: cover; background-attachment: fixed; background-color: "+c+"; }}",j+="@media (max-width: 480px) { body.isMobile.isAndroidBrowser, .isMobile.isAndroidBrowser .contact-new-form, .isMobile.isAndroidBrowser .contact-container, .isMobile.isAndroidBrowser .settings-user-info:before, .isMobile.isAndroidBrowser .msglist-section-container, .isMobile.isAndroidBrowser .message-header { background-attachment: scroll; }}",e.env.lastThemeSelected=e.env.currentThemeSelected,b.changeSkin(e.env.currentThemeSelected.cssFile),b.updateUserBackground(),b.clearPreviousUserThemeSelected(),a.$broadcast("settings:theme:adjust-iframe-style")}),b.close()},b.changeSkin=function(a){var b,c=document.getElementById("theme-stylesheet");null===c&&(c=document.createElement("link"),c.id="theme-stylesheet",c.rel="stylesheet","DS"===e.env.name?(c.type="text/less",less.sheets.push(c)):c.type="text/css",document.querySelector("head").appendChild(c)),c.setAttribute("href",e.env.staticUrl+"/css/"+a),"ds"===e.env.name&&(less.sheets.length&&(b=less.sheets[0].nextSibling,b&&b.parentNode.removeChild(b)),less.refresh())},b.updateUserBackground=function(){var a=document.createTextNode(j);t.appendChild(a)},b.clearPreviousUserThemeSelected=function(){for(;t.childNodes.length>=2;)t.removeChild(t.firstChild)},b.cancelUserTheme=function(){return b.isWizard?void(b.$parent.userThemeStep=0):void b.close()},b.close=function(){h.removeUserTheme()},b.afterAddingFile=function(){p()},b.afterAddingAll=function(a,c){c&&(b.uploader.clearQueue(),i.error("uploader:theme-size-exceeded"),q())},b.afterProgress=function(){},b.afterProgressAll=function(){},b.afterSuccess=function(a){var d=b.selectedUserThemeId;b.setUserTheme(d,a),b.userThemeAttachment=a,b.userThemeId=d,q(),c(function(){b.uploader.clearQueue(),b.$digest()},0,!1)},b.afterError=function(d){d.response&&d.response.code?(d=d.response,401===d.code?a.$broadcast("http:response:error:sessionExpired",d):403===d.code&&i.error("uploader:theme-token-error")):i.error("uploader:theme-other-error"),q(),c(function(){b.uploader.clearQueue(),b.$digest()},0,!1)},b.afterCompleteAll=function(){},a.$on("frame-login:success-ready",function(){n()}),m()},templateUrl:function(){return e.env.device.isPc?"/settings/views/user_theme.html":"/settings/views/user_theme_mobile.html"}}}]),angular.module("nxt-slideshow").directive("nxtSlideshowImages",["$timeout","ApplicationData","ScopeService",function(a,b,c){"use strict";function d(a,b){var c,d=Math.atan(a.offsetWidth/a.offsetHeight),e=Math.sqrt(Math.pow(a.offsetHeight,2)+Math.pow(a.offsetWidth,2)),f=b*Math.PI/180;return c=b<90?f-d:b<180?f+d:b<270?f-d:f+d,a.offsetHeight/Math.cos(c)/e}function e(a,b){var c=a.indexOf("?f="),d=a.substring(0,c),e=a.substring(c);return angular.forEach(b,function(a,b){d+=","+b+","+a}),a=d+e}function f(){var a={maxwidth:window.innerWidth||document.documentElement.clientWidth,maxheight:window.innerHeight||document.documentElement.clientHeight};return window&&window.devicePixelRatio&&window.devicePixelRatio>1&&(a={maxwidth:a.maxwidth*window.devicePixelRatio,maxheight:a.maxheight*window.devicePixelRatio}),a}return{restrict:"A",scope:{images:"=nxtSlideshowImages"},link:function(g,h){function i(a,b){if(g.images[b]){var c=g.images[b].rotationAngle,e=Math.abs(d(g.images[b],c));a.style.cssText="-webkit-transform: rotate("+c+"deg) scale("+e+");-ms-transform: rotate("+c+"deg) scale("+e+");transform: rotate("+c+"deg) scale("+e+");"}}function j(a){if(g.images&&g.images[a]&&!g.images[a].isLoaded){var b=document.createElement("img"),d=angular.element(h[0].children[a]);b.className="slideshow-photo-image",b.onload=function(){c.safeApply(g,function(){g.images[a].offsetWidth=b.offsetWidth,g.images[a].offsetHeight=b.offsetHeight,g.images[a].isLoaded=!0,i(b,a)})};var j=f();m=j,g.images[a].originalUrl||(g.images[a].originalUrl=g.images[a].url),b.src=e(g.images[a].url,j),d.html("").append(b)}}function k(){a.cancel(n),n=a(function(){var b=f(),c=g.images[l];h.addClass("block-animate"),g.$parent.screenWidth=window.innerWidth||document.documentElement.clientWidth,h.css("width",(g.images.length+1)*g.$parent.screenWidth+"px"),h.css("left",-l*g.$parent.screenWidth+"px"),a(function(){h.removeClass("block-animate")},600);for(var d=0;d<g.images.length;d++)g.images[d].isLoaded=!1;c&&(m.maxwidth<b.maxwidth||m.maxheight<b.maxheight)&&(c.url=e(c.originalUrl,b),j(l))},100)}g.$parent.screenWidth=window.innerWidth||document.documentElement.clientWidth;var l,m,n,o=b.get("slideshowRotates");g.images&&(g.images=g.images.map(function(a){return o&&o[a.mid]&&o[a.mid][a.mpid]&&(a.rotationAngle=o[a.mid][a.mpid]),a})),g.images&&h.css("width",(g.images.length+1)*g.$parent.screenWidth+"px"),g.$parent.$watch("currentIndex",function(a){l=a,h.css("left",-l*g.$parent.screenWidth+"px"),j(l),l>0&&j(l-1),l<g.images.length-1&&j(l+1)}),g.$on("slideshow:image:rotate",function(a,c){var d="left"==c.direction?-90:90,e=angular.element(h[0].children[c.currentIndex]).children()[0];g.images[c.currentIndex].rotationAngle=g.images[c.currentIndex].rotationAngle+d;var f=b.get("slideshowRotates");f||(f={}),f[c.mid]||(f[c.mid]={}),f[c.mid][g.images[c.currentIndex].mpid]=g.images[c.currentIndex].rotationAngle,b.put("slideshowRotates",f),i(e,c.currentIndex)}),angular.element(window).on("resize",k),g.$on("$destroy",function(){if(angular.element(window).off("resize",k),g.images)for(var a=0;a<g.images.length;a++)g.images[a].isLoaded=!1})}}}]),angular.module("nxt-slideshow").directive("nxtSlideshowScroller",["ApplicationConfig",function(a){"use strict";var b=a.env.device.isMobile?83:72;return{restrict:"A",scope:{isLast:"=nxtSlideshowScroller",index:"=nxtSlideshowScrollerIndex"},link:function(a,c){function d(c,d){var e,i,j=c*b,k=parseInt(h.css("left"),10)||0,l=h.prop("offsetWidth")+k;d=d||1,j?(g/2-k/2<j&&(d=-1),i=Math.abs(j-(Math.floor(g/2)-k))):i=Math.floor(g/2),e=f<g?0:d<0?Math.min(l-g,i):Math.min(-k,i);var m=k+d*e;h.css("left",m+"px"),a.$emit("slideshow:leftrightbuttons",{left:m<0,right:m+f-g>0})}var e,f,g=c.prop("offsetWidth"),h=c.children();a.$watch("isLast",function(c){c&&(e=h.children(),f=e.length*b,h.css("width",f+"px"),d(a.index))}),a.$on("controller:slideshow:previousPack",function(){d(null,1)}),a.$on("controller:slideshow:nextPack",function(){d(null,-1)}),a.$on("controller:slideshow:changephoto",function(a,b){d(b.index)})}}}]),angular.module("nxt-common").filter("destroy",function(){"use strict";return function(a){return Array.isArray(a)?a.filter(function(a){return a._destroy!==!0}):a}}),angular.module("nxt-common").filter("safehtml",["$sce",function(a){"use strict";return function(b){return a.trustAsHtml(b)}}]),angular.module("nxt-contact").filter("filterContacts",function(){"use strict";return function(a,b,c,d){return Array.isArray(a)?(d=d||"reverse"===d,b&&(a=a.filter(function(a){return a.name.indexOf(b)!==-1||a.email.indexOf(b)!==-1})),c&&(a=a.filter(function(a){var b=a.groups.indexOf(c);return d?b===-1:b!==-1})),a):a}}),angular.module("nxt-exception").config(["$provide",function(a){"use strict";a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){return function(c,d){var e=b.get("Bugtracker");return e.send({exception:c,message:c?c.message:"empty exception",cause:d}),a.apply(a,arguments)}}])}]),angular.module("nxt-external-account").config(["$provide",function(a){"use strict";a.decorator("ExternalAccount",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("ExternalAccount");return 0===d.prefs.defaultAccount&&(d.prefs.defaultAccount=d.env.ownEmail),a.__query__=a.query,a.query=function(f,g){if(f=f||d.folders.INBOX,e&&e.data&&e.time===d.cacheTime&&f==d.folders.INBOX&&!g){e.data=e.data.map(function(b){return b.service=a.getService(b.email),b.unread=b.totalMsg-b.readMsg,b.defaultSent=b.email===d.prefs.defaultAccount,b});var h=b.when(e.data);return h}return a.__query__(f,g).then(function(a){return c.put("ExternalAccount",{time:d.cacheTime,data:a}),a})},a}])}]),angular.module("nxt-filter").config(["$provide",function(a){"use strict";a.decorator("Blacklist",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("Blacklist");return a.__query__=a.query,a.query=function(){if(e&&e.data&&e.time===d.cacheTime){var f=b.when(e.data);return f}return a.__query__().then(function(a){return c.put("Blacklist",{time:d.cacheTime,data:a}),a})},a}])}]),angular.module("nxt-folder").config(["$provide",function(a){"use strict";a.decorator("Folder",["$delegate","$q","$stateParams","ApplicationData","ApplicationConfig","$rootScope","DialogManager",function(a,b,c,d,e,f,g){function h(a,b){for(var c=a.length;c--;){if(a[c].id==b)return a[c];if(a[c].subfolders){var d=h(a[c].subfolders,b);if(d)return d}}}var i=d.get("Folder");return a.__query__=a.query,a.query=function(){if(i&&i.data&&i.time===e.cacheTime){var c=b.when(i.data);return c}return a.__query__().then(function(a){return d.put("Folder",{time:e.cacheTime,data:a}),a})},a.__queryAsMap__=a.queryAsMap,a.queryAsMap=function(){if(i&&i.data&&i.time===e.cacheTime){var c={all:e.folders,system:e.folders,user:{}};i.data.forEach(function(b){c.all[b.id]=b,a.isUsersFolder(b)?(c.user[b.id]=b,Array.isArray(b.subfolders)&&b.subfolders.forEach(function(a){c.all[a.id]=a,c.user[a.id]=a})):(c.system[b.id]=b,b.isShopping?(c.all.SHOPPING=b.id,c.system.SHOPPING=b.id):b.isSocial?(c.all.SOCIAL=b.id,c.system.SOCIAL=b.id):b.isBilling&&(c.all.BILLING=b.id,c.system.BILLING=b.id))});var d=b.when(c);return d}return a.__queryAsMap__()},a.__get__=a.get,a.get=function(c){if(i&&i.data&&i.time===e.cacheTime){var d=h(i.data,c.id);if(d){d.isInbox=d.id===e.folders.INBOX,d.isSent=d.id===e.folders.SENT,d.isDrafts=d.id===e.folders.DRAFTS,d.isTrash=d.id===e.folders.TRASH,d.isSpam=d.id===e.folders.SPAM;var f=b.when(d);return f}return a.__get__(c)}return a.__get__(c)},a.isFrozen=d.isFrozen,a.__operation__=a.operation,a.operation=function(h,i){var j=b.defer();if(["create","update","delete","touch"].indexOf(h.oper)===-1){var k=c.folderId;e.env.device.isMobile&&"purge"===h.oper&&(k=h.folderId),a.get({id:k}).then(function(b){b.total>d.MESSAGE_OPERATION_LIMIT?g.confirmFolderFreeze(function(){d.freeze(k),f.$broadcast("application:freeze",k),a.__operation__.call(a,h,i).then(function(){j.resolve.apply(j,arguments),d.unfreeze(k),f.$broadcast("application:unfreeze:success",k)})["catch"](function(){j.reject.apply(j),d.unfreeze(k),f.$broadcast("application:unfreeze:error",k)})},function(){j.reject.apply(j)}):a.__operation__.call(a,h,i).then(function(){j.resolve.apply(j,arguments)})["catch"](function(){j.reject.apply(j,arguments)})})}else a.__operation__.call(a,h,i).then(function(){j.resolve.apply(j,arguments)})["catch"](function(){j.reject.apply(j,arguments)});return j.promise},a}])}]),angular.module("nxt-folder").config(["$provide",function(a){"use strict";a.decorator("Messages",["$delegate","$q","ApplicationData","$rootScope","DialogManager",function(a,b,c,d,e){return a.__operation__=a.operation,a.operation=function(f){var g=f.messages[0],h=b.defer();return f.messages.length>c.MESSAGE_OPERATION_LIMIT?e.confirmFolderFreeze(function(){c.freeze(g.folderId),d.$broadcast("application:freeze",g.folderId),a.__operation__.call(a,f).then(function(){h.resolve.apply(h,arguments),c.unfreeze(g.folderId),d.$broadcast("application:unfreeze:success",g.folderId)})["catch"](function(){h.reject.apply(h),c.unfreeze(g.folderId),d.$broadcast("application:unfreeze:error",g.folderId)})},function(){h.reject.apply(h)}):a.__operation__.call(a,f).then(function(){h.resolve.apply(h,arguments)})["catch"](function(){h.reject.apply(h,arguments)}),h.promise},a}])}]),angular.module("nxt-framework").config(["$provide",function(a){"use strict";a.decorator("$http",["$delegate",function(a){function b(a){return angular.extend(a||{},{headers:{"X-CACHE-IS-VALID":!0}})}return a.__delete__=a["delete"],a["delete"]=function(b,c,d){return d=angular.extend(d||{},{method:"delete",url:b,data:c}),a(d)},a.postPreserveCache=function(c,d,e){return e=b(e),a.post(c,d,e)},a.putPreserveCache=function(c,d,e){return e=b(e),a.put(c,d,e)},a.deletePreserveCache=function(c,d,e){return e=b(e),a["delete"](c,d,e)},a}])}]),angular.module("nxt-framework").config(["$provide",function(a){"use strict";a.decorator("$templateCache",["$delegate",function(a){var b=function(a){return a=a||"",a.replace(/.*\/js/,"")};return a._put=a.put,a._get=a.get,a.put=function(c,d){return a._put(b(c),d)},a.get=function(c){return a._get(b(c))},a}])}]),angular.module("nxt-settings").config(["$provide",function(a){"use strict";a.decorator("Theme",["$delegate","$q","ApplicationData","ApplicationConfig",function(a,b,c,d){var e=c.get("Theme");return a.__query__=a.query,a.query=function(){if(e&&e.data&&e.time===d.cacheTime){var f=b.when(e.data);return f.success=function(){return f},f.error=function(){return f},f}return a.__query__().then(function(a){return c.put("Theme",{time:d.cacheTime,data:a}),a})},a}])}]),angular.module("nxt-webmail").config(["$stateProvider","ApplicationConfigProvider",function(a,b){"use strict";var c=b.$get(),d={};c.env.device.isMobile||(d=angular.extend(d,{"navigation@":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/main.html"},"contact@":{controller:"ContactMainCtrl",templateUrl:"/contact/views/main.html"}})),a.state("abstract",{"abstract":!0,views:d})}]),angular.module("nxt-webmail").config(["uiSelectConfig",function(a){a.theme="selectize",a.searchEnabled=!1}]),angular.module("nxt-composition").config(["$stateProvider",function(a){"use strict";a.state("composition",{url:"/composition",onEnter:["$state","$location",function(a,b){try{a.transitionTo("folder",{folderId:1,withComposition:!0,recipients:b.hash()},{reload:!0,inherit:!0,notify:!0})}catch(c){}}]})}]),angular.module("nxt-contact").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".contact",{views:{"contact@":{controller:"ContactMainCtrl",templateUrl:"/contact/views/main.html"}}}).state(b+".contact.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]})})}]),angular.module("nxt-external-account").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".external-account",{"abstract":!0,views:{"external-account@":{controller:"ExternalAccountMainCtrl",templateUrl:"/external-account/views/main.html"}}}).state(b+".external-account.configure.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.configure.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.configure.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.configure.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.configure",{params:{accountId:null,aliasEmail:null,currentSentEmail:null,accountMessage:null},views:{"external-account-configure":{controller:"ExternalAccountConfigureCtrl",templateUrl:"/external-account/views/configure.html"}}}).state(b+".external-account.statement.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.statement.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.statement.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.statement.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.statement",{params:{isAlias:null,aliasEmail:null,email:null,accountId:null},views:{"external-account-statement":{controller:"ExternalAccountStatementCtrl",templateUrl:"/external-account/views/statement.html"}}}).state(b+".external-account.list.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".external-account.list.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".external-account.list.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".external-account.list.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".external-account.list",{views:{"external-account-list":{controller:"ExternalAccountListCtrl",templateUrl:"/external-account/views/list.html"}}})})}]),angular.module("nxt-folder").config(["$stateProvider","$urlRouterProvider",function(a,b){"use strict";a.state("folder",{parent:"abstract",url:"/folder/:folderId?sort&search&filter&extaccId&searchf&mode&iwa_source&iwa_testab&iwa_url&board&boardType",params:{withComposition:null,recipients:null,openFromNotification:null},onEnter:["$state","$stateParams",function(a,b){b.folderId&&!isNaN(Number(b.folderId))||(b.folderId=1,a.go("folder",{folderId:1}))}],views:{"message-list@":{controller:"FolderMainCtrl",templateUrl:function(){return NXT_CONFIG.env.device.isMobile?"/folder/views/main_mobile.html":"/folder/views/main.html"}}}}),b.otherwise(function(a,b){var c=b.path();return c="?"+c.substring(1),"/folder/1"+c})}]),angular.module("nxt-framework").config(["$httpProvider",function(a){"use strict";var b=function(a,b){var d=a.map(function(a,d){d=b+"["+d+"]";var e={};return e[d]=a,c(e)});return d.join("&")},c=function(a,d){var e=[],f=null;for(var g in a)a.hasOwnProperty(g)&&g.indexOf("$$")===-1&&(f=a[g],Array.isArray(f)?f=b(f,g):f instanceof Object?f=c(f,g):(d&&(g=d+"["+g+"]"),f=encodeURIComponent(g)+"="+encodeURIComponent(f)),e.push(f));return e.join("&")};a.defaults.transformRequest.unshift(function(a){if(a)return c(a)})}]),angular.module("nxt-framework").config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","**"])}]),angular.module("nxt-message").config(["$stateProvider",function(a){"use strict";a.state("message",{parent:"folder",url:"/message/:messageId",params:{leaveAsUnread:null,messageId:null,specialMessageType:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}}).state("messageEml",{parent:"folder",url:"/message/:messageId/:mpid/",params:{leaveAsUnread:null,messageId:null,mpid:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}}).state("thread",{parent:"folder",url:"/thread/:threadId",params:{leaveAsUnread:null,threadId:null},views:{"message@":{controller:"MessageMainCtrl",templateUrl:"/message/views/main.html"}}})}]),angular.module("nxt-navigation").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".navigation",{views:{"navigation@":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/main.html"}}}).state(b+".navigation.navigation",{onEnter:["$state",function(a){a.go(b+".navigation")}]}).state(b+".folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-list.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".settings.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-list.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".navigation.folder-list.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".navigation.folder-list",{views:{"folder-list":{controller:"NavigationMainCtrl",templateUrl:"/navigation/views/folder-list.html"}}}).state(b+".folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".navigation.folder-edit.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]}).state(b+".navigation.folder-edit.folder-list",{onEnter:["$state",function(a){a.go(b+".navigation.folder-list")}]}).state(b+".navigation.folder-edit.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".navigation.folder-edit.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".navigation.folder-edit",{params:{folderEditId:null},views:{"folder-edit":{controller:"NavigationFolderEditCtrl",templateUrl:"/navigation/views/folder-edit.html"}}})})}]),angular.module("nxt-settings").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".settings",{views:{"settings@":{controller:"SettingsMainCtrl",templateUrl:function(){return NXT_CONFIG.env.device.isMobile?"/settings/views/main_mobile.html":"/settings/views/main.html"}}}}).state(b+".settings.slideshow",{onEnter:["$state",function(a){a.go(b+".slideshow")}]}).state(b+".settings.settings",{onEnter:["$state",function(a){a.go(b+".settings")}]}).state(b+".settings.folder-edit",{onEnter:["$state",function(a){a.go(b+".navigation.folder-edit")}]})})}]),angular.module("nxt-slideshow").config(["$stateProvider",function(a){"use strict";["folder","message","thread","messageEml"].forEach(function(b){a.state(b+".slideshow",{url:"/slideshow",params:{attachments:null,attachmentName:null,isForVideos:null,isForIosVideos:null},views:{"slideshow@":{controller:"SlideshowMainCtrl",templateUrl:"/slideshow/views/main.html"}}})})}]),angular.module("nxt-change-password").controller("ChangePasswordCtrl",["$scope","ApplicationConfig","Security","Notification","Track",function(a,b,c,d,e){"use strict";function f(){a.changePassword.passwordNew.$validators.password=function(c){if(""===c)return a.passwordErrorMessage="",!0;var d=c.length>=8&&c.length<=32,e=/[a-zA-Z]/.test(c),f=/[\-+\*=_!@#$%\^&\(\)\{\}\[\]\|:;,\.<>\?\/\\\'\'`~0-9]/.test(c),g=/[^a-zA-Z0-9\-+\*=_!@#$%\^&\(\)\{\}\[\]\|:;,\.<>\?\/\\\'\'`~]/.test(c),h=b.env.ownEmail;return d?e?f?g?(a.passwordErrorMessage="Hasło zawiera nieprawidłowe znaki",!1):c===h?(a.passwordErrorMessage="Wybrane hasło nie może być identyczne jak Twój główny adres e-mail (login).",!1):(a.passwordErrorMessage="",!0):(a.passwordErrorMessage="Hasło powinno zawierać co najmniej jeden znak specjalny",!1):(a.passwordErrorMessage="Hasło powinno zawierać co najmniej jedną literę",!1):(a.passwordErrorMessage="Hasło powinno składać się od 8 do 32 znaków",!1)}}a.passwordNew="",a.password="",a.passwordNewRepeat="",a.passwordErrorMessage="",a.isIdentical=function(){return a.passwordNew&&a.passwordNew===a.passwordNewRepeat},a.submit=function(){e.pushIWACode(a.$parent.$parent.stats.changePassword),a.isIdentical()&&c.changePassword(a.password,a.passwordNew).then(function(b){b&&(d.success("Hasło zostało zmienione"),a.$parent.$parent.nextStep())})["catch"](function(a){if(a.data&&422===a.data.code){var b=a.data.data;d.error(b.password&&b.password.newPassword?b.password.newPassword[0]:b[0])}else d.error("Wystąpil nieoczekiwany błąd")})},setTimeout(function(){f()})}]),angular.module("nxt-change-password").controller("ChangePasswordBoardCtrl",["$scope","ApplicationConfig","Security","Notification","Track",function(a,b,c,d,e){"use strict";a.copies={0:{title:"Wymagana zmiana hasła",message:a.$parent.params.message},1:{title:"Zmień hasło",message:'<a class="link" target="_blank" href="https://pomoc.poczta.interia.pl/news-jak-zadbac-o-bezpieczenstwo-na-poczcie-i-ustawic-silne-haslo,nId,2136357#utm_source=plansza_bok_smtp&utm_medium=wskazowki&utm_campaign=pass">Wskazówki potrzebne do utworzenia silnego<br/> i bezpiecznego hasła.</a>'},2:{title:"Zmień opcje odzyskiwania hasła",message:"Uzupełnione i aktualne dane umożliwią Ci <br/>odzyskanie dostępu do poczty w sytuacji, <br/>gdy zapomnisz hasła."}},a.currentStep=0,a.list=a.$parent.params.additionalData.description||[],a.stats=a.$parent.params.additionalData.stats,e.pushIWACode(a.stats.view),a.nextStep=function(){0===a.currentStep&&e.pushIWACode(a.stats.next),a.currentStep=a.currentStep+1},a.sendLinkTrack=function(){1===a.currentStep&&e.pushIWACode(a.stats.link)}}]),angular.module("nxt-change-password").controller("ChangeRecoveryOptionsCtrl",["$rootScope","$scope","ApplicationConfig","Security","Notification","Track",function(a,b,c,d,e,f){"use strict";function g(a){return void 0!==a&&a.length>0}function h(){var a;a=b.mobile&&b.mail?"tel&mail":b.mobile?"nr_tel":"email",f.pushIWACode(b.$parent.$parent.stats.changeOptions,a)}var i=239;b.phonePattern=c.patterns.phone,b.emailPattern=c.patterns.email,b.mail="",b.mobile="",d.getSecurityData().then(function(a){a&&(b.mobile=a.mobile,b.mail=a.email)}),b.submit=function(){h(),d.setSecurityData({email:b.mail,mobile:b.mobile,password:""}).then(function(b){b?(e.success("security:saved-success"),a.$broadcast("directive:dialog:close-composition"),Setting.update({onlyQuestionRecovery:2}),$http.put("/infoBoard",{id:i,state:c.boardStates.BOARD_STATE_ACCEPT,sValue:1})):e.error(b.msg?b.msg:"Wystąpił błąd")})["catch"](function(a){a.data&&a.data.data.recovery&&a.data.data.recovery.email[0]&&e.error(a.data.data.recovery.email[0])})},b.validate=function(){return!(g(b.mobile)||g(b.mail))}}]),angular.module("nxt-contact").controller("ContactMainCtrl",["$location","$rootScope","$scope","$state","$timeout","ApplicationConfig","Contact","ContactGroup","DialogManager","Compositions","Notification","Counter","ApplicationData","Track","ScopeService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b){return angular.isArray(a[G.GROUPS])&&a[G.GROUPS].indexOf(b)!==-1}function q(a,b){return angular.isArray(a[G.WORDS])&&a[G.WORDS].some(function(a){return 0===a.indexOf(b.toLowerCase())})}function r(a){return a[G.TYPE]===g.CONTACT_TYPE_FAKE}function s(a,b){return a[G.NAME].indexOf(b.toLowerCase())!=-1&&!r(a)||a[G.NAME].indexOf(b.toLowerCase())==-1}function t(a,b){return a&&b?function(c){return p(c,a)&&q(c,b)}:a?function(b){return p(b,a)}:b?function(a){return q(a,b)&&s(a,b)}:!c.isCorp||a||c.isContactEdited?function(a){return!r(a)}:function(a){return g.isNotEmployeeFilter(a)}}function u(a){a.sort(c.sortOrder===c.SORT_POPULARITY?g.popularitySorter:g.alphabeticSorter)}function v(a){var b=[],d=t(c.selectedGroup&&c.selectedGroup.id,c.data.search);if(a&&a.length)for(var e=0;e<a.length;e++)d(a[e])&&b.push(a[e]);return b}function w(){m.putBroadcast("Contact",{time:f.cacheTime,data:z})}function x(a){return c.contacts.filter(function(b){return b.groups.indexOf(a.id)!==-1})}function y(a,b){z=a,b&&u(z),A=v(a),c.contacts=g.contactArraysToObjects(A.slice(0,H)),c.contactIsLoading=!1}var z,A,B,C,D=15,E=50,F=500,G=f.ContactKeys,H=E;c.isCorp=f.env.isCorp,c.data={},c.employeeGroup={id:g.EMPLOYEE_GROUP_ID,name:"Pracownicy"},c.isExportContactsDisabled=f.env.isExportContactsDisabled,c.env=f.env,c.isMobile=f.env.device.isMobile,c.isExpanded=c.isMobile,c.ContactKeys=f.ContactKeys,c.contactIsLoading=!1,c.isSearchVisible=!0,c.isGroupsVisible=!1,c.isMobile||c.$watch("isExpanded",function(a){a===!1&&(c.isSearchVisible=!0,c.isGroupsVisible=!1,c.isContactEdited=!1,c.selectedGroup=null,c.isGroupAdd=!1,c.isGroupEdited=!1,c.panel=null,c.$broadcast("controller:contact:edit-cancel"),A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H)))}),c.toggleExpand=function(){c.isExpanded&&c.isContactEdited?c.$broadcast("controller:contact:has-contact-change"):(c.isExpanded=!c.isExpanded,c.isGroupsVisible=!1,c.isContactEdited=!1,c.isSearchVisible=!0)},c.$on("directive:contact:has-contact-change",function(a,b){b?i.confirm({title:"Zakończ dodawanie kontaktu",message:"Nie dokończono dodawania kontaktu (wszystkie dane zostaną utracone) czy chcesz kontynuować?",confirm:"Zakończ",callback:function(){c.isExpanded=!c.isExpanded}}):c.isExpanded=!c.isExpanded}),c.escape=function(){c.isMobile?c.close():c.isExpanded=!1},f.env.device.isPc&&(c.$on("ui-events:keydown:Escape",c.escape),c.$on("ui-events:click",function(a,b){b.panel&&"contact"!==b.panel&&c.escape()})),c.$on("directive:contact:edit-save",function(a,b){if(c.contactEdited=null,c.isContactEdited=!1,c.isSearchVisible=!0,b.words=g.getContactDictionary(b.name,b.email),b.isNew)z.push(g.contactObjectToArray(b));else for(var d=0;d<z.length;d++)if(z[d][G.ID]===b.id){z[d]=g.contactObjectToArray(b);break}A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H))}),c.$on("service:contact:delete",function(a,b){z=z.filter(function(a){return a[G.ID]!=b.id}),A=v(z),c.contacts=g.contactArraysToObjects(A.slice(0,H)),w()}),c.$on("service:composition:autoinsert-contact",function(a,b){b.forEach(function(a){if("pomoc@firma.interia.pl"!==a.email){a.name=a.email.substr(0,a.email.indexOf("@")),a.score=9.89009141411e-7,a.type=g.CONTACT_TYPE_AUTOINSERT;var b=g.create(a);c.contacts.push(b),z.push(g.contactObjectToArray(b))}})}),c.$on("controller:contact:goto",function(b,d){c.isExpanded=!0,e(function(){a.hash(d.id)},300)}),c.$on("directive:contact:edit",function(a,b){c.contactEdited=b,c.isContactEdited=!0}),c.$on("directive:contact:new-form",function(a,b){c.contactEdited=g.create(b),c.isExpanded=!0,c.isContactEdited=!0}),c.$on("directive:contact:close",function(){c.isContactEdited=!1,c.isSearchVisible=!0}),c.isMobile||g.query().then(function(a){y(a)}),g.isCachedQueryAlreadyResolved()?y(m.get("Contact").data):g.cachedQuery().then(function(a){y(a)}),h.query().then(function(a){c.groups=a}),c.createContact=function(){c.contactEdited&&!c.contactEdited.id||(c.contactEdited=g.create()),c.isContactEdited=!0,c.isGroupsVisible=!1,c.isSearchVisible=!1,c.panel=null},c.close=function(){d.go("^.navigation")},c.activate=function(a){c.panel=a},c.deactivate=function(){c.panel=null},c.showSettings=function(){c.isExpanded=!1,d.go(".settings")},c.addGroup=function(){c.selectedGroup=h.create(),c.isGroupAdd=!0,c.isGroupEdited=!0,A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H)),B=z.filter(function(a){return!(r(a)||angular.isArray(a[G.GROUPS])&&a[G.GROUPS].indexOf(c.selectedGroup.id)!==-1)}),c.otherContacts=g.contactArraysToObjects(B.slice(0,H))},c.selectGroup=function(a){c.selectedGroup=a,c.isGroupEdited=!1,A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H)),a.name&&n.pushIWACode("contactSelectGroup",a.name)},c.clearSelectedGroup=function(){
c.selectedGroup=null,c.isGroupEdited=!1,A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H))},c.newMessageForGroup=function(a){j.addComposition({toActive:x(a),allowOwnEmails:!0})},c.editGroup=function(a){c.selectGroup(a),c.isGroupEdited=!0,c.contacts=g.contactArraysToObjects(v(z)),B=z.filter(function(b){return!angular.isArray(b[G.GROUPS])||b[G.GROUPS].indexOf(a.id)===-1}),H=E,c.otherContacts=g.contactArraysToObjects(B.slice(0,H))},c.cancelEditGroup=function(){c.$broadcast("controller:contact:group-edit:cancel"),c.isGroupAdd&&(c.selectedGroup=null,H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H))),c.isGroupAdd=!1,c.isGroupEdited=!1},c.saveGroup=function(){if(c.isCorp&&c.isGroupAdd&&c.selectedGroup.name===c.employeeGroup.name)return void k.error("Ups, coś poszło nie tak. Spróbuj za chwilę.");var a=x(c.selectedGroup);h.save(c.selectedGroup,a).then(function(b){b.isNew&&(a.forEach(function(a){var d=a.groups.indexOf(c.selectedGroup.id);a.groups.splice(d,1),a.groups.push(b.id)}),c.selectedGroup=b,H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H)),c.selectGroup(b)),h.query().then(function(a){c.groups=a}),c.isGroupEdited=!1,c.isGroupAdd=!1})},c.deleteGroup=function(a){h["delete"]({id:a.id}).then(function(){a._destroy=!0,c.selectedGroup&&c.selectedGroup.id==a.id&&c.clearSelectedGroup(),A=v(z),H=E,c.contacts=g.contactArraysToObjects(A.slice(0,H))})},c.SORT_ALPHABETICALLY="alphabetically",c.SORT_POPULARITY="popularity",c.sortOrder=c.SORT_POPULARITY,c.isSortReverse=!0,c.sortAlphabetically=function(){c.sortOrder!==c.SORT_ALPHABETICALLY&&(c.sortOrder=c.SORT_ALPHABETICALLY,u(z),A=v(z),c.contacts=g.contactArraysToObjects(A.slice(0,H)))},c.sortByPopularity=function(){c.sortOrder!==c.SORT_POPULARITY&&(c.sortOrder=c.SORT_POPULARITY,u(z),A=v(z),c.contacts=g.contactArraysToObjects(A.slice(0,H)))},c.importFilename="",c.isMobile||c.$on("service:contacts:import:addfile",function(a,b){c.importFilename=b.name}),c.$on("contact-list:scroll:bottom",function(){e(function(){c.isGroupEdited?c.otherContacts.push.apply(c.otherContacts,g.contactArraysToObjects(B.slice(H,H+D))):c.contacts.push.apply(c.contacts,g.contactArraysToObjects(A.slice(H,H+D))),H+=D,c.$digest()})}),c.$on("contact:add-to-selected-group",function(a,b){var d=0;for(d=0;d<z.length;d++)if(z[d][G.ID]===b.id){z[d]=g.contactObjectToArray(b),c.contacts=g.contactArraysToObjects(v(z));break}for(d=0;d<B.length;d++)if(B[d][G.ID]===b.id)return B.splice(d,1),void(c.otherContacts=g.contactArraysToObjects(B.slice(0,H)))}),c.$on("contact:remove-from-selected-group",function(a,b){var d=0;for(d=0;d<z.length;d++)if(z[d][G.ID]===b.id){z.splice(d,1),c.contacts=g.contactArraysToObjects(v(z));break}for(d=0;d<B.length;d++)if(B[d][G.ID]===b.id)return B[d]=g.contactObjectToArray(b),void(c.otherContacts=g.contactArraysToObjects(B.slice(0,H)))}),c.importContacts=function(){g.importContacts().then(function(){g.query().then(function(a){z=a,g.convertSpecialContactsToArrays(z),z=g.initDictionary(z),A=v(z),u(A),c.contacts=g.contactArraysToObjects(A.slice(0,H))}),c.deactivate()})},c.uploader=g.getUplouder(),c.searchChange=function(){z&&z.length&&(e.cancel(C),C=e(function(){H=E,A=v(z),o.safeApply(b,function(){c.contacts=g.contactArraysToObjects(A.slice(0,H))})},F,!1))},c.$on("controller:wizard:ownNameUpdate",function(){c.env.ownName=f.env.ownName}),c.isMobile&&(c.$on("controller:counters:update",function(){c.unseenMessageCount=l.getSumAllCounters()}),l.updateWithoutFolders()),c.$on("controller:wizard:avatarChange",function(){c.isUpdatingAvatar=!0,e(function(){c.isUpdatingAvatar=!1},0,!1)})}]),angular.module("nxt-dialog").controller("MultiBoardsCtrl",["$scope","Profile","Track",function(a,b,c){"use strict";function d(b){!b&&a.cancelCallback&&(a.cancelCallback(),a.cancelCallback=null)}var e=a.$parent.params.boards,f=2!=b.getAvatarFromCookie().type,g=[],h=0;a.activePage=0,a.paginationLength=[];for(var i in e)if(e.hasOwnProperty(i)){if(i=e[i],"changeAvatarBoard"==i.boardName&&f)continue;i.boardId=h,g.push(i),i.pagination.skipInPagination||a.paginationLength.push({id:h}),h++}a.changeStep=function(b,e){return a.board=g[b],b>=g.length?void a.$parent.close():(e&&(document.getElementById("step-"+a.activePage).className+=" complete"),d(e),a.activePage=b,c.pushIWACode("partialCustomizeWebmail"),void(a.board.stat&&a.pushStat(a.board.stat.type,a.board.stat.display)))},a.nextStep=function(b){a.changeStep(a.activePage+1,b),d(b)},a.prevStep=function(b){a.changeStep(a.activePage-1,b)},a.close=function(){a.$parent.close()},a.pushStat=a.$parent.pushStat,a.changeStep(0)}]),angular.module("nxt-external-account").controller("ExternalAccountConfigureCtrl",["$scope","$rootScope","Compositions","$state","$stateParams","ExternalAccount","ApplicationConfig","Track","Tools","$timeout",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,b){function c(a){return a.toUpperCase()!=a.toLowerCase()}b=null==b||b;var d=a.split("@")[0].toLowerCase();return d.length>2&&(!b||c(d.charAt(0)))}a.emailPattern=g.patterns.email,a.isShowMore=!1,a.isPending=!1,a.isSaving=!1,a.accountMessage=e.accountMessage,a.formData={port:110,deleteMessage:0},a.suggestions=[],a.ports=[110,995],a.actions=[{id:0,name:"Pozostaw kopie na koncie"},{id:1,name:"Usuń po pobraniu"}],a.isMobile=g.env.device.isMobile,0===g.prefs.defaultAccount&&(g.prefs.defaultAccount=g.env.ownEmail),a.$watch("formData.port",function(b){a.formData.secure=995==b?"1":"0"}),e.accountId?(a.isPending=!0,a.isShowMore=!0,a.isEdit=!0,f.get({id:e.accountId}).then(function(b){a.isPending=!1,angular.extend(a.formData,b),a.formData.isAvailable=!0,a.formData.isExternalDomain=!0})):e.aliasEmail&&(a.isEdit=!0,a.formData={email:e.aliasEmail,isAlias:!0,defaultSent:e.aliasEmail==g.prefs.defaultAccount?"1":"0"}),a.checkEmail=function(){a.formData.isOwner=void 0,a.formData.suggestion=void 0,a.formData.isAvailable=void 0,a.formData.isExternalDomain=f.isExternalDomain(a.formData.email),a.formData.domain=f.getMainDomain(a.formData.email),a.isInvalidInteriaMail=!1,a.isMainInteriaMail=!1,a.formData.email.toLowerCase()===g.env.ownEmail.toLowerCase()?a.isMainInteriaMail=!0:a.formData.isExternalDomain?(a.formData.isAvailable=!0,a.getSettings()):(a.isSupported=!0,k(a.formData.email,!1)?(a.isPending=!0,f.checkAliasAvailability(a.formData.email).then(function(b){a.isPending=!1,a.suggestions=b,a.formData.isAvailable=null===b,!k(a.formData.email)&&a.formData.isAvailable&&(a.isInvalidInteriaMail=!0,a.formData.isAvailable=null)})):a.isInvalidInteriaMail=!0)},a.$watch("formData.suggestion",function(b){b&&(a.formData.email=b)});var l;a.getSettings=function(){j.cancel(l),l=j(function(){f.settings(a.formData.email).then(function(b){a.isSupported=b.supported,a.isShowMore=!a.isSupported,angular.extend(a.formData,b)})},300)},a.sendIWATrack=function(a,b){void 0!==b&&h.pushIWACode(a,b)},a.submit=function(){var b=a.formData.isExternalDomain||a.formData.isOwner,c=b?"saveAccount":"saveAlias",d=a.formData.email===g.env.ownEmail,h=angular.copy(a.formData);if(g.env.device.isMobile||(a.successMessage=a.isEdit?"external-account:service:save":"external-account:service:add"),a.isWizard&&a.isShowMore&&0===a.externalAccountStep)return void(a.externalAccountStep=1);if(d)if("1"==a.formData.defaultSent){var i=e.currentSentEmail.type&&"alias"===e.currentSentEmail.type;b=!i,b?f.get({id:e.currentSentEmail.id}).then(function(a){h=a,h.defaultSent="0",h.isAvailable=!0,h.isExternalDomain=!0,c="saveAccount",n(h,c,b)}):(h={email:e.currentSentEmail.email,isAlias:!0,defaultSent:"0"},c="saveAlias",n(h,c,b))}else a.close();else n(h,c,b)};var m=function(a){if(sessionStorage){var b;try{var c=sessionStorage.getItem("extAccReq");null===c?(b=[a],sessionStorage.setItem("extAccReq",JSON.stringify({accs:b}))):(b=JSON.parse(c).accs,b.push(a),sessionStorage.setItem("extAccReq",JSON.stringify({accs:b})))}catch(d){}}},n=function(b,e,g){a.isSaving=!0,f[e](b,a.successMessage).then(function(e){if(a.isSaving=!1,g&&m(b.email),c.updateExternalAccounts({addedAccountEmail:b.email,isGlobal:1===parseInt(b.defaultSent),forceUpdate:!0}),a.isEdit)h.pushGACode("extAccAddWithChanges",b.domain),d.go("^.list");else{if(a.isWizard)return void a.wizardSuccess();h.pushGACode("extAccAdd",b.domain),d.go("^.statement",{isAlias:!g,accountId:e.id,accountMessage:e.accountMessage,email:b.email})}},function(){a.isSaving=!1})}}]),angular.module("nxt-external-account").controller("ExternalAccountListCtrl",["$scope","$rootScope","$state","$stateParams","ExternalAccount","ApplicationConfig","Folder","DialogManager","Compositions","Notification","ApplicationData","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){for(var b=0;b<a.externaAccounts.length;b++)if(a.externaAccounts[b].id===parseInt(a.activeExternalAccountId))return a.externaAccounts[b]}function n(){k.put("ExternalAccount",{time:f.cacheTime,data:a.externaAccounts}),l(function(){i.updateExternalAccounts()},0,!1)}a.mainAccountEmail=f.env.ownEmail,a.isAdmin=f.env.is_admin,a.isCorp=f.env.isCorp,a.ownEmail=f.env.ownEmail,a.folder=g.getCachedFolderById(d.folderId),a.activeExternalAccountId=d.extaccId,a.navExternalSelect=!1;var o=k.get("ExternalAccount").data;a.hasExternalAccounts=o&&o.length>1,f.env.device.isMobile?(a.externaAccounts=k.get("ExternalAccount").data,a.externaAccounts=a.externaAccounts.map(function(a){return angular.extend(a,{service:e.getService(a.email)})}),n()):e.query(d.folderId).then(function(b){a.externaAccounts=b,n()}),a.addExternalAccount=function(){f.env.device.isMobile?c.go("^.external-account.configure"):c.go("^.configure")},a.editExternalAccount=function(b,d){!a.navExternalSelect&&f.env.device.isMobile||(f.env.device.isMobile?c.go("^.external-account.configure",{accountId:b,accountMessage:d}):c.go("^.configure",{accountId:b,accountMessage:d}))},a.editAlias=function(b){var d=a.externaAccounts.filter(function(a){return a.defaultSent||a.vsmtpId&&a.vsmtpId==f.prefs.defaultAccount});f.env.device.isMobile?c.go("^.external-account.configure",{aliasEmail:b,currentSentEmail:d[0]}):c.go("^.configure",{aliasEmail:b,currentSentEmail:d[0]})},a.toggleNavExternalSelect=function(){a.navExternalSelect=!a.navExternalSelect},f.env.device.isMobile&&(a.activeExternalAccount=m()),a.deleteExternalAccount=function(c){var d=function(d){e.deleteAccount(c.id,d).then(function(){a.externaAccounts=a.externaAccounts.filter(function(a){return c.id!=a.id}),n(),b.$broadcast("controller:list:del-ext-acc",{accountId:c.id,accountMessage:c.message})})};h.confirm({title:"Usuń adres e-mail",message:"Czy chcesz usunąć adres "+c.email+"?<br><b>Uwaga!</b><br>Wszystkie wiadomości z tego konta zostaną usunięte.<br>Nie będzie można wysyłać i odbierać wiadomości z adresu "+c.email+".",confirm:"Usuń",template:"/dialog/views/dialog_confirm_del_ext_acc.html",additionalClasses:"dialog--confirm-del-ext-acc",additionalData:{isRemove:1,success:function(a){a&&c.totalMsg>1e3?h.confirmFolderFreeze(d(!0),function(){}):d(a)}}})},a.showErrorExternalAccountNotification=function(a){j.setOnClickCallback("external-account:service:edit",function(){c.go(".external-account.configure",{accountId:a.id,accountMessage:a.message})}),j.setReplaceParams([a.message]),j.error("external-account:service:edit")},a.deleteAlias=function(b,c){b.email===c?h.info({title:"Nie można usunąć aliasu",message:"Nie możesz usunąć aliasu na którym jesteś aktywnie zalogowany. Wybierz i zaloguj się na inny adres e-mail przypisany do tej skrzynki pocztowej i spróbuj ponownie",confirm:"Zamknij",additionalClasses:"notification-alias"}):h.confirm({title:"Usuń adres e-mail",message:"Czy chcesz usunąć adres "+b.email+" ? Nie będzie można wysyłać i odbierać wiadomości z tego adresu.",confirm:"Usuń",callback:function(){e.deleteAlias(b.email).then(function(){a.externaAccounts=a.externaAccounts.filter(function(a){return b.email!=a.email}),n()})}})}}]),angular.module("nxt-external-account").controller("ExternalAccountMainCtrl",["$scope","$state","ExternalAccount","Track","ApplicationConfig",function(a,b,c,d,e){"use strict";a.addExternalAccount=function(){b.go("^.configure")},a.close=function(){d.pushGACode("extAccClosePanel"),b.go("^.^")},a.$on("ui-events:keydown:Escape",function(){a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"external-account"!==c.panel&&a.close()}),a.$on("external-account:close",function(){a.close()}),e.aliasDomains.length||c.getInteriaDomains().then(function(a){e.aliasDomains=a.data})}]),angular.module("nxt-external-account").controller("ExternalAccountStatementCtrl",["$scope","$state","$stateParams","ApplicationConfig",function(a,b,c,d){"use strict";a.isAlias=c.isAlias,a.accountId=c.accountId,a.accountMessage=c.accountMessage,a.email=c.email,a.isGmail=/.*gmail.com$/.test(a.email),a.links=d.links,a.goToList=function(){b.go("^.list")}}]),angular.module("nxt-folder").controller("FolderMainCtrl",["$q","$scope","$rootScope","$state","$stateParams","Folder","Messages","Message","MessageCommander","Search","$filter","ApplicationConfig","Compositions","ExternalAccount","DialogManager","Track","Setting","$timeout","Counter","ApplicationData","InfoBoards","$cookies","MobileApp","$window","Notification","LongPoll","Retargeting","ServiceWorker","ScopeService","Billing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){"use strict";function E(){if(b.folderIsFrozen=f.isFrozen(e.folderId),b.folder=f.getCachedFolderById(e.folderId),I(),b.$on("folders:refresh",function(a,b){I(b)}),O(),e.withComposition&&b.openComposition(e.recipients),l.incrementSessionVisits(),b.refresh(),b.lastCheckedMessage=null,b.lastCheckedMessageWithShift=null,b.checkedMessagesCount=0,b.activeFilter=b.filter?b.filter:"all",l.env.mailto&&(m.addComposition({to:{email:l.env.mailto,name:l.env.mailto},autoFocusContent:!0}),l.env.mailto=""),b.isMobile&&(s.init(),b.isMobileApp=l.env.device.isMobileApp,b.swipeMsgId=!1,b.swipeAnimate=null,b.swipe=function(a,c){b.swipeMsgId&&b.swipeMsgId==a.uniqueId?(delete b.swipeMsgId,delete b.swipeAnimate):(delete b.swipeAnimate,b.swipeMsgId=a.uniqueId,r(function(){b.swipeAnimate=c,b.$digest()},50,!1)),p.pushIWACode("swipeMsglistLeft")},r(function(){c.$broadcast("controller:folder:seen",e.folderId)},0,!1)),l.hacks.AndroidVersion<4.1&&(b.isOldAndroid=!0),r(function(){l.env.isMobileApp&&w.renderReady()},0,!1),l.hacks.isIOS&&localStorage)try{var a=new Date;localStorage.setItem("nxtLogin",JSON.stringify({result:l.env.ownEmail,timestamp:a.getTime()+31536e4}))}catch(d){}F(),A.getRetargeting()}function F(){NXT_CONFIG.isAlreadyInit||(NXT_CONFIG.isAlreadyInit=!0,B.init(),l.env.longPollUrl&&z.connect(),e.board?(u.clearInfoboardsQueque(),"isTrigger"==e.boardType?u.displayById(e.board,!0):u.getBoardConfById(e.board).then(function(a){210==e.board&&o.multiBoards(a.options)}),d.go(".",{board:null,boardType:null})):u.init(),b.$on("http:response:error:sessionExpired",function(){z.disconnect("Sesja wygasła")}),b.$on("frame-login:success-ready",function(){NXT_CONFIG.blockRequest=!1,z.connect()}))}function G(a){b.pagination=a;var c=!(a.total%g.PACK_SIZE_REQUEST)||a.total%g.PACK_SIZE_REQUEST>g.PACK_SIZE;b.isMoreMessages=a.total>(a.pack-(c?1:0))*a.size}function H(a){ga.uniqueId=a}function I(a){f.query().then(function(c){b.userFolders=c.filter(function(a){return f.isUsersFolder(a)}),b.userFolders.length?l.env.hasCustomFolder=!0:l.env.hasCustomFolder=!1,b.selectedUserFolders=[{id:null,name:"Brak folderu nadrzędnego"}].concat(b.userFolders),a&&"function"==typeof a&&a()})}function J(){l.env.isMobileApp&&w.refreshFolder()}function K(){l.env.device.isMobile&&c.$broadcast("notification:remove:all")}function L(){l.env.isMobileApp&&(delete b.swipeMsgId,delete b.swipeAnimate)}function M(){Array.isArray(b.messages)&&(b.isAnyMessageChecked=b.messages.some(function(a){return a.checked}),b.isAnyMessageChecked||(b.lastCheckedMessage=null,b.lastCheckedMessageWithShift=null),l.env.isMobileApp&&(c.isAnyMessageChecked=b.isAnyMessageChecked))}function N(){for(var a=0,c=0;c<b.messages.length;c++)b.messages[c].checked&&a++;return a}function O(){var a=t.get("ExternalAccount").data,c=l.env.service?l.env.service.name:"interia";b.hasExternalAccounts=a&&a.length>1,null!==e.extaccId&&a&&("-1"==e.extaccId?b.activeAccount={email:l.env.ownEmail,service:c}:b.activeAccount=a.filter(function(a){return a.id==e.extaccId}).pop())}function P(a){angular.forEach(b.messages,function(c,d){c.uniqueId==g.getUniqueId(a)&&(b.messages[d].isForceHidden=!0)})}function Q(a){return b.isTolPushMessage.indexOf(a)!==-1}function R(){if(b.rodoApiStatus)return b.rodoApiStatus;b.rodoApiStatus=4;try{if(l.env.isMobileApp)b.rodoApiStatus=window.rodoApiStatusPocztaMobileAndPremium;else{var a=parseInt(window.rodoAPI.getStatus());isNaN(a)||(b.rodoApiStatus=a)}}catch(c){console.warn("rodoAPI.getStatus doesn't exist anymore")}return b.rodoApiStatus}function S(){if(b.messages)for(var a=0;a<b.messages.length;a++)0===a&&d.go("folder",{folderId:d.params.folderId}),a>0&&b.messages[a].id==d.params.messageId&&b.openMessage(b.messages[a-1])}function T(){if(b.messages)for(var a=0;a<b.messages.length;a++)b.messages[a].id==d.params.messageId&&(a<b.messages.length-1?b.openMessage(b.messages[a+1]):b.isMoreMessages?b.loadMoreMessages(!1,function(){b.openMessage(b.messages[a+1])}):d.go("folder",{folderId:d.params.folderId}))}function U(){for(var a=!1,c=0;c<fa.length;c++)if(void 0===b.messages[c]||b.messages[c].uniqueId!==fa[c].uniqueId){a=!0;break}return a}function V(){var a,c,e=fa[fa.length-1].uniqueId,f=U();if(f)if(0===b.messages.length||b.isShowAd)b.isShowAd=!0,d.go("folder",{folderId:b.folder.id});else if(b.activeUniqueId===e)b.openMessage(b.messages[b.messages.length-1]);else{for(var g=0;g<b.messages.length;g++)if(a=b.messages[g].uniqueId,b.activeUniqueId===a)return c=g,void b.openMessage(b.messages[c]);if(void 0===c)for(var g=0;g<b.messages.length;g++){if(b.messages[g].uniqueId!==fa[g].uniqueId)return void b.openMessage(b.messages[g]);g===b.messages.length-1&&b.openMessage(b.messages[b.messages.length-1])}}}function W(){return ga.initPage&&(b.currentPage<ga.initPage||ga.uniqueId&&b.currentPage<ga.initPage+1)}function X(){var a=b.messages;return a.filter(function(a){return a.checked})}function Y(a){var b=!1;return a.forEach(function(a){a.fUnsubscribable&&(b=!0)}),b}function Z(a){var b,c=[];return a=a||X(),a.forEach(function(a){a.threadId&&a.threadId!=-1?a.msgCount>0&&(b=a.fromEmail.split(";"),b.forEach(function(a){a=a.trim(),c.indexOf(a)==-1&&a!=l.env.ownEmail&&c.push(a)})):c.indexOf(a.fromEmail)==-1&&a.fromEmail!=l.env.ownEmail&&c.push(a.fromEmail)}),c}function $(){for(var a=X(),b=[],c=0;c<a.length;c++)b.push(a[c].billing.pname);return b}function _(a){o.confirm({title:"Zgłoszenie niechcianej wiadomości",message:"Ten nadawca umożliwia automatyczne wypisanie się z listy adresatów, dzięki temu nie będziesz otrzymywać od niego tego typu wiadomości. Czy chcesz skorzystać z tej opcji?",confirm:"wypisz mnie",template:"/dialog/views/dialog_unsubscribe.html",additionalData:a,callback:function(){i.listUnsubscribe(a)}})}var aa,ba,ca,da=a.defer(),ea=[],fa=[],ga={initPage:void 0!==e.page?parseInt(e.page):0,uniqueId:!1},ha=!1;b.isFolderScrollToPage=!1,b.sort=e.sort,b.filter=e.filter,b.newFolder={},b.isMobile=l.env.device.isMobile,b.isThreadingOn=!b.isMobile&&l.env.threading,b.hasSocialFolder=l.env.hasSocialFolder,b.hasShoppingFolder=l.env.hasShoppingFolder,b.hasBillingFolder=l.hasBillingFolderSetting(),b.billingUrl=l.env.billing.url,b.billingEnabled=l.env.billing.enabled,b.isSelectAllView=!1,b.isAnyMessageChecked=!1,b.isSearch=j.isSearch(),b.isSearchInContent=j.isSearchInContent(),b.isAddQuickFilter=!1,b.showQuickFilterCheckbox=!0,b.currentPage=1,b.isMoreMessages=!0,b.avatarsShowed=l.env.showAvatars,b.leftColumnMin=l.env.isLeftColumnMin,b.leftPreColumnMin=l.env.isLeftPreColumnMin,b.isBusinessAccount=l.env.adminBusinessPackType,b.isModeAttachments="attachments"===e.mode,b.movePending=!1,b.lastMovedMsgIndex=null,b.env=l.env,b.isInt="int"===l.env.service.name,b.isCorp=l.env.isCorp,b.isMobileApp=l.env.isMobileApp,b.isFirstPackReady=!1,b.isTolPushMessage=[],b.moduleConfigAds=l.getConfigAppModule("ads"),b.isPremiumAcc=!!l.env.accountType,b.staticUrl=l.env.staticUrl,d.params.threadId&&b.isThreadingOn?b.activeUniqueId="t"+d.params.threadId:d.params.messageId&&(b.activeUniqueId="m"+d.params.messageId),r(function(){if(NXT_CONFIG.env.isMobileApp)try{l.env.appSupportedOpenFiles=MobileAppConnector&&MobileAppConnector.getNativeAppIdent}catch(a){console.log("Only to use in mobileApp - getNativeAppIdent")}},0,!1),f.queryAsMap().then(function(a){b.foldersMap=a.all,b.isMobile&&s.update(a)});var ia=function(a){var c={};c.goTo=a&&a.goTo?a.goTo:"folder";var f=function(){i.setNextActionState(i.STATE_FOLDER),i.deleteMessages(a).then(function(){var f=e.folderId;ga={initPage:0,uniqueId:!1},a.folderId&&(e.folderId=a.folderId,b.refresh(!1,!0)),a.folderId&&(e.folderId=f),d.go(c.goTo),b.refresh(!1,!0)},function(){b.clearSelection()})};return a?f:f()};b.$on("service:folder:deleted",function(a,c){b.userFolders=b.userFolders.filter(function(a){return a.id!=c.id}),b.selectedUserFolders=[{id:null,name:"Brak folderu nadrzędnego"}].concat(b.userFolders),c.id===parseInt(e.folderId)&&d.go("folder",{folderId:l.folders.INBOX})}),b.$on("service:message:move",function(a,c){l.env.device.isMobile&&P(c.messages[0]),b.refresh()}),b.$on("controller:folder:update:delete",function(){b.refresh()}),l.env.isMobileApp&&b.$on("isapp:message:pop",function(a,c){for(var e=b.messages.map(function(a){return parseInt(a.id)}),f=0;f<c.length;f++)Q(c[f].mailId)||e.indexOf(c[f].mailId)===-1&&(b.isTolPushMessage.push(c[f].mailId),h.get({id:c[f].mailId,leaveAsUnread:!0}).then(function(a){a.folderId==d.params.folderId&&(a=g.generateUniqueId(a),b.messages.unshift(a),b.messages=k("orderBy")(b.messages,"-id"))},function(a){a.isMobileAppPush=!0}))}),b.$on("service:longpoll:success",function(a,c){if(!b.isSearch&&c.folderId===parseInt(e.folderId)&&c.inLastHour&&(!e.extaccId||parseInt(e.extaccId)===-1)){if(l.env.isMobileApp&&b.messages){var d=b.messages.map(function(a){return parseInt(a.id)});if(d.indexOf(c.id)!==-1)return 0;if(Q(c.id))return 0;b.isTolPushMessage.push(c.id)}h.get({id:c.id,leaveAsUnread:!0}).then(function(a){a.unseen=!0,a.longpollMessage=!0,a.threadId&&parseInt(a.threadId)>0&&(ea.push(parseInt(a.threadId)),delete a.threadId),b.isMoreMessages&&b.messages&&b.messages.splice(b.messages.length-1,1),b.messages&&(b.messages=g.insertMessageByDate(a,b.messages))})}}),b.$on("folder:refresh",function(a,c){c&&c.filter&&(b.filter=c.filter),b.currentPage=1,b.refresh()}),b.$on("folder:delegateMoveToFolder",function(){var a=X();b.delegateMoveToFolder(l.folders.SPAM,a)}),b.$on("folder:uncheckedAllMessages",function(){b.clearSelection()}),aa=c.$on("message:getCachedThread",function(a,d){da.promise.then(function(){var a,e={isThreadFound:!1,threadId:d};for(a=0;a<b.messages.length;a++)if(b.messages[a].threadId===parseInt(d)&&ea.indexOf(parseInt(d))===-1){if(b.messages[a].longpollMessage)break;b.messages[a].msgs&&b.messages[a].msgs.length?(e.messages=b.messages[a].msgs,e.allMessagesCount=b.messages[a].msgCount,e.isThreadFound=!0):(e.messages=[b.messages[a]],e.allMessagesCount=1,e.isThreadFound=!0);break}c.$broadcast("message:cachedThreadProvided",e)})}),da.promise.then(function(){c.$broadcast("folder:getCachedThreadEventAttached")}),b.advancedSearch=function(){var a=j.getPhrase()||j.getHistoryPhrase(),b=j.getFilters();j.searchInContent(a,b)},b.$on("service:message:favorite",function(a,c){b.messages.some(function(a){return a.id==c.message.id&&(a.isStarred=!c.message.isStarred,!0)})}),b.$on("loadingIndicator:folderLoading",function(){b.isFolderLoading=!0}),b.$on("loadingIndicator:folderLoaded",function(){b.isFolderLoading=!1}),b.$on("scrollToPage:ready",function(){b.isFolderScrollToPage=!1,b.isFolderLoading=!1,ga.uniqueId=!1}),b.$on("application:freeze",function(a,c){e.folderId==c&&(b.folderIsFrozen=!0)}),b.$on("application:unfreeze:success",function(a,c){b.folderIsFrozen&&e.folderId==c&&(b.isFolderUnfreeze=!0,b.folderIsFrozen=!1)}),b.$on("application:unfreeze:error",function(a,c){b.folderIsFrozen&&e.folderId==c&&(b.isFolderUnfreeze=!1,b.folderIsFrozen=!1)}),b.$on("controller:list:del-ext-acc",function(a,c){b.activeAccount&&b.activeAccount.id==c.accountId&&(b.activeAccount=null,e.extaccId=null)}),l.env.isMobileApp&&b.$on("isapp:message:open",function(a,e){d.go("message",{folderId:e.folderId,messageId:e.msgId}),C.safeApply(c,function(){h.get({id:e.messageId,leaveAsUnread:!0}).then(function(a){b.markMessageAsRead(a)})})}),b.isRodoApiReady=function(){return ha||(ha=window.rodoAPI&&"function"==typeof window.rodoAPI.getStatus),ha},b.isDisplayDfpAd=function(){return b.folder.isShopping&&!b.filter&&!b.isSearch&&!b.isMobileApp&&parseInt(localStorage.getItem("remarketingClosedTime"))!==l.env.lastLoginTimestamp},b.isDisplayFakeMailAd=function(){return b.folder.isInbox&&!b.filter&&!b.isSearch},b.dfpAdMessageUrl=function(){return"/next/adv,advKeyword,"+b.env.advKeyword+",adType,dfp_ad_message,rodo,"+R()},b.openMessage=function(a,f,g,h){var i=s.getCounters();if(b.isOpenRemarketingMsg=!1,b.isOpenBokMail=!1,b.isOpenFakeMailMsg=!1,(i.folders[e.folderId]||i.userFolders[e.folderId])&&c.$broadcast("controller:folder:seen",e.folderId),a.unseen=!1,b.activeUniqueId=a.uniqueId,a.folderId==l.folders.DRAFTS?f||b.editDraft(a):(a.threadId&&a.threadId!==-1&&!a.longpollMessage?d.go("thread",{threadId:a.threadId,leaveAsUnread:f,openFromNotification:null,specialMessageType:null}):d.go("message",{messageId:a.id,leaveAsUnread:f,openFromNotification:null,specialMessageType:null}),f&&!l.env.isMobileApp||b.simulateMarkMessageAsRead(a)),b.isMobile&&(b.swipeMsgId=!1,b.selectAllView(!1)),g=void 0===g||g,g&&p.pushGFK(),h=void 0===h||h){var j=b.messages.indexOf(a)+1;p.pushIWACode("partialOpenMsg",[j]),p.pushGACode("partialOpenMsg",[j])}l.hacks.AndroidVersion<4.1&&(document.body.scrollTop=0),A.getRetargeting()},b.openMessageAndLeaveAsUnread=function(a,c,d){b.openMessage(a,!0,c,d)},b.autoOpenMessage=function(a){var c=b.messages,f=b.isMobile&&screen.width>768&&screen.width>screen.height||l.env.device.isTablet&&x.innerWidth>x.innerHeight||l.env.device.isPc;if(fa.length>0&&parseInt(e.folderId)!==-1&&f)return void V();ca&&ca(),ba&&ba();var g;if(b.folder.isShopping&&d.params.specialMessageType&&!b.messages.length)d.go("folder",{folderId:d.params.folderId});else if("message"!=d.current.name&&"thread"!=d.current.name||d.params.specialMessageType)if((l.env.device.isPc&&(l.visitCounter>1||b.isFirstShowAd||b.moduleConfigAds.actions&&!b.moduleConfigAds.actions.mainAutoPromoBoxEnabled)||b.isMobile)&&e.folderId!=l.folders.DRAFTS&&d.params.folderId!=l.folders.BILLING&&c&&c.length>0&&f){if(a)b.lastMovedMsgIndex=b.lastMovedMsgIndex||0,g=c.length>b.lastMovedMsgIndex?c[b.lastMovedMsgIndex]:0!==b.lastMovedMsgIndex?c[c.length-1]:c[0],b.lastMovedMsgIndex=null;else{for(var h=0,i=0;i<c.length;i++)if(c[i].uniqueId===b.activeUniqueId){h=i;break}g=c[h]}b.openMessageAndLeaveAsUnread(g,!1,!1),b.isShowAd=!1,b.isFirstShowAd=!1}else b.isShowAd=!0,b.isShowAdDescription=l.isShowAdDescription,b.isFirstShowAd=!0;ca=b.$on("$stateChangeSuccess",function(a,c,d,f){"message"==c.name||"thread"==c.name?b.isShowAd=!1:"message"!=f.name&&"thread"!=f.name||"folder"!=c.name||d.folderId!=e.folderId?void 0!==g&&b.markMessageAsRead(g):b.isMobile||void 0!==d.search||b.autoOpenMessage()}),ba=b.$on("$destroy",ca)},b.$on("adplace:onload:box600x450",function(){if(b.isShowAdDescription){var a=window.frames.box600x450&&window.frames.box600x450.contentDocument&&window.frames.box600x450.contentDocument.getElementById("autopromoAd");b.isShowAdDescription=!(!b.isShowAdDescription||a)}}),b.openComposition=function(a){K(),a&&a.length?m.addComposition({ids:a.split(";")}):m.addComposition()},b.refresh=function(a,d,f){c.$broadcast("controller:folder:refresh",!0),J(),a||(b.currentPage=1,b.isSelectAllView=!1),f=f||function(){};var h,i={id:e.folderId,sort:b.sort,filter:b.filter,search:e.search,page:b.currentPage,extaccId:e.extaccId,searchf:e.searchf};j.isAdvanced()||j.isSearchInContent()&&i.search?(h=g.search(i,j.getFilters()),j.isSearchInContent()&&(p.pushGACode("searcherInContent"),p.pushIWACode("searcherInContent"))):h=g.query(i),i.search&&(p.pushGACode("actionSearch"),p.pushIWACode("partialActionSearch")),h.then(function(g){void 0!==b.messages&&(fa=b.messages),b.isMoreMessagesLoading=!1,l.env.isMobileApp&&w.sync("list",g.messages),a?(b.messages=b.messages.concat(g.messages),b.isMessagesLoading=!1):(b.messages=g.messages,da.resolve(),"undefined"==typeof d&&(d=!0),parseInt(e.folderId)===l.folders.SHOPPING&&c.$on("message:auto-open-message",function(){b.autoOpenMessage(d)}),parseInt(e.folderId)!==l.folders.BILLING&&b.autoOpenMessage(d)),g.pagination&&G(g.pagination),b.pagination&&b.pagination.total===b.messages.length&&(b.isMoreMessages=!1),c.$broadcast("controller:folder:main",{folderId:e.folderId,isSearch:b.isSearch}),e.openFromNotification&&ka(e.openFromNotification,!0),M(),W()?(b.isFolderLoading=!0,b.isFolderScrollToPage=!0,c.$broadcast("folder:scroll:page",{id:ga.uniqueId}),b.currentPage>ga.initPage&&(ga.initPage=b.currentPage)):(b.isFolderLoading=!1,l.env.isMobileApp&&c.$broadcast("folder:scroll:last-pos")),f(),b.isFirstPackReady=!0,c.$broadcast("controller:folder:refresh",!1)},function(){ja(),c.$broadcast("controller:folder:refresh",!1)})};var ja=function(){b.isShowAd=!0,b.isMessagesLoading=!1,b.isMoreMessagesLoading=!1,b.isFolderLoading=!1,b.currentPage--,J()};b.openExternalAccount=function(){d.current.name.indexOf(".external-account.list")==-1&&(K(),L(),d.go(".external-account.list"))},b.addExternalAccount=function(){K(),L(),d.go(".external-account.configure")},b.checkMessage=function(a,c){if(a.checked?b.checkedMessagesCount--:b.checkedMessagesCount++,a.checked=!a.checked,b.isSelectAllView=!!b.messages&&b.checkedMessagesCount===b.messages.length,c&&b.lastCheckedMessage){if(b.lastCheckedMessage){var d=!1,e=!1;b.messages.forEach(function(c){d=c==b.lastCheckedMessage||d,e=c==a||e,d!=e&&(c.checked=b.lastCheckedMessage.checked),e&&b.lastCheckedMessageWithShift&&(c.checked=!c.checked),c==b.lastCheckedMessageWithShift&&(b.lastCheckedMessageWithShift=null)}),b.lastCheckedMessageWithShift=a}}else b.lastCheckedMessage=a,b.lastCheckedMessageWithShift=null;a.checked===!0&&p.pushGACode("checkSingleMessage"),M()},b.markAsRead=function(){var a=X();i.markAsRead(a)["catch"](function(){a.map(function(a){a.seen=!1})}),b.isSelectAllView===!0?p.pushGACode("mailMarkReadAllMenuMore"):p.pushGACode("mailMarkReadSingleMenuMore"),a.map(function(a){a.seen=!0}),p.pushIWACode(N()>1?"markReadAll":"markRead"),b.clearSelection()},b.markAsUnread=function(){var a=X();i.markAsUnread(a)["catch"](function(){a.map(function(a){a.seen=!0})}),p.pushGACode(b.isSelectAllView===!0?"mailMarkUnReadAllMenuMore":"mailMarkUnReadSingleMenuMore"),a.map(function(a){a.seen=!1}),p.pushIWACode(N()>1?"markUnreadAll":"markUnread"),b.clearSelection()},b.markAsPaid=function(){D.markAsPaid($()),b.clearSelection()},b.markAsNotPaid=function(){D.markAsNotPaid($()),b.clearSelection()},b.pay=function(){var a=X();b.clearSelection();for(var c="/?document=",d=0;d<a.length;d++)c+=a[d].billing.pname+",";c=c.slice(0,-1),window.location.replace(l.env.billing.url+c)},b.$on("controller:folder:mark-as-favorite",function(a,c){b.markAsFavorite(c)}),b.markAsFavorite=function(a){var d=!!a,e=a?[a]:X(),f=[],g=[],h=!e[0].isStarred,j=h?"flagged":"unflagged";b.isMobile&&(b.swipeMsgId=!1),a&&H(a.uniqueId),e.forEach(function(a){parseInt(a.threadId)>0?f.push({threadId:a.threadId,folderId:a.folderId,isStarred:a.isStarred}):(f.push({id:a.id,folderId:a.folderId,isStarred:a.isStarred}),g.push(a.id)),a.isPreviouslyStarred=a.isStarred,a.isStarred=h}),e[0].isStarred&&(d?p.pushIWACode("markFavourite","lista_wiadomosci"):p.pushIWACode(N()>1?"markFavouriteAll":"markFavourite","gorne_menu")),i.markAsFavorite(f).then(function(a){e.forEach(function(b){angular.isArray(b.msgs)&&b.msgs.forEach(function(b,c,d){angular.isArray(a.flagged)&&a.flagged.indexOf(b.id)!==-1?d[c].isStarred=!0:angular.isArray(a.unflagged)&&a.unflagged.indexOf(b.id)!==-1&&(d[c].isStarred=!1);
})}),Array.isArray(a.flagged)||(a.flagged=[]),Array.isArray(a.unflagged)||(a.unflagged=[]),g.length&&(a[j]=a[j].concat(g)),c.$broadcast("folder-to-message:star-active",a),b.clearSelection(),p.pushGACode(b.isSelectAllView===!0?"setStarAll":"setStarSingle"),L()},function(){e.forEach(function(a){a.isStarred=a.isPreviouslyStarred,delete a.isPreviouslyStarred}),b.clearSelection()})},b.quickFilter=function(){b.isAddQuickFilter=!b.isAddQuickFilter},b.moveToInbox=function(){b.moveToFolder(l.folders.INBOX)},b.moveToSent=function(){b.moveToFolder(l.folders.SENT)},b.moveToDrafts=function(){b.moveToFolder(l.folders.DRAFTS)},b.moveToSocial=function(){b.moveToFolder(b.foldersMap.SOCIAL)},b.moveToShopping=function(){b.moveToFolder(b.foldersMap.SHOPPING)},b.moveToPayment=function(){b.moveToFolder(b.foldersMap.BILLING)},b.moveToTrash=function(a,c){b.moveToFolder(l.folders.TRASH,a,c),L()},b.moveCheckedToTrash=function(){b.moveToFolder(l.folders.TRASH,!1,!1,!0),L()},b.moveToSpam=function(a,c){b.moveToFolder(l.folders.SPAM,a,c),L()},b.moveToFolder=function(a,d,e,h){var i,j;l.env.device.isMobile&&c.$broadcast("directive:dropdown:hideAll-force"),g.clearBuffer();var k=X();d&&(k=[d]);var m=[f.getCachedFolderById(a).name];if(m.unshift(e?"lista_wiadomosci":"gorna_belka"),p.pushIWACode(N()>1?"moveAll":"move",m),a==l.folders.SPAM){for(j=!1,i=0;i<k.length;i++)"mailing"==k[i].msgType&&(j=!0);if(j)u.displayById(u.SPAM_MAILING_BOARD_ID,!0).then(function(a){a||Y(k)&&_(k)});else if(k.length>=3)return void u.displayById(u.SPAM_NOT_TRASH,!0).then(function(a){a.data===!1&&b.delegateMoveToFolder(l.folders.SPAM,k)});!j&&Y(k)&&_(k)}else if(a==l.folders.TRASH){for(j=!1,i=0;i<k.length;i++)"mailing"==k[i].msgType&&(j=!0);j&&u.displayById(u.REMOVE_MAILING_BOARD_ID,!0)}if(e)b.lastMovedMsgIndex=e,H(b.messages[e-1].uniqueId);else{var n=k.map(function(a){return a.uniqueId});if(b.lastCheckedMessage){var o=b.messages.map(function(a){return a.uniqueId}).indexOf(b.lastCheckedMessage.uniqueId),q=-1;for(i=o;i>=0;i--)if(b.messages[i-1]&&n.indexOf(b.messages[i-1].uniqueId)==-1){q=i-1;break}if(q==-1)for(i=o;i<b.messages.length;i++)if(b.messages[i+1]&&n.indexOf(b.messages[i+1].uniqueId)==-1){q=i+1;break}q!==-1&&b.messages[q]&&H(b.messages[q].uniqueId)}else b.messages[1]&&(H(b.messages[1].uniqueId),n.indexOf(b.messages[1].uniqueId)!==-1&&(H(!1),ga.initPage=0))}if(h){var r=[];for(i=0;i<k.length;i++)k[i].folderId==l.folders.TRASH&&(r.push(k[i]),k.splice(i,1),i--);r.length&&b.delegateDeleteMessages(r)}k.length&&b.delegateMoveToFolder(a,k),a===l.folders.TRASH&&p.pushIWACode("partialDeleteMsg")},b.delegateMoveToFolder=function(a,e){b.movePending||(b.movePending=!0,i.moveToFolder(a,e).then(function(){b.isAddQuickFilter&&!b.isSelectAllView&&(c.$broadcast("controller:filter:quick",{email:Z(e),folderId:a}),b.isAddQuickFilter=!1);for(var f=0;f<e.length;f++)if(e[f]&&e[f].uniqueId===b.activeUniqueId){d.go("folder");break}b.refresh(),b.movePending=!1},function(){b.clearSelection(),b.movePending=!1}))},b.moveToUnSpam=function(a,c){var d=X();g.clearBuffer(),a&&(d=[a]),c&&(b.lastMovedMsgIndex=c),b.delegateMoveToUnSpam(d),a?p.pushIWACode("notSpam","lista_wiadomosci"):p.pushIWACode("notSpamToolbar",1===d.length?"pojedynczy_mail":"wszystkie_zaz")},b.delegateMoveToUnSpam=function(a){i.moveToUnSpam(a).then(function(){for(var c=0;c<a.length;c++)if(a[c]&&a[c].uniqueId===b.activeUniqueId){d.go("folder");break}b.refresh()},function(){b.clearSelection()})},b.deleteMessages=function(a,c){g.clearBuffer();var d=X();a&&(d=[a]),c&&(b.lastMovedMsgIndex=c),b.delegateDeleteMessages(d)},b.delegateDeleteMessages=function(a){i.deleteMessages(a).then(function(){for(var c=0;c<a.length;c++)if(a[c]&&a[c].uniqueId===b.activeUniqueId){d.go("folder");break}b.refresh()},function(){b.clearSelection()})},b.deleteFolderMessages=function(a){var b={};b.title="Usuń wiadomości",b.message="Czy chcesz usunąć wybrane wiadomości?",b.confirm="Usuń",b.callback=ia,a&&(b=angular.extend(b,a)),o.confirm({title:b.title,confirm:b.confirm,message:b.message,callback:function(){p.pushGACode("deleteAllMessagesFromTrashViaDialog"),b.callback(b)()}})},b.selectAllView=function(a){b.isSelectAllView=void 0!==a?a:!b.isSelectAllView,p.pushGACode("selectAllMessages"),b.isSelectAllView?b.checkedMessagesCount=b.messages?b.messages.length:0:b.checkedMessagesCount=0,b.checkedMessagesCount>=0&&b.messages&&b.messages.forEach(function(a){a.checked=b.isSelectAllView}),M()},b.clearSelection=function(a){b.selectAllView(!1),a&&p.pushGACode(a),M()},b.$on("controller:folder:open-message",function(a,b){b.folderId==e.folderId?ka(b,!1):d.go("message",{folderId:b.folderId,openFromNotification:b,messageId:b.id})}),b.isBillingAutopromo=function(){var a="message"===d.current.name||"thread"===d.current.name;return!b.isSearch&&!a},b.$on("controller:folder:delete-all-folder-messages",function(a,c){var d={};d.goTo=".navigation",d.title="Opróżnij "+c.name,d.message="Czy chcesz usunąć wiadomości z folderu "+c.name+"?",d.confirm="Usuń",d.folderId=c.id;var e=ia;d.callback=e,b.deleteFolderMessages(d)});var ka=function(a,c){a.threadId&&a.threadId!==-1&&!a.longpollMessage?a.uniqueId="t"+a.id:a.uniqueId="m"+a.id,b.activeUniqueId=a.uniqueId,c||(a.unseen=!0,b.openMessage(a,!1,a.folderId),a.seen=!1,b.markMessageAsRead(a)),b.messages.some(function(b){if(b.id==a.id)return b.unseen=!1,b.seen=!0,!0})};b.markMessageAsRead=function(a){a.seen||g.markAsRead([a]).then(function(){a.seen=!0})},b.simulateMarkMessageAsRead=function(a){a.seen||(a.seen=!0,l.cacheTime=Date.now())},b.editDraft=function(a){m.addComposition({opt:"e",mesg:a.id,folder:a.folder})},b.forward=function(){var a,c=X(),d=0;if(c){for(a=0;a<c.length;a++)parseInt(c[a].threadId)>0&&d++;c.length>1||d>0?m.addComposition({opt:"fmsg",messages:c.map(function(a){return parseInt(a.threadId)>0?{threadId:parseInt(a.threadId)}:{id:a.id}})}):c.length>0&&m.addComposition({opt:"f",mesg:c[0].id,folder:c[0].folder})}p.pushGACode(c.length>1?"mailForwardAllSelect":"mailForwardSingle"),p.pushIWACode(c.length>1?"mailForwardAllSelect":"mailForwardSingle"),b.clearSelection()},b.createNewFolder=function(){f.save(b.newFolder).then(function(a){b.moveToFolder(a.id),b.foldersMap[a.id]=a,I()})},b.loadMoreMessages=function(a,c){b.currentPage++,b.currentPage>ga.initPage&&(ga.initPage=b.currentPage),b.isMoreMessagesLoading=!0,b.refresh(!0,!0,c),p.pushGACode("messageListNextPack"),p.pushIWACode("messageListNextPack")},b.reply=function(){var a,b=X();if(b&&b.length){if(a=b[0],!a.id){if(!a.msgs||!a.msgs.length)return;if(a=a.msgs[a.msgs.length-1],!a.id)return}h.get({id:a.id,leaveAsUnread:!0}).then(function(a){m.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,cc:a.cc,from:a.to,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients})}),p.pushIWACode("reply")}},b.sendFeedback=function(){m.addComposition({to:{email:"pomoc@firma.interia.pl",name:"BOK"},subject:"Sugestie do nowego interfejsu",autoFocusContent:!0})},b.showAvatars=function(){b.avatarsShowed=!b.avatarsShowed,l.env.showAvatars=b.avatarsShowed,q.update({showAvatars:b.avatarsShowed}),c.$broadcast("folder:controller:showAvatars")},b.activeFilter=b.filter?b.filter:"all",b.changeFilter=function(a){b.isFolderLoading=!0,b.activeFilter=a},b.openBilling=function(){p.pushIWACode("billingOpen")},b.premiumForBillingText={1:"Po opłaceniu rachunku wyłączamy reklamy. Sprawdź»",2:"Opłać rachunek kartą VISA i odbierz pocztę bez reklam»",3:"Poczta bez reklam na 6 mc po opłaceniu rachunku kartą VISA»"},b.premiumForBilling=Math.floor(3*Math.random()+1),b.$on("message:transform-to-thread",function(a,c){var d;if(c.threadId&&c.originalMessageId)for(d=0;d<b.messages.length;d++)b.messages[d].longpollMessage||b.messages[d].id!==c.originalMessageId||b.messages[d].threadId&&b.messages[d].threadId!==-1||(b.messages[d].threadId=parseInt(c.threadId),b.messages[d].msgCount=2)}),b.$on("message:move-by-drag&drop",function(a,c,d){c&&(b.moveToFolder(c,d),parseInt(e.folderId)===l.folders.SPAM&&p.pushIWACode("notSpamDragAndDrop",d?"pojedynczy_mail":"wszystkie_zaz"))}),b.$on("thread:increase-counter",function(a,c){var d;for(d=0;d<b.messages.length;d++)parseInt(b.messages[d].threadId)===parseInt(c)&&b.messages[d].msgCount++}),b.$on("message-to-folder:star-message-on-list",function(a,c){var d,e=parseInt(c.threadId)>0?"threadId":"id";for(d=0;d<b.messages.length;d++)if(parseInt(b.messages[d][e])===parseInt(c[e])){b.messages[d].isStarred=c.isStarred;break}}),b.$on("msglist:scroll:bottom",function(a){b.isMoreMessages&&!b.isMoreMessagesLoading&&(d.go(".",{page:b.currentPage+1},{notify:!1}),r(function(){b.isMessagesLoading=!0,b.loadMoreMessages(!0),a.preventDefault()},0))}),b.$on("msglist:mark-seen",function(a,c){angular.forEach(b.messages,function(a,d){g.getUniqueId(c.message)==a.uniqueId&&(b.messages[d].seen=!0)})}),b.$on("service:billing:mark-as-paid",function(a,c){for(var d=0;d<b.messages.length;d++)b.messages[d].billing&&c.pnames.indexOf(b.messages[d].billing.pname)!==-1&&(b.messages[d].billing.state=c.state,b.messages[d].billing.isPaid=c.state===D.STATES.paid?1:0)}),b.$on("service:longpoll:billing",function(a,c){if(parseInt(e.folderId)===l.folders.BILLING)for(var d=0;d<b.messages.length;d++)b.messages[d].id===c.msgId&&(b.messages[d].billing=c)}),l.env.device.isMobile?(l.env.isMobileApp&&b.$on("isapp:message-list:clear-selection",function(){b.clearSelection()}),b.clickMoreMessages=function(a){b.isMoreMessages&&!b.isMoreMessagesLoading&&r(function(){b.isMessagesLoading=!0,b.loadMoreMessages(!0),a.preventDefault()},0)},b.$on("message:open-message:prev-next",function(a,b){"prev"===b?(S(),p.pushIWACode("swipeMessageLeft")):"next"===b&&(T(),p.pushIWACode("swipeMessageRight"))}),b.$on("controller:counters:update",function(){b.unseenMessageCount=s.getSumAllCounters()}),b.openNavigation=function(a){K(),L(),d.go(".navigation"),p.pushIWACode("mobileOpenNavigation"),a&&p.pushIWACode("swipeOpenNavigation")}):(b.$on("directive:column-resize:left-column-min",function(){r(function(){b.leftColumnMin=!0,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-column-greater",function(){r(function(){b.leftColumnMin=!1,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-pre-column-min",function(){r(function(){b.leftPreColumnMin=!0,b.$digest()},0,!1)}),b.$on("directive:column-resize:left-pre-column-greater",function(){r(function(){b.leftPreColumnMin=!1,b.$digest()},0,!1)}),b.$on("infoboard:push-prompt",function(){u.displayById(u.PUSH_PROMPT,!0)})),E(),b.$on("$destroy",function(){var a=s.getCounters();a.folders[e.folderId]&&c.$broadcast("controller:folder:seen",e.folderId),aa()})}]),angular.module("nxt-message").controller("MessageMainCtrl",["$scope","$rootScope","$stateParams","$state","Message","Folder","Notification","ApplicationData","ApplicationConfig","Attachments","$q","Compositions","Search","$timeout","$sce","DialogManager","Track","InfoBoards","MobileApp","$window","Billing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(a){if(angular.isArray(a)){var b,c=[],d=[];for(b=0;b<a.length;b++)a[b].id&&d.indexOf(a[b].id)===-1&&(c.push(a[b]),d.push(a[b].id));return c}return a}function w(a){var b;return a.attachmentsLength=0,b=a.mimeParts||[],a.attachmentsLength+=b.length,b=a.mimePartsThumb||[],a.attachmentsLength+=b.length,a}function x(a,b){var c,d,e=[];for(d="number"==typeof b?Math.min(b,a.length):a.length,c=0;c<d;c++)e.push(w(a[c]));return e}function y(a,b){var c;for(c=0;c<b.length;c++)b[c].id===a.id&&(b[c]=a,b[c].isFull=!0,b[c].seen=!0);return b}function z(b){var d=k.defer(),f={id:b,leaveAsUnread:c.leaveAsUnread};return a.isEml&&c.mpid&&(f.mpid=c.mpid),e.get(f).then(function(a){a?d.resolve(a):d.reject("Pusta zwrotka dla messageId = "+b)}),d.promise}function A(){if(c.threadId)a.$emit("message:getCachedThread",c.threadId),a.threadId=c.threadId;else if(c.messageId){if(c.messageId<=0)return;z(c.messageId).then(function(b){a.firstFullMessage=b,a.threadId=b.threadId,b.threadId&&b.threadId!==-1?a.$emit("message:getCachedThread",b.threadId):D({isThreadFound:!0,allMessagesCount:1,messages:[b]}),i.env.isMobileApp&&b&&s.sync("message",b)})}else console.error("Brak parametru threadId lub messageId")}function B(b,c,d){var f=k.defer();return d=void 0===d||d,d&&(a.messagesToLoadCount=0),e.getThread(b).then(function(a){a&&a.length?f.resolve(x(a,c)):f.reject("Pusta zwrotka dla threadId = "+b)}),f.promise}function C(b){var c=k.defer();return a.firstFullMessage?(a.firstFullMessage.isMailing||(a.firstFullMessage.replyOpened=!0),c.resolve(y(a.firstFullMessage,b))):b.length&&"undefined"!=typeof b[0]?z(b[b.length-1].id).then(function(d){a.firstFullMessage=d,a.firstFullMessage.isMailing||(a.firstFullMessage.replyOpened=!0),c.resolve(y(d,b))}):(g.error("message:thread-error"),a.isMessageLoaded=!0),c.promise}function D(b){K=!0,b.isThreadFound?(a.messagesToLoadCount=b.allMessagesCount-b.messages.length,a.messagesToLoadCountPerm=a.messagesToLoadCount,C(b.messages).then(function(b){a.thread=v(b),a.isMessageLoaded=!0})):B(b.threadId).then(function(b){b=b.map(function(a,c){return a.isOld=c<b.length-J,a}),b.length>J&&(a.showOldMessages=!1,a.messagesToLoadCountPerm=b.length-J),C(b).then(function(b){a.thread=v(b),a.isMessageLoaded=!0})},function(){C([a.firstFullMessage]).then(function(b){a.thread=v(b),a.isMessageLoaded=!0})})}function E(){var a=[];return angular.forEach(i.folders,function(b){b.id&&b.parentId<=0&&a.push(b)}),a}function F(b){for(var c=0;c<L.length;c++)if(parseInt(L[c].id)===parseInt(b)){a.folder=f.getAdditionalSystemsFolderInfo(L[c]);break}a.userFolders=L.filter(function(a){return f.isUsersFolder(a)})}var G=1,H=2,I=3,J=3,K=!1,L=[];a.isMobile=i.env.device.isMobile,a.isForcedShowImages=!1,a.rightColumnMin=i.env.isRightColumnMin,a.isHTML=!0,a.isIos8PlusOnIpad=i.hacks.isIpad&&i.hacks.iosVersion>=8,a.isIOS=i.hacks.isIOS,a.isIOSApp=i.hacks.isIOS&&i.env.isMobileApp,a.isInt="int"==i.env.service.name,a.avatarsShowed=i.env.showAvatars,a.isReplyingToSingle=1==i.env.replyOption,a.isEml=!!c.mpid,a.folders=i.folders,a.hasSocialFolder=i.env.hasSocialFolder,a.hasShoppingFolder=i.env.hasShoppingFolder,a.hasBillingFolder=i.hasBillingFolderSetting(),a.webmailLinks=i.links,a.safetySenderReadMoreUrl=a.webmailLinks.safetySenderReadMore.url,a.isShowAdDescription=i.isShowAdDescription,a.isMobileApp=i.env.isMobileApp,a.specialMessageType=c.specialMessageType,a.isRemarketing=c.specialMessageType===G,a.isBok=c.specialMessageType===H,a.isFakeMail=c.specialMessageType===I,a.iframeIsLoaded=!1,a.isMobile?a.stickyMessageToolbar=function(){for(var b=0,c=0;c<a.thread.length;c++)a.thread[c].isFull&&b++;if(1===b)return!0}:(a.$on("tinymce:switched-editor-mode",function(b,c){n(function(){a.isHTML=c.isHTML,a.$digest()},0,!1)}),a.$on("message:iframe:onload",function(){n(function(){a.iframeIsLoaded=!0},300)})),L=E(),0===L.length?f.query().then(function(a){L=a,F(c.folderId)}):F(c.folderId),a.thread=[],a.$on("service:messages:favorite",function(b,c){a.thread&&c.messages.some(function(b){return b.id===a.thread[a.thread.length-1]&&(a.thread[a.thread.length-1].isStarred=!a.thread[a.thread.length-1].isStarred,!0)})}),a.$on("composition:sent",function(f,g){if(!c.threadId&&g.threadId)d.go("thread",{threadId:g.threadId}),b.$broadcast("message:transform-to-thread",g);else{var h,i=a.thread.length-1;for(h=0;h<a.thread.length;h++)if(a.thread[h].relatedDraft&&a.thread[h].relatedDraft.id===g.originalMessageId||a.thread[h].id===g.originalMessageId){delete a.thread[h].relatedDraft,a.thread[h].replyOpened=!1;break}e.get({id:g.newMessageId}).then(function(b){var c=b;c.isFull=!0,c.isFullDownloaded=!0,c.body=angular.element(b.content).text(),a.thread.splice(i+1,0,c)}),g.threadId&&b.$broadcast("thread:increase-counter",g.threadId)}}),a.$on("composition:saved",function(b,c){var d;for(d=0;d<a.thread.length;d++)!a.thread[d].isFullDownloaded&&!a.thread[d].isFull||parseInt(a.thread[d].id)!==parseInt(c)&&parseInt(a.thread[d].relatedDraft&&a.thread[d].relatedDraft.id)!==parseInt(c)||!function(b){var c;z(a.thread[b].id).then(function(d){c=a.thread[b].isFull,a.thread[b]=d,a.thread[b].isFull=c})}(d)}),a.$on("folder-to-message:star-active",function(b,c){a.thread.forEach(function(a,b,d){c.flagged.indexOf(a.id)!==-1?d[b].isStarred=!0:c.unflagged.indexOf(a.id)!==-1&&(d[b].isStarred=!1)})}),i.env.device.isMobile||(a.$on("directive:column-resize:right-column-min",function(){n(function(){a.rightColumnMin=!0,a.$digest()},0,!1)}),a.$on("directive:column-resize:right-column-greater",function(){n(function(){a.rightColumnMin=!1,a.$digest()},0,!1)})),a.isMessageLoaded=!1,a.getMessageFromThread=function(c){var d,f;a.thread[c].isFullDownloaded?a.thread[c].isFull=!0:(d=a.thread[c].body,f=a.thread[c].isOld,e.get({id:a.thread[c].id}).then(function(e){if(a.thread[c]=e,a.thread[c].body=d,a.thread[c].isFull=!0,a.thread[c].isFullDownloaded=!0,a.thread[c].isOld=f,a.thread[c].seen=!0,!a.isMobile){a.isMessageLoaded&&a.messagesToLoadCount>0&&B(a.threadId,a.messagesToLoadCount,!1).then(function(b){b.forEach(function(a){a.isOld=!0}),a.thread=v(b.concat(a.thread))});for(var g=0,h=0;h<a.thread.length;h++)a.thread[h].seen||g++;0===g&&b.$broadcast("msglist:mark-seen",{message:a.thread[a.thread.length-1]})}})),q.pushIWACode("messageThreadExpand")},a.$on("message:cachedThreadProvided",function(a,b){D(b)}),A(),a.$on("folder:getCachedThreadEventAttached",function(){K||A()}),a.loadOldMessages=function(){a.oldMessagesLoaded||(a.isMessageLoaded=!1,B(a.threadId,a.messagesToLoadCount).then(function(b){b.forEach(function(a){a.isOld=!0}),a.thread=v(b.concat(a.thread)),a.isMessageLoaded=!0,a.oldMessagesLoaded=!0})),a.showOldMessages=!0,q.pushIWACode("messageThreadOldMsg")},a.hideOldMessages=function(){a.showOldMessages=!1},a.collapseMessage=function(b){a.thread[b].isFull=!1,q.pushIWACode("messageThreadHide")},a.markAsFavorite=function(c){c=c||a.firstFullMessage,e.markAsFavorite({id:c.id,folderId:c.folderId,isStarred:c.isStarred}).then(function(d){c.isStarred?b.$broadcast("message-to-folder:star-message-on-list",{id:c.id,threadId:a.threadId,isStarred:c.isStarred}):angular.isArray(d.flagStatus)&&d.flagStatus.length&&angular.isObject(d.flagStatus[0])&&b.$broadcast("message-to-folder:star-message-on-list",{threadId:d.flagStatus[0].threadId,isStarred:!!d.flagStatus[0].isStarred})},function(){c.isStarred=!c.isStarred}),c.isStarred=!c.isStarred},a.moveToSpam=function(){"mailing"==a.firstFullMessage.msgType&&r.displayById(r.SPAM_MAILING_BOARD_ID,!0),a.firstFullMessage.fUnsubscribable&&a.messageUnsubscribeConfirm(a.firstFullMessage),e.moveToFolder(i.folders.SPAM,a.firstFullMessage).then(function(){d.go("folder")}),q.pushIWACode("viewMailToolboxMove","Spam")},a.moveToUnSpam=function(){e.moveToUnSpam(a.firstFullMessage).then(function(){d.go("folder")}),q.pushIWACode("notSpam","otwarty_mail")},a.forward=function(a){l.addComposition({opt:"f",mesg:a.id,folder:a.folder,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig}),a.length>1&&q.pushGACode()},a.showMailingHistory=function(){m.searchHistory(a.firstFullMessage.fromEmail)},a.moveToTrash=function(){e.moveToFolder(i.folders.TRASH,a.firstFullMessage).then(function(){d.go("folder")}),a.firstFullMessage.isMailing&&r.displayById(r.REMOVE_MAILING_BOARD_ID,!0),q.pushIWACode("removeThread"),q.pushIWACode("messageDeleteThread"),q.pushIWACode("viewMailToolboxMove","Kosz")},a.moveMessageFromThreadToTrash=function(b){var c=a.thread[b];c&&(c.threadId=-1,e.moveToFolder(i.folders.TRASH,c).then(function(){a.thread.splice(b,1),a.thread.length<=0&&d.go("folder")}),c.isMailing&&r.displayById(r.REMOVE_MAILING_BOARD_ID,!0)),q.pushIWACode("viewMailToolboxMove","Kosz")},a.deleteMessage=function(b){var c=b?a.thread[b]:a.firstFullMessage;p.confirm({title:"Usuń wiadomość",message:"Czy chcesz usunąć wiadomość?",confirm:"Usuń",callback:function(){e.deleteMessage({id:c.id,folderId:c.folderId}).then(function(){d.go("folder")})}})},a.moveToFolder=function(c,g){i.env.device.isMobile&&n(function(){b.$broadcast("directive:dropdown:hideAll-force")},0,!1),g=g||a.firstFullMessage,e.moveToFolder(c,g).then(function(){d.go("folder")}),q.pushIWACode("viewMailToolboxMove",f.getCachedFolderById(c).name)},a.showImages=function(c){null===c.from.email?b.$broadcast("service:message:show-images"):(c=c||a.firstFullMessage,e.showImages(c))},a.alwaysShowImages=function(b){b=b||a.firstFullMessage,e.alwaysShowImages(b).then(function(){g.success("message:sender-marked-as-trusted")})},a.$on("folder:controller:showAvatars",function(){a.avatarsShowed=i.env.showAvatars}),a.$on("message:content:open-slideshow",function(){var b=a.firstFullMessage.attachments.map(function(a){return a.thumbUrl=a.thumbnail,a});a.openSlideshow(b,b[0].name)}),a.openSlideshow=function(a,b,c){d.go(".slideshow",{attachments:a,attachmentName:b,isForVideos:c})},a.openHTMLPlayer=function(a,b){d.go(".slideshow",{attachments:a,attachmentName:b,isForIosVideos:!0})},a.openVideoSlideshow=function(b,c){a.openSlideshow(b,c,!0)},a.print=function(a){var b="/"+i.env.baseUrl+"/mail/"+a.id+"/print?uid="+i.env.uid;window.open(b),q.pushIWACode("messagePrint")},a.reply=function(b){1==i.env.replyOption?a.replyToSender(b):a.replyToAll(b)},a.replyToAll=function(a){l.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,cc:a.cc,from:a.to,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig,isReplyingToSingle:!1})},a.replyToSender=function(a){l.addComposition({opt:"ra",mesg:a.id,to:a.replyTo||a.from,envelopeTo:a.envelopeTo,originalRecipients:a.originalRecipients,senderConfig:a.senderConfig,isReplyingToSingle:!0}),q.pushIWACode("replyOnlySender")},a.$on("composition:popout",function(){a.compositionRemoved=!0}),a.$on("composition:activated",function(){a.isCompositionActive=!0}),a.$on("message:forced-show-images",function(b,c){a.isForcedShowImages=c}),a.$on("service:folder:deleted",function(b,c){a.userFolders=a.userFolders.filter(function(a){return a.id!=c.id})}),a.showDetails=function(a){if(!a.parsedHeaders){var b,c,d=[{find:"Cc",replace:"DW"},{find:"To",replace:"Do"},{find:"From",replace:"Od"},{find:"Date",replace:"Data"}];for(b=0;b<d.length;b++)for(c=0;c<a.headers.length;c++)0===a.headers[c].indexOf(d[b].find+": ")&&(a.headers[c]=a.headers[c].replace(d[b].find,d[b].replace),a.headers.unshift(a.headers.splice(c,1).pop()));a.parsedHeaders=a.headers.map(function(a){var b=a.split(": ");return{key:b.shift(),value:o.trustAsHtml(b.join(": "))}})}a.isDetailsVisible=!a.isDetailsVisible,q.pushIWACode("partialMessageDetails")},a.stopDownload=function(a){i.hacks.isFirefox&&h.getIsRequesting()&&(a.preventDefault(),a.stopPropagation())},a.openAtt=function(a,b){j.openAtt(a,b)},a.messageUnsubscribeConfirm=function(a){p.confirm({title:"Zgłoszenie niechcianej wiadomości",message:"Ten nadawca umożliwia automatyczne wypisanie się z listy adresatów, dzięki temu nie będziesz otrzymywać od niego tego typu wiadomości. Czy chcesz skorzystać z tej opcji?",confirm:"wypisz mnie",template:"/dialog/views/dialog_unsubscribe.html",additionalData:a,callback:function(){e.messageUnsubscribe(a)}})},a.back=function(){d.go("^")},a.isShowAdUnderMessage=function(b){var d=i.env.accountType,e=!d&&!a.isMobile||t.screen.width>=768&&a.isMessageLoaded&&a.iframeIsLoaded,f=c.folderId==u.FOLDER_ID;return"750x200_next_folder"===b?e&&!f:"box300x250"===b?e&&f:e},a.$on("service:billing:mark-as-paid",function(b,c){for(var d=0;d<a.thread.length;d++)a.thread[d].billing&&c.pnames.indexOf(a.thread[d].billing.pname)!==-1&&(a.thread[d].billing.state=c.state,a.thread[d].billing.isPaid=c.state===u.STATES.paid?1:0)}),a.$on("service:longpoll:billing",function(b,d){if(parseInt(c.folderId)===i.folders.BILLING)for(var e=0;e<a.thread.length;e++)a.thread[e].id===d.msgId&&(a.thread[e].billing=d)})}]),angular.module("nxt-navigation").controller("NavigationFolderEditCtrl",["$scope","$state","$stateParams","Folder","ApplicationConfig","$rootScope","$filter",function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c,d,e=!1;for(d=a.length;d--;)if(c=a[d],c.id==b.parentId?e=c:c.subfolders&&(e=h(c.subfolders,b)),e)return e;return e}function i(b,c){if(c.isNew)b.push(c),c.parentId||(a.$parent.selectUserFolders.push(c),a.$parent.selectUserFolders=g("orderBy")(a.$parent.selectUserFolders,"name"));else{var d,e;for(e=0;e<a.$parent.userFolders.length;e++)if(a.$parent.userFolders[e].id==c.id)a.$parent.userFolders.splice(e,1);else if(a.$parent.userFolders[e].subfolders)for(var f=0;f<a.$parent.userFolders[e].subfolders.length;f++)a.$parent.userFolders[e].subfolders[f].id==c.id&&a.$parent.userFolders[e].subfolders.splice(f,1);for(e=b.length;e--;)d=b[e],d.id==c.id&&(d.name=c.name,d.parentId=c.parentId);b.push(c)}}a.specialCharsPattern=e.patterns.specialChars,a.close=function(){a.env.device.isMobile?b.go("^"):a.userFolders.length?b.go("^.folder-list"):b.go("^.^")},c.folderEditId?(a.folder=e.folders[c.folderEditId],d.get({id:c.folderEditId}).then(function(b){a.folder=b})):a.folder={id:-1},a.submit=function(){d.save(a.folder).then(function(b){if(b.isNew=!c.folderEditId,b.parentId){var d=h(a.userFolders,b);d.subfolders=d.subfolders||[],i(d.subfolders,b)}else i(a.userFolders,b);f.$broadcast("folders:refresh"),a.close()})}}]),angular.module("nxt-navigation").controller("NavigationMainCtrl",["$scope","$rootScope","$location","$state","$stateParams","$filter","ApplicationConfig","Folder","Compositions","Notification","Counter","DialogManager","Track","MobileApp","InfoBoards",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(){h.queryAsMap().then(function(b){k.update(b),a.folders=b.system,a.userFolders=[],Object.keys(b.user).forEach(function(c){var d=b.user[c];0===d.parentId&&a.userFolders.push(d)});for(var c=f("orderBy")(a.userFolders,"name"),d=0;d<c.length;d++)if(c[d].isAd===!0){var e=c.splice(d,1);c.push(e[0]);break}a.sortListFolder=c,a.selectUserFolders=[{id:0,name:"Brak folderu nadrzędnego"}].concat(c)})}a.env=g.env,a.links=g.links,a.isOldAndroid=g.hacks.AndroidVersion<4.3,a.isTouch=g.env.device.isMobile,a.isNavigationFolder=/(folder-list|folder.edit)$/.test(d.current.name),a.isSearch=/\?search/.test(c.url()),a.hasSocialFolder=g.env.hasSocialFolder,a.hasShoppingFolder=g.env.hasShoppingFolder,a.isActiveBilling=1===g.env.billing.status,a.showBillingFolder=g.env.hasBillingFolder||g.isBillingEnabled();var q=g.env.isCorp;a.showSpamCounter=1===g.env.showSpamCounter||q&&g.env.showSpamCounter===-1,a.sendSuggestConf=!!g.getConfigAppModule("navigation")&&g.getConfigAppModule("navigation").data.sendSuggest,e.folderId&&(a.activeFolderId=e.folderId),k.init(),p(),a.$on("folders:refresh",p),a.showSettings=function(){g.env.isMobileApp?n.showSettings():d.go("^.settings")},a.close=function(){g.env.device.isMobile?d.go("^"):a.isNavigationFolder&&d.go("^.^")},a.$on("ui-events:keydown:Escape",function(){"folder"!==d.current.name&&d.current.name.indexOf("slideshow")===-1&&a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"navigation"!==c.panel&&a.close()}),a.openComposition=function(){i.addComposition(),b.$broadcast("bubble:close",5)},a.openFolderAdd=function(a){g.env.device.isMobile||a?d.go(".folder-edit"):d.go("^.folder-edit")},a.openFolderList=function(){g.cacheTime=Date.now(),d.go(".folder-list")},a.openContacts=function(){d.go("^.contact")},a.deleteFolderMessages=function(a,c){var d={};d.name=a,d.id=c,b.$broadcast("controller:folder:delete-all-folder-messages",d)},a.$on("controller:folder:main",function(b,c){a.activeFolderId=c.folderId,a.isSearch=c.isSearch}),a.openFolderEdit=function(a){g.env.device.isMobile?d.go(".folder-edit",{folderEditId:a.id}):d.go("^.folder-edit",{folderEditId:a.id})},a.deleteFolder=function(b){l.confirm({title:"Usuń folder",message:"Czy chcesz usunąć ten folder i przenieść jego zawartość do kosza?",confirm:"Usuń",callback:function(){b._destroy=!0,h.deleteFolder(b.id).then(function(){b.parentId?a.userFolders.forEach(function(a){a.id==b.parentId&&(a.subfolders=a.subfolders.filter(function(a){return a.id!=b.id}))}):(a.userFolders=a.userFolders.filter(function(a){return a.id!=b.id}),a.selectUserFolders=[{id:0,name:"Brak folderu nadrzędnego"}].concat(a.userFolders)),a.userFolders.length?g.env.hasCustomFolder=!0:g.env.hasCustomFolder=!1},function(){b._destroy=!1})}})},a.sendSuggest=function(){var b;b={to:{email:a.sendSuggestConf.email,name:"BOK"},subject:g.env.isMobileApp?a.sendSuggestConf.subjectApp:a.sendSuggestConf.subject,autoFocusContent:!0},i.addComposition(b)},a.openOffer=function(){m.pushIWA(["next","foldery","klik","oferty"])},a.openSocial=function(){m.pushIWA(["next","foldery","klik","spolecznosci"])},a.openBilling=function(b){g.folders.BILLING?a.pushStats(g.folders.BILLING):(b.stopPropagation(),b.preventDefault(),l.billing(!1,"po_kliku_w_folder"))},a.pushStats=function(a){var b=g.folders[a],c="",d="-";b&&(c=b.name,h.isUsersFolder(b)&&(d=a)),m.pushPartialFolder(c,d)},a.$on("service:folder:delete",function(b,c){a.folders&&(a.folders[c].total=0)}),a.$on("directive:newcomposition:save",function(){a.folders&&a.folders[g.folders.DRAFTS].total++}),a.$on("controller:counters:update",function(){a.counters=k.getCounters()}),a.$on("$stateChangeSuccess",function(b,c,d){a.activeFolderId=d.folderId}),a.$on("controller:folder:refresh",function(b,c){a.isRefreshingCurrentFolder=c}),a.logout=function(a){a.stopPropagation(),n.logout()}}]),angular.module("nxt-settings").controller("SettingsMainCtrl",["$scope","$state","ApplicationConfig","Uploader","Theme","Compositions","Track","DialogManager","InfoBoards","ServiceWorker",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){var b=a.env.ownEmail;a.isBusinessAccount=!1,1!==c.env.adminBusinessPackType&&2!==c.env.adminBusinessPackType||(a.isBusinessAccount=!0);for(var d=0;d<a.links.length;d++)a.links[d].hasOwnProperty("generateDescriptionAndUrl")&&(a.isBusinessAccount?(a.links[d].description="Zarządzaj domeną, kontami firmowymi i stroną www.",a.links[d].url=a.env.business_settings+"?iwa_source=poczta_next_ustawienia"):(b=b.replace(/[-_.]/g,""),b="kontakt@"+b.substring(0,b.indexOf("@")),b+=".pl",a.links[d].name=b,a.links[d].description="Gotowa strona www, własna domena, dodatkowy adres e-mail, zgodność z RODO i żadnych reklam.<br/>Poznaj pakiet nowych usług - dla każdego!",a.links[d].url=a.env.business_settings+"?iwa_source=poczta_next_ustawienia")),a.links[d].additionalClass&&a.links[d].additionalClass.indexOf("settings-link-push")!==-1&&(j.isPushServiceWorker()||(a.links.splice(d,1),d--)),a.links[d].additionalClass&&a.links[d].additionalClass.indexOf("clean-mail")!==-1&&j.isPushServiceWorker()&&(a.links.splice(d,1),d--),a.links[d].additionalClass&&a.links[d].additionalClass.indexOf("autoresponder")!==-1&&(j.isPushServiceWorker()&&!c.env.adminBusinessPackType||!j.isPushServiceWorker()&&!c.env.adminBusinessPackType)&&(a.links.splice(d,1),d--),!a.isBusinessAccount&&a.links[d].hasOwnProperty("isDisplayOnlyPremium")&&(a.links.splice(d,1),d--)}function l(){var b,d=a.moduleConfig.data.links,e=!0;c.env.device.isPc?b="isPc":c.env.device.isMobile&&(b="isMobile"),1!==c.env.adminBusinessPackType&&2!==c.env.adminBusinessPackType||(e=!1);for(var f=0;f<d.length;f++)if(!e&&d[f].hasOwnProperty("noAds")||d[f].hasOwnProperty(b)&&a.links.push(d[f]),d[f].hasOwnProperty("pathSource")&&(d[f].isInit||(d[f].url=a.env[d[f].pathSource]+d[f].url,d[f].isInit=!0)),d[f].hasOwnProperty("isPersonalData"))switch(c.env.accountType){case 0:d[f].url="http://pomoc.poczta.interia.pl/news-informacje-dotyczace-przetwarzania-danych-osobowych-konto-be,nId,2574158?iwa_source=poczta_next_ustawienia";break;case 1:c.env.adminBusinessPackType>0?d[f].url="http://pomoc.poczta.interia.pl/news-obowiazek-informacyjny-w-sciezce-rejestracji-pakiet-dla-firm,nId,2584997":1===c.env.isYoung?d[f].url="http://pomoc.poczta.interia.pl/news-informacje-dotyczace-przetwarzania-danych-osobowych-konto-te,nId,2574183":d[f].url="http://pomoc.poczta.interia.pl/news-informacje-dotyczace-przetwarzania-danych-osobowych-konto-pl,nId,2574173"}k()}a.moduleConfig=c.getConfigAppModule("settings"),a.env=c.env,a.webmailLinks=c.links,a.disableActions=a.moduleConfig.actions||{},a.isCorp=c.env.isCorp,a.isMobile=c.env.device.isMobile,
a.isInt=a.env.service&&"int"===a.env.service.name,a.links=[],a.changeable=!a.isInt&&c.env.adminBusinessPackType!=c.ADMIN_BUSINESS_TYPE.SUBACCOUNT,l();var m=a.env.ownEmail.split("@");if(m[0].length>=13?a.breakLineOwnEmail=m[0]+"<br>@"+m[1]:a.breakLineOwnEmail=a.env.ownEmail,a.currentYear=(new Date).getFullYear(),1==c.env.accountType)a.autopromo=a.env.autoPromo.settings;else{var n=Math.floor(3*Math.random()+1);a.autopromo=a.env.autoPromo["settings"+n],g.pushGA(["Autopromo_bez_reklam","wyswietlenie","v"+n])}a.close=function(){a.$broadcast("settings:close"),b.go("^")},a.openExternalPanel=function(){b.go("^.external-account.configure")},a.$on("ui-events:keydown:Escape",function(){a.close()}),a.$on("ui-events:click",function(b,c){c.panel&&"settings"!==c.panel&&a.close()}),a.$watch("env.device.isMobile",function(a){var b=a?"isMobilePhone":"nonMobileDevice",c=new Date;c.setDate(c.getDate()+14),document.cookie="inpl_mail_device_type="+escape(b)+";expires="+c.toUTCString()}),a.getLastLoginText=function(){return null===a.env.lastLogin?"Pierwsze logowanie":"Ostatnie logowanie:"+(c.env.device.isPc?"<br>":"")+a.env.lastLogin},a.functions={sendToBOK:function(b){f.addComposition({to:{email:"bok@firma.interia.pl",name:"BOK"},subject:"Poczta Firmowa - zgłoszenie do BOK",autoFocusContent:!0}),a.close(),b.preventDefault()},wizard:function(b){i.getBoardConfById(210).then(function(b){h.multiBoards(b.options),a.close()}),b.preventDefault()},pushSettings:function(b){h.pushSettings(),a.close(),b.preventDefault()}},a.isMobile&&(!c.hacks.isWindowsPhoneOS&&!c.env.isMobileApp&&a.webmailLinks.settingsAndroidApp&&a.webmailLinks.settingsIOSApp&&(c.env.device.isAndroid?a.linkToTouchApp=a.webmailLinks.settingsAndroidApp.url:c.env.device.isIOS&&(a.linkToTouchApp=a.webmailLinks.settingsIOSApp.url)),a.mobileCopyright=a.env.autoPromo.mobileCopyright),a.$on("controller:wizard:ownNameUpdate",function(){a.env.ownName=c.env.ownName}),g.pushIWACode("partialViewSettings")}]),angular.module("nxt-slideshow").controller("SlideshowMainCtrl",["$scope","$state","$stateParams","Message","$timeout","ApplicationConfig","Compositions","Attachments","Track","ScopeService",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){return a.photos.filter(function(a){return a.checked})}function l(){if(a.photos)for(var b=0;b<a.photos.length;b++)a.photos[b].checked=!1}if(a.interval=3e3,a.isPlaying=!1,a.timeoutH=null,a.isPc=f.env.device.isPc,a.isMobile=f.env.device.isMobile,a.isForVideos=c.isForVideos,a.isForIosVideos=c.isForIosVideos,a.checkedPhotosCount=0,a.close=function(){l(),b.go("^")},c.attachments||a.close(),c.attachments){if(a.isForIosVideos){c.attachments.filter(function(b,d){b.name==c.attachmentName&&(a.currentIndexVideo=d)});var m=h.getStreamUrl(c.attachments[a.currentIndexVideo].url);a.currentVideo=m}a.photos=c.attachments.map(function(b,d){b.name==c.attachmentName&&(a.currentPhoto=b,a.currentIndex=d);var e=b.name.match(/(.+)\.([^\.]+)/);return e&&3===e.length&&(b.extension=e[2]),b.rotationAngle=0,b}),a.isPrev=a.currentIndex>0,a.isNext=a.currentIndex<a.photos.length-1}else a.photos=[];a.changePhoto=function(){a.currentPhoto.selected=!1,a.currentPhoto=a.photos[a.currentIndex],a.currentPhoto.selected=!0,a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex}),a.isPrev=a.currentIndex>0,a.isNext=a.currentIndex<a.photos.length-1},a.previous=function(){a.currentIndex=Math.max(a.currentIndex-1,0),a.changePhoto(),a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex})},a.next=function(){a.currentIndex=Math.min(a.currentIndex+1,a.photos.length-1),a.changePhoto(),a.$broadcast("controller:slideshow:changephoto",{index:a.currentIndex})},a.previousPack=function(){a.$broadcast("controller:slideshow:previousPack")},a.nextPack=function(){a.$broadcast("controller:slideshow:nextPack")},a.play=function(){a.currentIndex=Math.min(a.currentIndex+1,a.photos.length-1),a.changePhoto(),a.isPlaying&&(a.timeoutH=e(function(){a.play()},a.interval))},a.rotateLeft=function(){a.$broadcast("slideshow:image:rotate",{currentIndex:a.currentIndex,direction:"left",mid:a.currentPhoto.mid,mpid:a.currentPhoto.mpid}),i.pushIWACode("attachGalleryRotatePhoto")},a.rotateRight=function(){a.$broadcast("slideshow:image:rotate",{currentIndex:a.currentIndex,direction:"right",mid:a.currentPhoto.mid,mpid:a.currentPhoto.mpid}),i.pushIWACode("attachGalleryRotatePhoto")},a.stop=function(){e.cancel(a.timeoutH)},a.selectPhoto=function(b){a.isForIosVideos&&(a.currentVideo=!1,e(function(){a.streamVideoUrl=h.getStreamUrl(c.attachments[b].url),a.currentVideo=a.streamVideoUrl},0)),a.currentIndex=b,a.changePhoto(),i.pushIWACode("attachGalleryThumbnail")},a.togglePlay=function(){a.isPlaying?e.cancel(a.timeoutH):(a.timeoutH=e(function(){a.play()},a.interval),i.pushIWACode("attachGallerySlideShow")),a.isPlaying=!a.isPlaying},a.isShowNavigation=!1,a.showNavigationTimeout=null,a.showNavigation=function(){a.isShowNavigation=!0,a.cancelPreviousShowNavigationTimeout(),a.hideNavigation()},a.downloadPhoto=function(a){window.location=a},a.cancelPreviousShowNavigationTimeout=function(){e.cancel(a.showNavigationTimeout)},a.hideNavigation=function(){a.showNavigationTimeout=e(function(){a.isShowNavigation=!1},2e3)},a.changeSendMode=function(b){a.sendMode=b,b||l(),i.pushIWACode("attachGalleryForward")},a.checkPhoto=function(b){b.checked?a.checkedPhotosCount--:a.checkedPhotosCount++,b.checked=!b.checked},a.sendMessage=function(){for(var b=k(),c=[],d=0;d<b.length;d++)c.push({mid:b[d].mid,mpid:b[d].mpid});a.close(),g.addComposition({mesg:c[0].mid,singleInstanceId:c[0].mid,opt:"att",attach:JSON.stringify(c)})},a.showNavigation(),f.env.device.isPc&&(a.$on("ui-events:keydown:Escape",function(){j.safeApply(a,function(){a.isPlaying&&(a.stop(),a.isPlaying=!1)}),a.close()}),a.$on("ui-events:keydown:Left",function(){j.safeApply(a,function(){a.previous()})}),a.$on("ui-events:keydown:Right",function(){j.safeApply(a,function(){a.next()})})),a.$on("slideshow:leftrightbuttons",function(b,c){a.buttonLeftEnabled=c.left,a.buttonRightEnabled=c.right})}]),function(a){"use strict";function b(a,b){for(var c=b.parentNode;null!==c;){if(c===a)return!0;c=c.parentNode}return!1}var c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a.module("pickadate",[]).provider("pickadateI18n",function(){var a={prev:"prev",next:"next"};this.translations={},this.$get=function(){var b=this.translations;return{t:function(c){return b[c]||a[c]}}}}).factory("pickadateUtils",["$locale",function(b){function c(a){switch(a){case"dd":return"day";case"MM":return"month";case"yyyy":return"year"}}return{parseDate:function(b,d){if(b){if(a.isDate(b))return new Date(b);d=d||"yyyy-MM-dd";var e="(dd|MM|yyyy)",f=d.match(/[-|\/]/)[0],g=b.split(f),h=new RegExp([e,e,e].join(f)),i=d.match(h),j={};if(i.shift(),a.forEach(i,function(a,b){j[c(a)]=parseInt(g[b],10)}),!(isNaN(j.year)||isNaN(j.month)||isNaN(j.day)))return new Date(j.year,j.month-1,j.day,3)}},buildDates:function(a,b){var c=[],d=new Date(a.getFullYear(),a.getMonth()+1,0,3);for(b=b||{},a=new Date(a);a.getDay()!==b.weekStartsOn;)a.setDate(a.getDate()-1);for(var e=0;e<42&&!(b.noExtraRows&&a.getDay()===b.weekStartsOn&&a>d);e++)c.push(new Date(a)),a.setDate(a.getDate()+1);return c},buildDayNames:function(a){var c=b.DATETIME_FORMATS.SHORTDAY;if(a){c=c.slice(0);for(var d=0;d<a;d++)c.push(c.shift())}return c}}}]).directive("pickadate",["$locale","$sce","$compile","$document","$window","pickadateUtils","pickadateI18n","dateFilter","Tools",function(d,e,f,g,h,i,j,k,l){var m='<div class="pickadate" ng-show="displayPicker" ng-style="styles"><div class="pickadate-header"><div class="pickadate-controls"><a href="" class="pickadate-prev" ng-click="changeMonth(-1)" ng-show="allowPrevMonth">'+e.trustAsHtml(j.t("prev"))+'</a><a href="" class="pickadate-next" ng-click="changeMonth(1)" ng-show="allowNextMonth">'+e.trustAsHtml(j.t("next"))+'</a></div><h3 class="pickadate-centered-heading">{{currentDate | date:"MMMM yyyy"}}</h3></div><div class="pickadate-body"><div class="pickadate-main"><ul class="pickadate-cell"><li class="pickadate-head" ng-repeat="dayName in dayNames">{{dayName}}</li></ul><ul class="pickadate-cell"><li ng-repeat="d in dates" ng-click="setDate(d)" ng-class="classesFor(d)">{{d.dateObj | date:"d"}}</li></ul></div></div></div>';return{require:"ngModel",scope:{defaultDate:"=",minDate:"=",maxDate:"=",disabledDates:"=",weekStartsOn:"="},link:function(d,e,j,n){function o(){var a=new Date(d.currentDate.getFullYear(),d.currentDate.getMonth(),1,3),b=a.getMonth()+1,c=i.buildDates(a,{weekStartsOn:y,noExtraRows:w}),e=[],f=k(new Date,C),g=new Date(a);g.setMonth(b),d.allowPrevMonth=!u||a>u,d.allowNextMonth=!v||g<=v,d.dayNames=i.buildDayNames(y);for(var h=0;h<c.length;h++){var j=[],l=c[h],m=k(l,C),n=s(m);r(l)||n?j.push("pickadate-disabled"):j.push("pickadate-enabled"),n&&j.push("pickadate-unavailable"),m===f&&j.push("pickadate-today"),e.push({date:m,dateObj:l,classNames:j})}d.dates=e}function p(a,b){b=b||{},x?n.$setViewValue(a):n.$setViewValue(a[0]),b.skipRenderInput||e.val(n.$viewValue)}function q(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];s(d)||r(i.parseDate(d,C))||b.push(d)}return b}function r(a){return a<u||a>v||k(a,"M")!==k(d.currentDate,"M")}function s(a){return c.call(d.disabledDates||[],a)>=0}function t(a,b){var d=c.call(b,a);return d===-1?b.push(a):b.splice(d,1),b}l.setElementIsolateScope(e,d);var u,v,w=j.hasOwnProperty("noExtraRows"),x=j.hasOwnProperty("multiple"),y=d.weekStartsOn,z=[],A=e[0]instanceof HTMLInputElement,B=f(m)(d),C=(j.format||"yyyy-MM-dd").replace(/m/g,"M");d.displayPicker=!A,(!a.isNumber(y)||y<0||y>6)&&(y=0),d.setDate=function(a){r(a.dateObj)||s(a.date)||(z=x?t(a.date,z):[a.date],p(z),d.displayPicker=!A)};var D=n.$render=function(b){b=b||{},a.isArray(n.$viewValue)?z=n.$viewValue:n.$viewValue&&(z=[n.$viewValue]),d.currentDate=i.parseDate(d.defaultDate,C)||i.parseDate(z[0],C)||new Date,z=q(z),p(z,b),o()};if(d.classesFor=function(a){var b=c.call(z,a.date)>=0?"pickadate-active":null;return a.classNames.concat(b)},d.changeMonth=function(a){d.currentDate.setDate(1),d.currentDate.setMonth(d.currentDate.getMonth()+a),o()},d.$watch(function(){return a.toJson([d.minDate,d.maxDate,d.disabledDates])},function(){u=i.parseDate(d.minDate,C)||new Date(0),v=i.parseDate(d.maxDate,C)||new Date(99999999999999),D()}),A){var E=function(a){d.displayPicker=a,d.$apply()};e.on("focus",function(){var a=void 0!==h.pageXOffset,b="CSS1Compat"===(g.compatMode||""),c=a?h.pageXOffset:b?g.documentElement.scrollLeft:g.body.scrollLeft,f=a?h.pageYOffset:b?g.documentElement.scrollTop:g.body.scrollTop,i=h.innerWidth||g.documentElement.clientWidth||g.body.clientWidth;d.styles={top:f+e[0].getBoundingClientRect().bottom+"px"},i-e[0].getBoundingClientRect().left>=300?d.styles.left=c+e[0].getBoundingClientRect().left+"px":d.styles.right=i-e[0].getBoundingClientRect().right-c+"px",E(!0)}),e.on("keydown",function(a){c.call([9,13,27],a.keyCode)>=0&&E(!1)}),d.$watch(function(){return n.$viewValue},function(a){var b=i.parseDate(a,C);b&&D({skipRenderInput:!0}),n.$setValidity("date",!!b)}),g.on("click",function(a){b(B[0],a.target)||a.target===e[0]||E(!1)}),d.$$postDigest(function(){j.value&&(n.$viewValue=j.value,D())}),e.after(B.addClass("pickadate-modal"))}else e.append(B)}}}])}(window.angular),angular.module("nxt-dialog").controller("AccountNameWizardCtrl",["$scope","ApplicationConfig","Setting",function(a,b,c){"use strict";a.accountName=b.env.ownName,a.submit=function(){c.update({senderName:a.accountName}),b.env.ownName=a.accountName,a.$broadcast("controller:wizard:ownNameUpdate"),a.nextStep(!0)}}]),angular.module("nxt-dialog").controller("BusinessPackWizardCtrl",["$scope","ApplicationConfig",function(a,b){"use strict";a.businessSettingsUrl=b.env.business_settings}]),angular.module("nxt-dialog").controller("ExternalAccountWizardCtrl",["$scope",function(a){"use strict";a.$parent.isWizard=!0,a.$parent.externalAccountStep=0,a.$parent.wizardSuccess=function(){a.pushStat(a.board.stat.type,a.board.stat.go),a.nextStep(!0)},a.cancel=function(){a.$parent.externalAccountStep=0},a.$on("$destroy",function(){a.$parent.isWizard=!1})}]),angular.module("nxt-dialog").controller("UserAvatarWizardCtrl",["$scope","$rootScope","ApplicationConfig","$http","FileUploader","ThemeUploader","$timeout","Notification","Avatar","$cookies",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){g(function(){n=document.querySelector(".choose-avatar"),a.$digest()},0,!1),l()}function l(){a.uploader=f.getUploader(a)}function m(a){i.setAvatar({avatarId:a,sid:c.env.sid,uid:c.env.uid}).then(function(a){if(a&&a.data){var d=new Date;d.setDate(d.getDate()+40),j.remove(a.data.profileCookie),j.putObject(a.data.profileCookie,JSON.parse(a.data.profileDataManager),{expires:d,domain:c.env.domainForCookie,path:"/"}),b.$broadcast("controller:wizard:avatarChange")}},function(a){console.log("err",a)})}var n;a.workId=!1,a.addUserAvatar=function(){a.uploader.fileInputClick(document.querySelector(".skin-upload-frame--normal"),n)},a.afterAddingAll=function(b,c){c&&(a.uploader.clearQueue(),h.error("uploader:avatar-size-exceeded"))},a.afterSuccess=function(b,d){var e=document.querySelector(".wizard-upload-avatar-box .avatar-simple-content"),f="url("+c.env.avatarBaseUrl+"/-/"+b+"-C435."+d+")";e.innerHTML="",e.style.backgroundImage=f,a.avatarId=b,i.addToAlbum({avatarId:b,ext:d,sid:c.env.sid,uid:c.env.uid}).then(function(b){a.workId=b.data.albumId},function(a){console.log("err",a)}),g(function(){a.uploader.clearQueue(),a.$digest()},0,!1)},a.afterError=function(){h.error("uploader:avatar-other-error"),g(function(){a.uploader.clearQueue(),a.$digest()},0,!1)},a.saveAvatar=function(){m(a.workId),a.nextStep(!0)},k()}]),angular.module("nxt-dialog").controller("UserThemeWizardCtrl",["$scope","ApplicationConfig",function(a,b){"use strict";var c=document.querySelector("#userBackground");if(c)var d=c.textContent;a.userThemeStep=0,a.saveTheme=function(){a.selectedTheme&&a.$broadcast("controller:settings:selectTheme",{theme:a.selectedTheme,isSave:!0}),a.nextStep(!0),a.$parent.$parent.cancelCallback=null},a.$parent.$parent.cancelCallback=function(){c&&(c.innerHTML=d),a.$broadcast("controller:settings:selectTheme",{theme:b.env.currentThemeSaved,isSave:!1})}}]),angular.module("nxt-common").run(["$templateCache",function(a){"use strict";var b={choices:'<ul class="ui-select-choices ui-select-choices-content"><li class="ui-select-choices-group" ng-class="{\'ui-select-choices-group--with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label" ng-bind-html="$group.name"></div><ul role="listbox" id="ui-select-choices-{{ $select.generatedId }}"ng-class="{\'ui-select-choices--sub\': $select.choiceGrouped($group), \'ui-select-choices--single\': !$select.choiceGrouped($group) }"><li role="option" id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}"class="ui-select-choices-row"ng-class="{\'ui-select-choices-row--highlighted\': $select.isActive(this) && !$select.isEmpty(), \'ui-select-choices-row--disabled\': $select.isDisabled(this)}"><div class="ui-select-choices-row-inner"></div></li></ul></li></ul>',match:'<a class="ui-select-match"ng-class="{\'ui-select-match--default\': $select.isEmpty()}"ng-click="$select.activate()" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="ui-select-match-chosen ui-select-match-chosen--placeholder">{{$select.placeholder}}</span><span ng-hide="$select.isEmpty()" class="ui-select-match-chosen" ng-transclude></span><abbr ng-if="$select.allowClear && !$select.isEmpty()" class="ui-select-match-choice-close" ng-click="$select.select(undefined)"></abbr><span class="ui-select-toggle" ng-click="$select.toggle($event)"><b></b></span></a>',"match-multiple":'<span class="ui-select-match"><li class="ui-select-match-item" ng-repeat="$item in $select.selected"ng-class="{\'ui-select-match-item--focus\':$select.activeMatchIndex === $index, \'ui-select-match-item--locked\':$select.isLocked(this, $index)}"><span uis-transclude-append></span><a href="javascript:;" class="ui-select-match-close" ng-click="$select.removeChoice($index)" tabindex="-1"></a></li></span>',select:'<div class="ui-select-container"ng-class="{\'ui-select-container--active ui-select-container--open\': $select.open,\'ui-select-container--disabled\': $select.disabled,\'ui-select-container--active\': $select.focus,\'ui-select-container--allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="ui-select-dropdown ui-select-dropdown--active"ng-class="{\'ui-select-dropdown--with-searchbox\': $select.searchEnabled}"ng-show="$select.open"><div class="ui-select-search-field" ng-show="$select.searchEnabled"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"role="combobox"aria-expanded="true"aria-owns="ui-select-choices-{{ $select.generatedId }}"aria-label="{{ $select.baseTitle }}"aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}"class="ui-select-search"placeholder="Filtruj"ng-model="$select.search"></div><div class="ui-select-choices"></div></div></div>',"select-multiple":'<div class="ui-select-container ui-select-multiple"ng-class="{\'ui-select-container--active ui-select-container--open\': $select.open,\'ui-select-container--disabled\': $select.disabled}"><ul class="ui-select-match-list"><span class="ui-select-match"></span><li class="ui-select-search-field"><input type="text"autocomplete="off"autocorrect="off"autocapitalize="off"spellcheck="false"role="combobox"aria-expanded="true"aria-owns="ui-select-choices-{{ $select.generatedId }}"aria-label="{{ $select.baseTitle }}"aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}"class="ui-select-search"ng-disabled="$select.disabled"ng-hide="$select.disabled"placeholder="Filtruj"ng-model="$select.search"ng-click="$select.activate()"></li></ul><div class="ui-select-dropdown ui-select-dropdown--active"ng-class="{\'ui-select-dropdown--with-searchbox\': $select.searchEnabled}"ng-show="$select.open"><div class="ui-select-choices"></div></div></div>'};Object.keys(b).forEach(function(c){a.put("selectize/"+c+".tpl.html",b[c])})}]),angular.module("nxt-dialog").run(["$rootScope","DialogManager",function(a,b){"use strict";a.$on("dialog:open",function(a,c){b.confirm({template:"/dialog/views/"+c.template+".html",success:c.success})})}]),angular.module("nxt-filter").run(["$rootScope","QuickFilter","Folder","DialogManager",function(a,b,c,d){"use strict";var e,f,g=function(a,c){var d={email:e};c&&(d.folderName=c,d.parentFolderId=f),d.folderId=a,d.email.length>0&&b.create(d)};a.$on("controller:filter:quickdialog",function(a,b){e=b.email,c.getFlatFoldersList().then(function(a){d.folderConfirm({title:"Dodaj filtr",message:"Przenoś wszystkie nowe wiadomości od tego nadawcy do:",confirm:"Dodaj",folders:a,additionalClasses:"addFilter",callback:function(a,b,c,d){var e;b&&(e=b.id,f=d),g(e,c)}})})}),a.$on("controller:filter:quick",function(a,b){b.folderId&&b.email&&(e=b.email,g(b.folderId))})}]),angular.module("nxt-notification").run(["ApplicationConfig","$rootScope","Notification",function(a,b,c){"use strict";b.$on("notification:error",function(a,b){c.error.call(c,b)}),b.$on("notification:info",function(a,b){c.info.call(c,b)}),b.$on("notification:success",function(a,b){c.success.call(c,b)})}]);